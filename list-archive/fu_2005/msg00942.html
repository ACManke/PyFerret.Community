<!-- MHonArc v2.5.13 -->
<!--X-Subject: Re: [ferret_users] Projected data -->
<!--X-From-R13: "Watb Prguxr (hvo)" <Watb.PrguxrNfghqrag.hvo.ab> -->
<!--X-Date: Tue, 18 Oct 2005 05:58:27 &#45;0700 -->
<!--X-Message-Id: 4354F164.9010201@student.uib.no -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: 20051017080333.84333.qmail@web32813.mail.mud.yahoo.com -->
<!--X-Derived: gif00061.gif -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<title>Re: [ferret_users] Projected data</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00935.html">Thread Prev</a>][<a href="msg00927.html">Thread Next</a>][<A HREF="threads.html#00942">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Projected data</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Projected data</strong></li>
<li><strong>From</strong>: <strong>&quot;Ingo Bethke (uib)&quot; &lt;<a href="mailto:Ingo.Bethke@DOMAIN.HIDDEN">Ingo.Bethke@xxxxxxxxxxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 18 Oct 2005 20:58:12 +0800</li>
<li>In-reply-to: &lt;20051017080333.84333.qmail@web32813.mail.mud.yahoo.com&gt;</li>
<li>References: &lt;20051017080333.84333.qmail@web32813.mail.mud.yahoo.com&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxxxxxxx</a></li>
<li>User-agent: Mozilla Thunderbird 1.0.7-1.1.fc4 (X11/20050929)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
Please find attached an example (I've tried to find some data which is 
similar to Tonys data). There is still a small but fixable problem where 
longitudes switch from ~360 to ~0. The sample data can be download from 
<a  href="ftp://ftp.gfi.uib.no/ingo/ferret/sample.nc.bz2">ftp://ftp.gfi.uib.no/ingo/ferret/sample.nc.bz2</a> 
<br>
Cheers, Ingo<br>
<br>
<br>
jagadish karmacharya wrote:<br>
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">Hi,<br>
will you please write and illustrative example.<br>
Thanks<br>
Jagadish 
<br>
--- &quot;Ingo Bethke (uib)&quot; &lt;Ingo.Bethke@student.uib.no&gt;<br>
wrote:<br>
<br>
 
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">Hi,<br>
<br>
If you are not happy with the default result of the<br>
3-argument versions 
of the SHADE, FILL , and CONTOUR commands you can<br>
try the POLYGON 
command in combination with the in ferret available<br>
map projections.<br>
<br>
I have tested this on curvlinear model output where<br>
the cell-corners can 
be used directly to define the polygons. However, it<br>
shouldn't be to 
difficult to define pseudo-cells (I guess that is<br>
exactly what is done 
in the SHADE command) which suit your data. The<br>
attached figures crudely 
illustrate how the result from the curvlinear output<br>
looks like.<br>
<br>
Following steps are involved:<br>
The polygon-coordinates need to be gathered in<br>
longitude and a latitude 
matrices where the first dimension corresponds to<br>
the number of points 
in each polygon and the second to your data<br>
dimension. It might be 
neccessary to check and fix the longitude<br>
information of each polygon 
(e.g.  179 and -179 -&gt; 179 and 181 ect.).  After<br>
calling the projection 
script (e.g. go mp_orthographic 0 90) you need to<br>
set the variabels mp_x 
and mp_y to your polygon longitude and latitude<br>
coordinates. Prior to 
the call of the 3-argument version of the polygon<br>
command (e.g. polygon 
x_page*mp_mask,y_page*mp_mask,sst) you might also<br>
want to call mp_aspect.<br>
<br>
The drawback of this method is that not all<br>
projection scripts are 
robust to user-defined mp_x,mp_y variables. With the<br>
exception of 
mp_orthographic I'm still trying hard to get grid<br>
lines and land masks 
right for the different projections.<br>
<br>
Hope this helps...<br>
<br>
Cheers, Ingo<br>
<br>
<br>
<br>
Ansley Manke wrote:<br>
<br>
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">Hi Tony,<br>
You can plot this data with the curvilinear forms<br>
     
<br>
</blockquote>of the plotting 
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">commands.  The variables LONGITUDE and LATITUDE<br>
     
<br>
</blockquote>are 2-dimensional 
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">curvilinear coordinate fields, so you can use this<br>
     
<br>
</blockquote>command to get the 
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">correct longitude and latitude labellings<br>
<br>
fill temperature, longitude, latitude<br>
<br>
The fact that the SHOW GRID has the axes of the<br>
     
<br>
</blockquote>variables like 
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">temperature labeled as longitude and latitude is<br>
     
<br>
</blockquote>misleading; the axes 
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">are just indices 1 to 792 and the coordinates are<br>
     
<br>
</blockquote>in the curvilinear 
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">coordinate variables.   Look at the SHOW GRID<br>
     
<br>
</blockquote>output:<br>
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">yes? show grid temperature<br>
  GRID GPI1<br>
name       axis              # pts   start        
     
<br>
</blockquote>      end<br>
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">X         LONGITUDE          792 r   1E           
     
<br>
</blockquote>      72E(792)<br>
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">Y         LATITUDE           792 r   1N           
     
<br>
</blockquote>      792N<br>
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">...<br>
<br>
It has a latitude 1 N to 792N, and longitude 1 to<br>
     
<br>
</blockquote>792 as well, which 
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">is clearly incorrect.  The curvilinear graphics<br>
     
<br>
</blockquote>commands require that 
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">the X and Y axes of the variable field such as<br>
     
<br>
</blockquote>TEMPERATURE or 
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">SALINITY, and the X and Y axes of the coordinates<br>
     
<br>
</blockquote>LONGITUDE and 
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">LATITUDE agree and then it can draw the plot.<br>
<br>
Ansley<br>
<br>
<br>
Tony Jolibois wrote:<br>
<br>
     
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">         Hi all,<br>
<br>
I have to plot some stereographic projected data<br>
       
<br>
</blockquote></blockquote>(latitude 55N to 
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">90N, projected in the netCDF), and I don't know<br>
       
<br>
</blockquote></blockquote>how I can use it with 
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">longitude and latitude (instead of x and y).<br>
<br>
Here is the ferret command I use to produce the<br>
       
<br>
</blockquote></blockquote>plot attached. The 
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">axes are not good and I can not fill the land<br>
       
<br>
</blockquote></blockquote>mask...<br>
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">[console@rdp1-jaune arc]$ ferret -nojnl<br>
       NOAA/PMEL TMAP<br>
       FERRET v5.50<br>
       Linux 2.4.3-12smp - 01/15/03<br>
       12-Oct-05 09:40<br>
<br>
yes? use<br>
       
<br>
</blockquote></blockquote>mercatorPsy3v1R1v_arc_mean_20050923_R20051005.nc<br>
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">yes? show data<br>
    currently SET data sets:<br>
   1&gt;<br>
       
<br>
</blockquote></blockquote>./mercatorPsy3v1R1v_arc_mean_20050923_R20051005.nc 
(default)<br>
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">name     title                             I    
       
<br>
</blockquote></blockquote>   J         
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">K         L<br>
TEMPERATURE<br>
         temperature                      1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">1:43      ...<br>
SALINITY salinity                         1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">1:43      ...<br>
U        zonal velocity                   1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">1:43      ...<br>
V        meridian velocity                1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">1:43      ...<br>
KZ       vertical eddy diffusivity        1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">1:43      ...<br>
LONGITUDE<br>
         longitude                        1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">...       ...<br>
LATITUDE latitude                         1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">...       ...<br>
SSH      sea surface height               1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">...       ...<br>
MLD      temperature ocean mixed layer t  1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">...       ...<br>
MLP      density ocean mixed layer thick  1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">...       ...<br>
TAUX     windstress eastward Tx componen  1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">...       ...<br>
TAUY     windstress northward Ty compone  1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">...       ...<br>
QTOT     total net heat flux              1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">...       ...<br>
EMP      water flux                       1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">...       ...<br>
QSR      surface downward solar heat flu  1:792 
       
<br>
</blockquote></blockquote>  1:792     
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">...       ...<br>
<br>
yes? show grid temperature<br>
   GRID GPI1<br>
name       axis              # pts   start      
       
<br>
</blockquote></blockquote>        end<br>
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">X         LONGITUDE          792 r   1E         
       
<br>
</blockquote></blockquote>        72E(792)<br>
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">Y         LATITUDE           792 r   1N         
       
<br>
</blockquote></blockquote>        792N<br>
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">DEPTH     DEPTH (m)           43 i-  0          
       
<br>
</blockquote></blockquote>        5500<br>
   
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">normal    T<br>
yes? set region/x=1:792/y=1:792/z=0<br>
yes? fill/levels=(-3,15,0.2) temperature<br>
<br>
Best regards,<br>
Tony<br>
<br>
--<br>
Tony Jolibois<br>
<br>
CLS - Direction Océanographie Spatiale<br>
8-10 rue hermès - 31520 Ramonville Saint-Agne<br>
tjolibois@cls.fr<br>
       
<br>
</blockquote></blockquote></blockquote>=== message truncated ===<br>
<br>
<br>
<br>
		<br>
__________________________________ 
Yahoo! Music Unlimited 
Access over 1 million songs. Try it free.<br>
<a  href="http://music.yahoo.com/unlimited/">http://music.yahoo.com/unlimited/</a><br>
 
<br>
</blockquote><pre>! example script for the use of map projections with curvlinear data 
! (2005,ingo@nersc.no) 


! access data
use sample.nc


! compute cell corners 
let lon_corner_1=0.25*ysequence(lon[i=@shf:-1,j=@shf:-1]\
                 +lon[i=@shf:-1]+lon[j=@shf:-1]+lon)
let lon_corner_2=0.25*ysequence(lon[i=@shf:+1,j=@shf:-1]\
                 +lon[i=@shf:+1]+lon[j=@shf:-1]+lon)
let lon_corner_3=0.25*ysequence(lon[i=@shf:+1,j=@shf:+1]\ 
                 +lon[i=@shf:+1]+lon[j=@shf:+1]+lon)
let lon_corner_4=0.25*ysequence(lon[i=@shf:-1,j=@shf:+1]\
                 +lon[i=@shf:-1]+lon[j=@shf:+1]+lon)

let lat_corner_1=0.25*ysequence(lat[i=@shf:-1,j=@shf:-1]\
                 +lat[i=@shf:-1]+lat[j=@shf:-1]+lat)
let lat_corner_2=0.25*ysequence(lat[i=@shf:+1,j=@shf:-1]\
                 +lat[i=@shf:+1]+lat[j=@shf:-1]+lat)
let lat_corner_3=0.25*ysequence(lat[i=@shf:+1,j=@shf:+1]\ 
                 +lat[i=@shf:+1]+lat[j=@shf:+1]+lat)
let lat_corner_4=0.25*ysequence(lat[i=@shf:-1,j=@shf:+1]\
                 +lat[i=@shf:-1]+lat[j=@shf:+1]+lat)


! concatenate cell corners
let lon_corner_12=xcat(lon_corner_1,lon_corner_2)
let lon_corner_123=xcat(lon_corner_12,lon_corner_3)
let lon_corners=xcat(lon_corner_123,lon_corner_4)

let lat_corner_12=xcat(lat_corner_1,lat_corner_2)
let lat_corner_123=xcat(lat_corner_12,lat_corner_3)
let lat_corners=xcat(lat_corner_123,lat_corner_4)


! mask bad corners (ideally these should be replaced...) 
let mask_corners=if (abs(ysequence(lon)-lon_corners) lt 10) then 1 


! select a time slice and reshape data
set variable /bad=0 fice
let field=ysequence(fice[l=1])


! run projection script 
go mp_orthographic -20 70 


! draw global basemap 
use levitus_climatology 
let dummy=x[g=temp]+y[g=temp]
set grid temp
go mp_aspect
fill /nolab/noaxis/nokey/palette=blue dummy,x_page,y_page
go mp_fland 20 greyscale overlay detailed 
cancel data levitus_climatology.cdf


! plot polygons 
let mp_x=lon_corners*mask_corners
let mp_y=lat_corners*mask_corners
poly /ov/nolab/nokey/noaxis/palette=bluescale/levels=20 \
     x_page*mp_mask,y_page*mp_mask,field


! draw graticules
use levitus_climatology 
set grid temp
go mp_graticule
cancel data levitus_climatology.cdf


! print result
!frame /file=sample.gif 


</pre>
<p><a href="gif00061.gif" ><img src="gif00061.gif" alt="GIF image"></a></p>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00935.html">Re: [ferret_users] Projected data</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00927.html">[ferret_users] Re: ferret -script and arguments</a></strong>
</li>

</UL>
<center>[<a href="msg00935.html">Thread Prev</a>][<a href="msg00927.html">Thread Next</a>][<A HREF="threads.html#00942">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<hr>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> / 
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://tmap.pmel.noaa.gov">TMAP</a>
</address> <br> <a href="http://ferret.pmel.noaa.gov/Ferret/ferret_contact_us.html">Contact Us</a> | <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 
</font>
<!--X-User-Footer-End-->
</body>
</html>
