<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [ferret_users] Calculation of Meridional Overturning Circulation -->
<!--X-From-R13: [vpunry Yyvcuhvf <z.xyvcuhvfNhh.ay> -->
<!--X-Date: Wed, 20 Jan 2010 07:35:21 &#45;0800 -->
<!--X-Message-Id: D851940D&#45;83BE&#45;49FA&#45;80EF&#45;AD78C6C7B913@uu.nl -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 64650818A3A8FE49BCB9B0835918FD795C0063@uu01msg&#45;exb05.soliscom.uu.nl -->
<!--X-Reference: 702E446F&#45;67B7&#45;48DF&#45;9C68&#45;E0ABF3F9D3FD@ucar.edu -->
<!--X-Derived: png2KSlKIGTIn.png -->
<!--X-Derived: pngTXP0e40n8Q.png -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Calculation of Meridional Overturning Circulation</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00030.html">Thread Prev</a>][<a href="msg00028.html">Thread Next</a>][<A HREF="threads.html#00037">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Calculation of Meridional Overturning Circulation</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Gary Strand &lt;<a href="mailto:strandwg@DOMAIN.HIDDEN">strandwg@xxxxxxxx</a>&gt;, Ansley Manke &lt;<a href="mailto:Ansley.B.Manke@DOMAIN.HIDDEN">Ansley.B.Manke@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Calculation of Meridional Overturning Circulation</strong></li>
<li><strong>From</strong>: <strong>Michael Kliphuis &lt;<a href="mailto:m.kliphuis@DOMAIN.HIDDEN">m.kliphuis@xxxxx</a>&gt;</strong></li>
<li>Date: Wed, 20 Jan 2010 16:30:29 +0100</li>
<li>Cc: Russell Fiedler &lt;<a href="mailto:russell.fiedler@DOMAIN.HIDDEN">russell.fiedler@xxxxxxxx</a>&gt;,        Olivier Marti &lt;<a href="mailto:olivier.marti@DOMAIN.HIDDEN">olivier.marti@xxxxxxxxxxxx</a>&gt;, <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></li>
<li>In-reply-to: &lt;<a href="mailto:702E446F-67B7-48DF-9C68-E0ABF3F9D3FD@DOMAIN.HIDDEN">702E446F-67B7-48DF-9C68-E0ABF3F9D3FD@xxxxxxxx</a>&gt;</li>
<li>References:  &lt;<a href="mailto:64650818A3A8FE49BCB9B0835918FD795C0063@DOMAIN.HIDDEN">64650818A3A8FE49BCB9B0835918FD795C0063@xxxxxxxxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:702E446F-67B7-48DF-9C68-E0ABF3F9D3FD@DOMAIN.HIDDEN">702E446F-67B7-48DF-9C68-E0ABF3F9D3FD@xxxxxxxx</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td style="">
<div>Dear Gary, Russel, Olivier and Ansley,</div><div><br></div><div>I've been travelling so was not able to check your suggestions yet&nbsp;</div><div>but thank you very much for your help. Ansley to start with you:&nbsp;</div><div><br></div><div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: 12.0px Helvetica">&gt; Have you looked at plots of the regridded data, and compared with a plot of the data on a curvilinear grid?&nbsp; Does the regridded data look&nbsp;</font></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: 12.0px Helvetica">&gt; wrong?&nbsp; What do you mean that the results are "very different"? Are they way off in character, or in magnitude or what?</font></div></div><div><br></div>Yes the data looks the same after regridding so I guess the CURV_TO_RECT function is not the problem. Attached are 2 plots of the&nbsp;<div>global MOC as it should be (calculated by POP) and the MOC that I calculated via meridional velocity VVEL with the Ferret script that I showed in an earlier mail. You see that the 0-contours look very similar and the range of the colour labels is also not far off but still it's obvious that the results are different.</div><div><br></div><div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: 12.0px Helvetica">&gt; Another tack you might take is to do the calculation in Ferret on the native curvilinear grid - I the tripolar grid has grid cell edges that one could &gt; create (sum of data* box sizes)/ (sum of box sizes)&nbsp; being careful to do the calculation with the box sizes in radians and applying a&nbsp;</font></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><font face="Helvetica" size="3" style="font: 12.0px Helvetica">&gt; cosine(latitude) correction.&nbsp;</font></div></div><div><br></div><div>Oke I did not try this yet but then I will get an x axis with j-values and loose the axis with latitudes in degrees right ?</div><div><br></div><div>Then Russel:</div><div><br></div><div>I tried your missing values theory e.g. setting missing (land) values to zero. I was very hopeful because my land values were indeed&nbsp;</div><div>not 0 but 9.96e+36 but unfortunately it did not make any difference.</div><div><br></div><div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">&gt;Also, (though this may be irrelevant since I'm not familiar with POP) is VVEL the true North/South velocity</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">&gt;or is it the component along the grid?</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; ">As far as I know it is indeed the true North/South velocity</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">&gt;Any contribution due to variable cell thickness (e.g. free surfaces, partial cells) will also be missed using the</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">&gt;standard Ferret integrations.</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">&gt;It may be better (but tedious) to perform the integration in a manner consistent with the original code and then</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">&gt;regrid the result.</div></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Both comments very true and especially the last one. That is why I followed the answer from Gary Strand from NCAR and got in contact&nbsp;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">with Mat Maltrud from LANL. He sent me the piece of Fortran code that Gary mentioned and I'm now finally able to calculate the MOC&nbsp;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">(global, atlantic and indo-pacific) for the POP model of CCSM3.&nbsp;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Gary, you also said:</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">&gt; It's also preferable to let POP compute MOC as POP is running, rather than from the output data. POP is more accurate.</div></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">That is true but POP then does not calculate the MOC for the Indo-Pacific ocean (the fortran code does)&nbsp;and I really need that.&nbsp;</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Cheers,</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">-- Michael</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><br></div><div><br></div></div><div><br></div><div><br></div><div><img src="png2KSlKIGTIn.png"><img src="pngTXP0e40n8Q.png">&nbsp;</div><div><div><br></div><div><br><div><div>On Jan 13, 2010, at 12:19 AM, Gary Strand wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">It's not easy to compute MOC from CCSM3 POP - we here at NCAR use a piece of Fortran code, to avoid remapping to a regular grid, which can strongly change the answers.</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">It's also preferable to let POP compute MOC as POP is running, rather than from the output data. POP is more accurate.</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">On Tue Jan 12, 2010, at 3:29 PM, Kliphuis, M. (Michael) wrote:</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div> <blockquote type="cite"><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Dear ferreter's</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">I am having big problems in calculating the meridional overturning</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">for the POP ocean model of CCSM3. POP is defined on a curvilinear</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">grid so I figured that the way to do this is to first convert this grid</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">to a rectangular grid with Ferret's CURV_TO_RECT function.</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">I created a file map_deg_control.nc containing the weights for the</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">mapping with help of the user's guide.</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">After that I calculated the MOC with the .jnl script below. It is possible to let POP</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">output the MOC field so I was able to check if my own calculated MOC</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">was good but the fields are very different.</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">I think that something goes wrong with the conversion from curvilinear to</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">a rectangular grid so I looked for other ways to do this e.g. with NCO or CDO</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">but I could not find anything.</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Are there people who have experience with the calculation of<span class="Apple-converted-space">&nbsp; </span>the MOC for POP output from CCSM3 ?</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Kind regards,</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Michael</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">!------------------------------------</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">! my moc.jnl script</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">!------------------------------------</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">! read file containing meridional velocity VVEL</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">use reversed_rotation_pd.pop.h.0300-01_vvel_world.nc</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">! Determine velocity on rectangular LON-LAT grid</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">! Apply mapping to variables</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">USE "umap_deg_control.nc"</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">LET vnew = curv_to_rect(VVEL[D=1], map[D=2])</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">! Save variable + grid to a file</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">save/clobber/file=basinshelp.nc vnew</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">! Now determine moc</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">cancel data/all</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">cancel var/all</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">use basinshelp.nc</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">! divide by 1.e8 for conversion from cm^3/sec to Sv</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">let vdash = vnew/1.e8</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">! do the integration</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">let moc = vdash[x=@din,z=@iin] - vdash[x=@din,z=@din]</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">shade/nolab moc</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">contour/ov/nolab moc</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">label/nou 4 6.5 0 0 .25 MOC (Sv)</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div> </blockquote><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; ">Gary Strand</div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; "><a rel="nofollow" href="mailto:strandwg@xxxxxxxx">strandwg@xxxxxxxx</a></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; min-height: 14px; "><br></div> </blockquote></div><br></div></div></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00026" href="msg00026.html">[ferret_users] Calculation of Meridional Overturning Circulation</a></strong>
<ul><li><em>From:</em> Kliphuis, M. (Michael)</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00030.html">Re: [ferret_users] Calculation of Meridional Overturning Circulation</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00028.html">[ferret_users]contour concentric circles - bivariate PDF</a></strong>
</li>

</UL>
<center>[<a href="msg00030.html">Thread Prev</a>][<a href="msg00028.html">Thread Next</a>][<A HREF="threads.html#00037">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<hr>
<A HREF="ferret_contact_us.html">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> / 
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://tmap.pmel.noaa.gov">TMAP</a>
</address>
<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 
</font>
<!--X-User-Footer-End-->
</body>
</html>
