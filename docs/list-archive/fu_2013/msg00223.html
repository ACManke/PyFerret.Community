<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] LEVITUS Ocean Data/FERRET shows differing results -->
<!--X-From-R13: Oafyrl [naxr <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Mon, 25 Mar 2013 14:42:50 &#45;0700 -->
<!--X-Message-Id: 5150C30C.2030808@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: BAY170&#45;W12243476FE052A560CAABEEA5D60@phx.gbl -->
<!--X-Reference: DBF01CD1&#45;CD49&#45;4816&#45;BE20&#45;7621960335FF@lsce.ipsl.fr -->
<!--X-Reference: BAY170&#45;W121E6B2776C8CFDB310106EA5D60@phx.gbl -->
<!--X-Reference: 839518F0&#45;A411&#45;472D&#45;8B26&#45;C0D3223A1192@lsce.ipsl.fr -->
<!--X-Reference: BAY170&#45;W4007320621A24E7C1B2860A5D70@phx.gbl -->
<!--X-Reference: 51509A41.9010705@noaa.gov -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] LEVITUS Ocean Data/FERRET shows differing results</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00222.html">Thread Prev</a>][<a href="msg00224.html">Thread Next</a>][<A HREF="threads.html#00223">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] LEVITUS Ocean Data/FERRET shows differing results</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Star Physicist &lt;<a href="mailto:couragetoknowgc@DOMAIN.HIDDEN">couragetoknowgc@xxxxxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] LEVITUS Ocean Data/FERRET shows differing results</strong></li>
<li><strong>From</strong>: <strong>Ansley Manke &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Mon, 25 Mar 2013 14:35:08 -0700</li>
<li>Cc: &quot;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&quot; &lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;</li>
<li>In-reply-to: &lt;<a href="msg00222.html">51509A41.9010705@noaa.gov</a>&gt;</li>
<li>List-archive: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/?hl=en_US">http://groups.google.com/a/noaa.gov/group/ferret_users/?hl=en_US</a>&gt;</li>
<li>List-help: &lt;<a href="http://support.google.com/a/noaa.gov/bin/topic.py?hl=en_US&topic=25838">http://support.google.com/a/noaa.gov/bin/topic.py?hl=en_US&topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/post?hl=en_US">http://groups.google.com/a/noaa.gov/group/ferret_users/post?hl=en_US</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe?hl=en_US">http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe?hl=en_US</a>&gt;, &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00215.html">BAY170-W12243476FE052A560CAABEEA5D60@phx.gbl</a>&gt;,&lt;<a href="msg00216.html">DBF01CD1-CD49-4816-BE20-7621960335FF@lsce.ipsl.fr</a>&gt; &lt;<a href="msg00217.html">BAY170-W121E6B2776C8CFDB310106EA5D60@phx.gbl</a>&gt;,&lt;<a href="msg00218.html">839518F0-A411-472D-8B26-C0D3223A1192@lsce.ipsl.fr</a>&gt; &lt;<a href="msg00219.html">BAY170-W4007320621A24E7C1B2860A5D70@phx.gbl</a>&gt; &lt;<a href="msg00222.html">51509A41.9010705@noaa.gov</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:17.0) Gecko/20130307 Thunderbird/17.0.4</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    Hi Mubashar,<br>
    I thought about it some more.&nbsp; In this case it is the location of
    missing data that's causing the difference in how these averages are
    computed.<br>
    <br>
    Here's an example that I think shows what is happening with these
    averages. It comes from the fact that you're in a basin where at
    different XY locations there are different number of Z levels with
    good data.&nbsp; It will be up to you to decide what calculation to use,
    based on what kind of average operation you want to do with this
    data.<br>
    <br>
    <br>
    If we were out in the open ocean, where there is data all the way
    down, you would not see the difference.<br>
    <br>
    <blockquote><tt>yes?&nbsp; use levitus_climatology</tt><br>
      <tt><br>
      </tt><tt><br>
      </tt><tt>&nbsp; ! Define an XY average</tt><tt> and a Z average
        variable<br>
        <br>
      </tt><tt>yes? let zave = temp[k=1:16@ave]</tt><tt><br>
      </tt><tt>yes? let xyave = temp[x=330:340@ave,y=-5:5@ave]</tt><tt><br>
      </tt><tt><br>
      </tt><tt>&nbsp; ! </tt><tt>Compare the z average of the XY average,
        and the XY average of the Z ave.</tt><tt><br>
        <br>
      </tt><tt>yes? list xyave[k=1:16@ave],&nbsp;
        zave[x=330:340@ave,y=-5:5@ave]</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DATA SET:
        /home/users/tmap/ferret/linux/fer_dsets/data/levitus_climatology.cdf</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LONGITUDE: 30W to 20W</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LATITUDE: 5S to 5N</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DEPTH (m): 0 to 1750</tt><tt><br>
      </tt><tt>&nbsp;Column&nbsp; 1: XYAVE[Z=@AVE] is
        TEMP[X=330:340@AVE,Y=-5:5@AVE]</tt><tt><br>
      </tt><tt>&nbsp;Column&nbsp; 2: ZAVE[X=@AV4,Y=@AV4] is TEMP[K=1:16@AVE]</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; XYAVE&nbsp;&nbsp; ZAVE</tt><tt><br>
      </tt><tt>I / *:&nbsp;&nbsp;&nbsp;&nbsp; 7.185&nbsp; 7.185</tt><br>
      <br>
    </blockquote>
    Look at a slice of data in the region you're working with. At some
    locations the data goes deeper than others:<br>
    <br>
    <tt>yes? list/y=19.5 /k=1:16/x=35e:45e temp<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VARIABLE : TEMPERATURE (DEG C)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FILENAME : levitus_climatology.cdf<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FILEPATH :
      /home/users/tmap/ferret/linux/fer_dsets/data/<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUBSET&nbsp;&nbsp; : 10 by 16 points (LONGITUDE-DEPTH (m))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LATITUDE : 19.5N<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 35.5E&nbsp; 36.5E&nbsp; 37.5E&nbsp; 38.5E&nbsp; 39.5E&nbsp; 40.5E&nbsp; 41.5E&nbsp;
      42.5E&nbsp; 43.5E&nbsp; 44.5E <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16&nbsp;&nbsp;&nbsp;&nbsp; 17&nbsp;&nbsp;&nbsp;&nbsp; 18&nbsp;&nbsp;&nbsp;&nbsp; 19&nbsp;&nbsp;&nbsp;&nbsp; 20&nbsp;&nbsp;&nbsp;&nbsp; 21&nbsp;&nbsp;&nbsp;&nbsp; 22&nbsp;&nbsp;&nbsp;&nbsp;
      23&nbsp;&nbsp;&nbsp;&nbsp; 24&nbsp;&nbsp;&nbsp;&nbsp; 25<br>
      &nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /&nbsp; 1:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 28.90&nbsp; 29.12&nbsp; 29.25&nbsp; 29.28&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /&nbsp; 2:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 28.76&nbsp; 28.98&nbsp; 29.12&nbsp; 29.15&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /&nbsp; 3:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 28.59&nbsp; 28.78&nbsp; 28.85&nbsp; 28.78&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /&nbsp; 4:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 28.38&nbsp; 28.54&nbsp; 28.55&nbsp; 28.38&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /&nbsp; 5:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 27.80&nbsp; 27.70&nbsp; 27.39&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;75&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /&nbsp; 6:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 26.10&nbsp; 26.15&nbsp; 26.08&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;100&nbsp;&nbsp;&nbsp;&nbsp; /&nbsp; 7:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 24.50&nbsp; 24.49&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;150&nbsp;&nbsp;&nbsp;&nbsp; /&nbsp; 8:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 22.68&nbsp; 22.60&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;200&nbsp;&nbsp;&nbsp;&nbsp; /&nbsp; 9:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 21.98&nbsp; 21.98&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;300&nbsp;&nbsp;&nbsp;&nbsp; / 10:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 21.67&nbsp; 21.54&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;400&nbsp;&nbsp;&nbsp;&nbsp; / 11:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 21.57&nbsp; 21.42&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;600&nbsp;&nbsp;&nbsp;&nbsp; / 12:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 20.71&nbsp; 20.58&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;800&nbsp;&nbsp;&nbsp;&nbsp; / 13:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 21.65&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;1000&nbsp;&nbsp;&nbsp; / 14:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 21.67&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;1200&nbsp;&nbsp;&nbsp; / 15:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      &nbsp;1500&nbsp;&nbsp;&nbsp; / 16:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp;&nbsp;
      ....&nbsp;&nbsp; ....&nbsp;&nbsp; ....<br>
      <br>
      <br>
    </tt>I'll define a simpler variable with more extreme variation so
    we can really see what's going on.<tt><br>
      <br>
    </tt>
    <blockquote><tt>&nbsp; ! define a synthetic variable in X and Z</tt><br>
      <br>
      <tt>yes? let var =
        {41,42,43,44,45,,32,33,34,35,,22,23,24,,,,13,14,}</tt><br>
      <tt>yes? def axis/z/depth zax =&nbsp; {5,15,25,50}</tt><br>
      <tt>yes? def axis/x=31:39:2/units=degrees_east&nbsp; xax</tt><br>
      <tt>yes? let xzvar = x[gx=xax]+z[gz=zax]</tt><br>
      <tt>yes? let var_xz = reshape(var,xzvar)</tt><br>
      <br>
      <tt>yes? list var_xz</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VARIABLE : RESHAPE(VAR,XZVAR)</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUBSET&nbsp;&nbsp; : 5 by 4 points (LONGITUDE-Z)</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 31E&nbsp;&nbsp;&nbsp; 33E&nbsp;&nbsp;&nbsp; 35E&nbsp;&nbsp;&nbsp; 37E&nbsp;&nbsp;&nbsp; 39E&nbsp;&nbsp; </tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5</tt><br>
      <tt>&nbsp;5&nbsp;&nbsp;&nbsp; / 1:&nbsp; 41.00&nbsp; 42.00&nbsp; 43.00&nbsp; 44.00&nbsp; 45.00</tt><br>
      <tt>&nbsp;15&nbsp;&nbsp; / 2:&nbsp;&nbsp; ....&nbsp; 32.00&nbsp; 33.00&nbsp; 34.00&nbsp; 35.00</tt><br>
      <tt>&nbsp;25&nbsp;&nbsp; / 3:&nbsp;&nbsp; ....&nbsp; 22.00&nbsp; 23.00&nbsp; 24.00&nbsp;&nbsp; ....</tt><br>
      <tt>&nbsp;50&nbsp;&nbsp; / 4:&nbsp;&nbsp; ....&nbsp;&nbsp; ....&nbsp; 13.00&nbsp; 14.00&nbsp;&nbsp; ....</tt><br>
      <br>
      <tt>&nbsp; ! The average over x and the average over Z</tt><br>
      <br>
      <tt>yes? let xave =&nbsp; var_xz[x=30:40@ave]</tt><br>
      <tt>yes? let zave =&nbsp; var_xz[k=1:4@ave]</tt><br>
      <br>
      <tt>&nbsp; ! Here is the depth average, each column averaged. The
        locations with more</tt><br>
      <tt>&nbsp; !</tt><tt> depth data</tt><tt> have lower values</tt><br>
      <br>
      <tt>yes? list/order=x zave</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VARIABLE : VAR_XZ[K=1:4@AVE]</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUBSET&nbsp;&nbsp; : 5 points (LONGITUDE)</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 0 to 62.5</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 31E&nbsp;&nbsp;&nbsp; 33E&nbsp;&nbsp;&nbsp; 35E&nbsp;&nbsp;&nbsp; 37E&nbsp;&nbsp;&nbsp; 39E&nbsp;&nbsp; </tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 41.00&nbsp; 30.00&nbsp; 23.80&nbsp; 24.80&nbsp; 40.00</tt><br>
      <br>
      <tt>&nbsp; ! Here is the average across each row.</tt><br>
      <br>
      <tt>yes? list xave</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VARIABLE : VAR_XZ[X=30:40@AVE]</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUBSET&nbsp;&nbsp; : 4 points (Z)</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LONGITUDE: 30E to 40E</tt><br>
      <tt>&nbsp;5&nbsp;&nbsp;&nbsp; / 1:&nbsp; 43.00</tt><br>
      <tt>&nbsp;15&nbsp;&nbsp; / 2:&nbsp; 33.50</tt><br>
      <tt>&nbsp;25&nbsp;&nbsp; / 3:&nbsp; 23.00</tt><br>
      <tt>&nbsp;50&nbsp;&nbsp; / 4:&nbsp; 13.50</tt><tt></tt><br>
      <br>
      <tt>&nbsp; ! The average of the column-average is not the same as the
        average of the row-average.</tt><br>
      <br>
      <tt><tt>yes? list/noheader zave[x=30:40@ave], xave[k=1:4@ave]</tt></tt><br>
      <tt><tt>I / *:&nbsp;&nbsp;&nbsp;&nbsp; 31.92&nbsp; 24.08</tt></tt><br>
    </blockquote>
    <tt><tt><br>
      </tt></tt><tt><tt><br>
        <br>
      </tt></tt>
    <div class="moz-cite-prefix">On 3/25/2013 11:41 AM, Ansley Manke
      wrote:<br>
    </div>
    <blockquote cite="" type="cite">
      
      Hi,<br>
      This is discussed in the documentation. All Ferret calculations
      take into account data marked as missing. <br>
      <br>
      I think the differences you are seeing has to do with the order of
      operations, and the weighting that the average transformation
      does. Averages use cell size to compute a weighted average, and
      also apply a correction for the variation in the size of
      longitude/latitude grid boxes depending on the location in
      latitude on the Earth.&nbsp; If it were an unweighted average then the
      order of operations would not matter. <br>
      <br>
      You could do an integral as Olivier suggests, but I don't think
      that's necessary.&nbsp; Do it like this, and Ferret will weight the
      calculation by the size of the grid boxes or parts of grid boxes
      in the region you have specified, where there is valid data:<br>
      <br>
      &nbsp; &nbsp;&nbsp; let redSea = t_an[k=1:16@ave,x=30E:45E@ave,y=10N:30N@ave]<br>
      <br>
      Here are some of the relevant pieces of documentation:<br>
      <br>
      <a rel="nofollow" moz-do-not-send="true" class="moz-txt-link-freetext"
href="http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/XPRESSIONS#_VPINDEXENTRY_439">http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/XPRESSIONS#_VPINDEXENTRY_439</a><br>
      <blockquote><i><b>@AVE&#8212;average</b></i>
        <p align="left"><i><b>The transformation @AVE computes the
              average weighted by grid box size&#8212;a single number
              representing the average of the variable between two
              endpoints.</b></i></p>
        <p align="left"><i><b>If @AVE is specified simultaneously on
              multiple axes the calculation will be performed as a
              multiple integration rather than as sequential single
              integrations. The output will document this fact by
              showing @AV4 or "XY ave" as the transformation.<br>
            </b></i></p>
        <p align="left"><i><b>See the </b></i><i><b><a rel="nofollow"
                moz-do-not-send="true"
href="http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/XPRESSIONS#GeneralInfo">General

                Information</a></b></i><i><b> on transformations for
              important details about this transformation. In
              particular, note the discussion about specifying the
              averaging interval in world coordinates, e.g. longitude,
              meters, time as in var[x=3.4:4.6@AVE] versus specifying
              the interval using indices, as in var[I=4:12@AVE]. When
              the interval is expressed in world coordinates, the
              weighting is done using partial grid boxes at the edges of
              the interval. If the interval is expressed using indices,
              the entire grid cells contribute to the weights.</b></i></p>
      </blockquote>
      That link to the General Information about transformations also
      contains important information.<b><br>
      </b><br>
      <strong><a rel="nofollow" moz-do-not-send="true" title="averages/integrals on the
          sphere"
href="http://ferret.pmel.noaa.gov/Ferret/faq/averages-integrals-on-the-sphere">How

          does Ferret compute averages and integrals on the surface of
          the surface of the earth?</a></strong><br>
      <br>
      <div class="moz-cite-prefix"><br>
        <br>
        Ansley<br>
        <br>
        <br>
        On 3/25/2013 9:53 AM, Star Physicist wrote:<br>
      </div>
      <blockquote cite=""
        type="cite">
        
        <div dir="ltr">Do you think if my NETCDF file has missing value
          flag, FERRET considers it in calculation? Could you please
          slightly elaborat ewhy do we need RedSea_Mask and how it is
          working to compute volume? I am pasting some part of ncdump -h
          of my data as follows:<br>
          <br>
          ncdump -h
tanom_1955-2004_missing_value.ncA/TANOM/ftp.nodc.noaa.gov/pub/WOD/SELECT/CDOME<br>
          netcdf tanom_1955-2004_missing_value {<br>
          dimensions:<br>
          &nbsp;&nbsp;&nbsp; gsize = 2 ;<br>
          &nbsp;&nbsp;&nbsp; lon = 360 ;<br>
          &nbsp;&nbsp;&nbsp; nb2 = 2 ;<br>
          &nbsp;&nbsp;&nbsp; lat = 180 ;<br>
          &nbsp;&nbsp;&nbsp; depth = 16 ;<br>
          &nbsp;&nbsp;&nbsp; time = UNLIMITED ; // (200 currently)<br>
          variables:<br>
          &nbsp;&nbsp;&nbsp; float lon(lon) ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; lon:standard_name = "longitude" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; lon:long_name = "longitude" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; lon:units = "degrees_east" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; lon:axis = "X" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; lon:bounds = "lon_bnds" ;<br>
          &nbsp;&nbsp;&nbsp; float lon_bnds(lon, nb2) ;<br>
          &nbsp;&nbsp;&nbsp; float lat(lat) ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; lat:standard_name = "latitude" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; lat:long_name = "latitude" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; lat:units = "degrees_north" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; lat:axis = "Y" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; lat:bounds = "lat_bnds" ;<br>
          &nbsp;&nbsp;&nbsp; float lat_bnds(lat, nb2) ;<br>
          &nbsp;&nbsp;&nbsp; float depth(depth) ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; depth:units = "meters" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; depth:axis = "Z" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; depth:bounds = "depth_bnds" ;<br>
          &nbsp;&nbsp;&nbsp; float depth_bnds(depth, nb2) ;<br>
          &nbsp;&nbsp;&nbsp; double time(time) ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; time:standard_name = "time" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; time:units = "months since 1955-01-01 00:00:00" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; time:calendar = "standard" ;<br>
          &nbsp;&nbsp;&nbsp; float climatology_bounds(time, gsize) ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; climatology_bounds:comment = "This variable defines
          the bounds of the climatological time period for each time" ;<br>
          &nbsp;&nbsp;&nbsp; float t_an(time, depth, lat, lon) ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; t_an:long_name = "Objectively Analyzed Mean" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; t_an:units = "degrees_celsius" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; t_an:comment = "Objectively analyzed climatologies are
          the objectively interpolated mean fields for an oceanographic
          variable at standard depth levels for the World Ocean." ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; t_an:cell_methods = "area:mean depth:mean time:mean" ;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; t_an:missing_value = 9.96921e+36f ;<br>
          <br>
          Thanks,<br>
          <br>
          Mubashar<br>
          <br>
          <div>
            <hr id="stopSpelling">From: <a rel="nofollow" moz-do-not-send="true"
              class="moz-txt-link-abbreviated"
              href="mailto:olivier.marti@xxxxxxxxxxxx">olivier.marti@xxxxxxxxxxxx</a><br>
            Subject: Re: [ferret_users] LEVITUS Ocean Data/FERRET shows
            differing results<br>
            Date: Sun, 24 Mar 2013 18:44:03 +0100<br>
            To: <a rel="nofollow" moz-do-not-send="true"
              class="moz-txt-link-abbreviated"
              href="mailto:ferret_users@xxxxxxxx">ferret_users@xxxxxxxx</a>;
            <a rel="nofollow" moz-do-not-send="true" class="moz-txt-link-abbreviated"
              href="mailto:couragetoknowgc@xxxxxxxxxxx">couragetoknowgc@xxxxxxxxxxx</a><br>
            <br>
            <br>
            <div>
              <div>Le 24 mars 2013 &agrave; 18:24, Star Physicist a &eacute;crit :</div>
              <br class="ecxApple-interchange-newline">
              <blockquote><span class="ecxApple-style-span"
                  style="border-collapse: separate; font-family: 'Lucida
                  Grande'; font-style: normal; font-variant: normal;
                  font-weight: normal; letter-spacing: normal;
                  line-height: normal; orphans: 2; text-indent: 0px;
                  text-transform: none; white-space: normal; widows: 2;
                  word-spacing: 0px; font-size: medium;"><span
                    class="ecxApple-style-span" style="font-family:
                    Calibri; font-size: 16px;">Which way I should
                    proceed then? How could I overcome this issue?
                    Actually there is a function in CDO for vertical
                    averaging over all grid points called "cdo vertmean
                    ifile ofile" but I don't know whether it can handle
                    bottom shallower sea level. Any suggestion?<br>
                  </span></span></blockquote>
              <br>
            </div>
            <div>You should compute a full 3D integral, not 1D/2D ou
              2D/1D :</div>
            <div><br>
            </div>
            <div>
              <div><br>
              </div>
              <div>USE tanom_1955-2004_missing_value.nc</div>
              <div><br>
              </div>
              <div>! Compute a Red Sea mask. Data dependant, what do you
                have for missing value ?</div>
              <div>LET RedSea_mask = IF t_an GT -100 THEN 1 ! Use an ad
                hoc criterion, depending of your data</div>
              <div><br>
              </div>
              <div>! Integrate temperature</div>
              <div>LET RedSea_Temp =
                t_an[K=1:16@DIN,x=30E:45E@DIN,y=10N:30N@DIN]</div>
              <div><br>
              </div>
              <div>! Integrate volume</div>
              <div>LET RedSea_Vol =
                RedSea_mask[K=1:16@DIN,x=30E:45E@DIN,y=10N:30N@DIN]</div>
              <div><br>
              </div>
              <div>LET anom = RedSea_Temp / RedSea_Vol&nbsp;</div>
              <div><br>
              </div>
            </div>
            <br>
            <div>
              <div style="word-wrap: break-word;"><span
                  class="ecxApple-style-span" style="border-collapse:
                  separate; color: rgb(0, 0, 0); font-family: 'Lucida
                  Grande'; font-variant: normal; font-weight: normal;
                  letter-spacing: normal; line-height: normal; orphans:
                  2; text-indent: 0px; text-transform: none;
                  white-space: normal; widows: 2; word-spacing: 0px;
                  font-size: medium;">
                  <div style="word-wrap: break-word;"><span
                      class="ecxApple-style-span"
                      style="border-collapse: separate; color: rgb(0, 0,
                      0); font-variant: normal; letter-spacing: normal;
                      line-height: normal; orphans: 2; text-indent: 0px;
                      text-transform: none; white-space: normal; widows:
                      2; word-spacing: 0px;">
                      <div style="word-wrap: break-word;"><span
                          class="ecxApple-style-span"
                          style="border-collapse: separate; color:
                          rgb(0, 0, 0); font-variant: normal;
                          letter-spacing: normal; line-height: normal;
                          orphans: 2; text-indent: 0px; text-transform:
                          none; white-space: normal; widows: 2;
                          word-spacing: 0px;">
                          <div style="word-wrap: break-word;"><span
                              class="ecxApple-style-span"
                              style="border-collapse: separate; color:
                              rgb(0, 0, 0); font-variant: normal;
                              letter-spacing: normal; line-height:
                              normal; orphans: 2; text-indent: 0px;
                              text-transform: none; white-space: normal;
                              widows: 2; word-spacing: 0px;">
                              <div style="word-wrap: break-word;"><span
                                  class="ecxApple-style-span"
                                  style="border-collapse: separate;
                                  color: rgb(0, 0, 0); font-variant:
                                  normal; letter-spacing: normal;
                                  line-height: normal; orphans: 2;
                                  text-indent: 0px; text-transform:
                                  none; white-space: normal; widows: 2;
                                  word-spacing: 0px;">
                                  <div style="word-wrap: break-word;"><span
                                      class="ecxApple-style-span"
                                      style="border-collapse: separate;
                                      color: rgb(0, 0, 0); font-variant:
                                      normal; letter-spacing: normal;
                                      line-height: normal; orphans: 2;
                                      text-indent: 0px; text-transform:
                                      none; white-space: normal; widows:
                                      2; word-spacing: 0px;">
                                      <div style="word-wrap:
                                        break-word;"><span
                                          class="ecxApple-style-span"
                                          style="border-collapse:
                                          separate; color: rgb(0, 0, 0);
                                          font-variant: normal;
                                          letter-spacing: normal;
                                          line-height: normal; orphans:
                                          2; text-indent: 0px;
                                          text-transform: none;
                                          white-space: normal; widows:
                                          2; word-spacing: 0px;">
                                          <div style="word-wrap:
                                            break-word;"><span
                                              class="ecxApple-style-span"
                                              style="border-collapse:
                                              separate; color: rgb(0, 0,
                                              0); font-variant: normal;
                                              letter-spacing: normal;
                                              line-height: normal;
                                              orphans: 2; text-indent:
                                              0px; text-transform: none;
                                              white-space: normal;
                                              widows: 2; word-spacing:
                                              0px;">
                                              <div style="word-wrap:
                                                break-word;">
                                                <div>
                                                  <div style="font-size:
                                                    11px;">
                                                    <div
                                                      style="font-style:
                                                      normal;
                                                      font-family:
                                                      Helvetica;">--&nbsp;</div>
                                                    <div
                                                      style="font-style:
                                                      normal;"><b
                                                        style="font-family:
                                                        Helvetica;">Dr.
                                                        Olivier Marti</b><font
class="ecxApple-style-span" face="Helvetica"><span
                                                          class="ecxApple-converted-space">&nbsp;</span>&nbsp;-<span
class="ecxApple-converted-space">&nbsp;</span></font><font
                                                        class="ecxApple-style-span"
                                                        face="Courier"><a rel="nofollow"
moz-do-not-send="true" href="mailto:olivier.marti@xxxxxxxxxxxx">mailto:olivier.marti@xxxxxxxxxxxx</a></font></div>
                                                    <div
                                                      style="font-family:
                                                      Helvetica;"><i>Laboratoire

                                                        des Sciences du
                                                        Climat et de
                                                        l'Environnement</i></div>
                                                    <div
                                                      style="font-family:
                                                      Helvetica;"><i>Institut

                                                        Pierre Simon
                                                        Laplace</i></div>
                                                    <div
                                                      style="font-style:
                                                      normal;
                                                      font-family:
                                                      Helvetica;">Laboratoire

                                                      CEA-CNRS-UVSQ &nbsp;-
                                                      &nbsp;UMR 8212</div>
                                                    <div
                                                      style="font-style:
                                                      normal;
                                                      font-family:
                                                      Helvetica;">Tel :
                                                      +33 1 69 08 77 27
                                                      - Mob : +33 6 45
                                                      36 43 74</div>
                                                  </div>
                                                  <div
                                                    style="font-style:
                                                    normal; font-size:
                                                    11px; font-family:
                                                    Helvetica;">Fax :
                                                    +33 1 69 08 30 73<br>
                                                  </div>
                                                  <div
                                                    style="font-style:
                                                    normal;">
                                                    <div><font
                                                        class="ecxApple-style-span"
                                                        size="2"
                                                        face="Courier">&lt;<a rel="nofollow"
moz-do-not-send="true"
                                                          href="http://www.lsce.ipsl.fr/Pisp/56/olivier.marti.html"
target="_blank">http://www.lsce.ipsl.fr/Pisp/56/olivier.marti.html</a>&gt;</font></div>
                                                  </div>
                                                </div>
                                              </div>
                                            </span><br
                                              class="ecxApple-interchange-newline">
                                          </div>
                                        </span><br
                                          class="ecxApple-interchange-newline">
                                      </div>
                                    </span><br
                                      class="ecxApple-interchange-newline">
                                  </div>
                                </span><br
                                  class="ecxApple-interchange-newline">
                              </div>
                            </span><br
                              class="ecxApple-interchange-newline">
                          </div>
                        </span><br class="ecxApple-interchange-newline">
                      </div>
                    </span><br class="ecxApple-interchange-newline">
                  </div>
                </span><br class="ecxApple-interchange-newline">
              </div>
              <br class="ecxApple-interchange-newline">
              <br class="ecxApple-interchange-newline">
            </div>
            <br>
          </div>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
        </div>
      </blockquote>
      <br>
    </blockquote>
    <br>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00215" href="msg00215.html">[ferret_users] LEVITUS Ocean Data/FERRET shows differing results</a></strong>
<ul><li><em>From:</em> Star Physicist</li></ul></li>
<li><strong><a name="00216" href="msg00216.html">Re: [ferret_users] LEVITUS Ocean Data/FERRET shows differing results</a></strong>
<ul><li><em>From:</em> Olivier Marti</li></ul></li>
<li><strong><a name="00217" href="msg00217.html">RE: [ferret_users] LEVITUS Ocean Data/FERRET shows differing results</a></strong>
<ul><li><em>From:</em> Star Physicist</li></ul></li>
<li><strong><a name="00218" href="msg00218.html">Re: [ferret_users] LEVITUS Ocean Data/FERRET shows differing results</a></strong>
<ul><li><em>From:</em> Olivier Marti</li></ul></li>
<li><strong><a name="00219" href="msg00219.html">RE: [ferret_users] LEVITUS Ocean Data/FERRET shows differing results</a></strong>
<ul><li><em>From:</em> Star Physicist</li></ul></li>
<li><strong><a name="00222" href="msg00222.html">Re: [ferret_users] LEVITUS Ocean Data/FERRET shows differing results</a></strong>
<ul><li><em>From:</em> Ansley Manke</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00222.html">Re: [ferret_users] LEVITUS Ocean Data/FERRET shows differing results</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00224.html">[ferret_users] Re: How to plot a text data in ferret (data and plot model attached);</a></strong>
</li>

</UL>
<center>[<a href="msg00222.html">Thread Prev</a>][<a href="msg00224.html">Thread Next</a>][<A HREF="threads.html#00223">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
