<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [ferret_users] Changed behaviour in regridding one point axes -->
<!--X-From-R13: Xnvfba Yhevna <wnvfbaNngzbf.hpyn.rqh> -->
<!--X-Date: Mon, 5 Oct 2009 08:55:31 &#45;0700 -->
<!--X-Message-Id: 6501ecd10910050855h63b075c4kfce144e181c3d1ac@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 4AC52719.4010207@noaa.gov -->
<!--X-Reference: 20091002.115247.41971882.furue@hawaii.edu -->
<!--X-Reference: 4AC68654.8050405@noaa.gov -->
<!--X-Reference: 4AC9B131.9010505@io&#45;warnemuende.de -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Changed behaviour in regridding one point axes</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00647.html">Thread Prev</a>][<a href="msg00649.html">Thread Next</a>][<A HREF="threads.html#00648">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Changed behaviour in regridding one point axes</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:martin.schmidt@DOMAIN.HIDDEN">martin.schmidt@xxxxxxxxxxxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Changed behaviour in regridding one point axes</strong></li>
<li><strong>From</strong>: <strong>Jaison Kurian &lt;<a href="mailto:jaison@DOMAIN.HIDDEN">jaison@xxxxxxxxxxxxxx</a>&gt;</strong></li>
<li>Date: Mon, 05 Oct 2009 08:55:28 -0700</li>
<li>Cc: Ansley Manke &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;, <a href="mailto:oar.pmel.ferret_users@DOMAIN.HIDDEN">oar.pmel.ferret_users@xxxxxxxx</a></li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=gmail.com; s=gamma;        h=domainkey-signature:mime-version:sender:received:in-reply-to         :references:date:x-google-sender-auth:message-id:subject:from:to:cc :content-type;        bh=M/qds2Abz7tE3OlCYBjdCyabA1qQLzW08TPzHMlSywo=; b=WeZos3mK/R3RdBxjyoGU7TslnOeGIWfrhuZvBKJU5I22WE2D0IVUr3kP4I81BQ/Wn1 cQ7meu+DoaXW9xOP4KBsL7r+WAgded0VgHxQa46j4Fgdk3hrRFEdY+0d9TCMglbqT3iU GL6H4r2M7u6SUF4rnVubgvDtDZtjwwb+At0F4=</li>
<li>Domainkey-signature: a=rsa-sha1; c=nofws;        d=gmail.com; s=gamma; h=mime-version:sender:in-reply-to:references:date :x-google-sender-auth:message-id:subject:from:to:cc:content-type; b=J5Qapj1jePGwCgh8NdcK3qra4LQRh/RtiaDl+p3/5/Cjw8h+Wo368zMYwuGWKGEGmI WeJ9+NHNi08/iyFRpq9mJ0FDVf4w6uF7XMeB1zfMhIDawtvalu4m5I6cEtfDbwG59Vm3 UFF1oYgSp9uluUWlYgHQfwLAseSDJqd7jTtTM=</li>
<li>In-reply-to: &lt;<a href="mailto:4AC9B131.9010505@DOMAIN.HIDDEN">4AC9B131.9010505@xxxxxxxxxxxxxxxxx</a>&gt;</li>
<li>References: &lt;<a href="mailto:4AC52719.4010207@DOMAIN.HIDDEN">4AC52719.4010207@xxxxxxxx</a>&gt; &lt;<a href="mailto:20091002.115247.41971882.furue@DOMAIN.HIDDEN">20091002.115247.41971882.furue@xxxxxxxxxx</a>&gt; &lt;<a href="mailto:4AC68654.8050405@DOMAIN.HIDDEN">4AC68654.8050405@xxxxxxxx</a>&gt; &lt;<a href="mailto:4AC9B131.9010505@DOMAIN.HIDDEN">4AC9B131.9010505@xxxxxxxxxxxxxxxxx</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
Hi Martin,<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; First, regarding your example:<br><br>this has to do with the Ferrets &quot;delayed evaluation mode&quot;. If you use a specific value instead of the<br>&quot;RANDU&quot; function, this example will work just fine.<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; define axis/x=163e/npoints=1 x1pt<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; let var_1pt =x[gx=x1pt]*0 + 0.4914<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; list var_1pt<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; define axis/x=161e:165e:1 x5pt<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; list var_1pt[gx=x5pt@MAX]<br>
<br>Both will give you 0.4914, which is the correct answer.<br><br>Second, your original problem of assigning point time series to the model grid: here is an example,<br>which will work just fine. Please note that, the grid point which matches with the station lat-lon will<br>
have data and all other points will have missing values. This could be easily manipulated as shown<br>towards the end of the example:<br><br>! get a grid<br><br>&#xA0;&#xA0;&#xA0; use coads_climatology<br>&#xA0;&#xA0;&#xA0; define grid/x=sst[d=1]/y=sst[d=1] rgrid&#xA0; ! just XY axes, no time axis<br>
<br>! define river runoff data, at a single grid point<br><br>&#xA0;&#xA0;&#xA0; define axis/x=90E/npoints=1 x1pt<br>&#xA0;&#xA0;&#xA0; define axis/y=10N/npoints=1 y1pt<br>&#xA0;&#xA0;&#xA0; let roff = x[gx=x1pt]*0 + y[gy=y1pt]*0 + sin(t[gt=sst,d=1]/1000) + 2 ! with time axis<br>
<br>! assign runoff to destination grid<br><br>&#xA0;&#xA0;&#xA0; let runoff = roff[gx=rgrid@MAX,gy=rgrid@MAX]<br><br>! check values --&gt; @MAX picks lon 91E and lat 11N as the dx=dy=2Degrees<br><br>&#xA0;&#xA0;&#xA0; list runoff[x=91,y=11],roff <br>
&#xA0;&#xA0;&#xA0; shade/l=10 runoff<br><br>! apply proper mask<br><br>&#xA0;&#xA0;&#xA0; let mask_tmp = IF sst[d=1,l=1] THEN 1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ! this is on XYT grid<br>&#xA0;&#xA0;&#xA0; let mask&#xA0;&#xA0;&#xA0;&#xA0; = RESHAPE(mask_tmp, runoff)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ! with proper time axis&#xA0;&#xA0;&#xA0; <br>&#xA0;&#xA0;&#xA0; let river_1&#xA0; = IF runoff THEN runoff ELSE 0&#xA0;&#xA0; ! 0-for all missing data<br>
&#xA0;&#xA0;&#xA0; let river&#xA0;&#xA0;&#xA0; = river_1 * mask&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ! model&#39;s land mask <br>&#xA0;&#xA0;&#xA0; shade/l=10 river<br><br><br>You could use @XACT regrdding if there is an exact match between river location and grid point.<br>This way of assigning grid, by specifying each axis instead of the variable or /like, found to work<br>
as intended in most of the situations.<br><br>Hope this helps,<br><br>Please let me know if you have any questions,<br><br>Jaison<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <br><br><div class="gmail_quote">On Mon, Oct 5, 2009 at 1:41 AM, Martin Schmidt <span dir="ltr">&lt;<a rel="nofollow" href="mailto:martin.schmidt@xxxxxxxxxxxxxxxxx">martin.schmidt@xxxxxxxxxxxxxxxxx</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">Hi,<br>
I am trying to regrid a variable defined at a single point with two dimensions.<br>
>From one file I read a 2d-field &quot;wet&quot; that is 1 at ocean points and 0 otherwise.<br>
I define a new grid (for short notation)<br>
<br>
define grid/like=wet[d=1] rgrid<br>
<br>
Read the river data<br>
use &quot;with_coordinates/<a rel="nofollow" href="http://angola.nc" target="_blank">angola.nc</a>&quot;<br>
<br>
rivers data are time series with a single latitude and longitude coordinate and a time axis<br>
<br>
let runoff= RIVER_BENGO[gx=rgrid@sum,gy=rgrid@sum]<br>
<br>
I would expect, that ferret searches, in which grid cell the river is and sets runoff to the data value.<br>
Otherwise runoff should be zero.<br>
<br>
This does not work, the river appears to be spread over an area. The sum over all grid<br>
points is the correct data value.<br>
<br>
I was playing around with the examples in the manual. For example:<br>
<br>
yes? define axis/x=163e/npoints=1 x1pt<br>
yes? let var_1pt = randu(x[gx=x1pt]) ! a random value at a single coordinate<br>
yes? list var_1pt<br>
 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;VARIABLE : RANDU(X[GX=X1PT])<br>
 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;LONGITUDE: 163E<br>
 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;.4914<br>
yes? define axis/x=161e:165e:1 x5pt<br>
yes? list var_1pt[gx=x5pt@max] ! same value embedded within 5 point axis<br>
 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;VARIABLE : RANDU(X[GX=X1PT])<br>
 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; regrid: 1 deg on X@MAX<br>
 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;SUBSET &#xA0; : 5 points (LONGITUDE)<br>
161E &#xA0; / 1: &#xA0; &#xA0; ....<br>
162E &#xA0; / 2: &#xA0; &#xA0; ....<br>
163E &#xA0; / 3: &#xA0;0.04804<br>
164E &#xA0; / 4: &#xA0; &#xA0; ....<br>
165E &#xA0; / 5: &#xA0; &#xA0; ....<br>
<br>
This differes from the example in the manual and is wrong. The number should be .4914.<br>
I am using ferret 6.03. An old version (5.41 for AIX gives the correct result,<br>
but does not work too for the river example. 5.7 and 5.8 are wrong too.<br>
<br>
What I am doing wrong with the river example?<br>
Seems there is a bug in ferret 6. Version 6.01 gives the same result.<br>
<br>
Greetings,<br><font color="#888888">
Martin <br>
<br>
<br>
</font></blockquote></div><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00640" href="msg00640.html">[ferret_users] ***** Announcing the official release of Ferret version 6.3 *****</a></strong>
<ul><li><em>From:</em> Ansley Manke</li></ul></li>
<li><strong><a name="00643" href="msg00643.html">Re: [ferret_users] ***** Announcing the official release of Ferret version 6.3 *****</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
<li><strong><a name="00644" href="msg00644.html">Re: [ferret_users] ***** Announcing the official release of Ferret version 6.3 *****</a></strong>
<ul><li><em>From:</em> Ansley Manke</li></ul></li>
<li><strong><a name="00647" href="msg00647.html">[ferret_users] Changed behaviour in regridding one point axes</a></strong>
<ul><li><em>From:</em> Martin Schmidt</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00647.html">[ferret_users] Changed behaviour in regridding one point axes</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00649.html">Re: [ferret_users] Changed behaviour in regridding one point axes</a></strong>
</li>

</UL>
<center>[<a href="msg00647.html">Thread Prev</a>][<a href="msg00649.html">Thread Next</a>][<A HREF="threads.html#00648">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<hr>
<A HREF="ferret_contact_us.html">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> / 
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://tmap.pmel.noaa.gov">TMAP</a>
</address>
<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 
</font>
<!--X-User-Footer-End-->
</body>
</html>
