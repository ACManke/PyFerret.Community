<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [ferret_users] Problems with eof_space first mode -->
<!--X-From-R13: zvpx fcvyynar <zvpx.fcvyynarNabnn.tbi> -->
<!--X-Date: Mon, 2 Mar 2009 10:52:03 &#45;0800 -->
<!--X-Message-Id: 49AC2AFA.5090002@noaa.gov -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: e297448b0902270912q21d76f10hd194998324503207@mail.gmail.com -->
<!--X-Reference: 49A83AFE.9070500@noaa.gov -->
<!--X-Reference: e297448b0903020331w22cf887by68be858201429f3f@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Problems with eof_space first mode</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00109.html">Thread Prev</a>][<a href="msg00112.html">Thread Next</a>][<A HREF="threads.html#00113">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Problems with eof_space first mode</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Aideen Foley &lt;<a href="mailto:aideen.m.foley@DOMAIN.HIDDEN">aideen.m.foley@xxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Problems with eof_space first mode</strong></li>
<li><strong>From</strong>: <strong>mick spillane &lt;<a href="mailto:mick.spillane@DOMAIN.HIDDEN">mick.spillane@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Mon, 02 Mar 2009 10:52:42 -0800</li>
<li>Cc: Ansley Manke &lt;<a href="mailto:Ansley.B.Manke@DOMAIN.HIDDEN">Ansley.B.Manke@xxxxxxxx</a>&gt;,        Ferret users &lt;<a href="mailto:oar.pmel.ferret_users@DOMAIN.HIDDEN">oar.pmel.ferret_users@xxxxxxxx</a>&gt;</li>
<li>In-reply-to: &lt;<a href="mailto:e297448b0903020331w22cf887by68be858201429f3f@DOMAIN.HIDDEN">e297448b0903020331w22cf887by68be858201429f3f@xxxxxxxxxxxxxx</a>&gt;</li>
<li>References: &lt;<a href="mailto:e297448b0902270912q21d76f10hd194998324503207@DOMAIN.HIDDEN">e297448b0902270912q21d76f10hd194998324503207@xxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:49A83AFE.9070500@DOMAIN.HIDDEN">49A83AFE.9070500@xxxxxxxx</a>&gt; &lt;<a href="mailto:e297448b0903020331w22cf887by68be858201429f3f@DOMAIN.HIDDEN">e297448b0903020331w22cf887by68be858201429f3f@xxxxxxxxxxxxxx</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Thunderbird 2.0.0.19 (Macintosh/20081209)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi Aideen,

</pre><tt>   I can't see anything wrong with your script. Perhaps it is just the 
</tt><tt>way you are visualizing or interpreting the results.  I would remove the 
</tt><tt>&quot;/levels=&quot; from the shade command for the ire_uk case to let the field 
</tt><tt>choose the contour range.  Even if the space_eof has all negative (or 
</tt><tt>all positive) values it is not necessarily wrong.
</tt><pre style="margin: 0em;">

</pre><tt>   Attached is a demo that I think illustrates the point.  Suppose 
</tt><tt>there is a large spatial scale behavior that covers Europe and a 
</tt><tt>finer-scale variability (with a scale closer to that of Ire-UK).  Then 
</tt><tt>it is quite possible if the amplitude of the large scale signal exceeds 
</tt><tt>that of the fine, that the Ire-UK region be all the same sign in each 
</tt><tt>snapshot. This would carry over into the first mode eof of the 
</tt><tt>subregion. The eof_tfunc allows the pattern in the subregion to swing 
</tt><tt>from the (all) positive to the (all) negative phase.  A higher mode that 
</tt><tt>represents the finer scale variability will probably have an eof_space 
</tt><tt>distribution that spans zero.
</tt><pre style="margin: 0em;">

</pre><tt>   On the other hand, if the amplitude of the fine space scale 
</tt><tt>structure is great enough to result a sign change in any snapshot of the 
</tt><tt>subregion, then this behavior will likely appear in the first mode, and 
</tt><tt>perhaps the second mode will have the single signed property.
</tt><pre style="margin: 0em;">

</pre><tt>In the demo script that is attached the signal is made up of three 
</tt><tt>parts:  vxy0 - large scale, vxy1-finer scale, and a normal random noise 
</tt><tt>component.  The composite signal modulates the first two components with 
</tt><tt>an annual signal and has amplitude factors &quot;ampf&quot; and &quot;ampn&quot; to modify 
</tt><tt>the size of the fine scale and normal components relative to the large 
</tt><tt>scale.
</tt><pre style="margin: 0em;">

</pre><tt>With ampf=0.1 (and ampn=0.01) the large scale signal dominates and both 
</tt><tt>individual January snapshots and the first mode eof are single-signed 
</tt><tt>over Ire-UK.  Mode-2 is what captures the fine scale signal and spans zero.
</tt><pre style="margin: 0em;">

</pre><tt>If you crank up to ampf=10, the fine scale signal becomes the dominant 
</tt><tt>one an the situation is reversed: Mode one spans zero while mode-2 (now 
</tt><tt>representing the large spatial scale signal) is essentially single-signed.
</tt><pre style="margin: 0em;">

</pre><tt>Hope this is some help; other EOF-an(atics) in the user-group may spot 
</tt><tt>something or amplify/correct my interpretation.
</tt><pre style="margin: 0em;">
Good luck,
   Mick
----------
Aideen Foley wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi Mick,
It's a small world, isn't it? Nice to meet you!
</pre><tt> 
</tt><tt>Ok, here are details of what I've tried...
</tt><tt> 
</tt><tt> 
</tt><tt>!!!!! start of script !!!!!
</tt><tt> 
</tt><tt>cancel data/all 
</tt><tt>use mask_data.nc &lt;<a  rel="nofollow" href="http://mask_data.nc">http://mask_data.nc</a>&gt;
</tt><pre style="margin: 0em;">
let mask = if fr_land[d=1] lt 0.5 then fr_land[d=1]/0 else 1
</pre><tt>use test_file.nc &lt;<a  rel="nofollow" href="http://test_file.nc">http://test_file.nc</a>&gt; ! gridded temperature data for 
</tt><tt>Europe
</tt><pre style="margin: 0em;">
let masked_temp = t2m*mask[l=1]
</pre><tt>let eof_europe_jan = eof_space(masked_temp[t=1:240:12, i=10:90:2, 
</tt><tt>j=10:80:2], 1)
</tt><tt>set view ul; shade/palette=mine/levels=(-4,4,0.5) eof_europe_jan[l=1]; 
</tt><tt>go land
</tt><tt> 
</tt><tt>! produces a plot based on 20 Januaries for Europe
</tt><pre style="margin: 0em;">
! (domain and resolution somewhat constrained to overcome memory issues
! positive and negative eigenfunctions, as expected

</pre><tt>let eof_gb_and_ire_jan = eof_space(masked_temp[t=1:240:12, i=10:35:1, 
</tt><tt>j=30:50:1], 1)
</tt><tt>set view ur; shade/palette=mine/levels=(-4,4,0.5) 
</tt><tt>eof_gb_and_ire_jan[l=1]; go land
</tt><pre style="margin: 0em;">

! plot based on UK and Ireland
! all negative eigenfunctions
</pre><tt> 
</tt><tt>let eof_ire_jan = eof_space(masked_temp[t=1:240:12, i=11:19:1, 
</tt><tt>j=33:42:1], 1)
</tt><tt>set view ll; shade/palette=mine/levels=(-4,4,0.5) eof_ire_jan[l=1]; go 
</tt><tt>land
</tt><pre style="margin: 0em;">

! plot based on Ireland
! all negative eigenfunctions

!!!!! end of script !!!!!
</pre><tt> 
</tt><tt> 
</tt><tt>I tried saving the subregion as a seperate file also....
</tt><tt> 
</tt><tt>!!!!! start of script !!!!!
</tt><pre style="margin: 0em;">

</pre><tt>use test_file_ire 
</tt><tt>!  masked_temp[t=1:240:12, i=11:19:1, j=33:42:1] saved as seperate file
</tt><tt> 
</tt><tt>let eof_ire_jan = eof_space(temp_ire, 1)
</tt><tt>set view lr; shade/palette=mine/levels=(-4,4,0.5) eof_ire_jan[l=1]; go 
</tt><tt>land
</tt><pre style="margin: 0em;">

! same result as previous (all negative eigenfunctions)
</pre><tt> 
</tt><tt>!!!!! end of script !!!!!
</tt><pre style="margin: 0em;">
If anyone can tell me what's going on here I'd appreciate it.
</pre><tt> 
</tt><tt>Thanks,
</tt><pre style="margin: 0em;">
Aideen
</pre><tt> 
</tt><tt> 
</tt><tt> 
</tt><tt>On Fri, Feb 27, 2009 at 7:11 PM, mick spillane &lt;Mick.Spillane@xxxxxxxx 
</tt><tt>&lt;<a  rel="nofollow" href="mailto:Mick.Spillane@xxxxxxxx">mailto:Mick.Spillane@xxxxxxxx</a>&gt;&gt; wrote:
</tt><pre style="margin: 0em;">

    Hi Aideen,
      It would help if you cut and paste the commands that work (whole
    dataset) and those that give suspect results (the subregion).  If
    memory serves, you need to explicitly state the subregion and, if
    you provide the details of what you tried, someone will spot the
    problem. Another avenue to follow might be to write a netCDF file
    of your subregion and try the &quot;whole dataset&quot; commands on that
    reduced file.
      I've been a ferreter for many years and was intrigued at the
    &quot;nuim.ie &lt;<a  rel="nofollow" href="http://nuim.ie/">http://nuim.ie/</a>&gt;&quot; as well as your name. As a fellow
    NUIer (UCC 1974) it was great to see Ferret in use in the
    Geography Dept at Maynooth (if I got the Dept right).  I work in
    Tsunami research in Seattle but a good friend (similarly aged)
    from my home town, Fermoy Co.Cork, is a Maynooth grad.
      Good luck in your research - I'm sure an answer to your problem
    will be forthcoming as the ferret eof tools are tried and true.
      Regards,
         Mick Spillane
    ----------------------

    Aideen Foley wrote:

        I have a strange problem with the eof functions (in v5.51) and
        I wonder can anyone help me?
        When I plot the first spatial mode for my data, it just
        doesn't make sense. I get an entirely negative plot, no
        gradients, yet this explains over 90% of the variance in the
        data. The second is more so what I would have expected the
        first mode to be.
        I have tried this on numerous datasets and different
        variables. My data is for all of Europe, and when I run
        eof_space on the larger domain, I get good results, but when I
        try to extract the smaller domain I am interested in, I run
        into all this trouble.
        Has anyone encountered anything like this before? If anyone
        can describe to me exactly how ferret processes data for the
        eof functions, that might help.
        Thanks so much.



</pre></blockquote><pre style="margin: 0em;">

</pre><pre>! test of eof routines

set mem/size=500
let twopi=8*atan(1.)

use etopo60                       ! I'm using this to define a land mask
let mask=if(rose[d=1] gt 0)then 1

! a 20-year monthly time axis ...
def axis/t=15-jan-1981:15-dec-2000/npoints=240/units=days/t0=15-jan-1981 tax

! ... together with the 1 degree lat-lon of etopo define my demo grid
def grid/x=ETOPO60X/y=ETOPO60Y/t=tax grd

! define large-scale and finer-scale fields over land
let xx=x[g=grd] ; let yy=y[g=grd] ; let tt=t[g=grd]
let vxy0=mask*cos(twopi*(xx-15)/120)*sin(twopi*(yy-45)/60)
let vxy1=mask*sin(twopi*(xx-20)/30)*cos(twopi*(yy-45)/15)

! look at the functions over european area
region/x=-15:45/y=30:60

! ... and define suitable upper &amp; lower viewports
ppl size 8 10.5 ; ppl axlen 6 4.25 ; ppl origin 0.75 0.75
def view/size=1/orig=0.03125,0.452381/clip=0.96875,1 vhi
def view/size=1/orig=0.03125,0/clip=0.96875,0.547619 vlo

set view vhi ; shade/nolab vxy0 ; label/nouser 5.8 0.2 1 0 0.25 Large-scale Signal
set view vlo ; shade/nolab vxy1 ; label/nouser 5.8 0.2 1 0 0.25 Fine-scale Signal
message ; ppl shaset reset

! combine the fields with an annual cycle and some noise (the large-scale signal
! has unit amplitude, the fine-scale amp is &quot;ampf&quot; and the noise amp &quot;ampn&quot; 

let europe=vxy0*cos(twopi*tt/365)+ampf*vxy1*sin(twopi*(tt-25)/365)+ampn*randn(vxy1*tt)

! define the nw subregion as ireuk
let ireuk=if(xx lt 2 and yy gt 48)then europe

! CASE A - the large-scale signal dominates
let ampf=0.1 ; let ampn=0.01

! look at the first snapshot
set view vhi ; shade/nolab/l=1 europe ; label/nouser 5.8 0.2 1 0 0.25 Full region
label/nouser 3 4.4 0 0 0.25 January 1981 for case AMPF=0.1
set view vlo ; shade/nolab/l=1 ireuk  ; label/nouser 5.8 0.2 1 0 0.25 Sub-region
message ; ppl shaset reset

let europe_space=eof_space(europe[t=1:240:12],1)
let ireuk_space=eof_space(ireuk[t=1:240:12],1)

! look at the first mode of each
set view vhi ; shade/nolab/l=1 europe_space ; label/nouser 5.8 0.2 1 0 0.25 Mode 1 full region
label/nouser 3 4.4 0 0 0.25 Large Spatial Scale Signal Dominant 
set view vlo ; shade/nolab/l=1 ireuk_space  ; label/nouser 5.8 0.2 1 0 0.25 Mode 1 subregion
message ; ppl shaset reset

! ... and the 2nd mode of each
set view vhi ; shade/nolab/l=2 europe_space ; label/nouser 5.8 0.2 1 0 0.25 Mode 2 full region
label/nouser 3 4.4 0 0 0.25 Large Spatial Scale Signal Dominant
set view vlo ; shade/nolab/l=2 ireuk_space  ; label/nouser 5.8 0.2 1 0 0.25 Mode 2 subregion
message ; ppl shaset reset

! CASE B - the fine-scale signal dominates
let ampf=10.0 ; let ampn=0.01

! look at the first snapshot
set view vhi ; shade/nolab/l=1 europe ; label/nouser 5.8 0.2 1 0 0.25 Full region
label/nouser 3 4.4 0 0 0.25 January 1981 for case AMPF=10.0
set view vlo ; shade/nolab/l=1 ireuk  ; label/nouser 5.8 0.2 1 0 0.25 Sub-region
message ; ppl shaset reset

let europe_space=eof_space(europe[t=1:240:12],1)
let ireuk_space=eof_space(ireuk[t=1:240:12],1)

! look at the first mode of each
set view vhi ; shade/nolab/l=1 europe_space ; label/nouser 5.8 0.2 1 0 0.25 Mode 1 full region
label/nouser 3 4.4 0 0 0.25 Fine Spatial Scale Signal Dominant
set view vlo ; shade/nolab/l=1 ireuk_space  ; label/nouser 5.8 0.2 1 0 0.25 Mode 1 subregion
message ; ppl shaset reset

! ... and the 2nd mode of each
set view vhi ; shade/nolab/l=2 europe_space ; label/nouser 5.8 0.2 1 0 0.25 Mode 2 full region
label/nouser 3 4.4 0 0 0.25 Fine Spatial Scale Signal Dominant
set view vlo ; shade/nolab/l=2 ireuk_space  ; label/nouser 5.8 0.2 1 0 0.25 Mode 2 subregion
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00109" href="msg00109.html">[ferret_users] Problems with eof_space first mode</a></strong>
<ul><li><em>From:</em> Aideen Foley</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00109.html">[ferret_users] Problems with eof_space first mode</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00112.html">[ferret_users] Composite using separate date files</a></strong>
</li>

</UL>
<center>[<a href="msg00109.html">Thread Prev</a>][<a href="msg00112.html">Thread Next</a>][<A HREF="threads.html#00113">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<hr>
<A HREF="ferret_contact_us.html">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> / 
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://tmap.pmel.noaa.gov">TMAP</a>
</address>
<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 
</font>
<!--X-User-Footer-End-->
</body>
</html>
