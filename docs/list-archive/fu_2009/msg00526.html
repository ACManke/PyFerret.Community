<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [ferret_users] strange summarizing -->
<!--X-From-R13: Brgre Emnob <fmnocrg83Ntznvy.pbz> -->
<!--X-Date: Fri, 28 Aug 2009 04:36:25 &#45;0700 -->
<!--X-Message-Id: 8cc42c030908280436h48e0aadakfc5400f6520d70e5@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 8cc42c030908270247u21f31b2ey700611e844aa3b16@mail.gmail.com -->
<!--X-Reference: 20090827.170608.219756354.furue@hawaii.edu -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] strange summarizing</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00525.html">Thread Prev</a>][<a href="msg00527.html">Thread Next</a>][<A HREF="threads.html#00526">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] strange summarizing</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Ryo Furue &lt;<a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a>&gt;, Steve Hankin &lt;<a href="mailto:Steven.C.Hankin@DOMAIN.HIDDEN">Steven.C.Hankin@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] strange summarizing</strong></li>
<li><strong>From</strong>: <strong>Peter Szabo &lt;<a href="mailto:szabpet83@DOMAIN.HIDDEN">szabpet83@xxxxxxxxx</a>&gt;</strong></li>
<li>Date: Fri, 28 Aug 2009 13:36:22 +0200</li>
<li>Cc: <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=gmail.com; s=gamma; h=domainkey-signature:mime-version:received:in-reply-to:references :date:message-id:subject:from:to:cc:content-type; bh=p4MrMBf35temZvovrixujtrB0r2ElGWgSuFaSqo7wiE=; b=bYJV/h4+7GlJxvCgXHdj+2lrVnMPab8G8fwUvLkSJASdmujlcuNKIYktKNORmZIQv4 qL1H3BGrF8ReTFUqO5dV5aouGKycTinmrzi6nw86vYfXBHCGGHUgQxQD88Lx2Bo/98AK EBrpNbpy1HPdbJZS0HU4QykyXe53FCChaC6eU=</li>
<li>Domainkey-signature: a=rsa-sha1; c=nofws;        d=gmail.com; s=gamma; h=mime-version:in-reply-to:references:date:message-id:subject:from:to :cc:content-type; b=mK63sCh4i/k5LkjkOUdurBZCFb7UaVHPSSLyp3bUAdNB3HnIjVXLVhwhQ3N0l08S8O nQ4rBnJ7AwdRLPRHhfE4N5eHvWn72ux9yFo4cheBFL3iMcXyiq3Kuw+8ZAr0eQn0M3oQ YzEo/7TVOApsczLw2pc5Mm6RV3ud5svEs7DCA=</li>
<li>In-reply-to: &lt;<a href="mailto:20090827.170608.219756354.furue@DOMAIN.HIDDEN">20090827.170608.219756354.furue@xxxxxxxxxx</a>&gt;</li>
<li>References: &lt;<a href="mailto:8cc42c030908270247u21f31b2ey700611e844aa3b16@DOMAIN.HIDDEN">8cc42c030908270247u21f31b2ey700611e844aa3b16@xxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20090827.170608.219756354.furue@DOMAIN.HIDDEN">20090827.170608.219756354.furue@xxxxxxxxxx</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
Hi Steve and Ryo,<br><br>WOW, Thanks for your kind help!<br>I succeed in having the running sum with @rsum instead of the previously used complex script (with the evaluation ``). Although i had to use a repat loop as the MK test uses two, complex summarizing. See below.<br>
My Mann-Kendall test works fine now in ferret (i wrote two scripts).<br><br>Peter<br>------------<br>repeat/range=1:39:1/name=ka (let signpreX = if (pre[t=`ka`:40] - pre[t=`ka`]) ge 1&#xA0; then 1 else signproba; let signproba= if (pre[t=`ka`:40] - pre[t=`ka`]) le -1 then (-1) else 0; let szum = signpreX[t=`ka`:40@rsum]; let ss=szum[t=40]; def ax/t=&quot;`ka`&quot;:&quot;`ka`&quot;:1 ann; def grid/t=ann gann; let times=t[g=gann]*0; let sss=ss+times; save/file=&quot;/home/szabop/mannkendall/MK_pre.nc&quot;/append/clobber/t=`ka` sss)<br>
------------<br><br><div class="gmail_quote">On Fri, Aug 28, 2009 at 5:06 AM, Ryo Furue <span dir="ltr">&lt;<a rel="nofollow" href="mailto:furue@xxxxxxxxxx">furue@xxxxxxxxxx</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">
Hi Peter,<br>
<div class="im"><br>
| when i am trying to have the results of mann-kendall test, i found<br>
| something strange: i want to sum a calculated variable it just dont<br>
| work. A bug or i am messing up something?<br>
<br>
</div>I think so. &#xA0;In Ferret, a variable is defined but not evaluated<br>
until its value is demanded. &#xA0;To illustrate your problem, let&#39;s<br>
consider a very simple example:<br>
<br>
 &#xA0;yes? let a = 1 &#xA0; &#xA0; &#xA0; &#xA0;!!(1)<br>
 &#xA0;yes? let b = a + 2 &#xA0; &#xA0;!!(2)<br>
 &#xA0;yes? let a = 10 &#xA0; &#xA0; &#xA0; !!(3)redefinition<br>
 &#xA0;yes? list/nohead a, b !!(4)<br>
 &#xA0;I / *: &#xA0; &#xA0; 10.00 &#xA0;12.00<br>
 &#xA0;yes? let a = 100 &#xA0; &#xA0; &#xA0;!!(5)redefinition<br>
 &#xA0;yes? list/nohead a, b !!(6)<br>
 &#xA0;I / *: &#xA0; &#xA0; 100.0 &#xA0;102.0<br>
<br>
At line (2), b is defined to be &quot;a + 2&quot; not &quot;3&quot;.<br>
Then, at line (3), the definition of a is changed.<br>
At line (4), the values of a and b are demanded,<br>
so they are computed. &#xA0;Since &quot;b = a + 2&quot; and &quot;a = 10&quot;<br>
b is &quot;evaluated&quot; as 12.<br>
<br>
This doesn&#39;t change the definition of b. &#xA0;So, after<br>
the definition of a is again changed at line (5),<br>
b evaluates to yet a different value.<br>
<div class="im"><br>
| let ka=1<br>
| let szum`ka`=0<br>
| repeat/range=`ka+1`:40:1/name=ja (let signpreX=if (pret=`ja`]-pre[t=`ka`])<br>
| ge 1 then 1 else signproba; let signproba=if (pret=`ja`]-pre[t=`ka`]) le -1<br>
| then (-1) else 0; let szum`ja`=signpreX+szum`ja-1`; list/nohead<br>
| szum`ja`,signpreX)<br>
<br>
</div>So, let&#39;s consider the first two steps of this loop:<br>
<br>
ja=2<br>
<br>
 &#xA0; &#xA0; SZUM1 = 0<br>
 &#xA0; &#xA0; SZUM2 = SIGNPREX + SZUM1<br>
<br>
ja=3<br>
<br>
 &#xA0; &#xA0; SZUM1 = 0<br>
 &#xA0; &#xA0; SZUM2 = SIGNPREX + SZUM1<br>
 &#xA0; &#xA0; SZUM3 = SIGNPREX + SZUM2<br>
<br>
As you see,<br>
<br>
 &#xA0;SZUM3 = SIGNPREX + SZUM2<br>
 &#xA0; &#xA0; &#xA0; &#xA0;= SIGNPREX + SIGNPREX + SZUM1<br>
 &#xA0; &#xA0; &#xA0; &#xA0;= 2 * SIGNPREX + SZUM1<br>
<br>
which isn&#39;t what you want.<br>
<br>
To fix the problem, you have to force the evaluation of signpreX<br>
at each iteration of the loop.<br>
<div class="im"><br>
 &#xA0; let szum`ja` = `signpreX` + szum`ja-1`<br>
<br>
</div>The operator `` means &quot;evaluate it right now&quot;.<br>
<br>
Having said all this, I don&#39;t think you need such a complex<br>
program. &#xA0;In your loop, you are computing a running sum of<br>
signpreX. &#xA0;So, I think you&#39;d be better off with<br>
<br>
&#xA0;let ka=1<br>
&#xA0;let signpreX = if (pre - pre[t=`ka`]) ge 1 &#xA0;then 1 else signproba<br>
&#xA0;let signproba= if (pre - pre[t=`ka`]) le -1 then (-1) else 0<br>
&#xA0;let szum = signpreX[t=1:40@rsum]<br>
&#xA0;list szum<br>
<br>
where &quot;@rsum&quot; operator computes the running sum.<br>
<br>
Hope this helps,<br>
<font color="#888888">Ryo<br>
</font></blockquote></div><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00524" href="msg00524.html">[ferret_users] strange summarizing</a></strong>
<ul><li><em>From:</em> Peter Szabo</li></ul></li>
<li><strong><a name="00525" href="msg00525.html">Re: [ferret_users] strange summarizing</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00525.html">Re: [ferret_users] strange summarizing</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00527.html">[ferret_users] bug on creation of axis</a></strong>
</li>

</UL>
<center>[<a href="msg00525.html">Thread Prev</a>][<a href="msg00527.html">Thread Next</a>][<A HREF="threads.html#00526">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<hr>
<A HREF="ferret_contact_us.html">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> / 
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://tmap.pmel.noaa.gov">TMAP</a>
</address>
<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 
</font>
<!--X-User-Footer-End-->
</body>
</html>
