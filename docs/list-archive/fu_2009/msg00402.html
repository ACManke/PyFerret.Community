<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [ferret_users] insert data into variable at certain time step -->
<!--X-From-R13: Ehqurre Xbfrcu <fwb.vaqvnNtznvy.pbz> -->
<!--X-Date: Thu, 25 Jun 2009 18:21:20 &#45;0700 -->
<!--X-Message-Id: a903a9720906251821n5df46cdeh2aa09b610244c452@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 4A3155A3.9050505@ec.gc.ca -->
<!--X-Reference: 4A316784.7090308@noaa.gov -->
<!--X-Reference: 15279_1244763332_4A3194C2_15279_38403_1_4A3190AC.60204@ec.gc.ca -->
<!--X-Reference: 4A43BBC2.3020108@ec.gc.ca -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] insert data into variable at certain time step</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00401.html">Thread Prev</a>][<a href="msg00357.html">Thread Next</a>][<A HREF="threads.html#00402">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] insert data into variable at certain time step</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Fabian Lienert &lt;<a href="mailto:cccma-student-003@DOMAIN.HIDDEN">cccma-student-003@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] insert data into variable at certain time step</strong></li>
<li><strong>From</strong>: <strong>Sudheer Joseph &lt;<a href="mailto:sjo.india@DOMAIN.HIDDEN">sjo.india@xxxxxxxxx</a>&gt;</strong></li>
<li>Date: Fri, 26 Jun 2009 06:51:17 +0530</li>
<li>Cc: <a href="mailto:oar.pmel.ferret_users@DOMAIN.HIDDEN">oar.pmel.ferret_users@xxxxxxxx</a></li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=gmail.com; s=gamma; h=domainkey-signature:mime-version:received:in-reply-to:references :date:message-id:subject:from:to:cc:content-type; bh=3AQ6zJAg3fUtHY4tDURRhDxJNt2bGQVCLtOeKyeKfCA=; b=bVRopJ7ZEbxGWAFxS2ZN/RODL5djzCbkqHntnz57LXtjN0GjBlvlsQxUfFRr5v122d +Eiac8RQX2AcSGdyq6jjHy9xaCek/YwttbWzCuz+TDUFi8Uez3tVkX5uG+Gcr3KxMqdd i/wHq1IznKggxAGQEkUpI8LC9+bel8GSvjV28=</li>
<li>Domainkey-signature: a=rsa-sha1; c=nofws;        d=gmail.com; s=gamma; h=mime-version:in-reply-to:references:date:message-id:subject:from:to :cc:content-type; b=Rofla1qb4i+Zb+XSJqQ3AmoDxg4DU4/wPXjFwFQfjUi7sBufsAXGcFR9Ulw5biigSk YsJVDqmsYdoAKQiJJr2AKLRJeHhlqXp3qe3BT5ukRZPxhqK6meTnGgWa7CYVryafvoTm LGNRptc5CJA8WfU08h6oRZlG8LLb9PqWPENjc=</li>
<li>In-reply-to: &lt;<a href="mailto:4A43BBC2.3020108@DOMAIN.HIDDEN">4A43BBC2.3020108@xxxxxxxx</a>&gt;</li>
<li>References: &lt;<a href="mailto:4A3155A3.9050505@DOMAIN.HIDDEN">4A3155A3.9050505@xxxxxxxx</a>&gt; &lt;<a href="mailto:4A316784.7090308@DOMAIN.HIDDEN">4A316784.7090308@xxxxxxxx</a>&gt; &lt;<a href="mailto:15279_1244763332_4A3194C2_15279_38403_1_4A3190AC.60204@DOMAIN.HIDDEN">15279_1244763332_4A3194C2_15279_38403_1_4A3190AC.60204@xxxxxxxx</a>&gt; &lt;<a href="mailto:4A43BBC2.3020108@DOMAIN.HIDDEN">4A43BBC2.3020108@xxxxxxxx</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
Hi Fabian,<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; I am making an assumption from ur mail else this may not work.<br>1) you are initially listing data to an ascii file&#xA0; from netcdf using ferret ( I guess so as you say <br>crashes or complains about the missing <br>

values ***** in the text file.)<br><br>&#xA0;To solve this you need to set&#xA0; the variable as bad with a specific number<br>set var/bad= -999.999 temp<br>list/file=temp.dat/format=(f10.4)/nohead&#xA0; temp<br><br>2) Then while reading you read&#xA0; variable as temp to ferret and then <br>
set var/bad=-999.999 temp<br><br>this will tell ferret that there are missing values in the data.<br>Hope this helps<br>sjo<br><br><div class="gmail_quote">On Thu, Jun 25, 2009 at 11:32 PM, Fabian Lienert <span dir="ltr">&lt;<a rel="nofollow" href="mailto:cccma-student-003@xxxxxxxx">cccma-student-003@xxxxxxxx</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">Hi Ferret crowd,<br>
<br>
The script below works fine if there are no missing values. Since I started<br>
computing lagged correlations for SST, a netcdf dataset with missing values,<br>
the troubles started. Ferret crashes when reading an ASCII file with missing<br>
values. Adding different format options when writing and reading text file like list/form=comma didn&#39;t help, Fferret either crashes or complains about the missing<br>
values ***** in the text file.<br>
<br>
So I tried writing the 2d field &#39;correl&#39; in the repeat loop into a netcdf file<br>
using save/append/file=&quot;<a rel="nofollow" href="http://temp.nc" target="_blank">temp.nc</a>&quot;/clobber correl[g=sst[d=2]] without success.<br>
Correl does not have a time axis, so correl is not appended but overwritten.<br>
Using just save/append/file=&quot;<a rel="nofollow" href="http://temp.nc" target="_blank">temp.nc</a>&quot; or adding and increasing /l=1 does not help either.<br>
I also tried to define different time axis for correl like the following, without success.<br>
def axis/t=1:3:1 lagx; def grid/like=sst[d=2,l=1]/t=lagx glag; correl[g=glag]<br>
<br>
The only fix I could come up with was the following:<br>
let max_lag = 1<br>
repeat/range=`-1*max_lag`:`max_lag`:1/name=lag (let q = some_ts[l=@shf:`lag`]; let p = sst[d=2]; go variance;\<br>
 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;let lagcorr = correl + 0*sst[d=2,l=`lag+max_lag+1`];\<br>
 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; save/append/file=&quot;<a rel="nofollow" href="http://temp.nc" target="_blank">temp.nc</a>&quot;/clobber lagcorr;\<br>
 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; cancel var correl; cancel var q; cancel var p; cancel memory )<br>
<br>
Cheers,<br>
Fabian<br>
<br>
<br>
Fabian Lienert wrote:<br>
<blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">
Thanks very much Mick,<br>
<br>
I tested the commands. There should be an append option while writing<br>
the ASCII file in order not to overwrite the previous one.<br>
So for people finding this useful, below is the corrected version.<br>
<br>
Cheers,<br>
Fabian<br>
<br>
<br>
use my_data &#xA0;!(the original xyt dataset containing &quot;myvar&quot;)<br>
spawn touch temp.file<br>
repeat/range=1:5/name=lag ( ... define and compute the lagged correlation variable &quot;correl&quot; from &quot;myvar&quot; &#xA0;;\<br>
 &#xA0; list/nohead/file=temp.file/form=(f12.5)/append correl )<br>
def axis/t=1:5:1 lagx<br>
def grid/like=myvar[d=1]/t=lagx glag<br>
file/form=free/g=glag/ord=xyt/var=mylagvar temp.file<br>
set var/title=&quot;Lagged Correlations&quot; mylagvar<br>
! now you can plot or use them ... or use ferret to write them to a netCDF file then discard temp.file<br>
save/file=MyLaggedResults.nc mylagvar<br>
<br>
<br>
mick spillane wrote:<br>
<blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">
Hi Fabian,<br>
 &#xA0; Unlike some other languages, what you are doing in Ferret is setting up the algebraic quantities to compute something, until you use or write the variable you define, it doesn&#39;t exist as a number. Your situation is a case like this -- for each lag the definition is changing so it is best to write out the results for each lag to a file, then read them back later.<br>

 &#xA0; The most elegant way would be to write to a netCDF file, one time slice (lag) at a time. &#xA0;But, unless the x-y grid is huge, I typically write to an ASCII file (one value per record) then define the appropriate grid and read it back. It would go something like this:<br>

<br>
use my_data &#xA0;!(the original xyt dataset containing &quot;myvar&quot;)<br>
spawn touch temp.file<br>
repeat/range=1:5/name=lag ( ... define and compute the lagged correlation variable &quot;correl&quot; from &quot;myvar&quot; &#xA0;;\<br>
 &#xA0; &#xA0;list/nohead/file=temp.file/form=(f12.5) correl )<br>
def axis/t=1:5:1 lagx<br>
def grid/like=myvar[d=1]/t=lagx glag<br>
file/form=free/g=glag/ord=xyt/var=mylagvar temp.file<br>
set var/title=&quot;Lagged Correlations&quot; mylagvar<br>
! now you can plot or use them ... or use ferret to write them to a netCDF file then discard temp.file<br>
save/file=MyLaggedResults.nc mylagvar<br>
<br>
Things to note:<br>
1) &quot;;\&quot; continues the repeat statement to the next line<br>
2) &#xA0;the build up lag-by-lag of the results file<br>
3) I just typed this in without doing a demo -- there may be typos but I hope the gist is clear<br>
<br>
Hope it helps,<br>
Mick<br>
PS Look in the user guide for the slice-by-slice construction of a netCDF file if you like to be more elegant<br>
-------<br>
Fabian Lienert wrote:<br>
<blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">
Hi Ferreters,<br>
<br>
Simple question, couldn&#39;t find an answer so far.<br>
In a repeat loop, I am calculating lagged cross correlations:<br>
<br>
yes? repeat/range = 1:5:1/Name=lag (let q = timeseries[d=1,i=1,l=@shf:`lag`]; \<br>
 &#xA0; &#xA0; &#xA0; &#xA0; let p = 3dvariable[d=2]; go variance;\<br>
All I want to do is to insert a 2-d field (correl) into a 3-d variable (x,y,t) at each time step inside the repeat loop, something like the following.<br>
 &#xA0; &#xA0; &#xA0; &#xA0; let lag_corr/l=`lag` = correl)<br>
<br>
In other programming languages this is easily done by filling an array:<br>
for (t in 1:5) {<br>
 &#xA0; &#xA0;lag_corr[,,t] = correl(t)<br>
}<br>
<br>
I am using FERRET v6.1 on Ubuntu Linux.<br>
<br>
Any help appreciated,<br>
Fabian<br>
<br>
</blockquote></blockquote>
<br>
<br>
</blockquote>
<br>
<br>
-- <br>
Fabian Lienert &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;| &#xA0;Canadian Centre for Climate Modelling and Analysis<br>
PhD Student &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; | &#xA0;Meteorological Service of Canada<br>
phone: +1(250)721-7211 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;| &#xA0;University of Victoria<br>
<a rel="nofollow" href="mailto:cccma-student-003@xxxxxxxx" target="_blank">cccma-student-003@xxxxxxxx</a> &#xA0; &#xA0; &#xA0;| &#xA0;P.O. Box 1700<br>
<a rel="nofollow" href="http://www.cccma.bc.ec.gc.ca" target="_blank">http://www.cccma.bc.ec.gc.ca</a> &#xA0; &#xA0;| &#xA0;Victoria, BC, &#xA0;V8W 2Y2, Canada<br>
</blockquote></div><br><br clear="all"><br>-- <br>**********************************************************************************<br>Sudheer Joseph &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;<br>
Scientist &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <br>Indian National Centre for Ocean Information Services (INCOIS) &#xA0; &#xA0; <br>Ocean Valley, Post Box No# 21,<br>IDA Jeedimetla P.O. &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <br>
Hyderabad, Ranga Reddy District - 500 055<br>Andhra Pradesh, India.<br>TEl:+91-40-23044600(R),Tel:+91-9440832534(Mobile)<br>Tel:+91-40-23886047(O),Fax:+91-40-23895011(O)<br><a rel="nofollow" href="mailto:E-mail%3Asjo@xxxxxxxxxxxxxx">E-mail:sjo@xxxxxxxxxxxxxx</a>; <a rel="nofollow" href="mailto:sudheer.joseph@xxxxxxxxx">sudheer.joseph@xxxxxxxxx</a>; &#xA0;<a rel="nofollow" href="mailto:sjo@xxxxxxxxxxxxx">sjo@xxxxxxxxxxxxx</a>.<br>
Web- <a rel="nofollow" href="http://oppamthadathil.tripod.com">http://oppamthadathil.tripod.com</a><br> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; --------------* ---------------<br>&quot;The ultimate measure of a man is<br>not where he stands in moments of<br>comfort and convenience, but where<br>
he stands at times of challenge and<br>controversy.&quot;<br> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;Martin Luther King, Jr.<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00355" href="msg00355.html">[ferret_users] insert data into variable at certain time step</a></strong>
<ul><li><em>From:</em> Fabian Lienert</li></ul></li>
<li><strong><a name="00401" href="msg00401.html">Re: [ferret_users] insert data into variable at certain time step</a></strong>
<ul><li><em>From:</em> Fabian Lienert</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00401.html">Re: [ferret_users] insert data into variable at certain time step</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00357.html">[ferret_users] picking up 5 day data</a></strong>
</li>

</UL>
<center>[<a href="msg00401.html">Thread Prev</a>][<a href="msg00357.html">Thread Next</a>][<A HREF="threads.html#00402">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<hr>
<A HREF="ferret_contact_us.html">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> / 
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://tmap.pmel.noaa.gov">TMAP</a>
</address>
<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 
</font>
<!--X-User-Footer-End-->
</body>
</html>
