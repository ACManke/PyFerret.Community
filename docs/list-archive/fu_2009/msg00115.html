<!-- MHonArc v2.6.16 -->
<!--X-Subject: RE: [ferret_users] Composite using separate date files -->
<!--X-From-R13: Eniva <fpunaqNctenq.havzryo.rqh.nh> -->
<!--X-Date: Mon, 2 Mar 2009 13:23:40 &#45;0800 -->
<!--X-Message-Id: 000901c99b7d$215a19a0$640e4ce0$@unimelb.edu.au -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 000001c99949$d4660d50$7d3227f0$@unimelb.edu.au -->
<!--X-Reference: 49AC3BDF.2020708@noaa.gov -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>RE: [ferret_users] Composite using separate date files</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00114.html">Thread Prev</a>][<a href="msg00116.html">Thread Next</a>][<A HREF="threads.html#00115">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>RE: [ferret_users] Composite using separate date files</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>&quot;'Ansley Manke'&quot; &lt;<a href="mailto:Ansley.B.Manke@DOMAIN.HIDDEN">Ansley.B.Manke@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>RE: [ferret_users] Composite using separate date files</strong></li>
<li><strong>From</strong>: <strong>Savin &lt;<a href="mailto:schand@DOMAIN.HIDDEN">schand@xxxxxxxxxxxxxxxxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 03 Mar 2009 08:23:28 +1100</li>
<li>Cc: <a href="mailto:oar.pmel.ferret_users@DOMAIN.HIDDEN">oar.pmel.ferret_users@xxxxxxxx</a></li>
<li>In-reply-to: &lt;<a href="mailto:49AC3BDF.2020708@DOMAIN.HIDDEN">49AC3BDF.2020708@xxxxxxxx</a>&gt;</li>
<li>References: &lt;<a href="mailto:000001c99949%24d4660d50%247d3227f0%24@DOMAIN.HIDDEN"><a href="msg00112.html">000001c99949$d4660d50$7d3227f0$@unimelb.edu.au</a></a>&gt; &lt;<a href="mailto:49AC3BDF.2020708@DOMAIN.HIDDEN">49AC3BDF.2020708@xxxxxxxx</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>Thread-index: AcmbcicFS6KSlDh1QdKNOIECInU7ygACuYwg</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="white" style="background-color: white; a:link { color: blue } a:visited { color: purple } ">





<div class=Section1>

<p class=MsoNormal><span style='color:#1F497D'>Thanks Ansley.<o:p></o:p></span></p>

<p class=MsoNormal><span style='color:#1F497D'><o:p>&nbsp;</o:p></span></p>

<div>

<div style='border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0cm 0cm 0cm'>

<p class=MsoNormal><b><span lang=EN-US style='font-size:10.0pt;font-family:
"Tahoma","sans-serif";color:windowtext'>From:</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:"Tahoma","sans-serif";color:windowtext'> Ansley
Manke [mailto:Ansley.B.Manke@xxxxxxxx] <br>
<b>Sent:</b> Tuesday, 3 March 2009 7:05 AM<br>
<b>To:</b> Savin<br>
<b>Cc:</b> oar.pmel.ferret_users@xxxxxxxx<br>
<b>Subject:</b> Re: [ferret_users] Composite using separate date files<o:p></o:p></span></p>

</div>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Hi Savin,<br>
Are you saying you have a set of dates in an ascii file that look for instance
like this:<br>
<br>
19940315<br>
19940415<br>
19940515<br>
19940615<br>
19940715<br>
...<br>
<br>
and you want to get that set of dates into Ferret and use them in a computation
with a dataset that has a time axis?&nbsp; The dates might or might not be
regularly-spaced, or match dates from the ncep data set - Ferret can handle
that.<br>
<br>
You can read in separate variables representing the year, month, day as
follows:<o:p></o:p></p>

<p class=MsoNormal><tt><span style='font-size:10.0pt'>yes?
file/var=&quot;yr,mo,da&quot;/format=(f4.0,f2.0,f2.0) dates.txt</span></tt><span
style='font-size:10.0pt;font-family:"Courier New"'><br>
<tt>yes? list yr, mo, da</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DATA SET: ./dates.txt</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; X:
0.5 to 9.5</tt><br>
<tt>&nbsp;Column&nbsp; 1: YR</tt><br>
<tt>&nbsp;Column&nbsp; 2: MO</tt><br>
<tt>&nbsp;Column&nbsp; 3: DA</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
YR&nbsp;&nbsp;&nbsp; MO&nbsp;&nbsp;&nbsp;&nbsp; DA</tt><br>
<tt>1&nbsp;&nbsp; / 1:&nbsp; 1994.&nbsp;&nbsp; 3.00&nbsp; 15.00</tt><br>
<tt>2&nbsp;&nbsp; / 2:&nbsp; 1994.&nbsp;&nbsp; 4.00&nbsp; 15.00</tt><br>
<tt>3&nbsp;&nbsp; / 3:&nbsp; 1994.&nbsp;&nbsp; 5.00&nbsp; 15.00</tt><br>
<tt>4&nbsp;&nbsp; / 4:&nbsp; 1994.&nbsp;&nbsp; 6.00&nbsp; 15.00</tt><br>
<tt>...</tt></span><o:p></o:p></p>

<p class=MsoNormal>Now define a variable representing these times.&nbsp; Ferret
has the function DAYS1900 to convert year, month, day data into a variable
representing days since 1-jan-1990.&nbsp; We'll use this and then convert these
times into the time reference used by the ncep data.<o:p></o:p></p>

<p class=MsoNormal><tt><span style='font-size:10.0pt'>yes? sh func days1900</span></tt><br>
<tt><span style='font-size:10.0pt'>DAYS1900(year,month,day)</span></tt><br>
<tt><span style='font-size:10.0pt'>&nbsp;&nbsp;&nbsp; days elapsed since
1-Jan-1900</span></tt><br>
<br>
<tt><span style='font-size:10.0pt'>yes? list&nbsp; days1900(yr, mo, da)</span></tt><br>
<tt><span style='font-size:10.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
VARIABLE : DAYS1900(YR, MO, DA)</span></tt><br>
<tt><span style='font-size:10.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
FILENAME : dates.txt</span></tt><br>
<tt><span style='font-size:10.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
SUBSET&nbsp;&nbsp; : 9 points (X)</span></tt><br>
<tt><span style='font-size:10.0pt'>&nbsp;1&nbsp;&nbsp; / 1:&nbsp; 34392.</span></tt><br>
<tt><span style='font-size:10.0pt'>&nbsp;2&nbsp;&nbsp; / 2:&nbsp; 34423.</span></tt><br>
<tt><span style='font-size:10.0pt'>&nbsp;3&nbsp;&nbsp; / 3:&nbsp; 34453.</span></tt><br>
<tt><span style='font-size:10.0pt'>&nbsp;4&nbsp;&nbsp; / 4:&nbsp; 34484.</span></tt><br>
<tt><span style='font-size:10.0pt'>...</span></tt><o:p></o:p></p>

<p class=MsoNormal>I don't know the details of the ncep reanalysis dataset
you're using - here's one I have available to me, so for example, here is the
data and its time origin and time units.<o:p></o:p></p>

<p class=MsoNormal><tt><span style='font-size:10.0pt'>yes? use
ncep_reanalysis_monthly_stress</span></tt><br>
<tt><span style='font-size:10.0pt'>yes? sh dat</span></tt><br>
<tt><span style='font-size:10.0pt'>&nbsp;&nbsp;&nbsp;&nbsp; currently SET data
sets:</span></tt><br>
<tt><span style='font-size:10.0pt'>&nbsp;&nbsp;&nbsp; 1&gt;
/.../ncep_reanalysis_monthly_stress.cdf&nbsp; (default)</span></tt><br>
<tt><span style='font-size:10.0pt'>&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;
title&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
I&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; J&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
K&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; L</span></tt><br>
<tt><span style='font-size:10.0pt'>&nbsp;TAUX&nbsp;&nbsp;&nbsp;&nbsp; Zonal
Wind
Stress&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1:160&nbsp;&nbsp;&nbsp;&nbsp; 1:100&nbsp;&nbsp;&nbsp;&nbsp;
...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1:204</span></tt><span
style='font-size:10.0pt;font-family:"Courier New"'><br>
<tt>&nbsp;TAUY&nbsp;&nbsp;&nbsp;&nbsp; Meridional Wind
Stress&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1:160&nbsp;&nbsp;&nbsp;&nbsp; 1:100&nbsp;&nbsp;&nbsp;&nbsp;
...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1:204</tt></span><o:p></o:p></p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><tt><span style='font-size:10.0pt'>yes? say
`taux[d=1],return=t0`</span></tt><br>
<tt><span style='font-size:10.0pt'>&nbsp;!-&gt; MESSAGE/CONTINUE 15-JAN-1901
00:00:00</span></tt><br>
<tt><span style='font-size:10.0pt'>15-JAN-1901 00:00:00</span></tt><br>
<tt><span style='font-size:10.0pt'>yes? say `taux[d=1],return=tunits`</span></tt><br>
<tt><span style='font-size:10.0pt'>&nbsp;!-&gt; MESSAGE/CONTINUE HOURS</span></tt><br>
<tt><span style='font-size:10.0pt'>HOURS</span></tt><o:p></o:p></p>

</blockquote>

<p class=MsoNormal>Define a time axis with the dates from the ascii file. We
will use regridding to put this data onto the time axis of the ncep data and
then create a mask that will pick out the times for the computation.&nbsp; (You
could use a different regridding tranformation in the second line.)<o:p></o:p></p>

<p class=MsoNormal><tt><span style='font-size:10.0pt'>yes? define
axis/t0=&quot;1-jan-1900&quot;/units=days my_t_axis = days1900(yr, mo, da)</span></tt><span
style='font-size:10.0pt;font-family:"Courier New"'><br>
<tt>yes? let tdays = t[gt=my_t_axis]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ! a
variable on the time axis </tt><br>
<tt>yes? let t_ncep = tdays[gt=taux,d=1]&nbsp;&nbsp; ! that variable, on the
NCEP time axis</tt></span><o:p></o:p></p>

<p class=MsoNormal>Now the variable we have created from the list of dates in
the ascii file has units of days and the NCEP time axis is in hours.&nbsp; Also
the variable we created has a time origin of 1-jan-1900 and NCEP is referenced
to 15-jan-1900.&nbsp; So, convert our variable to hours since 15-jan-1900:<o:p></o:p></p>

<p class=MsoNormal style='margin-bottom:12.0pt'><tt><span style='font-size:
10.0pt'>yes? list DAYS1900(1901,1,15)&nbsp; ! The number of days between the 2
time origins.</span></tt><span style='font-size:10.0pt;font-family:"Courier New"'><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
VARIABLE : DAYS1900(1901,1,15)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 379.0</tt><br>
<tt>yes? let compute_times =&nbsp; 24*(t_ncep-379)&nbsp; ! times in NCEP time
units</tt></span><o:p></o:p></p>

<p class=MsoNormal>We are almost done. Create a mask which is 1 at all the
times that match the input times in the file; or missing otherwise. Multiply
this by the NCEP variable, and the result is the variable at the selected
times.<o:p></o:p></p>

<p class=MsoNormal><tt><span style='font-size:10.0pt'>yes? let mask = if
compute_times then 1</span></tt><span style='font-size:10.0pt;font-family:"Courier New"'><br>
<tt>yes? let masked_taux = taux[d=1]*mask</tt></span><o:p></o:p></p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal style='margin-bottom:12.0pt'><tt><span style='font-size:
10.0pt'>yes? list/t=1-jan-1994:1-jan-1995&nbsp; t[gt=taux,d=1], compute_times,
mask, taux[d=1,x=180,y=0], masked_taux[x=180,y=0]</span></tt><span
style='font-size:10.0pt;font-family:"Courier New"'><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DATA SET:
/home/raid1/data/jaguar_data/ja10/data/f2/data/ncep_reanalysis_monthly_stress.cdf</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
NCEP Reanalysis Monthly Wind Stress</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
TIME: 01-JAN-1994 00:00 to 01-JAN-1995 00:00</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
LONGITUDE: ???</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
LATITUDE: ???</tt><br>
<tt>&nbsp;Column&nbsp; 1: T is T (axis TAX)</tt><br>
<tt>&nbsp;Column&nbsp; 2: COMPUTE_TIMES is 24*(T_NCEP-379)</tt><br>
<tt>&nbsp;Column&nbsp; 3: MASK is IF COMPUTE_TIMES THEN 1</tt><br>
<tt>&nbsp;Column&nbsp; 4: TAUX is Zonal Wind Stress (dyne/cm**2)</tt><br>
<tt>&nbsp;Column&nbsp; 5: MASKED_TAUX is TAUX[D=ncep_reanalysis_monthly_stress]*MASK</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
T&nbsp; COMPUTE_&nbsp; MASK&nbsp;&nbsp;&nbsp; TAUX&nbsp; MASKED_TAUX</tt><br>
<tt>15-JAN-1994 / 181:&nbsp; 815250.&nbsp;&nbsp;&nbsp;&nbsp; ....&nbsp;&nbsp;
.... -0.3323&nbsp;&nbsp;&nbsp; ....</tt><br>
<tt>15-FEB-1994 / 182:&nbsp; 815980.&nbsp;&nbsp;&nbsp;&nbsp; ....&nbsp;&nbsp;
.... -0.2561&nbsp;&nbsp;&nbsp; ....</tt><br>
<tt>17-MAR-1994 / 183:&nbsp; 816711.&nbsp; 816711.&nbsp; 1.000 -0.2233 -0.2233</tt><br>
<tt>17-APR-1994 / 184:&nbsp; 817442.&nbsp; 817442.&nbsp; 1.000 -0.1726 -0.1726</tt><br>
<tt>17-MAY-1994 / 185:&nbsp; 818172.&nbsp; 818172.&nbsp; 1.000 -0.1809 -0.1809</tt><br>
<tt>16-JUN-1994 / 186:&nbsp; 818902.&nbsp; 818902.&nbsp; 1.000 -0.1358 -0.1358</tt><br>
<tt>17-JUL-1994 / 187:&nbsp; 819633.&nbsp; 819633.&nbsp; 1.000 -0.1124 -0.1124</tt><br>
<tt>16-AUG-1994 / 188:&nbsp; 820364.&nbsp; 820364.&nbsp; 1.000 -0.0587 -0.0587</tt><br>
<tt>16-SEP-1994 / 189:&nbsp; 821094.&nbsp; 821094.&nbsp; 1.000 -0.1575 -0.1575</tt><br>
<tt>16-OCT-1994 / 190:&nbsp; 821824.&nbsp; 821824.&nbsp; 1.000 -0.0583 -0.0583</tt><br>
<tt>16-NOV-1994 / 191:&nbsp; 822555.&nbsp;&nbsp;&nbsp;&nbsp; ....&nbsp;&nbsp;
....&nbsp; 0.0692&nbsp;&nbsp;&nbsp; ....</tt><br>
<tt>16-DEC-1994 / 192:&nbsp; 823286.&nbsp;&nbsp;&nbsp;&nbsp; ....&nbsp;&nbsp;
....&nbsp; 0.0653&nbsp;&nbsp;&nbsp; ....</tt><br>
<tt>16-JAN-1995 / 193:&nbsp; 824016.&nbsp;&nbsp;&nbsp;&nbsp; ....&nbsp;&nbsp;
.... -0.0897&nbsp;&nbsp;&nbsp; ....</tt><br>
<br>
</span><o:p></o:p></p>

</blockquote>

<p class=MsoNormal>Savin wrote: <o:p></o:p></p>

<p class=MsoNormal>Dear ferret users,<o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>I have a separate date file (say in the format yyyymmdd). I
want to create a composites (say e.g., relative vorticity from NCEP reanalysis
data) using dates from this file in FERRET.<o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>Any suggestions how I can do it.<o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>Help will be very much appreciated.<o:p></o:p></p>

<p class=MsoNormal>&nbsp;<o:p></o:p></p>

<p class=MsoNormal>Thanks.<o:p></o:p></p>

<p class=MsoNormal>Savin<o:p></o:p></p>

</div>




</td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00112" href="msg00112.html">[ferret_users] Composite using separate date files</a></strong>
<ul><li><em>From:</em> Savin</li></ul></li>
<li><strong><a name="00114" href="msg00114.html">Re: [ferret_users] Composite using separate date files</a></strong>
<ul><li><em>From:</em> Ansley Manke</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00114.html">Re: [ferret_users] Composite using separate date files</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00116.html">[ferret_users] dynamic computation with variable depths</a></strong>
</li>

</UL>
<center>[<a href="msg00114.html">Thread Prev</a>][<a href="msg00116.html">Thread Next</a>][<A HREF="threads.html#00115">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<hr>
<A HREF="ferret_contact_us.html">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> / 
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://tmap.pmel.noaa.gov">TMAP</a>
</address>
<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 
</font>
<!--X-User-Footer-End-->
</body>
</html>
