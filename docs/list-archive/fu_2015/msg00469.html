<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] regridding transformation should reduce dimension . . . -->
<!--X-From-R13: "Oafyrl Q. [naxr" <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Tue, 1 Dec 2015 12:22:07 &#45;0800 -->
<!--X-Message-Id: 565E016C.1010009@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CAEwQpaJswMz=Cbg6qvZK5JakLG_jPajS9L6y+&#45;GWP8zidtY_2w@mail.gmail.com -->
<!--X-Reference: CAKoe08QwXL7MATPQqDYnkF3KO2qdPyp_A2ekyX0MkLpOd2Csjg@mail.gmail.com -->
<!--X-Reference: 17AF0581&#45;F9F8&#45;4A05&#45;9B99&#45;179887D98477@noaa.gov -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] regridding transformation should reduce dimension . . .</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00468.html">Thread Prev</a>][<a href="msg00467.html">Thread Next</a>][<A HREF="threads.html#00469">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] regridding transformation should reduce dimension . . .</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:william.s.kessler@DOMAIN.HIDDEN">william.s.kessler@xxxxxxxx</a>, <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] regridding transformation should reduce dimension . . .</strong></li>
<li><strong>From</strong>: <strong>&quot;Ansley C. Manke&quot; &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 1 Dec 2015 12:22:04 -0800</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa-gov.20150623.gappssmtp.com; s=20150623;        h=subject:to:references:from:message-id:date:user-agent:mime-version         :in-reply-to:content-type:x-original-sender         :x-original-authentication-results:precedence:mailing-list:list-id         :list-post:list-help:list-archive:list-unsubscribe;        bh=PNAVtE1hPOmpwLZAoBHj/YwqZ+CsR7VBMX1/+2DYwsU=;        b=i1IIqF2/mUWCQ7J6Dhv7tzuASpoT9+uoFu/prd/CkCohv2oZhR6HG4Qc87yXOjDz1H         0C3fhedJlpVXEWegtSYI/NTMDSaulF0S5RQvVgbUd5ZbuJ9Mwv24EOHF1fFNca2eQUcz         EEIylZIcm+Y2Jfw04n0z7UQ4OV6LFHXuFdAw3V0rbqT88cUnZHAC1yo4YQIyyVD6PF+Z         bLZmBU82q7NF5wCNqfiZ4t6NRXSbya09ZAa7/523OjJXrYCIkHeqZl1PEjFMHjXi5sql         R5hfcDeOcbG4QLt6spv+Yizr/LdmZk4kIDVVAJgeWaYxhh8TSI6XbrOGqHnDy8f6YlNi         mZhg==</li>
<li>In-reply-to: &lt;<a href="msg00466.html">17AF0581-F9F8-4A05-9B99-179887D98477@noaa.gov</a>&gt;</li>
<li>List-archive: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/">http://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="http://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">http://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/post">http://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;, &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe">http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;CAEwQpaJswMz=Cbg6qvZK5JakLG_jPajS9L6y+-GWP8zidtY_2w@mail.gmail.com&gt; &lt;<a href="msg00463.html">CAKoe08QwXL7MATPQqDYnkF3KO2qdPyp_A2ekyX0MkLpOd2Csjg@mail.gmail.com</a>&gt; &lt;<a href="msg00466.html">17AF0581-F9F8-4A05-9B99-179887D98477@noaa.gov</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:38.0) Gecko/20100101 Thunderbird/38.3.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    Hi Billy<br>
    z10 does have only a 2-D grid.&#xA0; What's getting us here is thinking
    about "once it's evaluated". Ferret doesn't fix in memory the array
    on its first evaluation, so if you ask for Z10[k=1], now that's a
    different _expression_. <br>
    <br>
    Another thing we could do here is to nail down the context to work
    on in Z as part of the original definition, for instance,<br>
    <blockquote><tt>yes? let z10 = temp[z=0:1000@LOC:10]</tt><br>
    </blockquote>
    and then you could work with z10 [k=1] or z10[k=800].&#xA0; (And those
    are identical, since z10 does not now depend on K.)<br>
    <br>
    -Ansley<br>
    <br>
    <div class="moz-cite-prefix">On 12/1/2015 10:57 AM, William S.
      Kessler wrote:<br>
    </div>
    <blockquote cite=""
      type="cite">
      <pre wrap="">Hi Andrew, Ryo -

I don't think that was Ryo's question. 

What he wants is for a field defined by @loc (once it is evaluated from a 3-d field) to have the grid of a 2-d field.

Of course Ferret understands it as 2-d (thus it can be plotted with SHADE), but the variable Z10 retains its 3-d grid. He would like it to be 2-d so he can refer to Z10[k=1], and get the single-z-level field.

But I understand a definition like TEMP[Z=@LOC:10] to be comparable to TEMP[Z=400], namely it describes a 2-d field that can be SHADEd, but it remains part of a 3-d grid. 

I think it can be converted to 2-d with RESHAPE:

LET Z102D = RESHAPE(Z10,X[GX=TEMP]+Y[GX=TEMP])

(No time to test this!)

Billy

</pre>
      <blockquote type="cite">
        <pre wrap="">On Dec 1, 2015, at 9:58 AM, Andrew Wittenberg - NOAA Federal <a rel="nofollow" class="moz-txt-link-rfc2396E" href="mailto:andrew.wittenberg@xxxxxxxx">&lt;andrew.wittenberg@xxxxxxxx&gt;</a> wrote:

Hi Ryo,

Thanks for the clearly-stated question.  [All: this is a good example
of how to ask a question so that it gets answered quickly.  In
particular, Ryo provided a working example using one of Ferret's
built-in datasets, e.g. levitus_climatology, coads_climatology, or
monthly_navy_winds; and also pasted in the Ferret header, which shows
what Ferret version he was using, just in case it turned out to be a
bug.]

Note that Z=@LOC doesn't mean "search from top to bottom for 10 degC."
Instead it means "search within the future evaluation context for 10
degC."

So when you later specify z10[k=1], @LOC dutifully searches only over
k=1; and since 10degC isn't found in the top level, it evaluates to
"missing."

To insulate @LOC from future contexts, specify explicit z-limits:

 NOAA/PMEL TMAP
 FERRET v6.951 (10/29/2015)
 Linux 2.6.32-573.7.1.el6.x86_64 64-bit - 10/30/15
 1-Dec-15 12:40

yes? use levitus_climatology
yes? let z10 = temp[z=0:6000@LOC:10]
yes? let below_z10 = z[g=temp] LT z10
yes? shade/x=180 below_z10
yes? shade/z=400 below_z10

The relevant documentation is:

<a rel="nofollow" class="moz-txt-link-freetext" href="http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/XPRESSIONS#_VPINDEXENTRY_528">http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/XPRESSIONS#_VPINDEXENTRY_528</a>

See also the following answer in the Ferret email archives:

<a rel="nofollow" class="moz-txt-link-freetext" href="http://www.pmel.noaa.gov/maillists/tmap/ferret_users/fu_2006/msg00098.html">http://www.pmel.noaa.gov/maillists/tmap/ferret_users/fu_2006/msg00098.html</a>

which was found by searching the email archives for "missing context".

Andrew


On Tue, Dec 1, 2015 at 6:06 AM, Ryo Furue <a rel="nofollow" class="moz-txt-link-rfc2396E" href="mailto:furue@xxxxxxxxxx">&lt;furue@xxxxxxxxxx&gt;</a> wrote:
</pre>
        <blockquote type="cite">
          <pre wrap="">Hi Ferret users,

I'm sure there has been discussions about this issue and I searched
our email archive and found some threads that touch upon it, but
didn't find whether it's "solved" or not.

The problem is that @LOC (and perhaps other similar transformations)
doesn't properly "eliminate" the axis.  For a (x,y,z) temperature
field, say, you can find the depth of an isopycnal:

  yes? z10 = temp[z=@LOC:10]

but, "SHOW GRID z10", it still has more than one gridpoints.  Nevertheless,

   yes? fill z10[k=1]   !--&gt; undefined field
   yes? fill z10           !--&gt; works!

See a complete example below.  This behavior looks like a bug to me.

This matters.  I wanted to define a mask on the basis of this
variable, something like:

  yes? let below_z10 = if z[g=temp] lt z10 then 1

but this doesn't work because z10[k=1, 2, 3, . . .] are undefined!

My temporary solution is

  yes? let grid = x[gx=temp] + y[gy=temp]
  yes? let z10_squashed = reshape(z10,grid)
  yes? let below_z10 = if z[g=temp] lt z10_squashed then 1

But, I guess Ferret should do this reshaping for me with @LOC.

Regards,

Ryo
----------------------------------------
$ ferret
 NOAA/PMEL TMAP
 FERRET v6.94
 Darwin 14.1.0 - 02/26/15
 1-Dec-15 19:36

yes? set data levitus_climatology
yes? let z10 = temp[z=@LOC:10]
yes? show grid z10
   GRID GMS1
name       axis              # pts   start                end
XAXLEVITR LONGITUDE          360mr   20.5E                19.5E(379.5)
YAXLEVITR LATITUDE           180 r   89.5S                89.5N
ZAXLEVITR DEPTH (m)           20 i-  0                    5000
normal    T
normal    E
normal    F
yes? list/x=180/y=0 z10[k=1]
            VARIABLE : TEMP[Z=@LOC:10]
            FILENAME : levitus_climatology.cdf
            FILEPATH : /usr/local/ferret/data/
            LONGITUDE: 179.5E
            LATITUDE : 0.5S
            DEPTH (m): 0 to 5
       ....
yes? list/x=180/y=0 z10
            VARIABLE : TEMP[Z=@LOC:10]
            FILENAME : levitus_climatology.cdf
            FILEPATH : /usr/local/ferret/data/
            LONGITUDE: 179.5E
            LATITUDE : 0.5S
            DEPTH (m): 0 to 5000
         371.7
!---- temporary solution ----
yes? let grid = x[gx=temp] + y[gy=temp]
yes? let z10_reshaped = reshape(z10, grid)
yes? show grid z10_reshaped
   GRID (G002)
name       axis              # pts   start                end
XAXLEVITR LONGITUDE          360mr   20.5E                19.5E(379.5)
YAXLEVITR LATITUDE           180 r   89.5S                89.5N
normal    Z
normal    T
normal    E
normal    F
yes? list/x=180/y=0 z10_reshaped[k=1]
            VARIABLE : RESHAPE(Z10, GRID)
            FILENAME : levitus_climatology.cdf
            FILEPATH : /usr/local/ferret/data/
            LONGITUDE: 179.5E
            LATITUDE : 0.5S
         371.7
yes? list/x=180/y=0 z10_reshaped
            VARIABLE : RESHAPE(Z10, GRID)
            FILENAME : levitus_climatology.cdf
            FILEPATH : /usr/local/ferret/data/
            LONGITUDE: 179.5E
            LATITUDE : 0.5S
         371.7
yes?
</pre>
        </blockquote>
      </blockquote>
      <pre wrap="">
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
William S. Kessler
NOAA / Pacific Marine Environmental Laboratory
7600 Sand Point Way NE
Seattle WA 98115 USA

<a rel="nofollow" class="moz-txt-link-abbreviated" href="mailto:william.s.kessler@xxxxxxxx">william.s.kessler@xxxxxxxx</a>
Tel: +1 206-526-6221
Fax: +1 206-526-6744
Web: <a rel="nofollow" class="moz-txt-link-freetext" href="http://faculty.washington.edu/kessler/">http://faculty.washington.edu/kessler/</a>


</pre>
    </blockquote>
    <br>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00461" href="msg00461.html">[ferret_users] regridding transformation should reduce dimension . . .</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
<li><strong><a name="00463" href="msg00463.html">Re: [ferret_users] regridding transformation should reduce dimension . . .</a></strong>
<ul><li><em>From:</em> Andrew Wittenberg - NOAA Federal</li></ul></li>
<li><strong><a name="00466" href="msg00466.html">Re: [ferret_users] regridding transformation should reduce dimension . . .</a></strong>
<ul><li><em>From:</em> William S. Kessler</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00468.html">Re: [ferret_users] regridding transformation should reduce dimension . . .</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00467.html">Re: [ferret_users] regridding transformation should reduce dimension . . .</a></strong>
</li>

</UL>
<center>[<a href="msg00468.html">Thread Prev</a>][<a href="msg00467.html">Thread Next</a>][<A HREF="threads.html#00469">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
