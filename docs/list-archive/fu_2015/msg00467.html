<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] regridding transformation should reduce dimension . . . -->
<!--X-From-R13: "Oafyrl Q. [naxr" <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Tue, 1 Dec 2015 10:58:51 &#45;0800 -->
<!--X-Message-Id: 565DEDE9.4050407@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CAEwQpaJswMz=Cbg6qvZK5JakLG_jPajS9L6y+&#45;GWP8zidtY_2w@mail.gmail.com -->
<!--X-Reference: CAKoe08QwXL7MATPQqDYnkF3KO2qdPyp_A2ekyX0MkLpOd2Csjg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] regridding transformation should reduce dimension . . .</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00469.html">Thread Prev</a>][<a href="msg00471.html">Thread Next</a>][<A HREF="threads.html#00467">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] regridding transformation should reduce dimension . . .</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>, Ryo Furue &lt;<a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a>&gt;,        Andrew Wittenberg - NOAA Federal &lt;<a href="mailto:andrew.wittenberg@DOMAIN.HIDDEN">andrew.wittenberg@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] regridding transformation should reduce dimension . . .</strong></li>
<li><strong>From</strong>: <strong>&quot;Ansley C. Manke&quot; &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 1 Dec 2015 10:58:49 -0800</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa-gov.20150623.gappssmtp.com; s=20150623;        h=subject:to:references:from:message-id:date:user-agent:mime-version         :in-reply-to:content-type:x-original-sender         :x-original-authentication-results:precedence:mailing-list:list-id         :list-post:list-help:list-archive:list-unsubscribe;        bh=+jRautqCg3l8eEj3tX/vJ4G+frbd0kz/gIN4fzMSXnY=;        b=c5lygblL8kq/DsCtkaTPargKFlaaBUuS0SC1G1L/qPYS6FMrNryAjqFZvrXLEEjdAh         nQEVyMpMABeldTfSJS2kXnhl5z+5vmweXnIR92dzpqSw2igxNLjY9sSaKHsHVRnvQrFc         52HgReXrKF6xL012cQ4erfkCCaI1WS9rUlidpTv7Ah53ecmhIESuDWvJeEvVfxHleZjL         DA2qdyih9fcH41efqTgQzLGpfVPoFo1d1qZ1x61/q0FX0xvOdgy3J6QtYdytQY9BaAFp         Tfyf7Lm1UfmflF0mA/Ws56iUoIYWEaNnMZwWZ0NeyWaYXzF+mSY5u/KZrgLOesvbacK/         TtJQ==</li>
<li>In-reply-to: &lt;<a href="msg00463.html">CAKoe08QwXL7MATPQqDYnkF3KO2qdPyp_A2ekyX0MkLpOd2Csjg@mail.gmail.com</a>&gt;</li>
<li>List-archive: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/">http://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="http://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">http://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/post">http://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;, &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe">http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;CAEwQpaJswMz=Cbg6qvZK5JakLG_jPajS9L6y+-GWP8zidtY_2w@mail.gmail.com&gt; &lt;<a href="msg00463.html">CAKoe08QwXL7MATPQqDYnkF3KO2qdPyp_A2ekyX0MkLpOd2Csjg@mail.gmail.com</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:38.0) Gecko/20100101 Thunderbird/38.3.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    Thanks Andrew for clarifying.&#xA0; A few more thoughts about SHOW GRID.<br>
    <br>
    SHOW GRID is not a very precise tool for getting the details of the
    grid of an _expression_. Ferret does this by checking off the the axes
    of the combined grid that is used in the computation. It does
    sometimes show axes which have in fact gone away when the _expression_
    is computed. Looking at <br>
    <blockquote><tt>yes? say `z10,return=shape`</tt><tt><br>
      </tt><tt>&#xA0;!-&gt; MESSAGE/CONTINUE XY</tt><tt><br>
      </tt><tt>XY</tt><br>
    </blockquote>
    returns the expected result, and Ferret writes just the XY
    coordinates if you SAVE the result to a netCDF file. So as Andrew
    explained, this is one of those cases where Ferret's
    delayed-evaluation computations aren't entirely obvious. <br>
    <br>
    -Ansley<br>
    <br>
    <div class="moz-cite-prefix">On 12/1/2015 9:58 AM, Andrew Wittenberg
      - NOAA Federal wrote:<br>
    </div>
    <blockquote
cite=""
      type="cite">
      <pre wrap="">Hi Ryo,

Thanks for the clearly-stated question.  [All: this is a good example
of how to ask a question so that it gets answered quickly.  In
particular, Ryo provided a working example using one of Ferret's
built-in datasets, e.g. levitus_climatology, coads_climatology, or
monthly_navy_winds; and also pasted in the Ferret header, which shows
what Ferret version he was using, just in case it turned out to be a
bug.]

Note that Z=@LOC doesn't mean "search from top to bottom for 10 degC."
 Instead it means "search within the future evaluation context for 10
degC."

So when you later specify z10[k=1], @LOC dutifully searches only over
k=1; and since 10degC isn't found in the top level, it evaluates to
"missing."

To insulate @LOC from future contexts, specify explicit z-limits:

  NOAA/PMEL TMAP
  FERRET v6.951 (10/29/2015)
  Linux 2.6.32-573.7.1.el6.x86_64 64-bit - 10/30/15
  1-Dec-15 12:40

yes? use levitus_climatology
yes? let z10 = temp[z=0:6000@LOC:10]
yes? let below_z10 = z[g=temp] LT z10
yes? shade/x=180 below_z10
yes? shade/z=400 below_z10

The relevant documentation is:

<a rel="nofollow" class="moz-txt-link-freetext" href="http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/XPRESSIONS#_VPINDEXENTRY_528">http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/XPRESSIONS#_VPINDEXENTRY_528</a>

See also the following answer in the Ferret email archives:

<a rel="nofollow" class="moz-txt-link-freetext" href="http://www.pmel.noaa.gov/maillists/tmap/ferret_users/fu_2006/msg00098.html">http://www.pmel.noaa.gov/maillists/tmap/ferret_users/fu_2006/msg00098.html</a>

which was found by searching the email archives for "missing context".

Andrew


On Tue, Dec 1, 2015 at 6:06 AM, Ryo Furue <a rel="nofollow" class="moz-txt-link-rfc2396E" href="mailto:furue@xxxxxxxxxx">&lt;furue@xxxxxxxxxx&gt;</a> wrote:
</pre>
      <blockquote type="cite">
        <pre wrap="">Hi Ferret users,

I'm sure there has been discussions about this issue and I searched
our email archive and found some threads that touch upon it, but
didn't find whether it's "solved" or not.

The problem is that @LOC (and perhaps other similar transformations)
doesn't properly "eliminate" the axis.  For a (x,y,z) temperature
field, say, you can find the depth of an isopycnal:

   yes? z10 = temp[z=@LOC:10]

but, "SHOW GRID z10", it still has more than one gridpoints.  Nevertheless,

    yes? fill z10[k=1]   !--&gt; undefined field
    yes? fill z10           !--&gt; works!

See a complete example below.  This behavior looks like a bug to me.

This matters.  I wanted to define a mask on the basis of this
variable, something like:

   yes? let below_z10 = if z[g=temp] lt z10 then 1

but this doesn't work because z10[k=1, 2, 3, . . .] are undefined!

My temporary solution is

   yes? let grid = x[gx=temp] + y[gy=temp]
   yes? let z10_squashed = reshape(z10,grid)
   yes? let below_z10 = if z[g=temp] lt z10_squashed then 1

But, I guess Ferret should do this reshaping for me with @LOC.

Regards,

Ryo
----------------------------------------
$ ferret
  NOAA/PMEL TMAP
  FERRET v6.94
  Darwin 14.1.0 - 02/26/15
  1-Dec-15 19:36

yes? set data levitus_climatology
yes? let z10 = temp[z=@LOC:10]
yes? show grid z10
    GRID GMS1
 name       axis              # pts   start                end
 XAXLEVITR LONGITUDE          360mr   20.5E                19.5E(379.5)
 YAXLEVITR LATITUDE           180 r   89.5S                89.5N
 ZAXLEVITR DEPTH (m)           20 i-  0                    5000
 normal    T
 normal    E
 normal    F
yes? list/x=180/y=0 z10[k=1]
             VARIABLE : TEMP[Z=@LOC:10]
             FILENAME : levitus_climatology.cdf
             FILEPATH : /usr/local/ferret/data/
             LONGITUDE: 179.5E
             LATITUDE : 0.5S
             DEPTH (m): 0 to 5
        ....
yes? list/x=180/y=0 z10
             VARIABLE : TEMP[Z=@LOC:10]
             FILENAME : levitus_climatology.cdf
             FILEPATH : /usr/local/ferret/data/
             LONGITUDE: 179.5E
             LATITUDE : 0.5S
             DEPTH (m): 0 to 5000
          371.7
!---- temporary solution ----
yes? let grid = x[gx=temp] + y[gy=temp]
yes? let z10_reshaped = reshape(z10, grid)
yes? show grid z10_reshaped
    GRID (G002)
 name       axis              # pts   start                end
 XAXLEVITR LONGITUDE          360mr   20.5E                19.5E(379.5)
 YAXLEVITR LATITUDE           180 r   89.5S                89.5N
 normal    Z
 normal    T
 normal    E
 normal    F
yes? list/x=180/y=0 z10_reshaped[k=1]
             VARIABLE : RESHAPE(Z10, GRID)
             FILENAME : levitus_climatology.cdf
             FILEPATH : /usr/local/ferret/data/
             LONGITUDE: 179.5E
             LATITUDE : 0.5S
          371.7
yes? list/x=180/y=0 z10_reshaped
             VARIABLE : RESHAPE(Z10, GRID)
             FILENAME : levitus_climatology.cdf
             FILEPATH : /usr/local/ferret/data/
             LONGITUDE: 179.5E
             LATITUDE : 0.5S
          371.7
yes?
</pre>
      </blockquote>
    </blockquote>
    <br>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00461" href="msg00461.html">[ferret_users] regridding transformation should reduce dimension . . .</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
<li><strong><a name="00463" href="msg00463.html">Re: [ferret_users] regridding transformation should reduce dimension . . .</a></strong>
<ul><li><em>From:</em> Andrew Wittenberg - NOAA Federal</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00469.html">Re: [ferret_users] regridding transformation should reduce dimension . . .</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00471.html">Re: [ferret_users] regridding transformation should reduce dimension . . .</a></strong>
</li>

</UL>
<center>[<a href="msg00469.html">Thread Prev</a>][<a href="msg00471.html">Thread Next</a>][<A HREF="threads.html#00467">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
