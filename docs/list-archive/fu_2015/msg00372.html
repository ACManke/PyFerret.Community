<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] Re: Ferret &#45; masking based on altitude -->
<!--X-From-R13: Dhff Tvrqyre <ehffryy.svrqyreNpfveb.nh> -->
<!--X-Date: Sun, 18 Oct 2015 17:55:43 &#45;0700 -->
<!--X-Message-Id: 56243F87.9030901@csiro.au -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CAOzkrhEza0pU76NxOYOx0=Nyx_tU=NSjmNF6PMLoiscmsiTtDQ@mail.gmail.com -->
<!--X-Reference: CAGfCSpuA9k+dXvirD3mP5dkju7_c3BSo3bwj16+oN809g33Rdg@mail.gmail.com -->
<!--X-Reference: CAOzkrhHCATHTcKw5DXiuqSp4miz0SnNiBCK6_suQcFfP0A4=7g@mail.gmail.com -->
<!--X-Reference: CAOzkrhGxcyQFEVJyoqcsPHY&#45;9AQ_302YDSMbtXNk0TvkYJTqmg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Re: Ferret - masking based on altitude</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00371.html">Thread Prev</a>][<a href="msg00373.html">Thread Next</a>][<A HREF="threads.html#00372">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Re: Ferret - masking based on altitude</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Re: Ferret - masking based on altitude</strong></li>
<li><strong>From</strong>: <strong>Russ Fiedler &lt;<a href="mailto:russell.fiedler@DOMAIN.HIDDEN">russell.fiedler@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Mon, 19 Oct 2015 11:55:35 +1100</li>
<li>In-reply-to: &lt;<a href="msg00369.html">CAOzkrhGxcyQFEVJyoqcsPHY-9AQ_302YDSMbtXNk0TvkYJTqmg@mail.gmail.com</a>&gt;</li>
<li>List-archive: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/">http://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="http://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">http://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/post">http://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;, &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe">http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;CAOzkrhEza0pU76NxOYOx0=Nyx_tU=NSjmNF6PMLoiscmsiTtDQ@mail.gmail.com&gt;	&lt;<a href="msg00365.html">CAGfCSpuA9k+dXvirD3mP5dkju7_c3BSo3bwj16+oN809g33Rdg@mail.gmail.com</a>&gt;	&lt;CAOzkrhHCATHTcKw5DXiuqSp4miz0SnNiBCK6_suQcFfP0A4=7g@mail.gmail.com&gt; &lt;<a href="msg00369.html">CAOzkrhGxcyQFEVJyoqcsPHY-9AQ_302YDSMbtXNk0TvkYJTqmg@mail.gmail.com</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (X11; Linux x86_64; rv:31.0) Gecko/20100101 Thunderbird/31.2.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    <div class="moz-cite-prefix"><br>
      Hi Simon,<br>
      <br>
      The problem is that you aren't mapping the variables between grids
      explicitly. Ferret is making its best guess (hence the warning
      about ambiguous grids) but not making the right choice. The
      repeated changing of regions is also confusing, especially the
      time index. The region is only evaluated when making the plot so
      your first set/region does precisely nothing.<br>
      <br>
      When defining variables from a combination of sources make sure
      that the grids are compatible.<br>
      <br>
      So rather than<br>
      <br>
      let rf_100 = rainfall[d=1] * mask1<br>
      <br>
      you should use (assuming the mask is time invariant)<br>
      <br>
      let rf_100 = rainfall[d=1,gxy=mask1]*mask1[l=1] ! put on the
      topography grid<br>
      <br>
      or<br>
      <br>
      let rf_100 = rainfall[d=1]*mask1[gxy=rainfall[d=1],l=1]&#xA0; ! put on
      the rainfall grid.<br>
      <br>
      If the grids are aligned but of different sizes then the @NRST
      regridding is possibly the most appropriate transform.<br>
      <b><span style="color:rgb(56,118,29)"><br>
        </span></b>I'd also omit the set region statements and plot
      things explicitly. Setting regions when you have mixed grids often
      leads to problems and it's<br>
      probably best not to get into the habit of automatically setting
      regions unless you are sure that it's safe and that you cancel the
      region as soon as it's not needed.<br>
      <br>
      plot/x=74E:81E/y=8N:15N/l=1:365 rf_100[x=@ave,y=@ave]<br>
      <br>
      <br>
      Cheers,<br>
      Russ<br>
      <br>
      On 17/10/15 22:10, simon EK wrote:<br>
    </div>
    <blockquote
cite=""
      type="cite">
      
      <div dir="ltr">
        <div>
          <div>
            <div>
              <div>
                <div>
                  <div>Dear Andre/ ferret users,<br>
                    <br>
                  </div>
                  I downloaded .25x.25 grid topography dataset and tried
                  with one mask as adviced by you::<br>
                </div>
                (the journal file and the errors &amp; warnings are
                listed below:<br>
              </div>
              I could not much understand the errors.<br>
            </div>
            kindly help.<br>
            <br>
          </div>
          Regards<br>
        </div>
        Simon<br>
        <div>
          <div>
            <div>
              <div>
                <div><br>
!====================================================================<br>
                  !topo-rf.jnl<br>
!====================================================================<br>
                  <b><span style="color:rgb(56,118,29)">use <a rel="nofollow"
                        moz-do-not-send="true" href="http://spi-rf.nc">spi-rf.nc</a>
                      &#xA0;&#xA0;&#xA0; ! Rainfall data on .25x.25 grid - variable
                      name 'rainfall'<br>
                      set region/x=74E:81E/y=8N:15N/l=1:365 &#xA0;&#xA0;&#xA0; !
                      selected 365 days data from ~ 100 years data<br>
                      <br>
                      use <a rel="nofollow" moz-do-not-send="true"
                        href="http://elev.0.25-deg.nc">elev.0.25-deg.nc</a>&#xA0;
                      &#xA0;&#xA0;&#xA0; ! elevation on .25x.25 grid - variable name
                      'data'<br>
                      set region/x=74E:81E/y=8N:15N/l=1<br>
                      <br>
                      let mask1 = IF (data GE 0 AND data LT 100) THEN 1
                      else 1/0<br>
                      <br>
                      let rf_100 = rainfall[D=1] * mask1<br>
                      <br>
                      plot rf_100[x=@ave,y=@ave,l=1:365]&#xA0;&#xA0;&#xA0; ! plotting
                      365 days xy spacially averaged data</span></b><br>
!====================================================================<br>
                  <b><span style="color:rgb(255,0,0)"><br>
                      Error</span></b><br>
                  <br>
                  <span style="color:rgb(0,0,255)">yes? go topo-rf.jnl<br>
                    use <a rel="nofollow" moz-do-not-send="true"
                      href="http://spi-rf.nc">spi-rf.nc</a> &#xA0;&#xA0;&#xA0; !
                    Rainfall data on .25x.25 grid<br>
                    set region/x=74E:81E/y=8N:15N/l=1:365 &#xA0;&#xA0;&#xA0; ! selected
                    365 days data from ~ 100 years data<br>
                    &#xA0;<br>
                    use <a rel="nofollow" moz-do-not-send="true"
                      href="http://elev.0.25-deg.nc">elev.0.25-deg.nc</a>&#xA0;
                    &#xA0;&#xA0;&#xA0; ! elevation on .25x.25 grid - variable name
                    'data' - got dataset from site.</span><br>
                  <b><span style="color:rgb(255,0,0)"><span
                        style="background-color:rgb(255,255,255)">&#xA0;***
                        NOTE: Axis coordinates are decreasing-ordered.
                        Reversing ordering for axis lat</span></span></b><br>
                  <span style="color:rgb(0,0,255)">set
                    region/x=74E:81E/y=8N:15N/l=1<br>
                    &#xA0;<br>
                    let mask1 = IF (data GE 0 AND data LT 100) THEN 1
                    else 1/0<br>
                    !let mask2 = IF (data GE 100 AND data LT 500) THEN 1
                    else 1/0<br>
                    &#xA0;<br>
                    &#xA0;<br>
                    let rf_100 = rainfall[D=1] * mask1<br>
                    !let rain_500 = rainfall * mask2<br>
                    &#xA0;<br>
                    plot rf_100[x=@ave,y=@ave,l=1:365]</span><br>
                  <span style="background-color:rgb(255,255,255)">&#xA0;<span
                      style="background-color:rgb(255,255,255)"><span
                        style="color:rgb(255,0,0)">*** NOTE: Ambiguous
                        coordinates on X axis: RAINFALL[D=1] * MASK1<br>
                        &#xA0;*** NOTE: Ambiguous coordinates on Y axis:
                        RAINFALL[D=1] * MASK1<br>
                        &#xA0;*** NOTE: Ambiguous coordinates on T axis:
                        RAINFALL[D=1] * MASK1<br>
                        &#xA0;**ERROR: inconsistent sizes of data regions: X
                        axis<br>
                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; MASK1 has 28 points (I=297:324)<br>
                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; _expression_ has 29 points (I=31:59)</span></span></span><br>
                  <span style="color:rgb(0,0,255)">plot
                    rf_100[x=@ave,y=@ave,l=1:365]</span><br>
                  <span style="color:rgb(0,0,255)">Command file, command
                    group, or REPEAT execution aborted</span><br>
                  <span style="color:rgb(0,0,255)">yes? </span><br>
=================================================================<br>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="gmail_extra"><br>
        <div class="gmail_quote">On Sat, Oct 17, 2015 at 9:58 AM, simon
          EK <span dir="ltr">&lt;<a rel="nofollow" moz-do-not-send="true"
              href="mailto:simonambat@xxxxxxxxx" target="_blank">simonambat@xxxxxxxxx</a>&gt;</span>
          wrote:<br>
          <blockquote class="gmail_quote" style="margin:0 0 0
            .8ex;border-left:1px #ccc solid;padding-left:1ex">
            <div dir="ltr">
              <div>
                <div>
                  <div>
                    <div>
                      <div>
                        <div>Dear Andre,<br>
                        </div>
                        I saw the mail of Jorg and got the background
                        information. Now I have to regrid the topo data
                        to 1/4deg as in the rain data and proceed with
                        the masking as clearly given in your mail.<br>
                        <br>
                      </div>
                      Can you please help me in regridding 1 minute grid
                      to 1/4 (0.25) deg as in rainfall data.<br>
                    </div>
                    (The rainfall data is on 1/4 deg xy grid with daily
                    data for about 100 years).<br>
                    <br>
                  </div>
                  Thanking you so much,<br>
                </div>
                Regards<span class="HOEnZb"><font color="#888888"><br>
                  </font></span></div>
              <span class="HOEnZb"><font color="#888888">Simon<br>
                </font></span></div>
            <div class="HOEnZb">
              <div class="h5">
                <div class="gmail_extra"><br>
                  <div class="gmail_quote">On Fri, Oct 16, 2015 at 10:04
                    PM, Andre Paim <span dir="ltr">&lt;<a rel="nofollow"
                        moz-do-not-send="true"
                        href="mailto:paim.oceano@xxxxxxxxx"
                        target="_blank">paim.oceano@xxxxxxxxx</a>&gt;</span>
                    wrote:<br>
                    <blockquote class="gmail_quote" style="margin:0 0 0
                      .8ex;border-left:1px #ccc solid;padding-left:1ex">
                      <div dir="ltr">Did you see Joerg's answer in you
                        other e-mail? If you manage to have both data
                        sets on the same grid, this should be easy
                        enough to go from there.
                        <div><br>
                        </div>
                        <div>About the masking, you would need to do
                          something like:</div>
                        <div>(assuming you have topography variable
                          called "topo")<br>
                        </div>
                        <div><br>
                        </div>
                        <blockquote style="margin:0px 0px 0px
                          40px;border:none;padding:0px">
                          <div>let mask1 = IF (topo GE 0 AND topo LT
                            100) THEN 1 else 1/0</div>
                          <div>let mask2 = IF (topo GE 100 AND topo LT
                            500) THEN 1 else 1/0</div>
                        </blockquote>
                        <div><br>
                        </div>
                        <div>Then you need to create a new variable
                          containing only the data in the level you
                          want:</div>
                        <div>(assuming a variable called "rain")</div>
                        <div><br>
                        </div>
                        <blockquote style="margin:0 0 0
                          40px;border:none;padding:0px">
                          <div>let rain_100 = rain * mask1</div>
                          <div>let rain_500 = rain * mask2</div>
                        </blockquote>
                        <div><br>
                        </div>
                        <div>Now all you need to do is compute your
                          average anyway you want.</div>
                        <div><br>
                        </div>
                        <div>Let me know if you have more questions.</div>
                        <div><br>
                        </div>
                        <div>Best regards,</div>
                        <div>Andre</div>
                        <div><br>
                        </div>
                      </div>
                      <div>
                        <div>
                          <div class="gmail_extra"><br>
                            <div class="gmail_quote">On 16 October 2015
                              at 05:38, simon EK <span dir="ltr">&lt;<a rel="nofollow"
                                  moz-do-not-send="true"
                                  href="mailto:simonambat@xxxxxxxxx"
                                  target="_blank">simonambat@xxxxxxxxx</a>&gt;</span>
                              wrote:<br>
                              <blockquote class="gmail_quote"
                                style="margin:0 0 0 .8ex;border-left:1px
                                #ccc solid;padding-left:1ex">
                                <div dir="ltr">
                                  <div>
                                    <div>
                                      <div>
                                        <div>
                                          <div>
                                            <div>
                                              <div>
                                                <div>
                                                  <div>
                                                    <div>
                                                      <div>Dear Ferret
                                                        users,<br>
                                                        <br>
                                                      </div>
                                                      I have a daily
                                                      rainfall dataset
                                                      on .25x.25 grid
                                                      and <br>
                                                    </div>
                                                    I have a topography
                                                    dataset with 1
                                                    minute resolution. <br>
                                                    <br>
                                                  </div>
                                                  I would like to study
                                                  the impact of altitude
                                                  on rainfall.&#xA0; Hence I
                                                  would like to get
                                                  spacial averages of
                                                  rainfall over
                                                  different altitude
                                                  regions, say<br>
                                                </div>
                                                0 to 100 meters<br>
                                              </div>
                                              100 to 500 meters<br>
                                            </div>
                                            500 to 1000 meters<br>
                                          </div>
                                          and above 1000 meters.<br>
                                        </div>
                                        I have seen certain ferret
                                        scripts&#xA0; using masking, etc. <br>
                                        <br>
                                      </div>
                                      Can you pl. help me?<br>
                                      <br>
                                    </div>
                                    Regards<span><font color="#888888"><span><font
                                            color="#888888"><br>
                                          </font></span></font></span></div>
                                  <span><font color="#888888"><span><font
                                          color="#888888">Simon </font></span>
                                      <div class="gmail_extra"><br>
                                      </div>
                                    </font></span></div>
                              </blockquote>
                            </div>
                            <br>
                          </div>
                        </div>
                      </div>
                    </blockquote>
                  </div>
                  <br>
                </div>
              </div>
            </div>
          </blockquote>
        </div>
        <br>
      </div>
    </blockquote>
    <br>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00373" href="msg00373.html">Re: [ferret_users] Re: Ferret - masking based on altitude</a></strong>
<ul><li><em>From:</em> simon EK</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00363" href="msg00363.html">[ferret_users] Ferret - masking based on altitude</a></strong>
<ul><li><em>From:</em> simon EK</li></ul></li>
<li><strong><a name="00365" href="msg00365.html">[ferret_users] Re: Ferret - masking based on altitude</a></strong>
<ul><li><em>From:</em> Andre Paim</li></ul></li>
<li><strong><a name="00369" href="msg00369.html">[ferret_users] Re: Ferret - masking based on altitude</a></strong>
<ul><li><em>From:</em> simon EK</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00371.html">RE: [ferret_users] Re: Ferret - masking based on altitude</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00373.html">Re: [ferret_users] Re: Ferret - masking based on altitude</a></strong>
</li>

</UL>
<center>[<a href="msg00371.html">Thread Prev</a>][<a href="msg00373.html">Thread Next</a>][<A HREF="threads.html#00372">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
