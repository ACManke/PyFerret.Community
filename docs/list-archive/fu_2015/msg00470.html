<!-- MHonArc v2.6.18 -->
<!--X-Subject: RE: Re: [ferret_users] regridding 3D data -->
<!--X-From-R13: Brnefr Phpunana <crnefr.ohpunanaNhgnf.rqh.nh> -->
<!--X-Date: Tue, 1 Dec 2015 15:21:52 &#45;0800 -->
<!--X-Message-Id: d0be305c663b425bbc7b0b1607242311@MBX6.utas.ad.internal -->
<!--X-Content-Type: multipart/related -->
<!--X-Reference: 565C282C.90505@io&#45;warnemuende.de -->
<!--X-Reference: 565D3FD5.6040804@io&#45;warnemuende.de -->
<!--X-Derived: pngDyQdL7Sb6o.png -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>RE: Re: [ferret_users] regridding 3D data</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00458.html">Thread Prev</a>][<a href="msg00455.html">Thread Next</a>][<A HREF="threads.html#00470">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>RE: Re: [ferret_users] regridding 3D data</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>&quot;<a href="mailto:martin.schmidt@DOMAIN.HIDDEN">martin.schmidt@xxxxxxxxxxxxxxxxx</a>&quot; &lt;<a href="mailto:martin.schmidt@DOMAIN.HIDDEN">martin.schmidt@xxxxxxxxxxxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>RE: Re: [ferret_users] regridding 3D data</strong></li>
<li><strong>From</strong>: <strong>Pearse Buchanan &lt;<a href="mailto:pearse.buchanan@DOMAIN.HIDDEN">pearse.buchanan@xxxxxxxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 1 Dec 2015 23:21:42 +0000</li>
<li>Accept-language: en-US, en-AU</li>
<li>Cc: ferret &lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa-gov.20150623.gappssmtp.com; s=20150623;        h=from:to:cc:subject:thread-topic:thread-index:date:message-id         :references:in-reply-to:accept-language:content-language         :content-type:mime-version:x-original-sender         :x-original-authentication-results:precedence:mailing-list:list-id         :list-post:list-help:list-archive:list-unsubscribe;        bh=r5KsDpKiX+RoVvXPt153R5Y7Kio/VBhLCQ6dvv2upGU=;        b=YcAm5MPqkeAN+s56Xk0c5+osVHevZrlFmUwhotC1mKq46WTNcWrhFqzoD7XknFF/V0         o7YksdK9UU+XabM/Am9+f+9rvgYSU6/oLYZnfeyBKruzqp+kUhInCtw260BlGzmaEpu6         P8hF9Z/QlLC5BhK3dr+wPxa6VosCMVE6F1sXcsHTf56eHZlgCMfcTQxQCFgro1VDHLTE         SuayHywk0IJ19anzANZvXJxNpkk2A5wnniu0493m9TIvzNCbZJu1ReAAOHMrE/pfNU4s         ijYtxUJhqOea9NAaAxfGzUMmabypC+ljb7XCaxECC8mFSiT7Z7AzcXsB9hHq1bVru7Xk         A0KA==</li>
<li>In-reply-to: &lt;<a href="msg00458.html">565D3FD5.6040804@io-warnemuende.de</a>&gt;</li>
<li>List-archive: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/">http://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="http://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">http://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/post">http://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;, &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe">http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;565C282C.90505@io-warnemuende.de&gt; &lt;<a href="msg00458.html">565D3FD5.6040804@io-warnemuende.de</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>Thread-index: AQHRLAnRCcqsrZiOj0qR3Kc/2UpAuZ62xK2w</li>
<li>Thread-topic: Re: [ferret_users] regridding 3D data</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="white" style="background-color: white; a:link { color: #0563C1 } a:visited { color: #954F72 } ">


<div class="WordSection1">
<p class="MsoNormal"><span style="font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif;color:#1F497D">Hi Martin,<o:p></o:p></span></p>
<p class="MsoNormal"><span style="font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif;color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal"><span style="font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif;color:#1F497D">Thank you for your really detailed reply to my question. I&#8217;m quite new to this and your answer really helps.<o:p></o:p></span></p>
<p class="MsoNormal"><span style="font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif;color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal"><span style="font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif;color:#1F497D">You offered to send me your scripts in your last email. Would that be alright? It&#8217;s always good to have a working example to work from. I&#8217;m especially interested
 In the <i>fill_xy</i> command you alluded to, as the fields within the original model restart file (i.e. PO<sub>4</sub>, O<sub>2</sub>, DIC, etc&#8230;) have no land component. They are completely filled across all latitudes, longitudes and depths, so that the model
 reads in a full 3D cube of values for each species. <o:p></o:p></span></p>
<p class="MsoNormal"><span style="font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif;color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal"><span style="font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif;color:#1F497D">And yes the field oesn&#8217;t have to be perfect due to the spin up.<o:p></o:p></span></p>
<p class="MsoNormal"><span style="font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif;color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal"><span style="font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif;color:#1F497D">Thanks again!<o:p></o:p></span></p>
<p class="MsoNormal"><span style="font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif;color:#1F497D">Pearse
<o:p></o:p></span></p>
<p class="MsoNormal"><span style="font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif;color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<div>
<div style="border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0cm 0cm 0cm">
<p class="MsoNormal"><b><span lang="EN-US" style="font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif;color:windowtext">From:</span></b><span lang="EN-US" style="font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif;color:windowtext"> owner-ferret_users@xxxxxxxx
 [mailto:owner-ferret_users@xxxxxxxx] <b>On Behalf Of </b>Martin Schmidt<br>
<b>Sent:</b> Tuesday, 1 December 2015 5:36 PM<br>
<b>To:</b> ferret &lt;ferret_users@xxxxxxxx&gt;<br>
<b>Subject:</b> Fwd: Re: [ferret_users] regridding 3D data<o:p></o:p></span></p>
</div>
</div>
<p class="MsoNormal"><o:p>&nbsp;</o:p></p>
<p class="MsoNormal">Hi Pearse,<br>
<br>
3d interpolation is not simple - like any interpolation. You have to make assumptions on the rules how to find values between source grid points. May be &quot;trilinear&quot; interpolation. But how do you justify this? The ocean is highly anisotropic between horizontal
 and vertical. Stratification is formed by mostly vertical processes, mixing is isoneutral in many cases. Hence ocean dynamics is not following linear &quot;interpolation rules&quot;. So why to invest much work in this direction. Also, in some areas the WOA is a climatology
 that is supported by only a few measurements anyway. So seeking accuracy from best interpolation onto the model grid may be hopeless.<br>
<br>
So I just use combined 2d-interpolation horizontally (bilinear with @ave) and 1d-interpolation vertically. The steps are:<br>
<br>
- extend the original field into land by fill_xy before interpolation to the model grid. This is a 2d nearest-neighbour averaging filler. Please consult the manual. The aim is to improve interpolation results for coastal points. Nevertheless, WOA is not well
 supported by data points near coasts in some cases.<br>
- map horizontally to the model&nbsp; grid by bilinear interpolation with @ave<br>
- apply your model land mask<br>
- interpolate vertically<br>
- fill missing model (mostly bottom and surface) cells by the 1d-nearest neighbour filler of ferret @fnr. This is an extrapolation.<br>
<br>
I am aware that your initial total nitrate content of the model may be incorrect this way. But the WOA itself has uncertaincy. Stratification from inclined isolines may be disturbed from this method. But this should be corrected during the models spin up by
 the model dynamics itself. At least the model should run into its own equilibrium during some time and should &quot;forget&quot; initial errors due to nitrate surfcace flux, denitrification, nitrification flux to sediments ...
<br>
<br>
If you are interested I can send you my scripts, just let me know.<br>
<br>
I hope this helps a little bit,<br>
Martin<br>
Am 30.11.2015 09:48, schrieb Pearse Buchanan: <o:p></o:p></p>
<blockquote style="margin-top:5.0pt;margin-bottom:5.0pt">
<div>
<p>Hi ferreters, <o:p></o:p></p>
<p>&nbsp; <o:p></o:p></p>
<p>I&#8217;m in the process of building some new routines within a global biogeochemical model. This means adding a climatology of Nitrate into the model&#8217;s restart file.
<o:p></o:p></p>
<p>&nbsp; <o:p></o:p></p>
<p>But I&#8217;m having some issues. Essentially, <o:p></o:p></p>
<p>&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; I want to take the World Ocean Atlas global annual mean of Nitrate, which has the following lat,lon,depth coordinates: [180,360,102]
<o:p></o:p></p>
<p>&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; And I want to regrid the data into the model&#8217;s coordinate system: [112,128,21]
<o:p></o:p></p>
<p>&nbsp; <o:p></o:p></p>
<p>I have looked everywhere online for some information on 3D regridding!!!!!!!! I&#8217;ve tried downloading the Earth System Modelling Framework toolbox for regridding, but to no avail.
<o:p></o:p></p>
<p>&nbsp; <o:p></o:p></p>
<p>So, I turn to this amazing ferret community for help. Does anyone have any experience doing 3-dimensional regridding!? How can I do this seemingly simple thing?
<o:p></o:p></p>
<p>&nbsp; <o:p></o:p></p>
<p>Thank you, <o:p></o:p></p>
<p>&nbsp; <o:p></o:p></p>
<p><b>Pearse J. Buchanan </b><o:p></o:p></p>
<p>PhD Candidate / CSIRO-UTAS Quantitative Marine Science <o:p></o:p></p>
<p>Institute for Marine and Antarctic Studies (IMAS), University of Tasmania <o:p>
</o:p></p>
<p>&nbsp; <o:p></o:p></p>
<p><img width="530" height="119" id="_x0000_i1025" src="pngDyQdL7Sb6o.png" alt="sig"><o:p></o:p></p>
<p>&nbsp; <o:p></o:p></p>
<p>~~~ &#8220;Ocean deoxygenation: A Palaeo-Modelling Perspective&#8221; ~~~ <o:p></o:p></p>
<p>Parts of the Ocean are predicted to lose oxygen in the coming century. But why?
<o:p></o:p></p>
<p>Looking into the past, how does oxygen in the ocean change across climate transitions?
<o:p></o:p></p>
<p>&nbsp; <o:p></o:p></p>
</div>
<p><br>
<br>
University of Tasmania Electronic Communications Policy (December, 2014). <br>
This email is confidential, and is for the intended recipient only. Access, disclosure, copying, distribution, or reliance on any of it by anyone outside the intended recipient organisation is prohibited and may be a criminal offence. Please delete if obtained
 in error and email confirmation to the sender. The views expressed in this email are not necessarily the views of the University of Tasmania, unless clearly intended otherwise.
<o:p></o:p></p>
</blockquote>
<p class="MsoNormal" style="margin-bottom:12.0pt"><o:p>&nbsp;</o:p></p>
</div>


</td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00458" href="msg00458.html">Fwd: Re: [ferret_users] regridding 3D data</a></strong>
<ul><li><em>From:</em> Martin Schmidt</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00458.html">Fwd: Re: [ferret_users] regridding 3D data</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00455.html">[ferret_users] seasonal anomaly timeseries for 30yrs</a></strong>
</li>

</UL>
<center>[<a href="msg00458.html">Thread Prev</a>][<a href="msg00455.html">Thread Next</a>][<A HREF="threads.html#00470">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
