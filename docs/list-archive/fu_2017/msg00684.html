<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] memory strategies for handling large computational requests -->
<!--X-From-R13: "Oafyrl Q. [naxr" <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Mon, 27 Nov 2017 16:36:33 &#45;0800 -->
<!--X-Message-Id: 0d7294d3&#45;5661&#45;2dc4&#45;6d74&#45;b7c862d24021@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 400769719.1005202.1511348224834.JavaMail.zimbra@lsce.ipsl.fr -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] memory strategies for handling large computational requests</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00679.html">Thread Prev</a>][<a href="msg00680.html">Thread Next</a>][<A HREF="threads.html#00684">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] memory strategies for handling large computational requests</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] memory strategies for handling large computational requests</strong></li>
<li><strong>From</strong>: <strong>&quot;Ansley C. Manke&quot; &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Mon, 27 Nov 2017 16:36:30 -0800</li>
<li>Arc-authentication-results: i=2; mx.google.com;       dkim=pass header.i=@noaa-gov.20150623.gappssmtp.com header.s=20150623 header.b=NgJ2Yxej;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a></li>
<li>Arc-authentication-results: i=1; mx.google.com;       dkim=pass header.i=@noaa-gov.20150623.gappssmtp.com header.s=20150623 header.b=NgJ2Yxej;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a></li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence         :content-language:in-reply-to:mime-version:user-agent:date         :message-id:from:references:to:subject:arc-authentication-results         :arc-message-signature:dkim-signature:arc-authentication-results;        bh=wcJ99t2aORx506I2SMgxlA7GFnGSphaA0wU994Q0oYQ=;        b=A2/xIuWjVB6iDepC/M46/sTZowm6sOt7vvZ6WubaZWaWZ73BvM+12aU6ZqwRC6hDBR         m5G508tNdMGHu1aweXa3L2V7SFaEnnVsQpWi+agF9KNO+H6mDX5WxiLu8A3fD8ESfVNi         0sDf/lE8/mRTrKhtaBk8X1hWWcb7Qi8UM5OqQkad2nbYpDrHCkcftm8AJTTUn66ULqS/         mgMfDN878zjqYQQvG00FiYOpmsZ2CfPSelqBAMQrRCNK1+j9RqRuCzxrtYoHKymHML8H         3etiry4fMdyFWwhsu2ojHzfdNhq6wDBz4lSSuPhzjOcx7qUw1snPN4NAhL9upZTHR26i         mU9A==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=content-language:in-reply-to:mime-version:user-agent:date         :message-id:from:references:to:subject:dkim-signature         :arc-authentication-results;        bh=wcJ99t2aORx506I2SMgxlA7GFnGSphaA0wU994Q0oYQ=;        b=L2rBxrdd/Pc0L2Nkbx9Oc/554oVJWLjMKHOCmxXNrOt3VwF65Dmhx5m00VFjvYDjpa         txCPXilzsZr4dQeYAZ/1kXOrutWzoIWALh5pT2Paq/MRSS0i63xL7YN55wUMoIFngWrY         Pt9pz2FB4LSoSR65sOWClEay/ZGGxYWBM/YWu/8fMrAO2DCwAFdEUd5Q0NL39UHbhbQD         TUYzJfHnXH2l2BD42ie5SXm3FFKrkPrFS4aGVstXaH9LQEgIMH/Gmo6tBS0dLeLZ7NJL         3c8KdG44agfTRB8hAz95l+t5GVLhsFCpYx69T6WY2Jq0wabM0luejQVsfr91OAoX6Jnx         PnIg==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1511829393; cv=pass;        d=google.com; s=arc-20160816;        b=DiXLB4JVWBEfxhH7nGhL1iuHY+KynZ+39/crEhMAtw+Zaf9F/DyNPiQvZoX6OB9x2m         rxZE0a5yHxo7tANjC6a5lWmlg5UMIH2GQ7QqaDw8duUDWWA+SnXa7K2CEjETQs/P/O6S         yweHpmxQMEv0VVDTmzQcbKM8LtPdtWfgoZnSH78x0o2NgYtFfafIudtiNUBQwh1Mqymp         C5hwhns/xFj4ROIU3L1NYDprn2X9oMZBHJlxR0n0asxFenzQjG9kL5EDOVUxKxJEl60T         LnqJSwfooRMsNv7ur7YrjcNplprSxpDk4cNdSJ/3E8TohoTeL9GQJjuN570zRFPyXnw+         wy0A==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1511829392; cv=none;        d=google.com; s=arc-20160816;        b=pzFdnHalf/X8qPQD8BY5gTr7SKOhfm1XbEQU/L5z4KR1exMS0UdGVeMbgwb+VNySHG         QzS+w92We1WGAXB2H2/VmWS4r9jPo3F20ROwr5I6CpklwJN3jKcUWlxdmPQYwKqrS3gD         BtI4Kz9NXvkNXUJUPSlrRt3vlvJRzebscLK52vlblNik4JEHai90rOmLmncF0UO5s/lk         UN/V34ZeC2I/Valeps7AItAOkw27NvYj+BP4JxC+QIUQ7ROr4zXPiKIiu1lMdposeCbR         EW4mCVqBLLz5eydIE4cyv/HH7i7GRrCWy7kpjpPynLBCLPF/7eiaGDNFlGeQjUAH2TNI         E5SQ==</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa-gov.20150623.gappssmtp.com; s=20150623;        h=subject:to:references:from:message-id:date:user-agent:mime-version         :in-reply-to:content-language:x-original-sender         :x-original-authentication-results:precedence:mailing-list:list-id         :list-post:list-help:list-archive;        bh=wcJ99t2aORx506I2SMgxlA7GFnGSphaA0wU994Q0oYQ=;        b=sblpc76brqKCctUz8aZTJwc2de4MMD5T0UExi5Kj9WBEukZ7x4T+JgQnqI042mgTsz         4McXV7I8uGC4uU6ebRFK9IGzKzpnh3O4lBkS0lkjCNTMSpb4U1eGw/vwU0Afk6In3x3I         /t0qsgj0ZFO8/SnEC8y0UpuNhS/YrJQ3SQycEzi6mLirCgLLrsftqFyaCjMsKjsk40Mo         0hv+iv1gdvUejpEm7ySXGJHZfIIuRjum2oqJ03OqdL3oGi3BP8lwvRPmPkL/uHj8Lx8d         CE9cs6r4ejCxaZOUU/T1p04jv0ndAz+O7IoBeewJ2medaOjBxq88ver+kz35qTozh7Go         Xf7w==</li>
<li>In-reply-to: &lt;<a href="msg00676.html">400769719.1005202.1511348224834.JavaMail.zimbra@lsce.ipsl.fr</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00676.html">400769719.1005202.1511348224834.JavaMail.zimbra@lsce.ipsl.fr</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko/20100101 Thunderbird/52.4.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    Hi Patrick,<br>
    Ferret does not need to load the whole grid into memory to do these
    operations. Ferret will try to break up the calculation itself,
    particularly with the memory-use enhancements in v7.2.&#xA0; For the
    operations you're using ferret will break up this computation.&#xA0; Not
    all computations can be broken up, either because of the nature of
    the operations themselves, or because we haven't implemented all
    combinations of operations.&#xA0; For instance function calls&#xA0; are not&#xA0;
    broken up.&#xA0; If that is the case for your computations, then writing
    a file will likely be necessary.&#xA0; Doing the operations in pieces in
    the T direction and appending is a good option. You can also append
    in other directions, as long as you first save the entire grid,
    containing say, missing data, and then use APPEND/K= /J= /I=&#xA0; to
    overwrite the file as the actual results are computed.&#xA0; See a few
    small examples of that in <a rel="nofollow" moz-do-not-send="true"
href="http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/converting-to-netcdf/SIMPLE-CONVERSIONS-USING-FERRET#_VPINDEXENTRY_1071">chapter
      10 of the Ferret users Guide</a>, examples 4, 4a, and 5.<br>
    <br>
    I'm going to do an example with your operations in some detail,
    since few of us have explored this.<br>
    <br>
    <br>
    <tt>yes? use
<a rel="nofollow" class="moz-txt-link-freetext" href="https://vesg.ipsl.upmc.fr/thredds/dodsC/IPSLFS/brocksce/tmp/CM6012.1-pi-ttop-02_23200101_30091231_1M_transpir.nc">https://vesg.ipsl.upmc.fr/thredds/dodsC/IPSLFS/brocksce/tmp/CM6012.1-pi-ttop-02_23200101_30091231_1M_transpir.nc</a></tt><tt><br>
    </tt><tt><br>
    </tt><tt>yes? show data</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0; currently SET data sets:</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0; 1&gt;
<a rel="nofollow" class="moz-txt-link-freetext" href="https://vesg.ipsl.upmc.fr/thredds/dodsC/IPSLFS/brocksce/tmp/CM6012.1-pi-ttop-02_23200101_30091231_1M_transpir.nc">https://vesg.ipsl.upmc.fr/thredds/dodsC/IPSLFS/brocksce/tmp/CM6012.1-pi-ttop-02_23200101_30091231_1M_transpir.nc</a>&#xA0;
      (default)</tt><tt><br>
    </tt><tt>&#xA0;name&#xA0;&#xA0;&#xA0;&#xA0; title&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; I&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;
      J&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; K&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; L</tt><tt><br>
    </tt><tt>&#xA0;TIME_CENTERED</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Time axis&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ...&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;
      ...&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ...&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1:8280</tt><tt><br>
    </tt><tt>&#xA0;TIME_CENTERED_BOUNDS</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1:2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;
      ...&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ...&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1:8280</tt><tt><br>
    </tt><tt>&#xA0;TRANSPIR Transpiration&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1:144&#xA0;&#xA0;&#xA0;&#xA0;
      1:143&#xA0;&#xA0;&#xA0;&#xA0; 1:13&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1:8280</tt><tt><br>
    </tt><tt>&#xA0;AREAS&#xA0;&#xA0;&#xA0; Mesh areas&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1:144&#xA0;&#xA0;&#xA0;&#xA0;
      1:143&#xA0;&#xA0;&#xA0;&#xA0; ...&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ...</tt><tt><br>
    </tt><tt>&#xA0;CONTFRAC Continental fraction&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1:144&#xA0;&#xA0;&#xA0;&#xA0;
      1:143&#xA0;&#xA0;&#xA0;&#xA0; ...&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ...</tt><tt><br>
    </tt><tt>&#xA0;</tt><tt><br>
    </tt><tt><br>
    </tt>(I made a local dataset with the same size grid for testing, as
    reading lots of data from the thredds server is somewhat slow.)<br>
    <br>
    Diagnostic mode lists information as Ferret runs, noting when it
    puts tasks on its operation stack, reads data, computes
    transformations, and does "gathering".&#xA0; The memory management in
    Ferret v7.2 breaks up computations into parts, executes those parts
    while saving partial results and finally "finalizes" by putting the
    results together.&#xA0; Earlier versions of Ferret also break
    computations up into pieces to&#xA0; reduce the amount of data that must
    be read in; in fact earlier Ferret versions do this particular thing
    in exactly the same way - the example below works with any old
    Ferret version. V7.2 would also break up the computation along the
    axes being compressed if that was the only way to shorten the
    computation.<br>
    <br>
    I'll put in some comments here in <font color="#ff6600"><b><font
          size="+1">orange</font></b></font>,<br>
    <br>
    First a shorter example, compute the result on L=1:360.&#xA0; <tt><br>
      <br>
      yes? let var=TRANSPIR[k=@sum, x=@ave, y=@ave]<br>
      <br>
    </tt><tt>yes? set memory/size=200</tt><tt><br>
    </tt><tt>yes? set mode diagnostic ! this is not needed, but lets us
      see Ferret memory management in action</tt><tt><br>
      <br>
      yes? save/clobber/file=file1.nc</tt><tt>/L=1:360 var[l=@sbx:120] <br>
      <br>
      &#xA0;getgrid EX#1&#xA0;&#xA0;&#xA0;&#xA0; C:&#xA0; 5 dset:&#xA0;&#xA0; 1 I:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0; J:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 1&#xA0;
      K:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 1&#xA0; L:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0; M:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 1&#xA0; N:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 1<br>
      &#xA0;getgrid VAR&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; C:&#xA0; 7 dset:&#xA0;&#xA0; 1 I:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0; J:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 1&#xA0;
      K:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 1&#xA0; L:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0; M:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 1&#xA0; N:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 1<br>
      &#xA0;allocate dynamic grid GBC3&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LON&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LAT&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;
      VEGET1&#xA0;&#xA0;&#xA0; TIME_COUNT<br>
      &#xA0;allocate dynamic grid GBC3&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LON&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LAT&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;
      VEGET1&#xA0;&#xA0;&#xA0; TIME_COUNT<br>
      <b>&#xA0;</b></tt><br>
    <tt><font color="#ff6600"><font size="+1"><b>Here</b></font></font><font
        size="+1"><b><font color="#ff6600"> Ferret is setting up to get
            data for L=1:420, to be able to correctly return the boxcar
            smoother var[L@SBX:120] on L=1:360, and sets up "gathering"
            to return the averaging and sum requests</font></b></font></tt><tt><br>
      strip limits reconciliation : EX#1<br>
      &#xA0;eval&#xA0;&#xA0;&#xA0; EX#1&#xA0;&#xA0;&#xA0;&#xA0; C:&#xA0; 5 dset:&#xA0;&#xA0; 1 I:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 144&#xA0; J:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0; 90&#xA0;
      K:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0; 13&#xA0; L:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 360<br>
      &#xA0;strip --&gt; VAR[L=1:360@SBX:120,D=1]<br>
      &#xA0;eval&#xA0;&#xA0;&#xA0; VAR&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; C:&#xA0; 8 dset:&#xA0;&#xA0; 1 I:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 144&#xA0; J:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0; 90&#xA0;
      K:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0; 13&#xA0; <font size="+1"><b>L:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 420</b></font><br>
      &#xA0;strip gathering TRANSPIR on T axis:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 420 dset:&#xA0;&#xA0;
      1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 420=request&#xA0;&#xA0;&#xA0;&#xA0; 100000000=availableMem<font size="+1"><b><font
            color="#ff6600"><br>
          </font></b></font><font color="#ff6600"><font color="#000000">&#xA0;strip
          --&gt; TRANSPIR[Z=0.5:13.5@SUM,D=1]<br>
          &#xA0;strip --&gt; TRANSPIR[Y=90S:90N@AV4,D=1]</font></font><font
        size="+1"><font color="#ff6600"><font color="#000000"><br>
            <font color="#ff6600"><b>It will read and compute the XY
                averages and Z sum for each subset in L:<font
                  color="#000000"> <br>
                </font></b></font></font></font></font><font
        color="#ff6600"><font color="#000000"><font color="#ff6600"><font
              color="#000000">strip --&gt;</font></font></font></font><font
        size="+1"><font color="#ff6600"><font color="#000000"><font
              color="#ff6600"><b><font color="#000000"> </font></b></font></font></font></font><font
        color="#ff6600"><font color="#000000"><font color="#ff6600"><font
              color="#000000">TRANSPIR[Z=0.5:13.5@SUM,D=1]<br>
              &#xA0;strip --&gt; TRANSPIR[Y=90S:90N@AV4,D=1]<br>
              &#xA0;<b>reading TRANSPIR M: 17 dset:&#xA0;&#xA0; 1 I:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 144&#xA0;
                J:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0; 90&#xA0; K:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0; 13&#xA0; L:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 138</b><br>
              &#xA0;doing --&gt; TRANSPIR[Y=90S:90N@AV4,D=1]<br>
              &#xA0;final --&gt; TRANSPIR[Y=90S:90N@AV4,D=1]<br>
              &#xA0;doing --&gt; TRANSPIR[Z=0.5:13.5@SUM,D=1]<br>
              &#xA0;doing gathering TRANSPIR on T axis:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 138
              dset:&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 138=request&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 99999724=availableMem<br>
              &#xA0;strip --&gt; TRANSPIR[Z=0.5:13.5@SUM,D=1]<br>
              &#xA0;strip --&gt; TRANSPIR[Y=90S:90N@AV4,D=1]<br>
              <b>&#xA0;reading TRANSPIR M: 13 dset:&#xA0;&#xA0; 1 I:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 144&#xA0;
                J:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0; 90&#xA0; K:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0; 13&#xA0; L:&#xA0;&#xA0;&#xA0; 139&#xA0;&#xA0;&#xA0; 276</b><br>
              &#xA0;doing --&gt; TRANSPIR[Y=90S:90N@AV4,D=1]<br>
              &#xA0;final --&gt; TRANSPIR[Y=90S:90N@AV4,D=1]<br>
              &#xA0;doing --&gt; TRANSPIR[Z=0.5:13.5@SUM,D=1]<br>
              &#xA0;doing gathering TRANSPIR on T axis:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 139&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 276
              dset:&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 138=request&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 99999304=availableMem<br>
              &#xA0;strip --&gt; TRANSPIR[Z=0.5:13.5@SUM,D=1]<br>
              &#xA0;strip --&gt; TRANSPIR[Y=90S:90N@AV4,D=1]<br>
              <b>&#xA0;reading TRANSPIR M: 10 dset:&#xA0;&#xA0; 1 I:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 144&#xA0;
                J:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0; 90&#xA0; K:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0; 13&#xA0; L:&#xA0;&#xA0;&#xA0; 277&#xA0;&#xA0;&#xA0; 414</b><br>
              &#xA0;doing --&gt; TRANSPIR[Y=90S:90N@AV4,D=1]<br>
              &#xA0;final --&gt; TRANSPIR[Y=90S:90N@AV4,D=1]<br>
              &#xA0;doing --&gt; TRANSPIR[Z=0.5:13.5@SUM,D=1]<br>
              &#xA0;doing gathering TRANSPIR on T axis:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 277&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 414
              dset:&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 138=request&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 99999304=availableMem<br>
              &#xA0;strip --&gt; TRANSPIR[Z=0.5:13.5@SUM,D=1]<br>
              &#xA0;strip --&gt; TRANSPIR[Y=90S:90N@AV4,D=1]<br>
              <b>&#xA0;reading TRANSPIR M:&#xA0; 7 dset:&#xA0;&#xA0; 1 I:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0; 144&#xA0;
                J:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0; 90&#xA0; K:&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0; 13&#xA0; L:&#xA0;&#xA0;&#xA0; 415&#xA0;&#xA0;&#xA0; 420</b><br>
              &#xA0;doing --&gt; TRANSPIR[Y=90S:90N@AV4,D=1]<br>
              &#xA0;final --&gt; TRANSPIR[Y=90S:90N@AV4,D=1]<br>
              &#xA0;doing --&gt; TRANSPIR[Z=0.5:13.5@SUM,D=1]<br>
              &#xA0;doing gathering TRANSPIR on T axis:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 415&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 420
              dset:&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 6=request&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 99999568=availableMem</font></font></font></font><font
        size="+1"><font color="#ff6600"><font color="#000000"><br>
            <b><font size="+2" color="#ff6600">And finally Ferret does
                the @SBX on the entire time series of XY averaged, Z
                summed data, returning </font></b></font></font></font></tt><tt><font
        size="+1"><font color="#ff6600"><font color="#000000"><tt><font
                size="+1"><font color="#ff6600"><font color="#000000"><b><font
                        size="+2" color="#ff6600">VAR[L=1:360@SBX:120]</font></b><br>
                  </font></font></font></tt></font></font></font><font
        color="#ff6600"><font color="#000000"><b>&#xA0;doing --&gt;
            VAR[L=1:360@SBX:120,D=1]</b><br>
          &#xA0;LISTing to file file1.nc</font></font><font size="+1"><b><font
            color="#ff6600"><br>
          </font></b></font>yes?<br>
      <br>
    </tt>Now do the whole set, using a larger memory setting.&#xA0; It does
    perhaps 12-15 different reads.<br>
    <tt>yes? set mem/siz=400</tt><tt><br>
    </tt><tt>yes? save/clobber/file=file2.nc&#xA0;&#xA0; var[l=@sbx:120]</tt><tt><br>
    </tt><tt>...<br>
      &#xA0;doing --&gt; VAR[T=01-JAN-232018:00:31-DEC-300918:00@SBX:120,D=1]</tt><br>
    <tt><tt><font color="#ff6600"><font color="#000000">&#xA0;LISTing to file
            file2.nc</font></font><font size="+1"><b><font
              color="#ff6600"><br>
            </font></b></font></tt></tt><br>
    <br>
    Verify that the operations on a subset of the data, computed in
    different chunks, matches what is computed for the entire dataset.<br>
    <tt><br>
      <br>
    </tt><tt>yes? cancel data/all</tt><tt><br>
    </tt><tt>yes? cancel var/all</tt><tt><br>
    </tt><tt><br>
    </tt><tt>yes? use file1.nc, file2.nc</tt><tt><br>
    </tt><tt>yes? list/l=60:70 var[d=2] - var[d=1]</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; VARIABLE : VAR[D=file2] - VAR[D=file1]</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SUBSET&#xA0;&#xA0; : 11 points (TIME)</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CALENDAR : NOLEAP</tt><tt><br>
    </tt><tt>&#xA0;16-DEC-2324 12 / 60:&#xA0;&#xA0;&#xA0; ....</tt><tt><br>
    </tt><tt>&#xA0;16-JAN-2325 12 / 61:&#xA0; 0.0000</tt><tt><br>
    </tt><tt>&#xA0;15-FEB-2325 00 / 62:&#xA0; 0.0000</tt><tt><br>
    </tt><tt>&#xA0;16-MAR-2325 12 / 63:&#xA0; 0.0000</tt><tt><br>
    </tt><tt>&#xA0;16-APR-2325 00 / 64:&#xA0; 0.0000</tt><tt><br>
    </tt><tt>&#xA0;16-MAY-2325 12 / 65:&#xA0; 0.0000</tt><tt><br>
    </tt><tt>&#xA0;16-JUN-2325 00 / 66:&#xA0; 0.0000</tt><tt><br>
    </tt><tt>&#xA0;16-JUL-2325 12 / 67:&#xA0; 0.0000</tt><tt><br>
    </tt><tt>&#xA0;16-AUG-2325 12 / 68:&#xA0; 0.0000</tt><tt><br>
    </tt><tt>&#xA0;16-SEP-2325 00 / 69:&#xA0; 0.0000</tt><tt><br>
    </tt><tt>&#xA0;16-OCT-2325 12 / 70:&#xA0; 0.0000</tt><br>
    <br>
    <tt>etc.</tt><tt><br>
      <br>
    </tt><br>
    <div class="moz-cite-prefix">On 11/22/2017 2:57 AM, Patrick
      Brockmann wrote:<br>
    </div>
    <blockquote type="cite"
      cite="">
      <div style="font-family: arial, helvetica, sans-serif; font-size:
        12pt; color: #000000">
        <div data-marker="__QUOTED_TEXT__">
          <div style="font-family: arial, helvetica, sans-serif;
            font-size: 12pt; color: #000000">
            <div>
              <div style="font-family: arial, helvetica, sans-serif;
                font-size: 12pt; color: #000000">
                <div>
                  <div style="font-family: arial, helvetica, sans-serif;
                    font-size: 12pt; color: #000000">
                    <div>Hi ferreters,<br>
                    </div>
                    <br>
                    <div>I would like to plot time series with quite
                      huge file (8.3G) from a variable XYZT
                      (144x143x13x8280).<br>
                    </div>
                    <div>I have worked with last 7.2 ferret release and
                      tried different increases of memory without
                      success.</div>
                    <div>I always get&#xA0; **ERROR: request exceeds memory
                      setting<br>
                      <br>
                    </div>
                    <div>Next step would be as suggested from doc
(<a rel="nofollow" class="moz-txt-link-freetext" href="http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/computing-environment/MEMORY-USE">http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/computing-environment/MEMORY-USE</a>)<br>
                    </div>
                    <div>to break up my request into fragments. <br>
                    </div>
                    <div>Is it the best solution in my case ?<br>
                    </div>
                    <br>
                    <div>My ressource is available from<br>
                    </div>
                    <div><a rel="nofollow" class="moz-txt-link-freetext" href="https://vesg.ipsl.upmc.fr/thredds/catalog/IPSLFS/brocksce/tmp/catalog.html?dataset=DatasetScanIPSLFS/brocksce/tmp/CM6012.1-pi-ttop-02_23200101_30091231_1M_transpir.nc">https://vesg.ipsl.upmc.fr/thredds/catalog/IPSLFS/brocksce/tmp/catalog.html?dataset=DatasetScanIPSLFS/brocksce/tmp/CM6012.1-pi-ttop-02_23200101_30091231_1M_transpir.nc</a><br>
                    </div>
                    <br>
                    <div>Typical code lines are:<br>
                    </div>
                    <br>
                    <div>yes? use
                      CM6012.1-pi-ttop-02_23200101_30091231_1M_transpir.nc<br>
                    </div>
                    <div>yes? let var=TRANSPIR[k=@sum, x=@ave, y=@ave]<br>
                      yes? plot var[l=@sbx:120]<br>
                      <br>
                    </div>
                    <div>! the following pass because I have limites
                      time range (1:1200)<br>
                    </div>
                    <div>yes? plot var[l=1:1200@sbx:120]<br>
                    </div>
                    <br>
                    <br>
                    <div>Any help welcome.<br>
                    </div>
                    <div>Regards<br>
                    </div>
                    <div>Patrick<br>
                    </div>
                    <br>
                    <div>--<br>
                      Data Analysis and Visualization Engineer<br>
                      LSCE/IPSL, CEA-CNRS-UVSQ laboratory<br>
                      LSCE - Climate and Environment Sciences Laboratory<br>
                      IPSL - Institut Pierre Simon Laplace<br>
                      --</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <br>
        </div>
      </div>
    </blockquote>
    <br>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00676" href="msg00676.html">[ferret_users] memory strategies for handling large computational requests</a></strong>
<ul><li><em>From:</em> Patrick Brockmann</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00679.html">Re: [ferret_users] Re: memory strategies for handling large computational requests</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00680.html">[ferret_users] Assigning values to a variable</a></strong>
</li>

</UL>
<center>[<a href="msg00679.html">Thread Prev</a>][<a href="msg00680.html">Thread Next</a>][<A HREF="threads.html#00684">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
