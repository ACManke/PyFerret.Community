<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] converting depth cordinated into density (sigma) cordinate -->
<!--X-From-R13: Pvyyl Yrffyre <jvyyvnz.f.xrffyreNabnn.tbi> -->
<!--X-Date: Fri, 20 Jan 2017 13:46:25 &#45;0800 -->
<!--X-Message-Id: B3259816&#45;634C&#45;4450&#45;978E&#45;AF4421C1ED72@noaa.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CAPV_wXNpRWBjO12373jH2gVeBXvgX_bfV_XwEXfpeceN3=rXpg@mail.gmail.com -->
<!--X-Reference: 47813329&#45;8af4&#45;423d&#45;5df3&#45;23a548065742@noaa.gov -->
<!--X-Reference: CAPV_wXNLxmz3HyaTa+RqDJbJVi0pj3L5W6QXrshXSp=&#45;4=p9MA@mail.gmail.com -->
<!--X-Reference: 53752ad3&#45;51ff&#45;9c0e&#45;c77a&#45;292f2196553b@noaa.gov -->
<!--X-Reference: CAEwQpaLvZ3Ygrpy&#45;RNrrTxCd_Dji=kF912JppnqXtmyg4mLRiw@mail.gmail.com -->
<!--X-Reference: CAPV_wXNsCsOYYbKYRA8Jjgq7zzy&#45;WpjekmRJMAxeO_L4ztS3Ww@mail.gmail.com -->
<!--X-Reference: alpine.LFD.2.03.1701191634001.2249@lsce.ipsl.fr -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] converting depth cordinated into density (sigma) cordinate</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00041.html">Thread Prev</a>][<a href="msg00029.html">Thread Next</a>][<A HREF="threads.html#00042">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] converting depth cordinated into density (sigma) cordinate</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>James Orr &lt;<a href="mailto:James.Orr@DOMAIN.HIDDEN">James.Orr@xxxxxxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] converting depth cordinated into density (sigma) cordinate</strong></li>
<li><strong>From</strong>: <strong>Billy Kessler &lt;<a href="mailto:william.s.kessler@DOMAIN.HIDDEN">william.s.kessler@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Fri, 20 Jan 2017 13:46:20 -0800</li>
<li>Cc: ferret users &lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa-gov.20150623.gappssmtp.com; s=20150623;        h=mime-version:subject:from:in-reply-to:date:cc         :content-transfer-encoding:message-id:references:to         :x-original-sender:x-original-authentication-results:precedence         :mailing-list:list-id:list-post:list-help:list-archive         :list-unsubscribe;        bh=hFclmf5xGaolceTYzjGWhkzBkox+HFaIGwoBHJw8wdo=;        b=r3Ir7TDulPK9Z1S6x01LC5qO4C2YbK3giSq9aZ/no5hduTMSGOqb4CWbSQrGlzRt4R         qmZXc1cDJzxn28uOsgfyTgNFGALflZPt1pYxQumDzT4iuJSyi+dfV7+oj7l0oUHGfDPL         pjgzC8ZT5G8K5cRRo3wyjxkJ6QGAkhLbsj7ColeDLVQkSsImcruMDugBbwaClC3Mo1ry         dp/LXmQ7yFRxvBr78oyhl1HHwbS6lehVNnRNhH3eyWZftmQHGkHdMwpCTZUyXole8YeJ         BR4Eu2SJ362JAibeKZkafVzPYBFFW7dmnw8Bl/fX7MQ/iAStHUMEcZhyXBnu4RgV4YqP         q91A==</li>
<li>In-reply-to: &lt;<a href="msg00041.html">alpine.LFD.2.03.1701191634001.2249@lsce.ipsl.fr</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;, &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/subscribe">https://groups.google.com/a/noaa.gov/group/ferret_users/subscribe</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;CAPV_wXNpRWBjO12373jH2gVeBXvgX_bfV_XwEXfpeceN3=rXpg@mail.gmail.com&gt; &lt;<a href="msg00031.html">47813329-8af4-423d-5df3-23a548065742@noaa.gov</a>&gt; &lt;CAPV_wXNLxmz3HyaTa+RqDJbJVi0pj3L5W6QXrshXSp=-4=p9MA@mail.gmail.com&gt; &lt;<a href="msg00033.html">53752ad3-51ff-9c0e-c77a-292f2196553b@noaa.gov</a>&gt; &lt;CAEwQpaLvZ3Ygrpy-RNrrTxCd_Dji=kF912JppnqXtmyg4mLRiw@mail.gmail.com&gt; &lt;<a href="msg00035.html">CAPV_wXNsCsOYYbKYRA8Jjgq7zzy-WpjekmRJMAxeO_L4ztS3Ww@mail.gmail.com</a>&gt; &lt;<a href="msg00041.html">alpine.LFD.2.03.1701191634001.2249@lsce.ipsl.fr</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Thanks for that useful code.

One suggestion. It is helpful to define pi exactly: LET PI=4*atan(1)
Then you can do calculations with the variable PI instead of writing numbers like 57.29578. It help reduce typos.

I have a file &quot;redefine.go&quot; which does this (and other useful numbers). redefine.go is the single line:
let pi=4*atan(1); let deg=111198.6; let twomega=1.458e-4; let beta=2.28e-11

Then if I want to clear out a mess of definitions, I can just 
yes? can var/all
yes? go redefine.go   ! restore basic definitions

This stuff can also be scripted to run automatically whenever you start a ferret session.

Billy


&gt; On Jan 20, 2017, at 11:49 AM, James Orr &lt;James.Orr@xxxxxxxxxxxx&gt; wrote:
&gt; 
&gt; If you really want to convert pressure to depth, see the paper by
&gt; 
&gt; Saunders P.M., Fofonoff N.P. (1976): Conversion of pressure to depth in the ocean. Deep-Sea Res. 23:109-111.
&gt; 
&gt; Here is a code snippet to do that conversion in Ferret:
&gt; 
&gt; ! Input for pressure-to-depth conversion
&gt; let lat = -30       ! latitude in degrees (30S, same result as 30N)
&gt; let P = 10000       ! hydrostatic pressure in decibars
&gt; 
&gt; ! Saunders &amp; Fofonoff algorithm to compute depth (m) from pressure (db)
&gt; let alat = abs(lat)
&gt; let a = sin(alat / 57.29578)
&gt; let xx = a * a
&gt; let gr = 9.780318 * (1.0 + (5.2788E-3 + 2.36E-5 * xx) * xx) + 1.092E-6 * P
&gt; let depthterm = (((-1.82E-15 * P + 2.279E-10) * P - 2.2512E-5) * P + 9.72659) * P
&gt; let depth = depthterm / gr
&gt; list depth
&gt; 
&gt; The corresponding code in Fortran is available in a 1983 report from UNESCO (see page 28):
&gt; 
&gt; UNESCO (1983): Algorithms for computation of fundamental properties of seawater. UNESCO technical papers in marine science 44:1-55.
&gt; 
&gt; <a  rel="nofollow" href="http://unesdoc.unesco.org/images/0005/000598/059832eb.pdf">http://unesdoc.unesco.org/images/0005/000598/059832eb.pdf</a>
&gt; 
&gt; Cheers,
&gt; 
&gt; Jim
&gt; 
&gt; On Wed, 18 Jan 2017, binny ra wrote:
&gt; 
&gt;&gt; Hi Ryo, Ansley and Ferreters
&gt;&gt; As of now its very difficult for me to get Z axis in meters from Z axis of dbars but what I can do is this:-
&gt;&gt; suppose I am having two NC files
&gt;&gt; salt_pressure.nc          !! salinity in unit of dbars axis
&gt;&gt; salt_meter.nc               !! salinity in units of meter axis
&gt;&gt; so can I do like this to get salinity in the Z axis of units of meter
&gt;&gt; let salt_new_meter=salt_pressure[gz=salt_meter]
&gt;&gt; so in this way I am replacing the Z axis of dbars from Z axis of meters. Is this the way I can use to get my
&gt;&gt; desired results ?
&gt;&gt; regards, binny
&gt;&gt; On Wed, Jan 18, 2017 at 1:09 PM, Ryo Furue &lt;furue@xxxxxxxxxx&gt; wrote:
&gt;&gt;      Hi Binny, Ansley, and ferret users,
&gt;&gt; 
&gt;&gt;      On Wed, Jan 18, 2017 at 5:32 AM, Ansley C. Manke
&gt;&gt;      &lt;ansley.b.manke@xxxxxxxx&gt; wrote:
&gt;&gt; 
&gt;&gt;      &gt; The method would be the same. You need an expression that relates the units
&gt;&gt;      &gt; of Z axis to the other; it doesn't matter what is being converted to what.
&gt;&gt; 
&gt;&gt;      I agree, but one issue that may not be obvious when you want to
&gt;&gt;      convert to the z axis, is how to find the &quot;z field&quot;.  In the
&gt;&gt;      z-to-sigma (z-to-density) conversion of the 3D variable salt
&gt;&gt; 
&gt;&gt;         ZAXREPLACE( salt, sigma, z[gz=axden]) ,
&gt;&gt; 
&gt;&gt;      you need the 3D variable sigma(x,y,z).  To convert a 3D variable
&gt;&gt;      salt(x,y,p) to the z axis, one needs the 3D &quot;z field&quot; z3d(x,y,p),
&gt;&gt;      which is the depth of the isobaric surface p at (x,y). If you have
&gt;&gt;      such a variable, then the conversion would be
&gt;&gt; 
&gt;&gt;          ZAXREPLACE(salt, z3d, z[gz=z_axis]) .
&gt;&gt; 
&gt;&gt;      You can compute z3d using the hydrostatic relation dp/dz = - rho z if
&gt;&gt;      you know density.
&gt;&gt; 
&gt;&gt;      HAVING SAID THAT, is this really what you are after, Binny?
&gt;&gt; 
&gt;&gt;      Normally, pressure-to-z conversion is just to &quot;re-interpret&quot; the
&gt;&gt;      vertical axis: You equate 10 dbar to 10 meters, for example. If this
&gt;&gt;      re-interpretation is fine, all you need is
&gt;&gt; 
&gt;&gt;          define axis/z= . . . ./units=meters  z_axis
&gt;&gt;          let salt_in_z = salt_in_p[gz=z_axis@ASN]
&gt;&gt; 
&gt;&gt;      See
&gt;&gt;      <a  rel="nofollow" href="http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/Grids-Regions/GRIDS#_VPINDEXENTRY_663">http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/Grids-Regions/GRIDS#_VPINDEXENTRY_663</a>
&gt;&gt;      for the @ASN transformation.  There is an example down the webpage.
&gt;&gt; 
&gt;&gt;      Regards,
&gt;&gt; 
&gt;&gt;      Ryo
&gt;&gt; 
&gt; 
&gt; -- 
&gt; LSCE/IPSL, Laboratoire des Sciences du Climat et de l'Environnement
&gt; CEA-CNRS-UVSQ
&gt; 
&gt; LSCE/IPSL, CEA Saclay           <a  rel="nofollow" href="http://www.ipsl.jussieu.fr/~jomce">http://www.ipsl.jussieu.fr/~jomce</a>
&gt; Bat. 712 - Orme                 mailto:  James.Orr@xxxxxxxxxxxx
&gt; Point courrier 132
&gt; F-91191 Gif-sur-Yvette Cedex    Phone:   (33) (0)1 69 08 39 73
&gt; FRANCE                          Fax:     (33) (0)1 69 08 30 73



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00028" href="msg00028.html">[ferret_users] converting depth cordinated into density (sigma) cordinate</a></strong>
<ul><li><em>From:</em> binny ra</li></ul></li>
<li><strong><a name="00031" href="msg00031.html">Re: [ferret_users] converting depth cordinated into density (sigma) cordinate</a></strong>
<ul><li><em>From:</em> Ansley C. Manke</li></ul></li>
<li><strong><a name="00032" href="msg00032.html">Re: [ferret_users] converting depth cordinated into density (sigma) cordinate</a></strong>
<ul><li><em>From:</em> binny ra</li></ul></li>
<li><strong><a name="00033" href="msg00033.html">Re: [ferret_users] converting depth cordinated into density (sigma) cordinate</a></strong>
<ul><li><em>From:</em> Ansley C. Manke</li></ul></li>
<li><strong><a name="00034" href="msg00034.html">Re: [ferret_users] converting depth cordinated into density (sigma) cordinate</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
<li><strong><a name="00035" href="msg00035.html">Re: [ferret_users] converting depth cordinated into density (sigma) cordinate</a></strong>
<ul><li><em>From:</em> binny ra</li></ul></li>
<li><strong><a name="00041" href="msg00041.html">Re: [ferret_users] converting depth cordinated into density (sigma) cordinate</a></strong>
<ul><li><em>From:</em> James Orr</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00041.html">Re: [ferret_users] converting depth cordinated into density (sigma) cordinate</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00029.html">[ferret_users] Help with contour labels</a></strong>
</li>

</UL>
<center>[<a href="msg00041.html">Thread Prev</a>][<a href="msg00029.html">Thread Next</a>][<A HREF="threads.html#00042">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
