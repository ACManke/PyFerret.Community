<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] unexpected difference depending on order of integration and annual cycle -->
<!--X-From-R13: Oaqerj Ivggraoret &#45; @AOO Trqreny <naqerj.jvggraoretNabnn.tbi> -->
<!--X-Date: Wed, 22 Mar 2017 15:01:31 &#45;0700 -->
<!--X-Message-Id: CAKoe08TrzaheB+aHUr2DYNPOyoA+8hmBZD+4fcA9Rjjjkpp8jw@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 6DADBCE5&#45;7F1A&#45;4EBF&#45;AFB6&#45;DDA5416DE892@noaa.gov -->
<!--X-Reference: 9d9869b5&#45;e074&#45;69f8&#45;7b32&#45;38dbbcf58165@io&#45;warnemuende.de -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] unexpected difference depending on order of integration and annual cycle</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00231.html">Thread Prev</a>][<a href="msg00237.html">Thread Next</a>][<A HREF="threads.html#00232">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] unexpected difference depending on order of integration and annual cycle</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>&quot;William S. Kessler&quot; &lt;<a href="mailto:william.s.kessler@DOMAIN.HIDDEN">william.s.kessler@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] unexpected difference depending on order of integration and annual cycle</strong></li>
<li><strong>From</strong>: <strong>Andrew Wittenberg - NOAA Federal &lt;<a href="mailto:andrew.wittenberg@DOMAIN.HIDDEN">andrew.wittenberg@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Wed, 22 Mar 2017 18:01:29 -0400</li>
<li>Cc: Ferret Users &lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa-gov.20150623.gappssmtp.com; s=20150623;        h=mime-version:in-reply-to:references:from:date:message-id:subject:to         :cc:x-original-sender:x-original-authentication-results:precedence         :mailing-list:list-id:list-post:list-help:list-archive         :list-unsubscribe;        bh=Fm27p1fbb3pC2yu7j/h+9RsZtB11cYGQHz6oGAPN7VM=;        b=U9tZLfNf+K9PkYqlIlK23OF8HTQnQOYLOoQxLJNZSlfIixmOjx4tHNJl6gLo9icVzE         bb4Xc34OMWf/9m32hP0eQD67PLaUGvqTeiZKG2hOugoNI/fPIksydsp0vKipvsKOh04m         awbiA7CoAF6zvbPt26DnYunsMEiug2GQOJ2WG3Sg2qI9Si0u8ScaJjwMkeNdWq5ccukq         PhyDQSU+I8eNy85NFzTJdLFGcraGOGI9Ge6wgtczzVQjtj0PcAcjOdgDz4oTkUmajIbz         s4nGbJ8xNQpaH6gvk3FyapF+SO0ykX9Svx8UsrVlk/JumPcaGEIch3p8qnaKJW9XibQB         2+5g==</li>
<li>In-reply-to: &lt;<a href="msg00231.html">9d9869b5-e074-69f8-7b32-38dbbcf58165@io-warnemuende.de</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;, &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/subscribe">https://groups.google.com/a/noaa.gov/group/ferret_users/subscribe</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00230.html">6DADBCE5-7F1A-4EBF-AFB6-DDA5416DE892@noaa.gov</a>&gt; &lt;<a href="msg00231.html">9d9869b5-e074-69f8-7b32-38dbbcf58165@io-warnemuende.de</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<div dir="ltr"><div class="gmail_default" style="font-family:arial,helvetica,sans-serif">Hi Billy,</div><div class="gmail_default" style="font-family:arial,helvetica,sans-serif"><br></div><div class="gmail_default" style="font-family:arial,helvetica,sans-serif">It&#39;s probably due to your time-dependent mask.&#xA0; First try filling narrow longitude gaps with:</div><div class="gmail_default" style="font-family:arial,helvetica,sans-serif"><br></div><div class="gmail_default"><font face="arial, helvetica, sans-serif">yes? let var_fill = IF max(var[x=@cia],var[x=@cib]) LE 2 THEN var[x=@fln]</font><br></div><div class="gmail_default" style="font-family:arial,helvetica,sans-serif"><br></div><div class="gmail_default" style="font-family:arial,helvetica,sans-serif">Then omit years with particularly bad coverage:</div><div class="gmail_default" style="font-family:arial,helvetica,sans-serif"><br></div><div class="gmail_default"><font face="arial, helvetica, sans-serif">yes? let var_crop = var_fill[t=1-jan-1995:1-jan-2016]</font><br></div><div class="gmail_default"><font face="arial, helvetica, sans-serif"><br></font></div><div class="gmail_default"><font face="arial, helvetica, sans-serif">Then make your mask stationary in time, by masking out any longitudes that are EVER missing:</font></div><div class="gmail_default"><font face="arial, helvetica, sans-serif"><br></font></div><div class="gmail_default"><font face="arial, helvetica, sans-serif">yes? let var_static = IF var_crop[t=@nbd] EQ 0 THEN var_crop</font></div><div class="gmail_default"><font face="arial, helvetica, sans-serif"><br></font></div><div class="gmail_default"><font face="arial, helvetica, sans-serif">Then try your test again on VAR_STATIC.</font></div><div class="gmail_default" style="font-family:arial,helvetica,sans-serif"><br></div><div class="gmail_default" style="font-family:arial,helvetica,sans-serif">Andrew</div><div class="gmail_extra">
<br><div class="gmail_quote">On Wed, Mar 22, 2017 at 4:39 PM, Martin Schmidt <span dir="ltr">&lt;<a rel="nofollow" href="mailto:martin.schmidt@xxxxxxxxxxxxxxxxx" target="_blank">martin.schmidt@xxxxxxxxxxxxxxxxx</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">
  
    
  
  <div bgcolor="#FFFFFF">
    <p>Hi William,</p>
    <p>I do not have the complete explanation. But:</p>
    <p>shade var</p>
    <p>reveals missing values with time dependent distribution.
      Replacing &quot;var&quot; by &quot;missing(var,0)&quot; gives results independent off
      the order of operations. <br>
    </p>
    <p>The @mod transformation should imply some division by @ngd. What
      @ngd is depends on the order of operations. So far, things may by
      not fully linear any more?</p>
    <p>Best,</p>
    <p>Martin<br>
    </p>
    <br>
    <div class="gmail-m_7741843557293167429moz-cite-prefix">On 03/22/2017 07:32 PM, William Kessler
      wrote:<br>
    </div>
    <blockquote type="cite">
      <pre>Hi Ferreters -

I have a confusing difference in result depending on the order of operations. These should all be linear operations, so the order of doing them should not affect the result. I&#39;m confused. 

The differences are smallish but could be significant. This is, by the way, the Ekman transport across 7.5S, and the differences are a few Sv.

In one case, I first find the annual cycle, then integrate the result in x. In the other, I first integrate in x, then find the annual cycle of the result. These should be identical, but aren&#39;t (attached gif plot). I don&#39;t know which is correct.

Why not? 

The attached cdf file (357Kb) has 5 variables:

VAR      original time series       
VAR_CL   annual cycle of original   
VAR_INT  x-integral of original     
VAR_INTCL  annual cycle of x-integral 
VAR_CLINT   x-integral of annual cycle 

These variables were defined by the following commands:

yes? let/tit=&quot;original time series&quot; var=eky[y=7.5s,x=148e:82w]
yes? let/tit=&quot;annual cycle of original&quot; var_cl=var[gt=month_irreg@mod]
yes? let/tit=&quot;x-integral of original&quot; var_int=var[x=@din]
yes? let/tit=&quot;annual cycle of x-integral&quot; var_intcl=var_int[gt=month_<wbr>irreg@mod]
yes? let/tit=&quot;x-integral of annual cycle&quot; var_clint=var_cl[x=@din]
yes? save/outtype=float/file=check_<wbr>order_of_operations.cdf var,var_cl,var_int,var_intcl,<wbr>var_clint

yes? plot/line/sym=27 var_intcl,var_clint

This is Ferret v6.94 (Mac)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<wbr>~~~~~~~~~~~~~~~
William S. Kessler
NOAA / Pacific Marine Environmental Laboratory
7600 Sand Point Way NE
Seattle WA 98115 USA

<a rel="nofollow" class="gmail-m_7741843557293167429moz-txt-link-abbreviated" href="mailto:william.s.kessler@xxxxxxxx" target="_blank">william.s.kessler@xxxxxxxx</a>
Tel: <a rel="nofollow" href="tel:(206)%20526-6221" value="+12065266221" target="_blank">+1 206-526-6221</a>
Fax: <a rel="nofollow" href="tel:(206)%20526-6744" value="+12065266744" target="_blank">+1 206-526-6744</a>
</pre>
      <br>
      <fieldset class="gmail-m_7741843557293167429mimeAttachmentHeader"></fieldset>
      <br>
      <pre></pre>
    </blockquote>
    <br>
  </div>

</blockquote></div><br></div></div>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00230" href="msg00230.html">[ferret_users] unexpected difference depending on order of integration and annual cycle</a></strong>
<ul><li><em>From:</em> William Kessler</li></ul></li>
<li><strong><a name="00231" href="msg00231.html">Re: [ferret_users] unexpected difference depending on order of integration and annual cycle</a></strong>
<ul><li><em>From:</em> Martin Schmidt</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00231.html">Re: [ferret_users] unexpected difference depending on order of integration and annual cycle</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00237.html">[ferret_users] diagonal section</a></strong>
</li>

</UL>
<center>[<a href="msg00231.html">Thread Prev</a>][<a href="msg00237.html">Thread Next</a>][<A HREF="threads.html#00232">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
