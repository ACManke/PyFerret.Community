<!-- MHonArc v2.6.18 -->
<!--X-Subject: [ferret_users] =?UTF&#45;8?Q?Re:_[ferret=5fusers]_20=c2=b0_E_seems_to_be_magic?= -->
<!--X-From-R13: [negva Epuzvqg <znegva.fpuzvqgNvb&#45;jnearzhraqr.qr> -->
<!--X-Date: Fri, 27 Jan 2017 07:38:58 &#45;0800 -->
<!--X-Message-Id: 533859a3&#45;e5a3&#45;f731&#45;7f3f&#45;84872bf93070@io&#45;warnemuende.de -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CAOs80Nw+8NnyzCaUrSefk5OZQ2f40VMiHbs78H+KmcwZK&#45;=A1g@mail.gmail.com -->
<!--X-Reference: 28cb516a&#45;5e29&#45;1afb&#45;a94d&#45;d4df96cfef9a@io&#45;warnemuende.de -->
<!--X-Reference: 5aa0b3c1&#45;dcdd&#45;22e4&#45;324c&#45;3077e6684f2b@itu.edu.tr -->
<!--X-Reference: CAPTKT0e_KOJ1Ue9Y&#45;JffnV4HPqvxg4njTkxpdMuhF&#45;A7QSP8zw@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[ferret_users] Re: [ferret_users] 20&#xB0; E seems to be magic</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00051.html">Thread Prev</a>][<a href="msg00053.html">Thread Next</a>][<A HREF="threads.html#00052">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[ferret_users] Re: [ferret_users] 20&#xB0; E seems to be magic</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>[ferret_users] Re: [ferret_users] 20&#xB0; E seems to be magic</strong></li>
<li><strong>From</strong>: <strong>Martin Schmidt &lt;<a href="mailto:martin.schmidt@DOMAIN.HIDDEN">martin.schmidt@xxxxxxxxxxxxxxxxx</a>&gt;</strong></li>
<li>Date: Fri, 27 Jan 2017 16:38:28 +0100</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa-gov.20150623.gappssmtp.com; s=20150623;        h=subject:to:references:from:message-id:date:user-agent:mime-version         :in-reply-to:x-original-sender:x-original-authentication-results         :precedence:mailing-list:list-id:list-post:list-help:list-archive         :list-unsubscribe;        bh=IxODcxhzUzwqYzL8A6uoAKTi0r1rgQ1Gm0YmRx4IKGU=;        b=HLYkPVMHBwf2eUgR9mlEs5D3+ltcafGlKtXtc1/8uVwm5ajaFtfkumtfb/yn3twL3N         mpQEuyjY0lsTygL+D4A+AP1xOOWQXQ1c1TC7E9x60YKnBLDAWKh7QcYQqLJhSYEvpyMN         IMaRiny78ZoqXFINFLtef8cfnHCj4zs/nnHXfeAajZMDfA2ELh8IS+ZmukmHBVSmfFrq         j+RHBn5ypNO8MnXjzlS3bCGRuU6xkjT0wnS2mjVD+G+ajleATrtO06OpCqBfknqVcmVd         tv8rdr5K1XFeJdlFGi73bnIwV2IMmTreyGaO2WVTArBZLsr+d83QA4Y2BdvKmHCcmELX         /5fQ==</li>
<li>In-reply-to: &lt;<a href="msg00051.html">CAPTKT0e_KOJ1Ue9Y-JffnV4HPqvxg4njTkxpdMuhF-A7QSP8zw@mail.gmail.com</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;, &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/subscribe">https://groups.google.com/a/noaa.gov/group/ferret_users/subscribe</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;CAOs80Nw+8NnyzCaUrSefk5OZQ2f40VMiHbs78H+KmcwZK-=A1g@mail.gmail.com&gt; &lt;<a href="msg00049.html">28cb516a-5e29-1afb-a94d-d4df96cfef9a@io-warnemuende.de</a>&gt; &lt;<a href="msg00050.html">5aa0b3c1-dcdd-22e4-324c-3077e6684f2b@itu.edu.tr</a>&gt; &lt;<a href="msg00051.html">CAPTKT0e_KOJ1Ue9Y-JffnV4HPqvxg4njTkxpdMuhF-A7QSP8zw@mail.gmail.com</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (X11; Linux x86_64; rv:45.0) Gecko/20100101 Thunderbird/45.5.1</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    <div class="moz-cite-prefix">Hi all, thank for the suggestions!
      Seems to be a Pandoran box. But step by step ...<br>
      <br>
      The following does not work:<br>
      ferret<br>
      yes? use coads_climatology<br>
      yes? shade/l=1/x=-20:40/y=-60:0 sst<br>
      yes? shade/over/lev=(100)/pal=grey missing(sst[l=1],100)<br>
      :-(<br>
      <br>
      Try to use another specification of coordinates:<br>
      ferret<br>
      yes? use coads_climatology<br>
      yes? shade/l=1/x=20W:40E/y=60S:0N sst<br>
      yes? shade/over/lev=(100)/pal=grey missing(sst[l=1],100)<br>
      )-:<br>
      <br>
      OK, lets say it explicitly<br>
      ferret<br>
      yes? use coads_climatology<br>
      yes? shade/l=1/x=-20:40/y=-60:0/grat sst<br>
      yes? shade/over/lev=(100)/pal=grey/x=-20:40/y=-60:0
      missing(sst[l=1],100)<br>
      <br>
      Much better. Is it eventuall the "missing" function?<br>
      ferret<br>
      yes? use coads_climatology<br>
      yes? shade/l=1/x=-20:40/y=-60:0/grat sst<br>
      yes? shade/over/pal=bluescale sst[l=1]*10<br>
      Definitely not, it is most probably the missing coordinate
      specification in the overlay.<br>
      <br>
      What tells ncdump:<br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; double COADSX(COADSX) ;<br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; COADSX:units = "degrees_east" ;<br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; COADSX:modulo = " " ;<br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; COADSX:point_spacing = "even" ;<br>
      &#xA0;COADSX = 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47,
      49, 51, 53, <br>
      .....<br>
      &#xA0;&#xA0;&#xA0; 373, 375, 377, 379 ;<br>
      Hm, 20&#xB0;E is really a special point, but the axis is modulo.<br>
      <br>
      Lets have graticule now<br>
      ferret<br>
      yes? use coads_climatology<br>
      yes? shade/l=1/x=-20:40/y=-60:0/grat sst<br>
      yes? shade/over/lev=(100)/pal=grey/x=-20:40/y=-60:0
      missing(sst[l=1],100)<br>
      <br>
      Excellent. Perfect for scientific work. But not for others
      purposes...<br>
      Remeber in "fill" to gain fake accuracy:<br>
      ferret<br>
      yes? use coads_climatology<br>
      yes? fill/l=1/x=-20:40/y=-60:0/grat sst<br>
      yes? shade/over/lev=(100)/pal=grey/x=-20:40/y=-60:0
      missing(sst[l=1],100)<br>
      <br>
      Smoother, but the white spots are still disturbing. So fill them
      with "shade" first and overlay with "fill":<br>
      yes? use coads_climatology<br>
      yes? shade/l=1/x=-20:40/y=-60:0 sst
      <br>
      yes? fill/l=1/x=-20.5:40.5/y=-60:0/over sst
      <br>
      yes? shade/over/lev=(100)/pal=grey/x=-20:40/y=-60:0
      missing(sst[l=1],100)
      <br>
      <br>
      This does the same<br>
      yes? use coads_climatology<br>
      yes? set region/x=-20:40/y=-60:0<br>
      yes? shade/l=1 sst
      <br>
      yes? fill/l=1/over sst
      <br>
      yes? shade/over/lev=(100)/pal=grey missing(sst[l=1],100)
      <br>
      <br>
      Now we try to add graticule:<br>
      yes? use coads_climatology<br>
      yes? set region/x=-20:40/y=-60:0<br>
      yes? shade/l=1/grat sst
      <br>
      yes? fill/l=1/over/grat sst
      <br>
      yes? shade/over/lev=(100)/pal=grey/grat missing(sst[l=1],100)
      <br>
      Land is filled correctly, but the graticule is mostly lost. It may
      be redrawn using a second viewport, or with explicit lines. But
      lets search for a simpler solution.<br>
      <br>
      Extend the ocean into land with the nearest neighbour filler
      fill_xy before using "fill" It calculates the average over all
      valid nearest neighbour points. This can be done repeatedly. A
      smooth and limited extrapolation. <br>
      yes? use coads_climatology<br>
      yes? set region/x=-20:40/y=-60:0<br>
      yes? let mask=0*missing(sst[l=1],1)+1 ! Nothing to be excluded<br>
      yes? fill/l=1/grat fill_xy(sst,mask,1)<br>
      yes? shade/over /lev=(100)/pal=grey missing(sst[l=1],100)<br>
      Filling one point seems not to satisfy the "fill" function near
      corners. <br>
      <br>
      Nothing to be discussed, just call two sequences in fill_xy to
      fill land two points inward:<br>
      ferret<br>
      yes? use coads_climatology<br>
      yes? set region/x=-20:40/y=-60:0<br>
      yes? let mask=0*missing(sst[l=1],1)+1<br>
      yes? fill/l=1/grat fill_xy(sst,mask,2) !Note the "2"<br>
      yes? shade/over /lev=(100)/pal=grey missing(sst[l=1],100)<br>
      There is one leftover white point that should not be there. I have
      inspected the details, just by plotting fields before and after
      filling. fill_xy does not fill the one point in the first
      sequence, again at 20&#xB0;E. There is a similar point located in the
      Mediterranean, again at 20&#xB0;E. So fill_xy gives wrong results at
      two ocean points.<br>
      <br>
      Wanting just an image, fill three time with fill_xy(sst,mask,3).
      Thats it. <br>
      <br>
      Anyway, it is disturbing to know that a tool gives a wrong result,
      even if this happens solely at two points in a 360x180 grid. In
      summery, some problems show up in overlay plots, but also without
      plotting in some functions things may go wrong. And it is
      generally related to the cut longitude at 20&#xB0;E.<br>
      <br>
      Is there a way to get a correct result with ferret? Yes, it can!<br>
      yes? use coads_climatology<br>
      yes? set region/x=-20:40/y=-60:0<br>
      yes? let mask=0*missing(sst,2)+1<br>
      yes? fill/l=1/grat
      fill_xy(sst[l=1,x=-20:40,y=-60:0],mask[x=-20:40,y=-60:0],2)<br>
      yes? shade/over /lev=(100)/pal=grey missing(sst[l=1],100)<br>
      <br>
      I did not check coordinates of land carefully, simple checks look
      fine considering we have a 2deg data set.<br>
      <br>
      All commands used here should give correct results, but some do
      not. But I cannot propose a general rule to produce safe scripts.
      <br>
      May be, I have missed a point specific for modulo axes?<br>
      <br>
      Have a nice weekend and happy ferreting,<br>
      Martin<br>
      <br>
      01/27/2017 01:24 PM, Nicolas Freychet wrote:<br>
    </div>
    <blockquote
cite=""
      type="cite">
      <div dir="ltr">
        <div>
          <div>
            <div>
              <div>Hi Martin,<br>
              </div>
              <br>
              Did you try to use explicitly "20E" instead of "-20"?&#xA0;<i>
                fill/l=1/grat/x=20E:40W/y=60S:0N sst</i><br>
            </div>
            Also, try to do a simple "go land 1" after you filled your
            figure, to see if the continents are placed correctly
            according to the lon/lat (if not, then it may be a problem
            of coordinates in your data)<br>
            <br>
          </div>
          Cheers,<br>
        </div>
        Nicolas<br>
        <br>
      </div>
      <div class="gmail_extra"><br>
        <div class="gmail_quote">2017-01-27 11:51 GMT+00:00 baris onol <span
            dir="ltr">&lt;<a rel="nofollow" moz-do-not-send="true"
              href="mailto:onolba@xxxxxxxxxx" target="_blank">onolba@xxxxxxxxxx</a>&gt;</span>:<br>
          <blockquote class="gmail_quote" style="margin:0 0 0
            .8ex;border-left:1px #ccc solid;padding-left:1ex">how about
            this one?<br>
            <br>
            yes? shade/l=1/x=-20:40/y=-60:0/ove<wbr>r sst<br>
            yes? fill/l=1/x=-20.5:40.5/y=-60:0/<wbr>over sst<br>
            yes? shade/over/lev=(100)/pal=grey/<wbr>x=-20:40/y=-60:0
            missing(sst[l=1],100)<br>
            <br>
            <br>
            On 01/27/2017 02:09 PM, Martin Schmidt wrote:<br>
            <blockquote class="gmail_quote" style="margin:0 0 0
              .8ex;border-left:1px #ccc solid;padding-left:1ex">
              Dear ferreters,<br>
              <br>
              I had to compile my pyferret by myself, so I am not sure
              if the subsequent bug is a general one.<br>
              <br>
              ferret<br>
              &#xA0; &#xA0; &#xA0; &#xA0; NOAA/PMEL TMAP<br>
              &#xA0; &#xA0; &#xA0; &#xA0; PyFERRET v7 (opt)<br>
              &#xA0; &#xA0; &#xA0; &#xA0; Linux 3.19.0-64-generic - 07/01/16<br>
              <br>
              yes? use coads_climatology<br>
              yes? fill/l=1/grat/x=-20:40/y=-60:0 sst<br>
              yes? shade/over /lev=(100)/pal=grey missing(sst[l=1],100)<br>
              <br>
              In my figure the land west of 20&#xB0;E remains white.<br>
              <br>
              The result for<br>
              yes? fill/l=1/grat/x=340:400/y=-60:<wbr>0 sst<br>
              yes? shade/over /lev=(100)/pal=grey missing(sst[l=1],100)<br>
              is complementary.<br>
              <br>
              I find also non-filled points in the function fill_xy near
              20&#xB0;E, where information on adjacent ocean points seems to
              be "blocked" at 20&#xB0;E. This looks like if the same error is
              behind the scene, but in the above example the problem is
              most obvious.<br>
              <br>
              Setting a region before calling the plot commands,
              everything is fine for this example:<br>
              yes? set region/x=-20:40/y=-60:0<br>
              yes? fill/l=1/grat sst<br>
              yes? shade/over /lev=(100)/pal=grey missing(sst[l=1],100)<br>
              <br>
              But with fill_xy there is still one point not filled at
              20&#xB0;E.<br>
              <br>
              Seems that 20&#xB0;E is still a magic boundary?<br>
              <br>
              So my question: For safe code, should it generally avoided
              to specify regions withing the plot commands? Is there
              another idea to get safe code.<br>
              <br>
              Best,<br>
              Martin<br>
              <br>
            </blockquote>
            <br>
          </blockquote>
        </div>
        <br>
        <br clear="all">
        <br>
        -- <br>
        <div class="gmail_signature" data-smartmail="gmail_signature">
          <div dir="ltr">
            <div>
              <div dir="ltr">----------------------------------------------------<br>
                <div>Nicolas Freychet<br>
                </div>
                PDRA, School of Geosciences<br>
                University of Edinburgh<br>
                ----------------------------------------------------</div>
            </div>
          </div>
        </div>
      </div>
    </blockquote>
    <p><br>
    </p>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00053" href="msg00053.html">[ferret_users] Re: [ferret_users] Re: [ferret_users] 20&#xB0; E seems to be magic</a></strong>
<ul><li><em>From:</em> Ansley C. Manke</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00046" href="msg00046.html">[ferret_users] images/labels pile up</a></strong>
<ul><li><em>From:</em> Ge Peng - NOAA Affiliate</li></ul></li>
<li><strong><a name="00049" href="msg00049.html">[ferret_users] [ferret_users] 20&#xB0; E seems to be magic</a></strong>
<ul><li><em>From:</em> Martin Schmidt</li></ul></li>
<li><strong><a name="00050" href="msg00050.html">[ferret_users] Re: [ferret_users] [ferret_users] 20&#xB0; E seems to be magic</a></strong>
<ul><li><em>From:</em> baris onol</li></ul></li>
<li><strong><a name="00051" href="msg00051.html">[ferret_users] Re: [ferret_users] Re: [ferret_users] [ferret_users] 20&#xB0; E seems to be magic</a></strong>
<ul><li><em>From:</em> Nicolas Freychet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00051.html">[ferret_users] Re: [ferret_users] Re: [ferret_users] [ferret_users] 20&#xB0; E seems to be magic</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00053.html">[ferret_users] Re: [ferret_users] Re: [ferret_users] 20&#xB0; E seems to be magic</a></strong>
</li>

</UL>
<center>[<a href="msg00051.html">Thread Prev</a>][<a href="msg00053.html">Thread Next</a>][<A HREF="threads.html#00052">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
