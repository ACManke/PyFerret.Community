<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] Masking in list command works for floats, not strings -->
<!--X-From-R13: "Oafyrl Q. [naxr" <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Wed, 5 Jul 2017 10:11:54 &#45;0700 -->
<!--X-Message-Id: 12871c80&#45;96d5&#45;d99c&#45;638e&#45;d352add928a2@noaa.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 99e4f7ced0844554ba730089bf8c4f1c@mpic.de -->
<!--X-Reference: 93be072b&#45;992c&#45;e4ec&#45;ed4e&#45;61a900ec45ff@noaa.gov -->
<!--X-Reference: 27a01988&#45;5c2f&#45;948d&#45;fa44&#45;7330f2891d31@mpic.de -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Masking in list command works for floats, not strings</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00470.html">Thread Prev</a>][<a href="msg00477.html">Thread Next</a>][<A HREF="threads.html#00474">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Masking in list command works for floats, not strings</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>&quot;Riede, Hella&quot; &lt;<a href="mailto:hella.riede@DOMAIN.HIDDEN">hella.riede@xxxxxxx</a>&gt;, ferret users &lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Masking in list command works for floats, not strings</strong></li>
<li><strong>From</strong>: <strong>&quot;Ansley C. Manke&quot; &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Wed, 5 Jul 2017 10:11:50 -0700</li>
<li>Arc-authentication-results: i=2; mx.google.com;       dkim=pass header.i=@noaa-gov.20150623.gappssmtp.com header.b=sR05RiwK;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 2607:f8b0:400e:c05::233 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a></li>
<li>Arc-authentication-results: i=1; mx.google.com;       dkim=pass header.i=@noaa-gov.20150623.gappssmtp.com header.b=sR05RiwK;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 2607:f8b0:400e:c05::233 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a></li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence         :content-language:content-transfer-encoding:in-reply-to:mime-version         :user-agent:date:message-id:from:references:to:subject         :arc-authentication-results:arc-message-signature:dkim-signature         :arc-authentication-results;        bh=aEBlS1g409zdHCw1OYJgjG5GPE/wgRkDCZb33C97MDQ=;        b=VnJAup7Y6joTK4b//P488bMK/sbQd/X8EKZf+cYsvu3beleTJZIGCuE6qA3aVkrDOG         1nDHx/WqNoJtwV6NotXhMzk28WtlrcV2dA4eE/3eJ0K22QiYVhEzXPDNo95Ek1vFthzR         0g8qyMGZzqlQcD2LCo8RYqG4B65YCsprkh71QocSBiWRmw3V8zPuL2fq8p92pKwgiIuL         piCYLoQvHL7PlUrneKxNwklbdyh1yORMjRsYr7y0YdUG6HHgMCDd/bdcl06zezH0hAJN         2lveVdZgQT1SibzabZ8F77wmfc28wGDf6btWiVMTVqwIdcvzgF8iyjHa32fuYxJkRuqt         FN+w==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=content-language:content-transfer-encoding:in-reply-to:mime-version         :user-agent:date:message-id:from:references:to:subject         :dkim-signature:arc-authentication-results;        bh=aEBlS1g409zdHCw1OYJgjG5GPE/wgRkDCZb33C97MDQ=;        b=XKytQPFBalMnYK+8uYxA0qbUiEX7ORoVtzoqu6ICw/JNNsrk75HXVatPMjB+ut6qFQ         9hunnZd/dsLPXjIxgcVbi08VHZcj/FnXhEnlEepw/HPZzUZFhvK2XqrHWkHRpsdFwmK1         jb9PonTzNtEw2VIBJDWSOkBYEbsih2GN2TI5tRZj4Ge3baFvB7jLmHkhw39aGcmtO1kH         V0ntE2+JcOrmN/L0fyoNbH7Hjwx9a1p/l/M1hn/x6gQZpwQGDP2FNxfyat+81UoOTPLp         erkdTOVK2CCy1TfOca6ssLRo2l4MGfoMtxBqgRkLO8UkqxGypwUzFTOodbCdB1Qp9Sce         eFdA==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1499274713; cv=pass;        d=google.com; s=arc-20160816;        b=bfIcJvOSeMEyouurOH5Ea1x1K5et0WSfMhZR12TF2tFQX26PakJJxexrSH38EHDjLx         ARTHaRPtp9RcwJa5QJ3FQjCb0+C3iYtb2JfxfJsT6RUzIeY/cElqoo2V+smRJTy88uZE         FRjfJEAG5y8YkesCMfnUcBLJzaFaRL+/m4GVAtMmORg7LJptvb5v0odFj8wUm1nroR7p         3Dwj36lUrkNKeZzkWwq9SU5/KjNcJ092e35A8RKymQPsjH/bQzcvghicK6K4UCvXDZOU         qVfdkDAFsiyKd0bu1v3nDGNaC5Dm9KOgzE5g5IQSxmyFPqqeMVfK1UkEguwIrACLQ9lg         DalQ==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1499274712; cv=none;        d=google.com; s=arc-20160816;        b=KV29lIjckr6fAqnN7wzp3EYhZd6eqZgMzMiAsjie8PoO12W8TSjQidW7ZXQHcL1t8e         wZgK0ekJQGNF6HRWllH4PuqY/x9wH3rWrbBmhIVuDDgIyDQBtqr9esffZ7TSBIEnfzxl         sMCaKvwWQudXDJQDAJSjehjBtXbpdNK5BCMOMpCPBfBq4dRXKcdeGkerJ7gEZimZShB2         G9jZ73mE/OubzKZlzNYnWQ6dlTwgv74y/JUYpIdUGrz77QjpFhz0wiPIPgdRY8GMlo95         mUUagDeuc1B4erX40racdyNOqNXS8BJNOOQ4ukZwScVlquvGuOlJ/WOZk20hoDHCd/xv         O4BQ==</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa-gov.20150623.gappssmtp.com; s=20150623;        h=subject:to:references:from:message-id:date:user-agent:mime-version         :in-reply-to:content-transfer-encoding:content-language         :x-original-sender:x-original-authentication-results:precedence         :mailing-list:list-id:list-post:list-help:list-archive;        bh=aEBlS1g409zdHCw1OYJgjG5GPE/wgRkDCZb33C97MDQ=;        b=tFJdhX0dUnF+ReM1nhiMDrsw74gWRGn1QyGSzm3FA/Koz/G9iSOTTpUhARmB7DejPG         GbHLgb+/8qalElwE81grjsVmY3OyvqjQ8yycKhEN35xzC0NVvozObBc5khe+ruaGjZG+         0Dkc0GovXLHSbqlFqF7dNmoJ1bRSskp3yhZiwNkn64ujTEDAD5BmaBYdaofS9sVpMwk4         EGkMl2HQ7dPW1j0kjacWo5f/qLw8/IcYM5geCPDs9QuN603FKp5ivFjDK1B8R37xgAV9         vUIL+xVONh+ZRyPf7Qzqbi0qtxlZxHvCloynDbjNki61OrPNKc6tlBMGnA1mHqFAwWZ5         sU0A==</li>
<li>In-reply-to: &lt;<a href="msg00470.html">27a01988-5c2f-948d-fa44-7330f2891d31@mpic.de</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00464.html">99e4f7ced0844554ba730089bf8c4f1c@mpic.de</a>&gt; &lt;<a href="msg00465.html">93be072b-992c-e4ec-ed4e-61a900ec45ff@noaa.gov</a>&gt; &lt;<a href="msg00470.html">27a01988-5c2f-948d-fa44-7330f2891d31@mpic.de</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko/20100101 Thunderbird/52.2.1</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi,

</pre><tt>This is definitely a bug. We have a fix for it which will be included in 
</tt><tt>the next release.
</tt><pre style="margin: 0em;">


On 7/3/2017 2:13 PM, Riede, Hella wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Thanks, Ansley.

Usually, I first define a variable, then list it in a simple way, so that's OK as a workaround for me.

However, there doesn't seem to be a workaround for this one as all variables are defined before listing already:

can var/all
let test = {1,1,0}
let strings = {&quot;a&quot;,&quot;b&quot;,&quot;c&quot;}
let masked = if (test) then strings
let masked2 = xsequence(masked)
list masked2
              VARIABLE : XSEQUENCE(MASKED)
              SUBSET   : 3 points (X)
  1   / 1:  1.859-316
  2   / 2:  1.877-316
  3   / 3:  1.877-316

(Last example in mask_string.jnl, see attachment. An extra 'faulty' listing is too big / takes too long for my real dataset.)


Thanks in advance for a hint on this one.


Best wishes,
Hella






On 06/27/2017 11:35 PM, Ansley C. Manke wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi Hella,

Thank you for the example.  In principle, specifying an expression as
the argument to a command:

    yes? list if (test) then strings

should be equivalent to defining a variable with that same expression
and sending that to the command:

     yes? let masked = if (test) then strings
     yes? list masked

However there winds up being a slight variation in how the computation
is done with occasionally different and incorrect results. (Here we're
seeing pointers to the strings which should be returned!)  We had a
similar bug report a year or two back which I think has been fixed; I'll
check into this.

Ansley

On 6/27/2017 9:38 AM, Riede, Hella wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Dear ferreters,

I discovered listing while masking seems to work. But not in all cases (see also attached script file with more examples and comments):


yes? let test = {1,1,0}

!! problem with masked strings -&gt; unexpected values
yes? let strings = {&quot;a&quot;,&quot;b&quot;,&quot;c&quot;}
yes? list if (test) then strings
               VARIABLE : IF (TEST) THEN STRINGS
               SUBSET   : 3 points (X)
   1   / 1:  2.109-316
   2   / 2:  2.109-316
   3   / 3:  2.109-316
!! repeat the listing, and the values change every time

!! define a masked variable instead, then list - works
yes? let masked = if (test) then strings
yes? list masked
               VARIABLE : IF (TEST) THEN STRINGS
               SUBSET   : 3 points (X)
   1   / 1:&quot;a&quot;
   2   / 2:&quot;b&quot;
   3   / 3:&quot;&quot;

!! OR do the same listing for a float first
yes? let floats = {2,3,4}
yes? list if (test) then floats
               VARIABLE : IF (TEST) THEN FLOATS
               SUBSET   : 3 points (X)
   1   / 1:  2.000
   2   / 2:  3.000
   3   / 3:   ....

!! now, also for strings listing while masking works
yes? list if (test) then strings
               VARIABLE : IF (TEST) THEN STRINGS
               SUBSET   : 3 points (X)
   1   / 1:&quot;a&quot;
   2   / 2:&quot;b&quot;
   3   / 3:&quot;&quot;


In an interactive ferret session, I first had defined a masked variable for strings (in this example 'masked'), and had also listed it for testing. After that I discovered that listing while masking works too (of course I didn't know it only worked because I had defined and listed the 'masked' variable before, in the same session). So later in my ferret script I omitted defining the 'masked' variable, and used the listing while masking. The script did not crash, but gave me unexpected values like the ones above, instead of proper strings.

Would be good to fix this, or - if the syntax of listing while masking is not supported - to catch these cases and throw an error.

The story goes on, however, see attached script as it seems not possible to mask a string variable and then make an xsequence out of it - unless you do for instance the &quot;faulty listing while masking&quot; from above before the &quot;right&quot; listing.



Best wishes,
Hella

PyFerret v7.11 (beta/optim), Linux 4.4.0-72-generic - 04/19/17
</pre></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00464" href="msg00464.html">[ferret_users] Masking in list command works for floats, not strings</a></strong>
<ul><li><em>From:</em> Riede, Hella</li></ul></li>
<li><strong><a name="00465" href="msg00465.html">Re: [ferret_users] Masking in list command works for floats, not strings</a></strong>
<ul><li><em>From:</em> Ansley C. Manke</li></ul></li>
<li><strong><a name="00470" href="msg00470.html">Re: [ferret_users] Masking in list command works for floats, not strings</a></strong>
<ul><li><em>From:</em> Riede, Hella</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00470.html">Re: [ferret_users] Masking in list command works for floats, not strings</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00477.html">[ferret_users] Plot differences using L=@ave</a></strong>
</li>

</UL>
<center>[<a href="msg00470.html">Thread Prev</a>][<a href="msg00477.html">Thread Next</a>][<A HREF="threads.html#00474">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
