<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] Looping over multiple input files to plot file variables and save to png -->
<!--X-From-R13: "Rhenpx, Bnhy X." <qhenpx1Nyyay.tbi> -->
<!--X-Date: Tue, 2 May 2017 09:35:55 &#45;0700 -->
<!--X-Message-Id: E62A55AB&#45;7BBC&#45;4B20&#45;9AB1&#45;AF1849B424B9@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 2595E167&#45;F5E9&#45;446A&#45;B269&#45;BC3569338DF4@llnl.gov -->
<!--X-Reference: dbfaef1a&#45;3e74&#45;32ff&#45;a89e&#45;8f07b1f90eee@csiro.au -->
<!--X-Reference: E9252927&#45;AFE7&#45;4723&#45;9018&#45;DE7F61C81867@llnl.gov -->
<!--X-Reference: alpine.LFD.2.03.1705020935020.1914@lsce.ipsl.fr -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Looping over multiple input files to plot file variables and save to png</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00325.html">Thread Prev</a>][<a href="msg00327.html">Thread Next</a>][<A HREF="threads.html#00326">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Looping over multiple input files to plot file variables and save to png</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>&quot;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&quot; &lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Looping over multiple input files to plot file variables and save to png</strong></li>
<li><strong>From</strong>: <strong>&quot;Durack, Paul J.&quot; &lt;<a href="mailto:durack1@DOMAIN.HIDDEN">durack1@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 2 May 2017 16:35:51 +0000</li>
<li>Accept-language: en-US</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa-gov.20150623.gappssmtp.com; s=20150623;        h=from:to:subject:thread-topic:thread-index:date:message-id         :references:in-reply-to:accept-language:content-language:user-agent         :spamdiagnosticoutput:spamdiagnosticmetadata:content-id         :content-transfer-encoding:mime-version:x-original-sender         :x-original-authentication-results:precedence:mailing-list:list-id         :list-post:list-help:list-archive:list-unsubscribe;        bh=0TnwDtSl/Yc9QABXpI/8d0g383/rcjZYwg4cAiWMa6w=;        b=ed3cbbNEyCVvy4OhHcV7IPjqF+bqKgc0fVI0+kXQhf3badtKGNhBAmGh1yBUmF0peg         ezevEgSK/xiwvlZxVfvdiLyUpnb0bwnHn9weA2z3jsjPPCH7Q1Yt6HH/coFPjtNl16y6         Uk6G+qI7vew+gnboim/9Ycch7QV/jc+DD+Bdubs9XMyVFqpzKEUHbrEvGuVEuKjFl0ix         iMOOy/CiYo9f0DmwhFJdjxzU5qQTpZL3cDKYWAQHTRm2XG9KsfwqEQ6jcT4+BLSg/Wey         KHkf58zLMyxBrR83SNpYV4qLH4Mzz5sRzVpmDEHRX6CVOOyrhZtCRlDyG/S9h5kJojH8         guVg==</li>
<li>In-reply-to: &lt;<a href="msg00324.html">alpine.LFD.2.03.1705020935020.1914@lsce.ipsl.fr</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;, &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/subscribe">https://groups.google.com/a/noaa.gov/group/ferret_users/subscribe</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00319.html">2595E167-F5E9-446A-B269-BC3569338DF4@llnl.gov</a>&gt; &lt;<a href="msg00320.html">dbfaef1a-3e74-32ff-a89e-8f07b1f90eee@csiro.au</a>&gt; &lt;<a href="msg00321.html">E9252927-AFE7-4723-9018-DE7F61C81867@llnl.gov</a>&gt; &lt;<a href="msg00324.html">alpine.LFD.2.03.1705020935020.1914@lsce.ipsl.fr</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>Spamdiagnosticmetadata: NSPM</li>
<li>Spamdiagnosticoutput: 1:99</li>
<li>Thread-index: AQHSwskbx8nirwRqo0uikwqY+usxGaHgMq+A//+0nICAAMHHAIAAIFMA</li>
<li>Thread-topic: [ferret_users] Looping over multiple input files to plot file variables and save to png</li>
<li>User-agent: Microsoft-MacOutlook/f.21.0.170409</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Thanks Jim,

I ended up with:

! Clean up target dir
SPAWN &quot;/bin/rm -rf basinmask/png/*.png&quot;

let filenames = SPAWN(&quot;/bin/ls -1 basinmask/*.nc&quot;) ! List of filenames
let numfiles = `filenames,return=iend` ! Number of files
repeat/range=1:`numfiles`/name=in (let filename = filenames[i=`in`] ; \ ! Loop over filenames
say `filename` ; \ ! print filename to screen
def sym filen `filename` ; \ ! Create filen variable
let filepng = {spawn:&quot;echo ($filen) | sed s:.nc:.png:&quot;} ; \ ! Rename nc to png
let filepng = {spawn:&quot;echo `filepng` | sed s:basinmask:basinmask/png:&quot;} ; \ ! Rewrite to png subdir
say `filepng` ; \ ! print pngname to screen
use ($filen) ; \ ! Load filen
can win/all ; \ ! Cancel all active windows
set win 1 ; \ ! Set new target window
sha basinmask4 ; \ ! Shade basinmask4 variable
go land ; \ ! Overlay continental outline
frame/file=&quot;`filepng`&quot; ; \ ! Save plot to png
can win 1) ! Cancel active window

Thanks for the tips..

P

On 5/2/17, 12:40 AM, &quot;James Orr&quot; &lt;James.Orr@xxxxxxxxxxxx&gt; wrote:

    Paul,
    
    Almost there. For your 2nd question, converting the output filename from .nc to 
    .png, just use 'sed' with ferret's spawn command, as in the following loop 
    (modified from my previous message):
    
    ! Loop over list of filenames and make plot (changing '.nc' to '.png')
       repeat/range=1:`numfiles`/name=in (let filename = filenames[i=`in`] ; \
             def sym filen basinmasks/`filename` ; \
     	use ($filen)          ; \
             let filepng = {spawn:&quot;echo ($filen) | sed s:.nc:.png:&quot;} ; \
             def sym filep `filepng` ; \
     	set win/new              ; \
     	shade temp[k=1] )
    
    ! Then just use ($filep) in your shade command (or use `filepng` directly).
    
    -- Jim
    
    On Tue, 2 May 2017, Durack, Paul J. wrote:
    
    &gt; 
    &gt; Thanks Russ, so how do I then loop over the entries:
    &gt; 
    &gt;  
    &gt; 
    &gt; let filenames = SPAWN(&quot;/bin/ls -1 basinmask/*.nc&quot;)
    &gt; 
    &gt; ! How do I loop over filenames?
    &gt; 
    &gt; !REPEAT/RANGE=1: ($filenames)
    &gt; 
    &gt; !
    &gt; 
    &gt; ! Then plot
    &gt; 
    &gt; use ($filename)
    &gt; 
    &gt; set win 1
    &gt; 
    &gt; sha basinmask4
    &gt; 
    &gt; frame/file=&quot;($outpath)($filename).png&quot; ! How to I replace *.nc in the filename with *.png?
    &gt; 
    &gt; cancel win 1
    &gt; 
    &gt;  
    &gt; 
    &gt; Cheers,
    &gt; 
    &gt;  
    &gt; 
    &gt; P
    &gt; 
    &gt;  
    &gt; 
    &gt; From: &lt;owner-ferret_users@xxxxxxxx&gt; on behalf of Russ Fiedler &lt;russell.fiedler@xxxxxxxx&gt;
    &gt; Date: Monday, May 1, 2017 at 5:36 PM
    &gt; To: &quot;ferret_users@xxxxxxxx&quot; &lt;ferret_users@xxxxxxxx&gt;
    &gt; Subject: Re: [ferret_users] Looping over multiple input files to plot file variables and save to png
    &gt; 
    &gt;  
    &gt; 
    &gt; 
    &gt; Hi Paul,
    &gt; 
    &gt; Rather than writing your filenames to a file you can create a variable using the SPAWN function directly.
    &gt; 
    &gt; let filenames = SPAWN(&quot;/bin/ls -1 basinmask/*.nc&quot;)
    &gt; 
    &gt; Another way would be to create the file as you are at the moment and read it in via a spawn and 'cat' command
    &gt; 
    &gt; let filenames = SPAWN(&quot;cat filenames.txt&quot;)
    &gt; 
    &gt; I'd prefer the first method.
    &gt; 
    &gt; Cheers,
    &gt; Russ
    &gt; 
    &gt; On 02/05/17 08:20, Durack, Paul J. wrote:
    &gt;
    &gt;       I have 51 netcdf files in a directory, and want to loop over each of these and for each plot the contents of a
    &gt;       gridded variable and save this to a png file, using pyferret 7.1
    &gt;
    &gt;        
    &gt;
    &gt;       I&#x2019;ve been struggling with syntax, and am getting &#x201C;**TMAP ERR: non-existent or not on line  filenames.txt&#x201D;, with the
    &gt;       following partial code:
    &gt;
    &gt;        
    &gt;
    &gt;       spawn &quot;ls basinmask/*.nc &gt; filenames.txt&quot; ! This is generating a file, but if I could create the filelist in memory
    &gt;       this step could be removed
    &gt;
    &gt;       FILE/FORMAT=DELIMITED/var=&quot;filenames&quot; filenames.txt ! &lt; This generates the error
    &gt;
    &gt;       say &quot;processing: &quot;,($file) ! don&#x2019;t get to here
    &gt;
    &gt;        
    &gt;
    &gt;        
    &gt;
    &gt;       The plot and save command will be a simple:
    &gt;
    &gt;        
    &gt;
    &gt;       &gt; sha basinmask4 ! Each file contains the same named variable
    &gt;
    &gt;       &gt; frame/file=&#x201D;($mypath)($myfile).png&#x201D;
    &gt;
    &gt;        
    &gt;
    &gt;       Can someone help me out to fill in the missing logic/syntax here?
    &gt;
    &gt;        
    &gt;
    &gt;       Thanks,
    &gt;
    &gt;        
    &gt;
    &gt;       P
    &gt; 
    &gt;  
    &gt; 
    &gt; 
    &gt;
    
    -- 
    LSCE/IPSL, Laboratoire des Sciences du Climat et de l'Environnement
    CEA-CNRS-UVSQ
    
    LSCE/IPSL, CEA Saclay           <a  rel="nofollow" href="http://www.ipsl.jussieu.fr/~jomce">http://www.ipsl.jussieu.fr/~jomce</a>
    Bat. 712 - Orme                 mailto:  James.Orr@xxxxxxxxxxxx
    Point courrier 132
    F-91191 Gif-sur-Yvette Cedex    Phone:   (33) (0)1 69 08 39 73
    FRANCE                          Fax:     (33) (0)1 69 08 30 73



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00319" href="msg00319.html">[ferret_users] Looping over multiple input files to plot file variables and save to png</a></strong>
<ul><li><em>From:</em> Durack, Paul J.</li></ul></li>
<li><strong><a name="00320" href="msg00320.html">Re: [ferret_users] Looping over multiple input files to plot file variables and save to png</a></strong>
<ul><li><em>From:</em> Russ Fiedler</li></ul></li>
<li><strong><a name="00321" href="msg00321.html">Re: [ferret_users] Looping over multiple input files to plot file variables and save to png</a></strong>
<ul><li><em>From:</em> Durack, Paul J.</li></ul></li>
<li><strong><a name="00324" href="msg00324.html">Re: [ferret_users] Looping over multiple input files to plot file variables and save to png</a></strong>
<ul><li><em>From:</em> James Orr</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00325.html">Re: [ferret_users] Looping over multiple input files to plot file variables and save to png</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00327.html">[ferret_users] STOP var prot err --&gt; UVAR</a></strong>
</li>

</UL>
<center>[<a href="msg00325.html">Thread Prev</a>][<a href="msg00327.html">Thread Next</a>][<A HREF="threads.html#00326">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
