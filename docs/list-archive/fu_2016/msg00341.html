<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] curl error when accessing a THREDDS -->
<!--X-From-R13: "Oafyrl Q. [naxr" <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Tue, 5 Jul 2016 10:52:39 &#45;0700 -->
<!--X-Message-Id: 41885866&#45;385c&#45;7c8b&#45;36cb&#45;403d9c6d172c@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CAN4rXbThsMGVKKhuVk2foJsMjN7VaBUA0NJGRxbPzhanqsVyxw@mail.gmail.com -->
<!--X-Reference: 577A3E28.1080402@io&#45;warnemuende.de -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] curl error when accessing a THREDDS</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00340.html">Thread Prev</a>][<a href="msg00342.html">Thread Next</a>][<A HREF="threads.html#00341">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] curl error when accessing a THREDDS</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] curl error when accessing a THREDDS</strong></li>
<li><strong>From</strong>: <strong>&quot;Ansley C. Manke&quot; &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 5 Jul 2016 10:52:36 -0700</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa-gov.20150623.gappssmtp.com; s=20150623;        h=subject:to:references:from:message-id:date:user-agent:mime-version         :in-reply-to:x-original-sender:x-original-authentication-results         :precedence:mailing-list:list-id:list-post:list-help:list-archive         :list-unsubscribe;        bh=CBvJHNCjntXiiD3cqbekiVH+U39Ukb6wGO+3QuwzPoM=;        b=wNUONYaVkqHv/2pCZ7yYzKP7+r17Mmf2yjw3b9IjWCKmFnUMuz668XVjCJISMRcxLx         qd3AeV7O2nM66Sa9WS/xxDmet01gf5hoypR9P8o6FIiCtHLIWdZ99qdwlSc0Td6joTUF         qDGY63efxmg7HALM4gYDmSHtVClpxy6biwQKNvxyph3xfhlAMAS45aNetI0TE9EPcULO         AcvH0MxBMce9QnhfoM4Rzz9HFMRGlq0jWXq5RRMSSWyHIovuat+KI11dAeeJaKJBbY+A         4yfWSOf192ZccwYkSEH0cuFcsX30S/73IOmCP3ALmd0YI+Wx6nhdPgKjmLlRk7eNXvQS         c2wQ==</li>
<li>In-reply-to: &lt;<a href="msg00340.html">577A3E28.1080402@io-warnemuende.de</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;, &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/subscribe">https://groups.google.com/a/noaa.gov/group/ferret_users/subscribe</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00106.html">CAN4rXbThsMGVKKhuVk2foJsMjN7VaBUA0NJGRxbPzhanqsVyxw@mail.gmail.com</a>&gt; &lt;<a href="msg00340.html">577A3E28.1080402@io-warnemuende.de</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:45.0) Gecko/20100101 Thunderbird/45.1.1</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    <p>Hi Martin,</p>
    <p>Ferret/Pyferret makes a call to the netCDF library to read data,
      and gets a status return flag, and is set to stop with an error if
      that return is not a "success" value. Ferret writes the line</p>
    <p><tt>&#xA0;&#xA0; **netCDF error </tt><br>
    </p>
    <p>Then it makes a call to a netCDF routine to translate the error
      code. That translation returns a string, in this case, <br>
    </p>
    <p><tt><tt>&#xA0;&#xA0; </tt>NetCDF: I/O failure (OPeNDAP/netCDF Error code
        -68)
      </tt></p>
    <p>Ferret writes that string, and then the URL or file name that was
      being used, and the command it was running, then returns&#xA0; to the
      command line.&#xA0; Ferret does not directly write any messages that
      contain "CURL Error".
    </p>
    <p>The "listing to file" message is issued AFTER Ferret has read the
      data, and received a "success" return flag.</p>
    <p>This sounds as if the netCDF library (or some other library that
      it is calling, maybe CURL?), is writing the "CURL Error: Failure
      when receiving data from the peer" message itself, before the read
      call is finished, and that the return flag from the netCDF call is
      coming back as a successful read.&#xA0; I have not seen this issue, but
      searching the web for the message, it certainly seems to be
      something people run into.<br>
    </p>
    <p>You want to at least detect this and exit, before writing bad
      data to your result file.&#xA0; You could use SET REDIRECT to send the
      output of your script to a file, and separate the commands to LOAD
      data and compute the climatology.&#xA0;&#xA0; (Note the SET REDIRECT/STDERR
      option described in the documentation is not implemented.)<br>
    </p>
    <p><br>
    </p>
    <blockquote>
      <p>set redirect/file=log.txt/clobber<br>
        use <a rel="nofollow" class="moz-txt-link-rfc2396E" href="http:......">"http:......"</a>
        <br>
        set region <br>
        define the climatology variable
        <br>
        LOAD data for climatology<br>
        spawn to check the log for CURL error, exit if it is found **<br>
        save to file </p>
      <p>cancel redirect &#xA0; ! restart your log<br>
        set redirect/file=log.txt/clobber<br>
        ...<br>
      </p>
    </blockquote>
    <br>
    ** something like this:<br>
    yes? let varc = {SPAWN:"grep CURL log.txt"}; let bad_read =
    STRINDEX(varc[i=1], "CURL"); if `bad_read` then exit/script<br>
    <br>
    <br>
    <div class="moz-cite-prefix">On 7/4/2016 3:44 AM, Martin Schmidt
      wrote:<br>
    </div>
    <blockquote cite=""
      type="cite">Hi,
      <br>
      <br>
      I am not really sure where to send this question to. From time to
      time I get the following error when reading data from a THREDDS
      server:
      <br>
      <br>
      CURL Error: Failure when receiving data from the peer
      <br>
      <br>
      but ferret continues ...
      <br>
      &#xA0;LISTing to file&#xA0; ....
      <br>
      <br>
      Anyway, if this happens, the resulting data are shifted within the
      grid and the result is useless.
      <br>
      It is hopeless to find the "rule" how data are changed.
      <br>
      <br>
      Ferret is calculating a climatology from a huge model output. That
      requires to split the model domain into subdomains.
      <br>
      After defining a region, the results for the climatology are
      written into separate files and joined later. The scripts for
      <br>
      finding the climatology are simple, just like in the tutorial. The
      data flow is
      <br>
      <br>
      use <a rel="nofollow" class="moz-txt-link-rfc2396E" href="http:......">"http:......"</a>
      <br>
      set region
      <br>
      find the climatology
      <br>
      save to file
      <br>
      set region
      <br>
      find the climatology
      <br>
      save to file
      <br>
      and so on
      <br>
      <br>
      The error shows up only intermittently. I have checked that the
      data set on the THREDDS is sane.
      <br>
      The THREDDS is pretty old, Version 4.2.10 - 20120417.2151. The
      access log of the THREDDS looks as it should. I discovered from
      the logs, that some of my tiles should be smaller, since ferret
      sends two requests to the THREDDS subdividing also the vertical
      coordinate. This works mostly well, but it seems, that the error
      shows up only in this case.
      <br>
      As a test - with smaller tiles I did not see the error yet but the
      calculation takes much longer.
      <br>
      <br>
      Ferret is pyferret 6.96 (PyFerret 1.2) running on OpenSuse 13.2.
      It is py_ferret_120_ub_py_27.
      <br>
      The same for ferret/6.951. This was a prerelease of 6.96 (not
      pyferret!)
      <br>
      With older ferret/6.85 some files are written. Later a similar
      error shows up but I get more details and ferret stops:
      <br>
      curl error details:
      <br>
      &#xA0;**netCDF error
      <br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; NetCDF: I/O failure (OPeNDAP/netCDF Error code -68)
      <br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Data set:
<a rel="nofollow" class="moz-txt-link-freetext" href="http://phy-4:8080/thredds/dodsC/genus/genus_era_exp13_run_40_5day_ocean.nc">http://phy-4:8080/thredds/dodsC/genus/genus_era_exp13_run_40_5day_ocean.nc</a><br>
      This is a "Generic IO error". What does this mean?
      <br>
      <br>
      I have no idea, how to fix this. Did anybody observe something
      similar?
      <br>
      <br>
      Best,
      <br>
      Martin Schmidt
      <br>
      <br>
    </blockquote>
    <br>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00342" href="msg00342.html">Re: [ferret_users] curl error when accessing a THREDDS</a></strong>
<ul><li><em>From:</em> Karl Smith - NOAA Affiliate</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00106" href="msg00106.html">[ferret_users] How to convert 3D data to 2D data.</a></strong>
<ul><li><em>From:</em> Kishore Ragi</li></ul></li>
<li><strong><a name="00340" href="msg00340.html">[ferret_users] curl error when accessing a THREDDS</a></strong>
<ul><li><em>From:</em> Martin Schmidt</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00340.html">[ferret_users] curl error when accessing a THREDDS</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00342.html">Re: [ferret_users] curl error when accessing a THREDDS</a></strong>
</li>

</UL>
<center>[<a href="msg00340.html">Thread Prev</a>][<a href="msg00342.html">Thread Next</a>][<A HREF="threads.html#00341">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
