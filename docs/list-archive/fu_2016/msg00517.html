<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] EOFSVD_STAT error -->
<!--X-From-R13: "Ivyyvnz E. Yrffyre" <jvyyvnz.f.xrffyreNabnn.tbi> -->
<!--X-Date: Thu, 6 Oct 2016 06:55:15 &#45;0700 -->
<!--X-Message-Id: 490702D9&#45;EA83&#45;43A0&#45;84E3&#45;B663CF9C60A4@noaa.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CAC0O64F&#45;9f5VqxR01hTu6zWO19Wh+7FMXeEO0OG1cYna8MwK2g@mail.gmail.com -->
<!--X-Reference: 57F5BAAA.8000306@csiro.au -->
<!--X-Reference: CAC0O64EDfcsg4AMOCCsJ8OgzsoeTN=qUCJK0EtgQJFdoGYDwWg@mail.gmail.com -->
<!--X-Reference: 57F5E4D6.5010004@csiro.au -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] EOFSVD_STAT error</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00514.html">Thread Prev</a>][<a href="msg00519.html">Thread Next</a>][<A HREF="threads.html#00517">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] EOFSVD_STAT error</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Russ Fiedler &lt;<a href="mailto:russell.fiedler@DOMAIN.HIDDEN">russell.fiedler@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] EOFSVD_STAT error</strong></li>
<li><strong>From</strong>: <strong>&quot;William S. Kessler&quot; &lt;<a href="mailto:william.s.kessler@DOMAIN.HIDDEN">william.s.kessler@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Thu, 6 Oct 2016 06:55:11 -0700</li>
<li>Cc: Ferret &lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa-gov.20150623.gappssmtp.com; s=20150623;        h=from:mime-version:subject:in-reply-to:date:cc         :content-transfer-encoding:message-id:references:to         :x-original-sender:x-original-authentication-results:precedence         :mailing-list:list-id:list-post:list-help:list-archive         :list-unsubscribe;        bh=ZOo6fh34FG0U1aXtrs/Fd/UsMa1kJq0vIK5GlwckPds=;        b=UU4ZIV2Ek4JBPSHrl1OaGM0eSJbA/60jhV/eQ+3jTLk4QN24OsP2cnhjPmgx/uBl0g         P/6+AvPmjK8Z46dYSIWcJVKgPcs/BxMuwLImqmtDQ4jisNG8VAIRilxNWvfEIP8qQ0mv         awHmhIb1BIXbCVEUg4Ii/axeKWOOWLje2ssItId6SWe7eYI9Bjc6/hp3tsL7CSkvCtxy         af0Denfo1mObxx1q+I2AFa2qoWWQw6TG1A5yRubIkZia5qR0S4INS4vmrL46kZT5rp0I         MnH9jn4/T9Uaj4pLwjPOQEkgsGRIV5rf2pSqnmaYs1eTyJCPeXwM3FjbjOUM+AUQd9q6         LbKQ==</li>
<li>In-reply-to: &lt;<a href="msg00514.html">57F5E4D6.5010004@csiro.au</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;, &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/subscribe">https://groups.google.com/a/noaa.gov/group/ferret_users/subscribe</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00511.html">CAC0O64F-9f5VqxR01hTu6zWO19Wh+7FMXeEO0OG1cYna8MwK2g@mail.gmail.com</a>&gt; &lt;<a href="msg00512.html">57F5BAAA.8000306@csiro.au</a>&gt; &lt;CAC0O64EDfcsg4AMOCCsJ8OgzsoeTN=qUCJK0EtgQJFdoGYDwWg@mail.gmail.com&gt; &lt;<a href="msg00514.html">57F5E4D6.5010004@csiro.au</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Consider that an EOF calculation is usually used to _simplify_ an interpretation. Namely, you expect the result to represent the variability in a very few functions, often only 1 or 2. 

Thus the small details in any dimension are unlikely to be important, and subsampling suggested by Russ is very appropriate. Subsampled fields should give a very good result, in addition to being much easier to work with.

Some thought is needed about how to subsample. For instance, if your data is daily but you're really interested in low frequencies, then subsampling to monthly might be the right approach. In that case, consider sampling from a running 31-day running mean (i.e. monthly average) to avoid extreme values that might occur on a particular day. And in any subsampling, always check by overplotting the original and subsampled time series at a few points, so easy to do in Ferret. 

Billy K

&gt; On Oct 5, 2016, at 10:44 PM, Russ Fiedler &lt;russell.fiedler@xxxxxxxx&gt; wrote:
&gt; 
&gt; Hi,
&gt; 
&gt; Yes, you are requesting a huge amount of memory by the looks. I had a quick glance at the source code and there is a call
&gt; in routine eofsvd_stat_work_size to allocate an array of size approximately the square of the number of horizontal points (possibly packed
&gt; to avoid all missing values/zeros). Anyway, this means an array of about 20GB is being requested!
&gt; 
&gt; You'll need to subsample in space pretty aggressively or possibly look at doing this outside Ferret. You may need an out of core solution or
&gt; be able to perform the SVD on a distributed memory device (or be lucky enough to have heaps of shared memory).
&gt; 
&gt; Russ
&gt; 
&gt; 
&gt; 
&gt; On 06/10/16 15:06, Manche Shivashankar wrote:
&gt;&gt; Thank you so much Russ for your advice
&gt;&gt; 
&gt;&gt; Here are the details of my data
&gt;&gt; it is daily ssh data covering north Indian ocean having dimensions 320 by 240 by 4866 latitude longitude and time respectively.
&gt;&gt; and the script I am using as follows
&gt;&gt; 
&gt;&gt; yes? use sla.nc
&gt;&gt; yes? let Eof_Grid = sla[x=30:110,y=-30:30,l=1:4886]
&gt;&gt; yes? let Eof_Stat = eofsvd_stat(Eof_Grid)
&gt;&gt; then ferret is asking for memory size to increase after increasing the memory by 
&gt;&gt; set memory/size= command the error is coming like this
&gt;&gt; 
&gt;&gt; **ERROR in efcn_compute() allocating -92862752 bytes of memory
&gt;&gt;     work array 5:  X=1:1604808814, Y=1:2, Z=1:1, T=1:1, E=1:1, F=1:1
&gt;&gt;  **ERROR: error in external function
&gt;&gt; 
&gt;&gt; how I can solve this problem
&gt;&gt; I am great full if someone helps me.
&gt;&gt; 
&gt;&gt; thanks and regards
&gt;&gt; shiva shankar
&gt;&gt; 
&gt;&gt; On Thu, Oct 6, 2016 at 8:14 AM, Russ Fiedler &lt;russell.fiedler@xxxxxxxx&gt; wrote:
&gt;&gt; 
&gt;&gt; Hi,
&gt;&gt; 
&gt;&gt; The problem is that you are requesting too much memory. The work array 5 looks to have 2.3 billion elements which comes to about 10GB if single precision or 20GB if double. The negative in the first error message indicates an integer overflow.
&gt;&gt; 
&gt;&gt; From the documentation
&gt;&gt; 
&gt;&gt; <a  rel="nofollow" href="http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/appendix-a-external-functions/EOF-STAT?searchterm=eof">http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/appendix-a-external-functions/EOF-STAT?searchterm=eof</a>
&gt;&gt; 
&gt;&gt; &quot;The EOFSVD analysis solves a matrix problem where the matrix is dimensioned (NX*NY*NZ) by NT, which can quickly become quite large. The EOFSVD functions use other workspace as well which demands even more memory, and often memory must be increased with the SET MEMORY command. Regridding to a coarser grid or restricting the region may be necessary.&quot;
&gt;&gt; 
&gt;&gt; Could you show the size of your variable and the exact commands that you are using to do the eof computation? Somebody may be able to suggest a better way to do this.
&gt;&gt; 
&gt;&gt; Russ
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On 06/10/16 13:02, Manche Shivashankar wrote:
&gt;&gt;&gt; Dear all,
&gt;&gt;&gt; 
&gt;&gt;&gt; I am trying to see each eigen mode variance by list/i=1:10/j=2 eofsvd_stat  command after eof decomposition of data. While trying it the error comes like this 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; **ERROR in efcn_compute() allocating -92862752 bytes of memory
&gt;&gt;&gt;     work array 5:  X=1:1604808814, Y=1:2, Z=1:1, T=1:1, E=1:1, F=1:1
&gt;&gt;&gt;  **ERROR: error in external function
&gt;&gt;&gt; 
&gt;&gt;&gt; what could be the reason.
&gt;&gt;&gt; 
&gt;&gt;&gt; Please help me.
&gt;&gt;&gt; Thanks in advance.
&gt;&gt;&gt; 
&gt;&gt;&gt; Regards
&gt;&gt;&gt; Shiva shankar
&gt;&gt; 
&gt;&gt; 
&gt; 

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
William S. Kessler
NOAA / Pacific Marine Environmental Laboratory
7600 Sand Point Way NE
Seattle WA 98115 USA

william.s.kessler@xxxxxxxx
Tel: +1 206-526-6221
Fax: +1 206-526-6744
Web: <a  rel="nofollow" href="http://faculty.washington.edu/kessler/">http://faculty.washington.edu/kessler/</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00519" href="msg00519.html">Re: [ferret_users] EOFSVD_STAT error</a></strong>
<ul><li><em>From:</em> Manche Shivashankar</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00511" href="msg00511.html">[ferret_users] EOFSVD_STAT error</a></strong>
<ul><li><em>From:</em> Manche Shivashankar</li></ul></li>
<li><strong><a name="00512" href="msg00512.html">Re: [ferret_users] EOFSVD_STAT error</a></strong>
<ul><li><em>From:</em> Russ Fiedler</li></ul></li>
<li><strong><a name="00513" href="msg00513.html">Re: [ferret_users] EOFSVD_STAT error</a></strong>
<ul><li><em>From:</em> Manche Shivashankar</li></ul></li>
<li><strong><a name="00514" href="msg00514.html">Re: [ferret_users] EOFSVD_STAT error</a></strong>
<ul><li><em>From:</em> Russ Fiedler</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00514.html">Re: [ferret_users] EOFSVD_STAT error</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00519.html">Re: [ferret_users] EOFSVD_STAT error</a></strong>
</li>

</UL>
<center>[<a href="msg00514.html">Thread Prev</a>][<a href="msg00519.html">Thread Next</a>][<A HREF="threads.html#00517">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
