<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] Regridding Ocean Velocity Data -->
<!--X-From-R13: "Oafyrl Q. [naxr" <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Tue, 30 Aug 2016 14:39:46 &#45;0700 -->
<!--X-Message-Id: 635b5b78&#45;9686&#45;2dbf&#45;2843&#45;186a30664dd8@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CAAZ5b9q7j8hAPqueHzwdJEvfPrCif+62Lft1d6sMQ_PWgvZK_g@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Regridding Ocean Velocity Data</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00445.html">Thread Prev</a>][<a href="msg00447.html">Thread Next</a>][<A HREF="threads.html#00446">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Regridding Ocean Velocity Data</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Regridding Ocean Velocity Data</strong></li>
<li><strong>From</strong>: <strong>&quot;Ansley C. Manke&quot; &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 30 Aug 2016 14:39:44 -0700</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa-gov.20150623.gappssmtp.com; s=20150623;        h=subject:to:references:from:message-id:date:user-agent:mime-version         :in-reply-to:x-original-sender:x-original-authentication-results         :precedence:mailing-list:list-id:list-post:list-help:list-archive         :list-unsubscribe;        bh=it2IBCgUL8KbTqKq/buCZ4SXCuoyMGJWE7z4ZihPRDc=;        b=K5OinHU9fizftaSSb4zYCfokNyAHL/Doxw4cMTeSLjEzhqEUEZlplPmSp1WRQomtub         ZZLL+HM5HZO59DowyrQbbpAU6KvNiqsp7aoDjYbo7UX4EoIRxtrSr8zeMuo9v5rXDpLf         Wnbl12YEdFbjO0n6Y3DOT/DrBLn0hVPiIh7Xpm4isM8GgQ3vddeIlI7I+fTx9prvG5zE         m3ygtwaCYHVO00PlIMALWkWwhxHtS2tEbl7BI8sOhznXdt32/8iN6pRuQalwZkBgC6qW         AjtgisAGIakQSCPi9TovW48FhMVVjP5IoKsj5WBDSSQ6PkVJY6jKmfmug1Unc+AyTdLH         ahLg==</li>
<li>In-reply-to: &lt;<a href="msg00445.html">CAAZ5b9q7j8hAPqueHzwdJEvfPrCif+62Lft1d6sMQ_PWgvZK_g@mail.gmail.com</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;, &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/subscribe">https://groups.google.com/a/noaa.gov/group/ferret_users/subscribe</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00445.html">CAAZ5b9q7j8hAPqueHzwdJEvfPrCif+62Lft1d6sMQ_PWgvZK_g@mail.gmail.com</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:45.0) Gecko/20100101 Thunderbird/45.2.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    <p>Hi Rebecca,</p>
    <p>It sounds as if the model data you're using has separate
      coordinate variables - the lon and lat that you're using in the
      curv_to_rect regridding function. We have not had other reports of
      changes in the magnitude of the data when data is regridded.&#xA0; Note
      that the radius is in degrees, so 10 is probably a bit large; but
      the data used in computing the regridding is weighted by the
      distance from the result location, so this should not cause an
      inaccuracy.&#xA0; <br>
    </p>
    <p>There are some other capabilities and functions you can use in
      Ferret -&#xA0; See "curvilinear coordinates " in the Users' Guide, and
      also to get a list of functions, <br>
    </p>
    <blockquote>
      <p><tt>yes? show function *curv*</tt></p>
      <p><tt>CURV_RANGE(LONGITUDES,LATITUDES,xrange_lo,xrange_hi,yrange_lo,yrange_hi,modulo
          flag for X coordinates)</tt><tt><br>
        </tt><tt>&#xA0;&#xA0;&#xA0; find i,j bounds for subset of a variable in
          curvilinear coordinates</tt><tt><br>
        </tt><tt>&#xA0;&#xA0;&#xA0; LONGITUDES: 2-D longitudes of curvilinear grid</tt><tt><br>
        </tt><tt>&#xA0;&#xA0;&#xA0; LATITUDES: 2-D latitudes of curvilinear grid</tt><tt><br>
        </tt><tt>&#xA0;&#xA0;&#xA0; xrange_lo: Minimum of longitude range</tt><tt><br>
        </tt><tt>&#xA0;&#xA0;&#xA0; xrange_hi: Maximum of longitude range</tt><tt><br>
        </tt><tt>&#xA0;&#xA0;&#xA0; yrange_lo: Minimum of latitude range</tt><tt><br>
        </tt><tt>&#xA0;&#xA0;&#xA0; yrange_hi: Maximum of latitude range</tt><tt><br>
        </tt><tt>&#xA0;&#xA0;&#xA0; modulo flag for X coordinates: 1= X modulo; 0= X
          not modulo</tt><tt><br>
        </tt><tt>CURV_TO_RECT(V,mapping)</tt><tt><br>
        </tt><tt>&#xA0;&#xA0;&#xA0; Apply mapping to regrid from curvilinear to
          rectangular grid</tt><tt><br>
        </tt><tt>...</tt></p>
    </blockquote>
    <p>The CURV_RANGE function returns the I,J bounds in the original
      grid that corresponds to a defined longitude/latitude rectangle.&#xA0;
      This function is newer and is not documented in the Ferret Users
      Guide.&#xA0; You might also find SAMPLEXY_CURV to be useful.<br>
    </p>
    <p>Some model results may include other variables describing the
      grid, such as the area of grid cells, grid cell centers and edges,
      and so forth. If you look at those and perhaps in documentation
      about the model output, you may get ideas for using this
      information in calculations on the native grid that you want to
      do.<br>
    </p>
    <p>Ansley<br>
    </p>
    <p><br>
    </p>
    <div class="moz-cite-prefix">On 8/30/2016 11:23 AM, Rebecca Lynn
      Beadling wrote:<br>
    </div>
    <blockquote
cite=""
      type="cite">
      <div dir="ltr">Hello Ferreters,
        <div><br>
        </div>
        <div>I am analyzing output from CMIP5 models at 26 N and some of
          the models provide their data in x,y coordinates rather than
          lat,lon. I can plot the data using latitude,longitude however
          to integrate the velocity to find the volume transport I have
          to use the x,y values.</div>
        <div><br>
        </div>
        <div>For example how I would calculate the gulf stream transport
          with a model with output given in lat,lon:</div>
        <div><br>
        </div>
        <div>let voltans = vo[x=81W:74W@DIN,y=26N@ITP,k=0:37@DIN]</div>
        <div><br>
        </div>
        <div>For a model in which the data is not already in latitude
          longitude but x and y .... say x goes from 1:182 and y from
          1:149, I am not sure how to determine which y value
          corresponds to 26N besides plotting identical images one using
          the lat,lon and the other without and using the where command
          to identify the closest point to what looks like 26N on the
          lat,lon plot.</div>
        <div><br>
        </div>
        <div>To get around this I thought I could just go ahead and
          regrid all of the data to a rectilinear coordinate system
          using the following script:</div>
        <div><br>
        </div>
        <div>
          <div>let lonin = lon[d=1]</div>
          <div>let latin = lat[d=1]</div>
          <div><br>
          </div>
          <div>define axis/x=0.5:359.5:1/modulo/unit=degrees xax</div>
          <div>define axis/y=-79.5:89.5:1/unit=degrees yax</div>
          <div><br>
          </div>
          <div>let lonlatout = y[gy=yax] + x[gx=xax]</div>
          <div><br>
          </div>
          <div>let map = curv_to_rect_map(lonin,latin,lonlatout,10)</div>
          <div><br>
          </div>
          <div>save/clobber/file=<a rel="nofollow" moz-do-not-send="true"
              href="http://noresm_map.nc">noresm_map.nc</a> map</div>
          <div>can var/all</div>
          <div><br>
          </div>
          <div>use noresm_map</div>
          <div><br>
          </div>
          <div>show data</div>
          <div><br>
          </div>
          <div>let vo_regrid = curv_to_rect(vo[d=1],map[d=2])</div>
          <div><br>
          </div>
          <div>save/clobber/file=<a rel="nofollow" moz-do-not-send="true"
              href="http://vo_regrid.nc">vo_regrid.nc</a> vo_regrid</div>
        </div>
        <div><br>
        </div>
        <div>However I am getting errors when I do this however they
          vary by model. For example when I compare the regridded data
          with the data on the native grid for ESM2M I get an increase
          of ~1.4 Sv when looking at the Gulf Stream Transport. When
          comparing for ESM2G I get an increase of ~10 Sv which seems
          unrealistic.</div>
        <div><br>
        </div>
        <div>Taking a look at the two files I noticed that when I regrid
          I am losing some of the topography / bathemetry and am getting
          values for velocity in regions where there used to be none.&#xA0;</div>
        <div><br>
        </div>
        <div>I have tried varying the radius I use when regridding
          however this does not seem to be solving the problem.</div>
        <div><br>
        </div>
        <div>Has anyone had similar issues when regridding ocean
          velocity data or know a way to determine which y value on a
          models native grid corresponds to a certain latitude?</div>
        <div><br>
        </div>
        <div>Any help would be great!</div>
        <div><br>
        </div>
        <div>Thank you,</div>
        <div><br>
        </div>
        <div>Rebecca Beadling</div>
        <div><br>
        </div>
        <div><br>
        </div>
        <div><br>
        </div>
      </div>
    </blockquote>
    <br>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00445" href="msg00445.html">[ferret_users] Regridding Ocean Velocity Data</a></strong>
<ul><li><em>From:</em> Rebecca Lynn Beadling</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00445.html">[ferret_users] Regridding Ocean Velocity Data</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00447.html">[ferret_users] jjas mean each year</a></strong>
</li>

</UL>
<center>[<a href="msg00445.html">Thread Prev</a>][<a href="msg00447.html">Thread Next</a>][<A HREF="threads.html#00446">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
