<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] Problems with netcdf output and zaxreplace -->
<!--X-From-R13: "Oafyrl Q. [naxr" <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Wed, 3 Jun 2020 18:11:09 &#45;0700 -->
<!--X-Message-Id: 3a1ee7ee&#45;9d47&#45;8745&#45;6ec8&#45;219605f42300@noaa.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1727b4edaf7.g.graffino@tim.it -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Problems with netcdf output and zaxreplace</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00716.html">Thread Prev</a>][<a href="msg00718.html">Thread Next</a>][<A HREF="threads.html#00717">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Problems with netcdf output and zaxreplace</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Problems with netcdf output and zaxreplace</strong></li>
<li><strong>From</strong>: <strong>&quot;Ansley C. Manke&quot; &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Wed, 3 Jun 2020 18:11:03 -0700</li>
<li>Arc-authentication-results: i=2; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=kMHBmpcP;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>;       dmarc=pass (p=REJECT sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-authentication-results: i=1; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=kMHBmpcP;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>;       dmarc=pass (p=REJECT sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence         :content-language:content-transfer-encoding:in-reply-to:mime-version         :user-agent:date:message-id:from:references:to:subject         :dkim-signature;        bh=o+9Ejpkff8vzGUedlLHU1FwpUeb4eB5papv4P5E68lI=;        b=PVKLqcnh7qLalkQHr5q03/0oPB1V/5z9PSC/nt6zenQlZovHo5jmg4hU4ZP8sAX9Ip         C0LuCspGarPfgw+Xn+f2j/cYOcadKQwAwwpRzDAVScD/uar73DBbslrmE4LRuBZOlTR4         ea0+EjfrTJQw0ORBP+xBJge+fzNteqo325yt2Sbhjl2zgYfz5FNdZXEqAc132g6Hs9V4         YkKlmsGpZFf9Ey/1X7q667+AYojoPr1pLXgsA+wPHQZrBPGuFbfwL8F4VhYjZ/vwLvC5         U7j8pcVwD4X0X9+Og+tkhK38zDPYUPDX04hw22CSMBXLSRrhuxXRagTpkvytSOxWEtlR         PhZw==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=content-language:content-transfer-encoding:in-reply-to:mime-version         :user-agent:date:message-id:from:references:to:subject         :dkim-signature;        bh=o+9Ejpkff8vzGUedlLHU1FwpUeb4eB5papv4P5E68lI=;        b=SVxUoNbpVAeIQxHSqAzHd+AoTS2JQNQMmLh0Ao9i8vemfOsH3Zm/Skj9rgIuizmhbJ         AYitQhXF7w4orSnIi6CQDyocUimDh81dP41NzHE4wthXkxpSU7A113FUMm6LgklcbE4b         BOvAuOV35j6A2wZeoP11ROTsyQ03WRhR0uMezX18zUDpUJJiKfhveG8daMKrojdebeZg         glnQMk9g8tJb8jp0XxGY/9uLmBwCVErCY8vk88OqRKTwcNa3FY7jjNmSfd3U1XiC7KOl         BW32bz58tN4CbEVtsNE3UQfZI4BWAB6uEg/TzS0Md/yt6hRaZLO8Nt0Um75YzO3RS5t+         X3eg==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1591233068; cv=pass;        d=google.com; s=arc-20160816;        b=oQRDt+AgPv9b4SJAdFlOgYjWiSIjNOfGWNlfemmEf/YlcdUKrZOmMerySR0ldmBh2S         nqr2DchAARpUabmfJcTx/15xFpvJbM+sQhaNW+cDLBAolRjxVox5coDT8aBDNesVLIvz         RFRFw6Kvohn+jUmJFPj0A+Hzren6B5TeCW0kSv7Qt5/X6xq7fFSalq6VSHBGGE/kgLm4         /rwsXDPK0EeDkfcyGiAiYjYYhrF4em48TQ2TcNJCfS48wi1bryMDxux+UXANEbQUW5fB         1q64qPbmIBArkVpzrVqMu/prvv0lCvTScE1BZLlRE3iGO2HiIcSU4PJLAuo/zn9MEUoI         REkA==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1591233067; cv=none;        d=google.com; s=arc-20160816;        b=axtg9JaZzocNJBjzMWMHluYAHNTRqWL0YjViffm3RRKpkyyWi4Re46J7ekis4WrNkG         GoZLgsN6TTK1tdoY1gvap9MtX00KbGnGLiO1k1c2S/IH1uJWy+jfGgaofipZ1OZynWMO         W91fCb9FpXghTQ2OcLjEGzOzLy8VTgZ0SA6R/8Zvn9LsSQzXD5BLzQRuNyIp3Dgd5r79         2GQf8uHV1M0ZaQGUGVuI/ezxo6buH4H7lpsHgMWn7ZAyO+uTawffIC5pU6GFtGPdZ47V         VYDxl45hPvimxg7Dl1FI2P9AgALPX4nxz4k8GiAeY19eeA+i1Ms0Bcy6iu2LjKBSyZSF         dOSA==</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google;        h=subject:to:references:from:message-id:date:user-agent:mime-version         :in-reply-to:content-transfer-encoding:content-language         :x-original-sender:x-original-authentication-results:precedence         :mailing-list:list-id:list-post:list-help:list-archive;        bh=o+9Ejpkff8vzGUedlLHU1FwpUeb4eB5papv4P5E68lI=;        b=nsw1Wb2I34mXTl19OoHpldXIZNYIsCmnFlG/o6CdH46R+MCq2CjLVXYbyp/lEVSLSq         rr8jzWN9xtMGKUt0wM9OkX/XKJItM1UPw6C87PypiNZ4LxAwmsyCuYEF8Nn7wvCcEsFK         S1b8m0o5FeRvMz94wNEUMMLGrVI56lP6CbfGGZcyZlYrkhf0VgjpkJBn1b49rZA0Deuo         ma5yKTRRR9LrnFSMywsTYmPeBOtGvYpAr9R+0FxbdMXC1lV2aSxcJ1YQObgvGsoJQNgm         lo/MkDUW8BRk3pHn43/VbSp6g0BENbD+ktgjWCbs5WkLUnez6dMf5hnJX11VGhaaYwTA         hjkg==</li>
<li>In-reply-to: &lt;<a href="msg00716.html">1727b4edaf7.g.graffino@tim.it</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00716.html">1727b4edaf7.g.graffino@tim.it</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:68.0) Gecko/20100101 Thunderbird/68.8.1</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi Giorgio,
</pre><tt>When you can, try to update to a newer version of pyferret or ferret. 
</tt><tt>Starting with Ferret v7.2 
</tt><tt>&lt;<a  rel="nofollow" href="https://ferret.pmel.noaa.gov/Ferret/documentation/release_notes/version-7-2-release-notes">https://ferret.pmel.noaa.gov/Ferret/documentation/release_notes/version-7-2-release-notes</a>&gt;, 
</tt><tt>there is much better memory management.&#xA0; With your version of Ferret you 
</tt><tt>can try &quot;set memory/size=&quot;&#xA0; to give it a larger&#xA0; working memory buffer.
</tt><pre style="margin: 0em;">

</pre><tt>For the errors you're seeing when trying to append to a file, the thing 
</tt><tt>to know is that the grid of the variable you are appending needs to 
</tt><tt>match what is in the file, except for time when appending in the time 
</tt><tt>direction.&#xA0; I can't quite see what is happening with the different grids 
</tt><tt>and datasets in your script. What I would do to see what is happening, 
</tt><tt>is at the point in your script where the error occurs, instead write 
</tt><tt>that variable to a second file, and then compare the new file with the 
</tt><tt>one you were trying to append to.&#xA0; The error message is saying that the 
</tt><tt>latitude coordinates don't match.
</tt><pre style="margin: 0em;">

Ansley

On 6/3/2020 10:51 AM, Giorgio Graffino wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Thanks Ashley about those useful tips.

</pre><tt>I'm now adapting my zaxreplace script for other applications (see 
</tt><tt>attached), but I have again issues on saving the output. I think the 
</tt><tt>problem is that the grid is too large for some models, and Ferret 
</tt><tt>complains by saying
</tt><pre style="margin: 0em;">

</pre><tt>**ERROR: request exceeds memory setting: A negative number of words 
</tt><tt>were requested.
</tt><pre style="margin: 0em;">
*** NOTE: The current grid is most likely too large

</pre><tt>So I'm subsetting the variable to select only the region I need, and 
</tt><tt>the computation works. But when I'm saving the generated field into 
</tt><tt>netcdf at line 52, Ferret comes out with the good ol' error
</tt><pre style="margin: 0em;">

**TMAP ERR: error in line definition
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;file coords dont match variable coords on axis LAT77_203

</pre><tt>It doesn't change whether I'm using RESHAPE or not. I also tried to 
</tt><tt>adapt my RESHAPE call according to what I read here 
</tt><tt>(<a  rel="nofollow" href="https://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/XPRESSIONS">https://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/XPRESSIONS</a>), 
</tt><tt>but with no luck. Can you please help me again about this?
</tt><pre style="margin: 0em;">

Cheers,
Giorgio

    ----Messaggio originale----
    Da: ansley.b.manke@xxxxxxxx
    Data: 20-mag-2020 18.52
    A: &quot;Giorgio Graffino&quot;&lt;g.graffino@xxxxxx&gt;
    Cc: &lt;ferret_users@xxxxxxxx&gt;
    Ogg: Re: [ferret_users] Problems with netcdf output and zaxreplace

    Hi,

    You could pass into the script the number of models

    &gt; ferret -script scriptname.jnl 7

    The script then does a repeat loop that would start like this.

    &#xA0;&#xA0; let nmodel = ($1)
    &#xA0;&#xA0; repeat/range=1:($1)/name=r (\
    &#xA0;&#xA0; use /home/data/model`r`.nc;\

    ...

    There are details on the grave-accent evaluation
    &lt;<a  rel="nofollow" href="https://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/EMBEDDED-XPRESSIONS#_VPINDEXENTRY_562">https://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/EMBEDDED-XPRESSIONS#_VPINDEXENTRY_562</a>&gt;that
    give you some flexibility.&#xA0; For instance if the models are named
    model01.nc, model02.nc, ...&#xA0; use the &quot;precision&quot; specifier to ask
    for the value to be replaced with zero-filled numbers, here 2-digits.

    &#xA0;&#xA0; let nmodel = ($1)
    &#xA0;&#xA0; repeat/range=1:`nmodel`/name=r (\
    &#xA0;&#xA0; use /home/data/model`r,p=z2`.nc;


    Or, you could use a unix foreach loop and write your script to
    operate on just one model if that makes sense for what you are
    doing. Here I've made a script myscript.jnl with:

    ! myscript.jnl
    echo ($1)


    This is csh, other shells will have other syntax.

    /home/users/ansley&gt; set flist = 'model_run_7.nc
    ocean_model_run5.nc <a  rel="nofollow" href="http://address/climate.nc">http://address/climate.nc</a>'
    /home/users/ansley&gt; foreach fname ($flist)
    foreach? ferret -script myscript.jnl $fname
    foreach? end
    model_run_7.nc
    ocean_model_run5.nc
    <a  rel="nofollow" href="http://address/data/climate.nc">http://address/data/climate.nc</a>


    On 5/18/2020 10:47 AM, Giorgio Graffino wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
    Hi Ashley,
    thanks for your suggestion.

    I preferred to implement the other method because it involved a
    single Ferret call, but I haven't thought about passing all
    variables in that way. You are suggesting something like

    ferret -script scriptname.jnl model1 model2 model3

    which would be great to have, but I should find a way to loop
    across all models from inside the jnl script. Now my jnl script
    includes

    define symbol model = ($01)

    to read the argument, because I'm parsing only one argument at a
    time. How can I loop over all models from inside the jnl script?

    Cheers,
    Giorgio


        ----Messaggio originale----
        Da: ansley.b.manke@xxxxxxxx
        Data: 12-mag-2020 19.55
        A: &lt;ferret_users@xxxxxxxx&gt;
        Ogg: Re: [ferret_users] Problems with netcdf output and
        zaxreplace

        Hi Giorgio,

        Another method for sending Ferret/PyFerret a set of commands
        is to use the -script option on startup.

        &gt; pyferret -script my_script.jnl&#xA0; [arguments]

        This is generally more flexible than piping commands.&#xA0; The
        startup option -batch for Ferret or -nodisplay for PyFerret
        are also useful when you don't want to have graphics windows
        display.&#xA0; Note that -script must appear last among command
        line switches so that the script arguments will be parsed
        correctly.

        Unix command-line switches
        &lt;<a  rel="nofollow" href="https://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/introduction/GETTING-STARTED#_VPID_8">https://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/introduction/GETTING-STARTED#_VPID_8</a>&gt;



        On 5/9/2020 3:19 AM, Giorgio Graffino wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
        Hi Ryo,
        thanks to your &quot;quote&quot; suggestion I could successfully run
        my bash script.

        Cheers,
        Giorgio

            ----Messaggio originale----
            Da: furue@xxxxxxxxxx
            Data: 28-apr-2020 14.28
            A: &quot;Giorgio Graffino&quot; &lt;g.graffino@xxxxxx&gt;
            Cc: &quot;Ferret&quot; &lt;ferret_users@xxxxxxxx&gt;
            Ogg: Re: [ferret_users] Problems with netcdf output and
            zaxreplace

            Hi Giorgio,

            On Tue, Apr 28, 2020 at 7:09 PM Giorgio Graffino &lt;
            g.graffino@xxxxxx &lt;invalidurl.gif&gt;&gt; wrote:


                !-&gt; REPEAT: I=1
                **ERROR: command syntax: II = ???
                define symbol ii


            Compare this line with the one in the original shell
            script:

            ferret &lt;&lt; STOP
            . . .
            define symbol ii `i`
            . . .
            STOP

            Where did `i`&#xA0; go?

            In the shell script as well as in the ferret script, the
            backquote construct is evaluated.&#xA0; In the above shell
            script, the shell tries to run a command named &quot;i&quot;.&#xA0; It
            fails and is replaced with an empty string. I
            suppose&#xA0;you saw this error message on your screen

            . . . i: command not found

            To prevent the shell from interpreting the backquote
            construct, you &quot;quote&quot; the here-document by

            ferret &lt;&lt;'STOP'
            . . .
            STOP

            Ryo
            --------------------
            To see what's going on, run this kind of test shell script

            echo date
            echo `date`
            echo &quot;abc `date` def&quot;
            echo 'abc `date` def'

            cat &lt;&lt;EOF
            date
            `date`
            EOF

            cat &lt;&lt;'EOF'
            date
            `date`
            EOF



</pre></blockquote><tt>        -- 
</tt><tt>        Ansley Manke
</tt><pre style="margin: 0em;">
        Science Data Integration Group
        NOAA Pacific Marine Environmental Laboratory
        7600 Sand Point Way NE
        Seattle WA 98115

        I am currently teleworking and am available Tue-Wed-Thu.



</pre></blockquote><tt>    -- 
</tt><tt>    Ansley Manke
</tt><pre style="margin: 0em;">
    Science Data Integration Group
    NOAA Pacific Marine Environmental Laboratory
    7600 Sand Point Way NE
    Seattle WA 98115

    I am currently teleworking and am available Tue-Wed-Thu.



</pre></blockquote><pre style="margin: 0em;">

--
Ansley Manke
Science Data Integration Group
NOAA Pacific Marine Environmental Laboratory
7600 Sand Point Way NE
Seattle WA 98115

I am currently teleworking and am available Tue-Wed-Thu.

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00716" href="msg00716.html">Re: [ferret_users] Problems with netcdf output and zaxreplace</a></strong>
<ul><li><em>From:</em> Giorgio Graffino</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00716.html">Re: [ferret_users] Problems with netcdf output and zaxreplace</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00718.html">Re: [ferret_users] Problems with netcdf output and zaxreplace</a></strong>
</li>

</UL>
<center>[<a href="msg00716.html">Thread Prev</a>][<a href="msg00718.html">Thread Next</a>][<A HREF="threads.html#00717">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
