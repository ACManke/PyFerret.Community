<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] vertical formula embedded in netcdf file -->
<!--X-From-R13: "Oafyrl Q. [naxr" <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Tue, 12 May 2020 10:51:34 &#45;0700 -->
<!--X-Message-Id: 279c4358&#45;eb42&#45;f639&#45;408b&#45;2a13c57ceae6@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CAEsMs0RwdG0dBUMfHDc+qH=P0Omw49LJ&#45;_AvEJ3qZrs05r5moA@mail.gmail.com -->
<!--X-Reference: CAEwQpaJ5858d&#45;T370e39D86H7sA6HQQeu&#45;ApXKe=L5QfJrPMfA@mail.gmail.com -->
<!--X-Reference: CAEsMs0Te1dGAar94TwVO8fDL3Ug8Y8big6B47okNf3AwzMVCUw@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] vertical formula embedded in netcdf file</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00639.html">Thread Prev</a>][<a href="msg00635.html">Thread Next</a>][<A HREF="threads.html#00642">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] vertical formula embedded in netcdf file</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] vertical formula embedded in netcdf file</strong></li>
<li><strong>From</strong>: <strong>&quot;Ansley C. Manke&quot; &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 12 May 2020 10:51:31 -0700</li>
<li>Arc-authentication-results: i=2; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=N+j6Dkza;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>;       dmarc=pass (p=REJECT sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-authentication-results: i=1; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=N+j6Dkza;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>;       dmarc=pass (p=REJECT sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence         :content-language:in-reply-to:mime-version:user-agent:date         :message-id:from:references:to:subject:dkim-signature;        bh=8O2Zpf+ay2gV63x6l2+SMXk3CjtKr351dRXj6LFHo78=;        b=MUkUfwunzp/Z3euPH/OwqX4ga4qmn0yscTpD0YO85VGFKh9VpMTnQ/Z+kZdneqCiID         g539jyJ2s1wJLR5GwDFenXyNbssf8xCJ09dC4YhgUH2A3jL+pCvBhoUIs6qZlGsm9Qsq         ulbV3Tjg224o2oRaVXepqW9XyIqJW6OH7LeM+hMSvZJtpGuPNuGTtm0ev7D4D2WJaW/p         TLUwcjkZhSHzTse+DYV0KuhKyu4aNgFRT3E9wrBcGUw0E32QbB6OUjn/FlEVtLvrN5p6         oYHq798t86Zrr2CbK0YDmkUytMlNP82jrpilWRCYvpf0z1aJO+BhpufDuzA2Hh2PTabG         jREg==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=content-language:in-reply-to:mime-version:user-agent:date         :message-id:from:references:to:subject:dkim-signature;        bh=8O2Zpf+ay2gV63x6l2+SMXk3CjtKr351dRXj6LFHo78=;        b=HtLtncjuoNEv94/RmQJhkuuPZ7p7eLizlFVJ6GRI/0xKLbupc2ampEzHbei4tNddt1         WT9aO6H0FiN8po/aZvbsuySKpjHtJG+GcRTZzl1QUFznwmBrYSS3b+X3P5IKsCHG56dU         cDOCczcNhPSM46UECfCHZIKWfR2AF5R4ciNxQmcbJqgYi41uilXJgKwxEKcQ4PwyegcS         8kJQOPXAW+fYeqMj3T9hPxEXoNzqg+pGhs+Oq10Seg2RXEjzSda2bbUDQeMHEQAU/SKM         ZqGW4Snp5veP1dQYsi6iSzLxD1rIcl99cuLCawv/qD1z+Usg6qeq2N5u2ZmC6K8skicD         Q3IA==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1589305894; cv=pass;        d=google.com; s=arc-20160816;        b=aVEQvAmZAN0p4ZyDvXjDYsUzcEOITRqJd1JBQYsYiYne1iU4YcAD4dqaU7NhDo7cY0         9RidaFqKM87GwLzftSzJIVmuvHu8h2hBEvzPSK56UuYQ/+VYvGaV+us2b/bIY92jL/LI         BOXf0YB7A+i+PTVclR29eHagCAzwf4YfiWVRs238l3IMQgTMmXfKRBbQ64DAsu55o4UB         LFWcgf/+ssjuA+4sSIYOhESUABvqAYjP5kBXtwpP3hSRNADWzBr5LWNB+/fa+WYKAHNZ         lKKJO1aPDTLjq2zNTck3iIKaNl9wCBIA1O2OuCpGw4TqtmrEl72Hnlx2b/0GROxc57kp         EM5w==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1589305893; cv=none;        d=google.com; s=arc-20160816;        b=LvWyYSjkxoJ9DiEzB7/41Lkb4QX/pd5IXGG0v8ekOgoUpx8Q5HKY+BED8lNsUT1QCQ         O9UiqkUzS/9l9xakV66VDq90qX8j0yTsUlXlJFY8ECmIDFbO8VBUF4th5k1uZMNbBSVe         QPcZ226hfQxC1gcMtW6M038JtQajJACPGnCVQseVF5hdj5v5ehi9XBQ0GRH5nw7G2uvK         +A6LvfHRs+EIq+n3Fqg1wP3IDAeLfpyr4TqfFvLPpZAJKntJr7hSKWZ3WfBHU53//TDO         n6AGpU0cYup8tt4tIdLwmLQJRY+ubUpa9LeaxViSLWBvIHXD2uioudrx0eMtJdivs+MH         fWyg==</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google;        h=subject:to:references:from:message-id:date:user-agent:mime-version         :in-reply-to:content-language:x-original-sender         :x-original-authentication-results:precedence:mailing-list:list-id         :list-post:list-help:list-archive;        bh=8O2Zpf+ay2gV63x6l2+SMXk3CjtKr351dRXj6LFHo78=;        b=ekG8hMc4MKL76G50FLseDjyVzupVqi9MjfC8FvxfQQtH2pPWn9uZkOc30P0C4pEjYA         fs2kJ6r6G83lUiVhwsafo03mt34gBKcUhU+5EabA0EGKoghO9IcC57ZrfVTt6Pu/6ROB         nuGN3WvTlvkf71+/G3bSnw2XNptdbL5vydQj72MWJZ4+eBs7vPoiD7mFujGITRTUyLdL         HfowypCb1WT4Dg+x0WYaDmXmEewzC/d1zsjF1zmyYnqIpJzq6HzoVFQPrtdH6zoi8dvA         yFBuKjE9jsFboAlDl7SZ7qEVVOUqVMFUXsrbajFSCtvBE+c8pE3Jcqd/4+rwCGoClSIv         cKSw==</li>
<li>In-reply-to: &lt;<a href="msg00639.html">CAEsMs0Te1dGAar94TwVO8fDL3Ug8Y8big6B47okNf3AwzMVCUw@mail.gmail.com</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;CAEsMs0RwdG0dBUMfHDc+qH=P0Omw49LJ-_AvEJ3qZrs05r5moA@mail.gmail.com&gt; &lt;CAEwQpaJ5858d-T370e39D86H7sA6HQQeu-ApXKe=L5QfJrPMfA@mail.gmail.com&gt; &lt;<a href="msg00639.html">CAEsMs0Te1dGAar94TwVO8fDL3Ug8Y8big6B47okNf3AwzMVCUw@mail.gmail.com</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:68.0) Gecko/20100101 Thunderbird/68.8.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->

  
  
    <p>Hi Al,</p>
    <p>No, Ferret/PyFerret doesn't automatically apply formula terms for
      z-regridding, nor does it automatically handle curvilinear
      coordinates in the horizontal direction.&#xA0; <br>
    </p>
    <p>I wonder if we'd do well to alert the user to these elements of
      the file.&#xA0; When there are attributes in the file that indicate
      these grid types, a **NOTE on opening the file pointing to the
      PyFerret terminology for working with these grids might be
      helpful.</p>
    <p>-Ansley<br>
    </p>
    <p><br>
    </p>
    <div class="moz-cite-prefix">On 5/8/2020 11:25 AM, Albert Hermann -
      NOAA Affiliate wrote:<br>
    </div>
    <blockquote type="cite"
cite="">
      
      <div dir="ltr">Thanks much Ryo,
        <div>I'm familiar with ZAXREPLACE; I guess my question is
          whether ferret is already doing this replacement internally
          (since that was the intention of this particular CF standard,
          to allow software to "automatically" regrid, or at least to
          calculate the z-array for the user). Any thoughts on this from
          the ferret developers? As it&#xA0;stands, it is difficult to know
          whether ferret is&#xA0;presenting me with raw or regridded values.
          If the former, I could attempt the regridding with ZAXREPLACE,
          as Ryo&#xA0;suggests.</div>
        <div>Best,</div>
        <div>Al Hermann</div>
      </div>
      <br>
      <div class="gmail_quote">
        <div dir="ltr" class="gmail_attr">On Thu, May 7, 2020 at 9:09 PM
          Ryo Furue &lt;<a rel="nofollow" href="mailto:furue@xxxxxxxxxx"
            moz-do-not-send="true">furue@xxxxxxxxxx</a>&gt; wrote:<br>
        </div>
        <blockquote class="gmail_quote" style="margin:0px 0px 0px
          0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">
          <div dir="ltr">
            <div dir="ltr">Hi Albert,</div>
            <div dir="ltr"><br>
            </div>
            <div>I'm not super familiar with the issue, I've seen this
              discussed on this mailing list, and somebody else must
              have a better answer, but anyway . . .&#xA0;</div>
            <br>
            <div class="gmail_quote">
              <div dir="ltr" class="gmail_attr">On Fri, May 8, 2020 at
                8:58 AM Albert Hermann - NOAA Affiliate &lt;<a rel="nofollow"
                  href="mailto:albert.j.hermann@xxxxxxxx"
                  target="_blank" moz-do-not-send="true">albert.j.hermann@xxxxxxxx</a>&gt;
                wrote:<br>
              </div>
              <blockquote class="gmail_quote" style="margin:0px 0px 0px
                0.8ex;border-left:1px solid
                rgb(204,204,204);padding-left:1ex">
                <div dir="ltr">
                  <div>Hi group,<br>
                  </div>
                  <div><br>
                  </div>
                  <div>I am reading in a file created from one of the
                    CMIP6 models. It appears to have a coordinate
                    transformation embedded&#xA0;as metadata, which one
                    might&#xA0;think would yield&#xA0;different&#xA0;z-levels for the
                    4D variable (vo) at each horizontal location.
                    However, when I read the file into ferret v7.5, I
                    get vo appearing on a single z-axis (which ferret
                    labels as&#xA0; "lev"), ranging from 1 to 7250. That axis
                    has the same values as the "zlev" variable in the
                    original file. Now, "zlev" is in fact used in the
                    depth formula, but it is *not* the only term - other
                    terms in the equation suggest that z-levels should
                    vary by location and time (see the formula listed in
                    the ncdump below). Is ferret in fact regridding to a
                    uniform z-axis based on zlev, or is it erroneously
                    assuming all is uniform?</div>
                </div>
              </blockquote>
              <div><br>
              </div>
              <div>Ferret just shows information contained in your
                netCDF file.&#xA0; It doesn't automatically regrid the data
                for you.</div>
              <div><br>
              </div>
              <div>Your 4D variable seems to be defined on the sigma
                coordinates for levels k = 1, 2, 3, . . . , nsigma</div>
              <div>and on the level coordinates for the deeper levels (k
                = nsigma&#xA0;+ 1, . . . ).</div>
              <div><br>
              </div>
              <div><font face="monospace">for k &lt;= nsigma:</font></div>
              <div><font face="monospace">&#xA0; &#xA0; z(n,k,j,i) = eta(n,j,i) +
                  sigma(k)*(min(depth_c,depth(j,i))+eta(n,j,i))&#xA0;</font></div>
              <div><font face="monospace">for k &gt; nsigma:</font></div>
              <div><font face="monospace">&#xA0; &#xA0; z(n,k,j,i) = zlev(k)</font><br>
              </div>
              <div><br>
              </div>
              <div>In the netCDF file, your 4D variable is defined at
                zlev(k) for all k just for convenience, I guess.&#xA0; &#xA0;For k
                &lt;= nsigma, therefore, zlev(k) doesn't indicate the
                actual depth at which your variable is defined.&#xA0; &#xA0;(For a
                model that uses the sigma coordinates for all depth, the
                vertical coordinate is usually sigma in [0, 1].)</div>
              <div><br>
              </div>
              <div>So, to use your data on Ferret, you first construct
                z(n,k,j,i) as described above for all k, and use it to
                regrid your variable onto the level coordinates with the
                ZAXREPLACE function.&#xA0; There have been discussions about
                that in this mailing list and I think there is an entry
                in Ferret's FAQ, in Ferret's official manual, or both.</div>
              <div><br>
              </div>
              <div>Hope this helps,</div>
              <div><br>
              </div>
              <div>Regards,</div>
              <div>Ryo</div>
            </div>
          </div>
        </blockquote>
      </div>
      <br clear="all">
      <div><br>
      </div>
      -- <br>
      <div dir="ltr" class="gmail_signature"><a rel="nofollow"
          href="mailto:albert.j.hermann@xxxxxxxx" target="_blank"
          moz-do-not-send="true">albert.j.hermann@xxxxxxxx</a><br>
        Pacific Marine Environmental Laboratory<br>
        7600 Sand Point Way NE<br>
        Seattle WA 98115<br>
        206-526-6495</div>
    </blockquote>
    <pre class="moz-signature" cols="72">-- 
Ansley Manke
Science Data Integration Group
NOAA Pacific Marine Environmental Laboratory
7600 Sand Point Way NE
Seattle WA 98115

I am currently teleworking and am available Tue-Wed-Thu.</pre>
  


<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00633" href="msg00633.html">[ferret_users] vertical formula embedded in netcdf file</a></strong>
<ul><li><em>From:</em> Albert Hermann - NOAA Affiliate</li></ul></li>
<li><strong><a name="00634" href="msg00634.html">Re: [ferret_users] vertical formula embedded in netcdf file</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
<li><strong><a name="00639" href="msg00639.html">Re: [ferret_users] vertical formula embedded in netcdf file</a></strong>
<ul><li><em>From:</em> Albert Hermann - NOAA Affiliate</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00639.html">Re: [ferret_users] vertical formula embedded in netcdf file</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00635.html">[ferret_users] white space in latitude-time cross-section plot (Hovemuller plot)</a></strong>
</li>

</UL>
<center>[<a href="msg00639.html">Thread Prev</a>][<a href="msg00635.html">Thread Next</a>][<A HREF="threads.html#00642">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
