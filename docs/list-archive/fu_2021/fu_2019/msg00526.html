<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] reusing information from variable definitions -->
<!--X-From-R13: "Oafyrl Q. [naxr" <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Tue, 11 Feb 2020 13:10:14 &#45;0800 -->
<!--X-Message-Id: bea5ef0f&#45;0d37&#45;c13a&#45;a731&#45;b7cea0c62b80@noaa.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20200127153619.0a19cf13@gfi063209.klientdrift.uib.no -->
<!--X-Reference: d00080bd&#45;a43e&#45;66d1&#45;fd55&#45;de6ccab4a0b0@noaa.gov -->
<!--X-Reference: 20200210174651.41f8eccb@gfi063209.klientdrift.uib.no -->
<!--X-Reference: ME2PR01MB322055FFCCAA90D3A015AB8C9D180@ME2PR01MB3220.ausprd01.prod.outlook.com -->
<!--X-Reference: 20200211113050.5de12d52@gfi063209.klientdrift.uib.no -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] reusing information from variable definitions</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00525.html">Thread Prev</a>][<a href="msg00510.html">Thread Next</a>][<A HREF="threads.html#00526">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] reusing information from variable definitions</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] reusing information from variable definitions</strong></li>
<li><strong>From</strong>: <strong>&quot;Ansley C. Manke&quot; &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 11 Feb 2020 13:10:09 -0800</li>
<li>Arc-authentication-results: i=2; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=koJQhLNB;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.65 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>;       dmarc=pass (p=REJECT sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-authentication-results: i=1; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=koJQhLNB;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.65 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>;       dmarc=pass (p=REJECT sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence         :content-language:content-transfer-encoding:in-reply-to:mime-version         :user-agent:date:message-id:from:references:to:subject         :dkim-signature;        bh=aUCDoRX0HU5mNnwKWKA5JPXQVeBFEDNd09XpzKKfvZ0=;        b=JMTZ33DQORhe7tMivYecQtSnz8LFPGjoZCDSGryt3hQCQ83mqw5xVqwnPLiFsr4/0a         4crSH186se4lqS3sQUBLENeISt1DqzGNG4f0OJ2A33vf65V8fTn56Epz/wD+fP2lwcyu         6zvlv6STUe8onx4rPMc1G/UUMVyi1DEjgkAYszOe+QsrHhS1D/YKpr7WAxZZrtUe/0iZ         zAd+GNOAzY+fsSFU2puzu70DMuKFeMxKU4KEXpVd802Y5uo6BPU1cfHsj5X4P/pWGeiK         34P7l031yPqIZPCB5vTTJxZI02OQGGjKR3FleoeP8kmwYXGbN661fcpOhvTcO4BqKRAW         I4hg==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=content-language:content-transfer-encoding:in-reply-to:mime-version         :user-agent:date:message-id:from:references:to:subject         :dkim-signature;        bh=aUCDoRX0HU5mNnwKWKA5JPXQVeBFEDNd09XpzKKfvZ0=;        b=Cz92KcR4CtK8RZNgGIr+q+qdEpCWuTCs/RUQHFLFqTEQUP3hB8Wal65pn8liJZCg1a         iuFHdRwBWE86jKmTwfQvn8jd/eUSSY0y1Q19L1j5EVPNOb4DAoEXBWTcfrBY8C+rprG9         veb/8FSJHk6D+ckH2or1toHnK/wP+zMuVILAz3DoK3w8kmU4gMxIC8pCsme+/o3+GcMx         UZq20l7hiUvwYKUhvJh+xXV/F8+YygRsDahPx+OIsZX2DG0uWP18bLDLZFTEdBZNg5Gj         I0ybJoLIH78OhV05sXd+MytSBY+6OeOwmlcM+dazgGvvHaCY2aZmoIGDJbs8cjVRa+0T         Xyyw==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1581455414; cv=pass;        d=google.com; s=arc-20160816;        b=MDdsl3cxN6ys8GW2GdAA3qQ9s6ongNq0YE1V8QMhy4neM7VSMWA9aDx5q3BLKS7ThQ         R9LiHZw87ADZRoAx9iq1ZgnhbM0MdZG2GPVJ5P/RfAbx5kJ9IT2Cphfsi7Vl2X4MQAz1         6eh8jPyfzPXBfyaVjiQ7y4qCxQtwOSlrPG1oHRHpMftwhQ0cElA9ALfd9v4CXeAPi1WB         xqwyEhSwGr1Gqo71A9CB/Dzj0+BmG8O5jEX1+WgAPN0Qe7rint2H2CeN09rOBs3D8psE         0OPNkQdIpaOlCyEocBgbNEqO0XciUjJ4bZ+QiizJvr8wM3260oHYwuOovu2mRont9DPX         dnlA==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1581455413; cv=none;        d=google.com; s=arc-20160816;        b=WBCRPpCACaIWKv8NGTftqzbGWp3+SEiVxWeVE99Ps7qV23YEQ5L7SaNo2aD5rmDDY9         Vvs+39FsAZfo0coOb8kXZNhhNGPp0MGrFOaXayBYGDUwEnxi/ozjoe21T6gpOhe+ACJQ         4iU0gaF4Zysxbhjwi/A6H8JuFl5Wp3eAT0fHtox2mOeDdjEUkoiECGJj+zPerWlnaXnU         ZqUDl2Bbz7A6fthbEaMfinPgwC5/oQ4A0o9F+YsvDAklJeKnr4TL4juVjl8PUhgiQG+t         /g2557WFGhE3Fwvk8o/nvBZOxmbCyKYdrG1sC/9gV5XMJFCHJc3B3ZCum3yAw5uPUkKH         X53g==</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google;        h=subject:to:references:from:message-id:date:user-agent:mime-version         :in-reply-to:content-transfer-encoding:content-language         :x-original-sender:x-original-authentication-results:precedence         :mailing-list:list-id:list-post:list-help:list-archive;        bh=aUCDoRX0HU5mNnwKWKA5JPXQVeBFEDNd09XpzKKfvZ0=;        b=UFrQItsLKqZXe4CpA1YZMg4VoZYAX+mArpwLs+AV45RSXc0pAsMgbEG0B/eZDxP8hZ         lBuTgTReD2m8+AXgI2G4SIXjeZE0gEkjgIjTRLfmFWTVFpDWk6nVCbvak7f5xurgrD4X         XaKT0l+b/iKAjIJEnuk1OKY7IKpCD3rofpZwtfWX1ltvKtS+BT0+kfToT0nEIR71MZ+T         KB+osVruyzC8ud7PgNfC0jS6v2LQwyaEq5kGgKFwvG5+HcY9r3OPv3CfCJUPBS8sMOXw         RWBjYEyuJBpa93kcNGgMqYbTet53LibWGp6/iGptoEOAe2XhzuksbxqTP4kAEBe8FvpY         1rMQ==</li>
<li>In-reply-to: &lt;<a href="msg00525.html">20200211113050.5de12d52@gfi063209.klientdrift.uib.no</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00502.html">20200127153619.0a19cf13@gfi063209.klientdrift.uib.no</a>&gt; &lt;<a href="msg00509.html">d00080bd-a43e-66d1-fd55-de6ccab4a0b0@noaa.gov</a>&gt; &lt;<a href="msg00523.html">20200210174651.41f8eccb@gfi063209.klientdrift.uib.no</a>&gt; &lt;<a href="msg00524.html">ME2PR01MB322055FFCCAA90D3A015AB8C9D180@ME2PR01MB3220.ausprd01.prod.outlook.com</a>&gt; &lt;<a href="msg00525.html">20200211113050.5de12d52@gfi063209.klientdrift.uib.no</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:68.0) Gecko/20100101 Thunderbird/68.4.2</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi Marco,

</pre><tt>I have a few ideas, most of which I think you know, but there may be 
</tt><tt>some new details.&#xA0; As you know, the `var,return=` keywords are intended 
</tt><tt>to let you get information that might otherwise appear just in the 
</tt><tt>output of commands such as SHOW.&#xA0; For convenience,
</tt><pre style="margin: 0em;">
<a  rel="nofollow" href="https://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/EMBEDDED-XPRESSIONS#Chapter3-RETURN">https://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/EMBEDDED-XPRESSIONS#Chapter3-RETURN</a>

</pre><tt>Other useful constructs are the ones for access to attributes of files 
</tt><tt>and variables, see here:
</tt><pre style="margin: 0em;">
<a  rel="nofollow" href="https://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/VARIABLES#_VPINDEXENTRY_attributes">https://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/variables-xpressions/VARIABLES#_VPINDEXENTRY_attributes</a>

</pre><tt>To find out how many datasets are open, if the current default dataset 
</tt><tt>corresponds to the last opened, you could define a variable based on the 
</tt><tt>dataset, so for instance this which uses ..nvars, the number of 
</tt><tt>variables in the dataset.
</tt><pre style="margin: 0em;">

yes? use etopo5
yes? use etopo20
yes? use etopo60

yes? let nvars = ..nvars
yes? let last_dset = `nvars,return=dsetnum`
&#xA0;!-&gt; MESSAGE/CONTINUE 3
3

</pre><tt>Note things can get messy, if for example the set of scripts may open 
</tt><tt>datasets and close some of them, or if we did a &quot;set data 2&quot; here so the 
</tt><tt>default dataset isn't the highest number opened.&#xA0; The dataset number for 
</tt><tt>each open dataset stays the same within a Ferret session.
</tt><pre style="margin: 0em;">


The LET/LIKE=&#xA0; acts just the same as this grave-accent evaluation:

yes? let/units=&quot;`aa,return=units`&quot;/&quot;`aa,return=title`&quot; tr = aa+123

</pre><tt>except that it transfers all of the attributes. In those grave-accent 
</tt><tt>evaluations, aa has to refer to the variable in a particular dataset.&#xA0; 
</tt><tt>Once the dataset number is known, you could use SET VARIABLE/UNITS= /TITLE=
</tt><pre style="margin: 0em;">

yes? define symbol dset = `ndset`
</pre><tt>yes? set 
</tt><tt>variable/units=&quot;`aa[d=($dset)],return=units`&quot;/title='`aa[d=($dset)],return=units`&quot; 
</tt><tt>tr
</tt><pre style="margin: 0em;">

</pre><tt>(I see that we should have a SET VARIABLE/LIKE= to pass all of the 
</tt><tt>attributes!)
</tt><pre style="margin: 0em;">



On 2/11/2020 2:30 AM, Marco van Hulten wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hello&#x2014;

On 11 Feb 03:09 Fiedler, Russell (O&amp;A, Hobart) wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
It looks like the /LIKE qualifier could be what you're after.

<a  rel="nofollow" href="https://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/commands-reference/DEFINE#_VPINDEXENTRY_1348">https://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/commands-reference/DEFINE#_VPINDEXENTRY_1348</a>

All attributes are inherited (apart from missing_value, scaling and offset). You can override some if you want.

e.g. (From the examples)



yes? let/like=temperature/title=&quot;Surface Temperature&quot; sst = temperature[z=0:5@MAX]

so

let/like=aa bb=aa+666
let/like=bb/title=&quot;`bb,return=original_definition`&quot; cc = bb

which should be the same as

let/like=aa/title=&quot;`bb,return=original_definition`&quot; cc = bb
</pre></blockquote><pre style="margin: 0em;">
Yes, this would be the solution to the problem that I stated.  The
/LIKE functionality is very useful.  But I forgot to mention something
that complicates the issue.  I will try to state the issue correctly
now.

Several datasets are loaded.  It is known that AA is in one of the
datasets but not in which one.  First, Tr is set as a function of AA:

     let Tr = AA + 123.

If I were to do

     let/like=AA Tr = AA + 123.

this would often result in failure as the current dataset may not be
containing AA.  This 'Tr' is a general variable that I refer to in
later scripts, but AA's name is only known at the stage of this command.

The next thing I do is check in which dataset Tr is available, so

     repeat/i=1:`ndsets` ( if `Tr,return=isReady` then ;\
         let ndset = `i` ;\
         exit/loop \
     )
     set data `ndset`

Note that I cannot determine 'ndsets' before defining Tr.  Only after
ndsets is determined, I can set attributes, e.g. like

     def attr Tr.units = &quot;`AA.units`&quot;

or, if not depending on current default dataset,

     def symb Ndset = `ndset`  ! avoid embedded ````
     def attr Tr.units = &quot;`AA.units[d=($Ndset)]`&quot;

or by redefining

     set data `ndset`
     let/like=AA Tr = AA + 123.

or, again not depending on current dataset (apparently both in the
/LIKE and the expression I must say what the right dataset is, which is
somewhat inconsistent as let Tr=AA; set data `ndset` works fine, i.e.,
without specifying the dataset in the expression):

     let/like=AA[d=`ndset`] Tr = AA[d=`ndset`] + 123.

But none of this would work, because I need to know the name of AA
(whether I set an attribute of Tr or redefine Tr with /LIKE).


I think the above is a MWE equivalent to what I try to accomplish in a
more complicated setting.  For further rationale of my challenge, I
explain it below concretely (see <a  rel="nofollow" href="http://complot.nongnu.org/">http://complot.nongnu.org/</a> for full
context).

One may ask why I want to refer to AA only once (let Tr = AA + 123.).
This is not just an issue of inelegant code duplication.  My main user
script is called with a tracer name argument, so in short this happens:

     def symb Tr = ($1)  ! user may have given &quot;GbSi&quot; as an argument
</pre><tt>     
</tt><tt>     let GbSi = GSi ! variable expected in one of the datasets
</tt><pre style="margin: 0em;">
     let SbSi = BSi
     let TPoC = POC
     ...
     ! Here we determine where ($Tr) is in (ndset).
     ! And then we do the proper initialisation:
     set data `ndset`
     let/like=GSi Tr = ($Tr)
     !        ^^^
     !        this we don't know

Am I overlooking something obvious?

&#x2014;Marco

</pre></blockquote>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00502" href="msg00502.html">[ferret_users] printing filename and line number at error</a></strong>
<ul><li><em>From:</em> Marco van Hulten</li></ul></li>
<li><strong><a name="00509" href="msg00509.html">Re: [ferret_users] printing filename and line number at error</a></strong>
<ul><li><em>From:</em> Ansley C. Manke</li></ul></li>
<li><strong><a name="00523" href="msg00523.html">[ferret_users] reusing information from variable definitions</a></strong>
<ul><li><em>From:</em> Marco van Hulten</li></ul></li>
<li><strong><a name="00524" href="msg00524.html">Re: [ferret_users] reusing information from variable definitions</a></strong>
<ul><li><em>From:</em> Fiedler, Russell (O&amp;A, Hobart)</li></ul></li>
<li><strong><a name="00525" href="msg00525.html">Re: [ferret_users] reusing information from variable definitions</a></strong>
<ul><li><em>From:</em> Marco van Hulten</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00525.html">Re: [ferret_users] reusing information from variable definitions</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00510.html">[ferret_users] Ferret installation error</a></strong>
</li>

</UL>
<center>[<a href="msg00525.html">Thread Prev</a>][<a href="msg00510.html">Thread Next</a>][<A HREF="threads.html#00526">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
