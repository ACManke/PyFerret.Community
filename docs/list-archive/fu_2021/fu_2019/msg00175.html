<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] memory problem with large file when regredding -->
<!--X-From-R13: [negva Epuzvqg <znegva.fpuzvqgNvb&#45;jnearzhraqr.qr> -->
<!--X-Date: Mon, 20 May 2019 07:14:57 &#45;0700 -->
<!--X-Message-Id: b7f029c4&#45;27e3&#45;4feb&#45;a5cd&#45;4a3575c120a5@io&#45;warnemuende.de -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 788501546.326051.1558357404559.JavaMail.zimbra@lsce.ipsl.fr -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] memory problem with large file when regredding</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00186.html">Thread Prev</a>][<a href="msg00181.html">Thread Next</a>][<A HREF="threads.html#00175">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] memory problem with large file when regredding</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] memory problem with large file when regredding</strong></li>
<li><strong>From</strong>: <strong>Martin Schmidt &lt;<a href="mailto:martin.schmidt@DOMAIN.HIDDEN">martin.schmidt@xxxxxxxxxxxxxxxxx</a>&gt;</strong></li>
<li>Date: Mon, 20 May 2019 16:13:43 +0200</li>
<li>Arc-authentication-results: i=3; mx.google.com;       arc=pass (i=2);       spf=neutral (google.com: 52.222.5.176 is neither permitted nor denied by domain of <a href="mailto:martin.schmidt@DOMAIN.HIDDEN">martin.schmidt@xxxxxxxxxxxxxxxxx</a>) smtp.mailfrom=<a href="mailto:martin.schmidt@DOMAIN.HIDDEN">martin.schmidt@xxxxxxxxxxxxxxxxx</a></li>
<li>Arc-authentication-results: i=2; mx.google.com;       arc=pass (i=1 spf=pass spfdomain=io-warnemuende.de);       spf=neutral (google.com: 65.127.216.229 is neither permitted nor denied by domain of <a href="mailto:martin.schmidt@DOMAIN.HIDDEN">martin.schmidt@xxxxxxxxxxxxxxxxx</a>) smtp.mailfrom=<a href="mailto:martin.schmidt@DOMAIN.HIDDEN">martin.schmidt@xxxxxxxxxxxxxxxxx</a></li>
<li>Arc-authentication-results: i=1; mx.google.com;       spf=pass (google.com: domain of <a href="mailto:martin.schmidt@DOMAIN.HIDDEN">martin.schmidt@xxxxxxxxxxxxxxxxx</a> designates 192.124.245.149 as permitted sender) smtp.mailfrom=<a href="mailto:martin.schmidt@DOMAIN.HIDDEN">martin.schmidt@xxxxxxxxxxxxxxxxx</a></li>
<li>Arc-message-signature: i=3; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=message-id:in-reply-to:mime-version:user-agent:date:from:references         :to:subject;        bh=pJAk1SM4Jd3VxKOuxJDO7iA2FWfjP6j1zvsocp4Xgqg=;        b=WZAc9juiKlxYUMe05lZBtzTbTlcjyl62pSP57aSkDERysB2to76BGV6I7k7VmoEJhO         Fin53OdLztGuRCbxrNof1Wq/Ns87IQpXovSWV9H2wLtbyuixTFTJoh4YgDtRulcw1lhb         StXqlhgFZQctu9fm936VQ9HhORFd/F1KXCcX6PARheZYtD61i6BM/j5r0P+4V4xDYed1         Zl5F/V3vdCoScsO4gPYS5IUSYCPy8nXshKCmejXRo3HjIkoewgSLRGUD6KVfS0lUfjyL         hihHo4uBuemjb24G9WSH4tDi3GrEX9xQ8xeqKTXNogS0mnuVBErN6dvTj/hOjT6NDsIx         VJzQ==</li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=in-reply-to:mime-version:user-agent:date:message-id:from:references         :to:subject;        bh=pJAk1SM4Jd3VxKOuxJDO7iA2FWfjP6j1zvsocp4Xgqg=;        b=aHIqxWIgNeARpleNhX0rHzOC8dBoy5Zcr1iQ7jxT/sgAT6rObrI+gQcf+MYFU+NB4A         LoLrxssSlhxJZix7YJwRbhuwG8OpTOOMNS3yDMKZJaXBn7Ywmnjr+EDP7ECOg0BuMhCj         4lZRr17a22RFrpamV5k+i2Xlv/3w+j2shu8BGM4WvU78p3sdA0lZ4FZb0PWiZFhErYdg         kjpyDJwL75XSnL5fIp1ftNpzepOsPPVLTIDR6EhEheJh4VbvQCJmTtirO+p+ugGO6gYX         lyOiI5/s48Ky/xbV8Ep6B7lP3lKY/3zzjOsE9V/dmrHSfKp0XsTzslUOqgWwDGCz1sOx         n96g==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=in-reply-to:mime-version:user-agent:date:message-id:from:references         :to:subject;        bh=pJAk1SM4Jd3VxKOuxJDO7iA2FWfjP6j1zvsocp4Xgqg=;        b=BFo/7xVq95YGZo2nB0pLSPaOPlhM3oavn3xv+XOpdxm0CtE9uMm5BMFoe0LpYuRE3d         DqqYJK++O9TGEkWDei23WCP5HhwbG4tEsHKSxd2gNtFRfjuMDl8toQPtLj1AcUz83Qpe         gxVfZmHdB4Sak8B3ywVvHhfdhh+ZElu5510CXaz7Fe/IGJ6n2oXhMvK2K7z2dAC+xjaS         JvTK0IdDd/1VHFFrEN4g1Ac1hw0WaTvcvmNbZRQ/zGtWVrGQ9s+5Sk0H28tiQDEG435n         7OMhi4aF3lFYiib/j8n17jKM6QgXW4HeoI6j6e0IEQXcntv//+2jB3ZuEYZEE6nK5XkQ         OSNw==</li>
<li>Arc-seal: i=3; a=rsa-sha256; t=1558361696; cv=pass;        d=google.com; s=arc-20160816;        b=c27NCzR+NbpHOKbBkk6pOsv96SqYx8hZ9gKidMe7xc5ft3izBY3yGJwxTRJQ8GVq/x         enAqGzjjHhRuUFMsRpXO02eM8tDN+U+N0o+K9q05uMq0XXAQ82Mb4IlpaWvhqNyig4AX         NxyIGevKGwQAarkzbzcqvd1T5mS1Eim2pjxH1B3eTcUjfCf751o2gaErlRXZlqHJgvZJ         3riIuWx/ZrtblPuKXEPQ96rcE06FcpINQRZY8NQcDyxMm9+rixgGHkXcShSSMMG4cDpR         VJFKCNHUw9MWOzVkdwUQXsUMk+rypi0cMFaaFZvvmF0yrrpmnx0nzbBS+78DyZWH1CIE         0mag==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1558361689; cv=pass;        d=google.com; s=arc-20160816;        b=nBzXENgjnl/rvmQUYlOiHc0sPpDk4PwLiJd8Hf0WABTQhwAIBt2Mya8yWuTdoc8WE4         uw5E5DHvJB014XGOxdpd1WC389HstsKv8uH17tu63pbbxg/RAPhEQ6iiLBc3C3COqjYY         na0fEWV5w9Wphr3Nf75nwF+fusnXi0ma6oxpdlnd4nBXvS07NyC6DUtaKPpyfHu3A5eS         ozYAfezxWBZKmjLRlkzE21AAgyVIbWTrlizq8TzbYKpBR45satSFEVdwRmp91ijXTDkk         XlE93AZmCZdXsg6FlB3T+kTgnG5oRyQbdSezktTraVc0yLd1VH8f4I9UaYUWc3IeVE09         bG2Q==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1558361684; cv=none;        d=google.com; s=arc-20160816;        b=Pl8wxfFCHu3MvoVxXKVLqUY8/oxOX0OrAn2xC51upYCCnQ67LFn9xmfh9b3htoVp8h         aRanhyccMreQPRU/PPxI8kiCfrAN31gBiKeVsrWAsKyL9lbu7lPoZnYPtolWoFxoLxvA         w0tGO9WDYfX2Uf7ZzIFuCdKTyNlAkknUZz0H5WEf2uV6AS5ZYeNtCBcFaSFj+20sCsQB         KM03OGSQMvpnSscWJUV1pE4NqmzmudmZze6imSoi+jyoALKuia4/bIvRAp10tQiZu1IA         lTFCNRZKmW8BCFX7Xpawvhyc7v0eOjRdlXF2mc5aswkT7FtBw1Bd8REVvSlAZzWwlLZr         LYZA==</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google;        h=sender:subject:to:references:from:date:user-agent:mime-version         :in-reply-to:message-id:x-original-sender         :x-original-authentication-results:precedence:mailing-list:list-id         :list-post:list-help:list-archive;        bh=pJAk1SM4Jd3VxKOuxJDO7iA2FWfjP6j1zvsocp4Xgqg=;        b=JlxvQVkJwg1kE8V/E/vzvePxMcFNfW58MeTDTpl2z8+L6osW2xVYzsTSXv0iqqopIV         j5che6ZAJdidev59q1kDpeuApolWaIFcWQ6rjmCV+WyGotADQRvitXsZN2/23q/Xpxi0         fdfnIWNjmDsVY28vOuaMDmAUpJ9Av7k59R4Blt1GQWLmX/3BUodoVBfJIjODKod2LKqd         2NsUAiVgygoLVL4UWTjIPjDSb5ckqLU8JhwQdmBGI8Y2JjJxaxwPY0JQbZdgvfqXlSbh         jEYYCuwckHaIenAyAJGs8wlaCOuP92zaKYxSD8uDzS9xD13Fd1w5JagUuAPCCBxLrM/U         0wSQ==</li>
<li>In-reply-to: &lt;<a href="msg00173.html">788501546.326051.1558357404559.JavaMail.zimbra@lsce.ipsl.fr</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00173.html">788501546.326051.1558357404559.JavaMail.zimbra@lsce.ipsl.fr</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:52.0) Gecko/20100101 Thunderbird/52.9.1</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    <p>Hi Patrick, <br>
    </p>
    <p>if using time slices does not solve the probelm, you may also use
      a domain decomposition like in parallel ocean models. One method
      would be to write the result in separate files for each domain and
      use the methods from MOM or NEMO to glue them into a single file.
      <br>
    </p>
    <p>You may also stay in the "ferret space". The following script
      works for me. wind_2008 contains 1 year daily wind with .25 deg
      resolution in that region also covered by the coarse grid. So not
      really huge. <br>
    </p>
    <p>I am aware, this is not the ultimate check that this method saves
      memory. You need to load one time slice once completely, just to
      write the x/y axes not allowing for extension with "append". I
      also left ferret between two slices and started from the
      beginning, for sure without writing the axes again. So I would
      expect that ferret loads only data for the subregions.</p>
    <p>The script needs streamlining to estimate the indices etc. But it
      shows the method. <br>
    </p>
    <p>Best,</p>
    <p>Martin<br>
    </p>
    <p> <br>
    </p>
    <p>use wind_2008.nc<br>
      <br>
      define axis/x=-60:30:1/edges/unit=degrees_east xax<br>
      define axis/y=-60:20:1/edges/unit=degrees_north yax<br>
      <br>
      can axis/modulo xax<br>
      <br>
      define grid /x=xax/y=yax gc<br>
      let wc = wind_speed[g=gc@ave]<br>
      <br>
      can region<br>
      save/l=1 /clobber/file=test.nc/outtype=float wc<br>
      <br>
      set region/x=-60:-30 /y=-60:-40<br>
      save/append/file=test.nc/outtype=float wc[i=1:30]<br>
      set region/x=-30:0 /y=-60:-40<br>
      save/append/file=test.nc/outtype=float wc[i=31:60]<br>
      set region/x=0:30 /y=-60:-40<br>
      save/append/file=test.nc/outtype=float wc[i=61:90]</p>
    <p>! you may leave ferret here and may restart<br>
      set region/x=-60:-30 /y=-40:-20<br>
      save/append/file=test.nc/outtype=float wc[i=1:30,j=21:40]<br>
      set region/x=-30:0 /y=-40:-20<br>
      save/append/file=test.nc/outtype=float wc[i=31:60,j=21:40]<br>
      set region/x=0:30 /y=-40:-20<br>
      save/append/file=test.nc/outtype=float wc[i=61:90,j=21:40]<br>
      <br>
      ! you may leave ferret here and may restart<br>
      set region/x=-60:-30 /y=-20:20<br>
      save/append/file=test.nc/outtype=float wc[i=1:30,j=41:80]<br>
      set region/x=-30:0 /y=-20:20<br>
      save/append/file=test.nc/outtype=float wc[i=31:60,j=41:80]<br>
      set region/x=0:30 /y=-20:20<br>
      save/append/file=test.nc/outtype=float wc[i=61:90,j=41:80]<br>
      <br>
      <br>
    </p>
    <br>
    <div class="moz-cite-prefix">Am 20.05.2019 um 15:03 schrieb Patrick
      Brockmann:<br>
    </div>
    <blockquote type="cite"
      cite="">
      
      <div style="font-family: arial, helvetica, sans-serif; font-size:
        12pt; color: #000000">
        <div>Hi all,<br>
        </div>
        <div><br data-mce-bogus="1">
        </div>
        <div>I have a 5Go variable at 0.01x0.01 resolution and I would
          like to save it at a coarser resolution.<br data-mce-bogus="1">
        </div>
        <div>My regridding script can be run because it requires too
          much memory.<br data-mce-bogus="1">
        </div>
        <div><br data-mce-bogus="1">
        </div>
        <div>Is there a strategy to run i ?<br data-mce-bogus="1">
        </div>
        <div>I have tried to save it with different /append calls but
          cannot figure out<br data-mce-bogus="1">
        </div>
        <div>because anunlimited dimension seems to be possible only for
          time dimension (L).<br>
        </div>
        <div><br data-mce-bogus="1">
        </div>
        <div>Here are the simplified lines from my script for a
          regredding from 0.01 to 0.1&#xB0;<br data-mce-bogus="1">
        </div>
        <div><br data-mce-bogus="1">
        </div>
        <div>!============================<br data-mce-bogus="1">
        </div>
        <div>use file_0.01.nc&#xA0;&#xA0;&#xA0;&#xA0; ! mask1 is the variable to regrid<br
            data-mce-bogus="1">
        </div>
        <div><br data-mce-bogus="1">
        </div>
        <div>def axis/x=-180:180:0.1/edges/units=degrees_east myxaxis <br>
          def axis/y=-90:90:0.1/edges/units=degrees_north myyaxis&#xA0; <br>
          def grid/x=myxaxis/y=myyaxis mygrid<br>
          let mask = mask1[G=MYGRID@AVE]&#xA0; <br>
          <br data-mce-bogus="1">
        </div>
        <div>save/clobber/file=file_0.1.nc mask<br data-mce-bogus="1">
        </div>
        <div>!============================</div>
        <div><br data-mce-bogus="1">
        </div>
        <div>Any help would be appreciated.<br data-mce-bogus="1">
        </div>
        <div>Regards<br data-mce-bogus="1">
        </div>
        <div><br data-mce-bogus="1">
        </div>
        <div>Patrick</div>
        <div><br data-mce-bogus="1">
        </div>
        <div data-marker="__SIG_PRE__">--<br>
          Data Analysis and Visualization Engineer / Project Manager<br>
          LSCE/IPSL, CEA-CNRS-UVSQ laboratory<br>
          LSCE - Climate and Environment Sciences Laboratory<br>
          IPSL - Institut Pierre Simon Laplace<br>
          --</div>
      </div>
    </blockquote>
    <br>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00173" href="msg00173.html">[ferret_users] memory problem with large file when regredding</a></strong>
<ul><li><em>From:</em> Patrick Brockmann</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00186.html">Re: [ferret_users] memory problem with large file when regredding</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00181.html">[ferret_users] how to put symbol in legend</a></strong>
</li>

</UL>
<center>[<a href="msg00186.html">Thread Prev</a>][<a href="msg00181.html">Thread Next</a>][<A HREF="threads.html#00175">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
