<!-- MHonArc v2.5.13 -->
<!--X-Subject: Re: Hide outside labels -->
<!--X-From-R13: Xnvfba Yhevna <wnvfbaNpnbf.vvfp.rearg.va> -->
<!--X-Date: Sun, 5 Dec 2004 10:58:02 &#45;0800 -->
<!--X-Message-Id: Pine.LNX.4.44.0412060033280.29276&#45;200000@caos.iisc.ernet.in -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: 41AE1301.7020609@noaa.gov -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<title>Re: Hide outside labels</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00862.html">Thread Prev</a>][<a href="msg00860.html">Thread Next</a>][<A HREF="threads.html#00873">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: Hide outside labels</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: Hide outside labels</strong></li>
<li><strong>From</strong>: <strong>Jaison Kurian &lt;<a href="mailto:jaison@DOMAIN.HIDDEN">jaison@xxxxxxxxxxxxxxxxxx</a>&gt;</strong></li>
<li>Date: Mon, 6 Dec 2004 00:36:45 +0530 (IST)</li>
<li>Cc: Ansley Manke &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;, Julien Demaria &lt;<a href="mailto:dem@DOMAIN.HIDDEN">dem@xxxxxxxxxx</a>&gt;</li>
<li>In-reply-to: &lt;<a href="msg00862.html">41AE1301.7020609@noaa.gov</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Hi Julien &amp; Ansley,
                      I just put Ansley's idea to a Ferret go script 
(see the attachment, label_inside.jnl). As Ansley mensioned in his 
previous mail, it is not that easy to get the labelling automated with
all our requirements satisfied. Even if you are using this go file, you
have to tune few arguments in order to get the plot labels in the 
desired  form. 

    Please find the details inside the jnl file and have a look at the
example given in the jnl file. In case you need any more explanation or
finds any problems with it, please let me know.

With Regards

Jaison

On Wed, 1 Dec 2004, Ansley Manke wrote:

&gt; Hi Julien,
&gt; There's no easy answer for this in terms of Ferret commands; labeling is 
&gt; set up so that
&gt; labels can be placed anywhere in the plot window. 
&gt; 
&gt; The answer will probably be that you'll have to compute the amount of 
&gt; space available
&gt; in the plot box, using symbols like  PPL$XLEN, axis length in inches, 
&gt; and XAXIS_MIN
&gt; and XAXIS_MAX, which are the axis endpoints in user units (e.g. 
&gt; longitude).  Then
&gt; you would compute the distance from your desired location to the edge of 
&gt; the plot box.
&gt; The size of the text and function STRLEN would tell how much of the 
&gt; label will fit, and
&gt; SUBSTRING  shortens the strings as needed.
&gt; 
&gt; Users, does anyone do this general kind of thing?  Does anyone have 
&gt; scripts that compute
&gt; positions on the pages in terms of plot-axis lengths, converting between 
&gt; user units and inches,
&gt; and the size of string labels?  I imagine a few examples would be very 
&gt; helpful.
&gt; 
&gt; Ansley
&gt; 
&gt; Julien Demaria wrote:
&gt; 
&gt; &gt; Ansley,
&gt; &gt;
&gt; &gt; Thanks for your answer,
&gt; &gt;
&gt; &gt; In fact I want use the mode ppl window off, but I need truncate cities 
&gt; &gt; labels too when there are too long and has a part outside the 
&gt; &gt; window... : example : at the end of your example :
&gt; &gt;
&gt; &gt; label 10, 53, -1, 0, 0.12 LONGLONGLABEL
&gt; &gt;
&gt; &gt; I need this because I generate labels from a big list of cities and I 
&gt; &gt; cannot know if each label 'll overlap the window (depending on font, 
&gt; &gt; size, ...).
&gt; &gt;
&gt; &gt; Thanks,
&gt; &gt;
&gt; &gt; Julien
&gt; &gt;
&gt; &gt; At 18:24 30/11/2004, Ansley Manke wrote:
&gt; &gt;
&gt; &gt;&gt; Hi Julien,
&gt; &gt;&gt; You don't say what command you're using to plot your symbols, but 
&gt; &gt;&gt; with either
&gt; &gt;&gt; the PLOT/VS command or POLYGON command,  the PPL WINDOW OFF
&gt; &gt;&gt; command will set Ferret so it doesn't &quot;window&quot; the data, that is, 
&gt; &gt;&gt; clip it to the
&gt; &gt;&gt; edges of the plot box.  Try this example:
&gt; &gt;&gt;
&gt; &gt;&gt;   yes? go basemap x=-60:20 y=20:80 20
&gt; &gt;&gt;   yes? ppl window off
&gt; &gt;&gt;
&gt; &gt;&gt;   yes? let xpts =  {10,15,20,22,25}
&gt; &gt;&gt;   yes? let ypts =  {43,55,49,43,50}
&gt; &gt;&gt;   yes? plot/vs/over/nolab/color=red/sym=26 xpts, ypts
&gt; &gt;&gt;
&gt; &gt;&gt;   yes? let ypts =  {53,65,59,53,60}
&gt; &gt;&gt;   yes? go polymark poly/over/nolab/nokey/line/pal=green xpts, ypts, 
&gt; &gt;&gt; ,circle
&gt; &gt;&gt;
&gt; &gt;&gt; Julien Demaria wrote:
&gt; &gt;&gt;
&gt; &gt;&gt;&gt; Hi,
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; I need to display a list of cities names on my map with little cross 
&gt; &gt;&gt;&gt; : when a cross is outside my map it is automatically hidden, but the 
&gt; &gt;&gt;&gt; associated label is displayed...
&gt; &gt;&gt;&gt; Are there tricks to automatically hide outside labels ?
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Thanks in advance,
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Julien
&gt; &gt;&gt;
&gt; &gt;
&gt; 

-- 
___________________________________________________

    Jaison Kurian                           
    Centre for Atmospheric and Oceanic Sciences
    Indian Institute of Science
    B A N G A L O R E   560 012
    Ph: +91-80-3942505
        +91-80-3600450
    Fax:+91-80-3600865
___________________________________________________
</pre>
<pre>\ cancel mode verify
!
! Description : Put labels such that the whole string will be inside the 
! -----------       plot area. IF the string will not fit inside the plot
!                   area, then trim it. Appropriate alignment will be chosen
!                   by the script. There will be little offset in the -ve Y
!                   direction for labels in the upper half of the plot area
!                   for a better clarity. There is no option for &quot;cetre align
!                   or justify&quot; and to &quot;rotate&quot; the string in order to
!                   avoid the complexity.
! Date : 05-DEC-2004
!
! Arguments :
! ----------  
! Mandatory   
!      (real) $1 : x position of label in X-axis units
!    &quot; (real) $2 : y position of label in Y-axis units
!    &quot; (text) $3 : label string in double quotes
! Optional    
!      (real) $4 : font size  (default is 0.12)
!    &quot; (int ) $5 : text color ( between 1 &amp; 18; default is black (1))
!    &quot; (text) $6 : font style (default is SR)
!    &quot; (int ) $7 : x clip =&gt; number of charaters to clip(if +ve) or add (if -ve) )
!                                  default is +1
!    &quot; (real) $8 : y clip =&gt; y delta over which labelling will be skipped at top and
!                                  bottom of the plot for neatness of plot ; should
!                                  be in yaxis units ; can be +ve or -ve ; default is 1
!    &quot; (int ) $9 : skip labelling if full string doesn't fits inside the plot area
!                        $9 .NE. 0 ==&gt; skip labelling with trimmed string
!                        $9 .EQ. 0 ==&gt; label with the trimmed string  (default)
!
! Usage :
! -------   
!          GO label_inside xpos, ypos, string, [font_size], [color], [font_style], [x_clip], [y_clip], [skip_trimmed]
!
! Example :
! --------
!   go basemap x=-60:20 y=0:80 20
!   let xpts = {-61,-60,-50,-40,-30,-20,-10,  0, 10, 20, 20}
!   let ypts = { 10,  0, 10, 20, 30, 40, 50, 60, 70, 80, 83}
!   plot/vs/over/color=4/nolab/size=0.2/sym=40 xpts, ypts
!   REPEAT/RANGE=1:11:1/NAME=labid ( ;\
!      let xx = xpts[i=`labid`] ;\      ! strongly recommended to use immediate
!      let yy = ypts[i=`labid`] ;\      !  variables to pass arguments within repeat loop
!      go label_inside xx, yy,&quot;WHATEVER MAY BE THE LENGTH OF THE STRING I WILL PUT IT INSIDE THE PLOT AREA&quot;, 0.12, 6, AS, 1,1,0 ;\
!     )
!
! NOTE :
! ------
! If you want to get &quot;_&quot; and &quot;^o&quot; in the same string then
!      select font style other than AS 
!      give a &quot;-&quot; sign after &quot;_&quot; like    &quot;mylab_-and^o degrees&quot;
! ref : <a  href="http://ferret.pmel.noaa.gov/Ferret/Mail_Archives/fu_2003/msg01555.html">http://ferret.pmel.noaa.gov/Ferret/Mail_Archives/fu_2003/msg01555.html</a>
!-----------------------------------------------------------------------------------

! put proper names to arguments and/or do a checking 

     let lbl_x             =  $1&quot;&lt;Usage: GO label_inside[.jnl] xpos ypos string [font_size] [color] [font_style] [x_clip] [y_clip] [skip_trimmed]&quot;
     let lbl_y             =  $2&quot;&lt;Usage: GO label_inside[.jnl] xpos ypos string [font_size] [color] [font_style] [x_clip] [y_clip] [skip_trimmed]&quot; 
     define symbol lbl_t   =  $3&quot;&lt;Usage: GO label_inside[.jnl] xpos ypos string [font_size] [color] [font_style] [x_clip] [y_clip] [skip_trimmed]&quot; 

     let lbl_sz             =  $4&quot;0.12&quot;           ! label font size
     let lbl_cl             =  $5&quot;1&quot;              ! label color, default black(1)
     define symbol lbl_stl  =  $6&quot;SR&quot;             ! label font style
     let lbl_skip_trimmed   =  $9&quot;0&quot;              ! allow for skipping trimmed labels
      
     let lbl_len            = STRLEN(&quot;($lbl_t)&quot;)  ! length of label text
     let lbl_l_max          = 0                   ! initialize, max char for left align 
     let lbl_r_max          = 0                   ! initialize, max char for right align
     let lbl_big            = 0                   ! initialize, biggest of above two
     define symbol do_label = no                  ! initialize
      
! define a cutoff for y when y is near to y_min or y_max of plot area   

     let lbl_y_max  = `(($PPL$YLEN)+($PPL$YORG))/lbl_sz`! maximum charaters along y 
     let lbl_y_len  = `($YAXIS_MAX)-($YAXIS_MIN)`       ! lenth of yax in axis units
     let lbl_y_off  = lbl_y_len/lbl_y_max               ! length of one char along yax 
                                                        !   as y cutoff
     let lbl_yclip  = $8&quot;`lbl_y_off`&quot;                   ! allow for user input
     let lbl_ybig   = `($YAXIS_MAX)` - lbl_yclip        ! max y for labelling
     let lbl_ysml   = `($YAXIS_MIN)` + lbl_yclip        ! min y for labelling
     
! in case label doesn't fit inside the plot area allow user to clip chars

     let lbl_xclip      = $7&quot;1&quot;                         ! how many chars to clip
     let lbl_xclip      = INT(`lbl_xclip`)

! ok..now check wether the labelling is inside the plot area or not

     IF `lbl_x GE ($XAXIS_MIN) AND lbl_x LE ($XAXIS_MAX)` THEN
        IF `lbl_y GE lbl_ysml AND lbl_y LE lbl_ybig` THEN
            define symbol do_label = yes
        ENDIF
     ENDIF
      
! align to &quot;bottom&quot; when label is in upper half of the plot area 

     let lbl_ymid = `($YAXIS_MIN)+($YAXIS_MAX)`/2
     IF `lbl_y GT lbl_ymid` THEN
         let lbl_y = `lbl_y` - 1.5*lbl_y_off
     ENDIF

! determine the alignment : left align is preffered

     let lbl_max_chars = `(($PPL$XLEN)+($PPL$XORG))/lbl_sz`! max chars possible
     let lbl_max_len       = `($XAXIS_MAX)-($XAXIS_MIN)`   ! lenth of xax in axis units
 
     let lbl_l_sz   = ($XAXIS_MAX)-lbl_x                   ! current size for left align
     let lbl_l_max1 = lbl_max_chars * lbl_l_sz/lbl_max_len ! max chars for left align
     let lbl_l_max  = INT(lbl_l_max1)                      !          &quot;
     IF `lbl_len LE lbl_l_max` THEN                        ! if it fits inside the plot
         let align              = -1                       ! then align left (-1)
         define symbol lbl_txt  = ($lbl_t)                 ! use full string
     ELSE                                                  ! if left align doesn't work
         let lbl_r_sz   = lbl_x-($XAXIS_MIN)               ! current size for right align
         let lbl_r_max1 = lbl_max_chars * lbl_r_sz/lbl_max_len ! max chars for right align
         let lbl_r_max  = INT(lbl_r_max1)                  !          &quot;
         IF `lbl_len LE lbl_r_max` THEN              ! if it fits inside the plot
            let align              =  1              ! then align right (1)
            define symbol lbl_txt  = ($lbl_t)        ! use full string
         ELSE                                        ! full text will not fit..trim it
            IF ($do_label) THEN                      ! if point is inside plot area
               IF `(lbl_skip_trimmed) EQ 0` THEN     ! if trimming is allowed
                   define symbol do_label = yes      !  ok ..do it
               ELSE                                  ! if trimming is not allowed
                   define symbol do_label = no       !  don't do the labelling
               ENDIF
            ENDIF
            let lbl_big = MAX(lbl_l_max,lbl_r_max)   ! more space is to left or right?
            IF `lbl_big EQ lbl_l_max` THEN           ! ok..to the left
               let align              = -1           !    then align left(-1)
            ELIF `lbl_big EQ lbl_r_max` THEN         ! no..it is to right
               let align              =  1           !    then align right(1)
            ENDIF
            let lbl_str = SUBSTRING(&quot;($lbl_t)&quot;,1,`lbl_big-lbl_xclip`) ! trim it to fit inside
            define symbol lbl_txt  = `lbl_str`       ! use the trimmed string to label
         ENDIF       
     ENDIF

! check the color argument

     let lbl_cl_len = STRLEN(&quot;`lbl_cl`&quot;)      ! wether color is between 1-9 or 10-19
     IF   `lbl_cl_len EQ 1` THEN              ! if it is between 1 and 9
          define symbol lbl_col = 0`lbl_cl`   ! put one &quot;0&quot; before it
     ELIF `lbl_cl_len EQ 2` THEN              ! if it is between 10 and 19
          define symbol lbl_col = `lbl_cl`    ! take it &quot;as is&quot;
     ELSE                                     ! we have only 19 colors !!!!
          say &quot;#### Error in Argument Passed to label_inside.jnl .&quot;
          say &quot;5th Argument color should be between 1 &amp; 19&quot;
          EXIT
     ENDIF

! if it passed all the tests, then do it 

     IF ($do_label) THEN        
        label `lbl_x`, `lbl_y`, `align`, 0, `lbl_sz`, @c0($lbl_col)@($lbl_stl)($lbl_txt)
     ENDIF

! cancel variables/symbols declared within label_inside.jnl

    cancel var    lbl_*
    cancel symbol lbl_*

</pre>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00862" href="msg00862.html">Re: Hide outside labels</a></strong>
<ul><li><em>From:</em> Ansley Manke</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00862.html">Re: Hide outside labels</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00860.html">fill vs shade</a></strong>
</li>

</UL>
<center>[<a href="msg00862.html">Thread Prev</a>][<a href="msg00860.html">Thread Next</a>][<A HREF="threads.html#00873">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<hr>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> / 
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://tmap.pmel.noaa.gov">TMAP</a>
</address> <br> <a href="http://ferret.pmel.noaa.gov/Ferret/ferret_contact_us.html">Contact Us</a> | <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 
</font>
<!--X-User-Footer-End-->
</body>
</html>
