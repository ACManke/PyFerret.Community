<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] Vertical velocity in Soda3.15.2 monthly mean data -->
<!--X-From-R13: Dlb Thehr <shehrNunjnvv.rqh> -->
<!--X-Date: Thu, 31 Aug 2023 20:51:29 &#45;0700 -->
<!--X-Message-Id: CAEwQpa+cNebt6ThHs8SYPMew=Awu741c+SBhpwz4T450BrN8Rw@mail.gmail.com -->
<!--X-Content-Type: multipart/related -->
<!--X-Reference: CADrnUWwbv0wyB3x&#45;Mt+xq5jotsBJcfLz4HrAiMHa0c8Teu0mJA@mail.gmail.com -->
<!--X-Reference: CAEwQpaKOu0W7F4m&#45;d5PLnuwFhCeveKF0Mc1tbdSGLD9ErdzwCA@mail.gmail.com -->
<!--X-Derived: pngjYxPKWOgmb.png -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Vertical velocity in Soda3.15.2 monthly mean data</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg01280.html">Thread Prev</a>][<a href="msg01282.html">Thread Next</a>][<A HREF="threads.html#01281">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Vertical velocity in Soda3.15.2 monthly mean data</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Satheesh Shenoi &lt;<a href="mailto:shenoi1958@DOMAIN.HIDDEN">shenoi1958@xxxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Vertical velocity in Soda3.15.2 monthly mean data</strong></li>
<li><strong>From</strong>: <strong>Ryo Furue &lt;<a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a>&gt;</strong></li>
<li>Date: Fri, 1 Sep 2023 12:51:09 +0900</li>
<li>Arc-authentication-results: i=3; mx.google.com;       dkim=pass header.i=@hawaii.edu header.s=google header.b=ZVonZ1UZ;       arc=pass (i=1 spf=pass spfdomain=hawaii.edu dkim=pass dkdomain=hawaii.edu dmarc=pass fromdomain=hawaii.edu);       spf=pass (google.com: domain of <a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a> designates 209.85.161.70 as permitted sender) smtp.mailfrom=<a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a></li>
<li>Arc-authentication-results: i=2; mx.google.com;       dkim=pass header.i=@hawaii.edu header.s=google header.b=ZVonZ1UZ;       arc=pass (i=1 spf=pass spfdomain=hawaii.edu dkim=pass dkdomain=hawaii.edu dmarc=pass fromdomain=hawaii.edu);       spf=pass (google.com: domain of <a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a> designates 209.85.161.70 as permitted sender) smtp.mailfrom=<a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a></li>
<li>Arc-authentication-results: i=1; mx.google.com;       dkim=pass header.i=@hawaii.edu header.s=google header.b=ZVonZ1UZ;       spf=pass (google.com: domain of <a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a>;       dmarc=pass (p=NONE sp=NONE dis=NONE) header.from=hawaii.edu</li>
<li>Arc-message-signature: i=3; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence:cc         :to:subject:message-id:date:from:in-reply-to:references:mime-version         :sender:dkim-signature;        bh=UpvPnP+orHzHqyfWtluHBjcL+a5VS9aMsrqwyyzrHZA=;        fh=OCQe8cYc4LR2DBuZzRbbb5j2VtBt+ExvcEnL7VAcf7Q=;        b=w1QuoLqsp/cdYqOjaeoImJG2NfpB9ESOUEIoCfo64ucVw2ZIWFNZDTQeg/3z2v5MdO         DIMIOh640gZ/8EFUR2sO12LIlN/45sQlX2ZqtimzCl9AScgSH624YqA7+IJekRlkNs37         aFGFgAnrnPVM5JE597KQ2KglG5YilXGKBIRxixd3CC9hl3L6WSSpQLbBLsKwvs2V4KIJ         pgqVRHTc5Rl1+05EbEwMtZoh3srlVOMDjLQJj7LEVYMinZNwYK7EdLjmu3Cnq67ipceh         9l9Bk69hagUo0v2kQ25LkaVhOnBlRdcqyLfLiUNVT7UpkNz0yp5wdpkUYOgTvY2Txrpo         HVLg==</li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=cc:to:subject:message-id:date:from:in-reply-to:references         :mime-version:dkim-signature;        bh=UpvPnP+orHzHqyfWtluHBjcL+a5VS9aMsrqwyyzrHZA=;        fh=OCQe8cYc4LR2DBuZzRbbb5j2VtBt+ExvcEnL7VAcf7Q=;        b=RTtok0BzBBWmuw45xwKUb/qeZq5VlD049Bg9AgSEm3UghwSEhFlZwtSRBVmgw2AmnC         ELi0HNXtIUDpvIdrlnxJjA0fPTMVEkBTXhc9834njbw01xSpD6FWwll8qPz5elb/a229         DACObDswUhhYdTGpfhz7EhC3j+7cLduLqHsPsUfuQk5OF68jj/npc13HXhyzMqYMD01Q         MXbSHAblk/aPzUeqc9Af/Cy797ABdv8zyhqcev5sj0/zCBrRoNzsjLgg+ZDvsg9moece         Q8vY0HRliZ/fhJtF06QdgieYznHpOXVp2QzeqjNg8cCD3LBXb0eOWGWv92XJ9TO+iODS         QjkA==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=cc:to:subject:message-id:date:from:in-reply-to:references         :mime-version:dkim-signature;        bh=UpvPnP+orHzHqyfWtluHBjcL+a5VS9aMsrqwyyzrHZA=;        fh=OCQe8cYc4LR2DBuZzRbbb5j2VtBt+ExvcEnL7VAcf7Q=;        b=PusKCxok3td9ucw4RfJEnrlmbEYidmykpqBgy6PjRJttGw+81wFoS3wnbwAx8p0169         9qSDZzP1ua1jeFKLRx6yZoHdhe/4XeKVvEs+/Qw2muMkZw4BoMbAUrWEwHBHUPCUoTRS         rS4Mw64WF6J26NBS3lq13O/GY0ButhBJsGbRF7d5FmEnQVbw2uVNwUpOJ30PyeElVCLg         2xgOjkmFMOK5ERbc5XbRp38b7KqH36s6/rrXNWDJUja7He7c5Ej/cL9eGgJA2wMxt7e2         AcVaK3efq6Qho0mHNDXeMJJ3npU2845NEPj6SjZyLSKrcj/D94gGEfSjImajacXre6fe         mBmw==</li>
<li>Arc-seal: i=3; a=rsa-sha256; t=1693540288; cv=pass;        d=google.com; s=arc-20160816;        b=y0vd/tvtV+IWc7DsVLnAmuN/k5DZD3JqdNvzI0sh2gwnMq6yjRnNsS20baAToR46kv         QtnKwHMD+eU4Ngz4VDfEapXfUjmIaVtXh/F4ApmtF4px2poOxWihKXMx2ySXOz++rvBs         QVOc5G6QAz1s6a/hEAp7P3Ny7muWdxjwiEvIjzVzBee52MuuzUqeF4F7sjmqA1phf5rA         lLBvsOwWTJW3cNubsrvocWYz86HcmrwK5+xB7ErjJgz1m/Crf5llkuSqS7Oszhj+66ZJ         yfYq8hDXMTO7RsNcDOOcC7IYdiinObNg7qqJZyb69OemG2JMGOU2Y6TPtaRumvVC8MKu         Y/Yg==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1693540286; cv=pass;        d=google.com; s=arc-20160816;        b=iyLlddrWnszm62EYjlnciOviNzwyufuNCGXnyUmFaLHx6iKbRRZwDrftVvtf30fNYm         iZMxli1lJ/4W0b25Twqjba6vUFXhg7Qnh6SdP/Y1RjleCGJBTHTMEoIaxeg3C9yCRpYF         N6yl1jXYUNC8LxN0oON9j2NvfIDpPLBLtw3SPTEGV5Uq8C5BKQVLHS1U9QqgBhq8vbR+         aAGQBfTGFTszcr3iYA+SZr17Y9YKuMxnYlXGhb8UmhJ7MoXU10wLSrCGGrC/d9fd6OqN         y4asCyFvMCbxobNtOAM7LT9v+RYKungCSPf73LoAPGATHz0O2k0b7CNrZy8DJezIhF5q         FKDw==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1693540281; cv=none;        d=google.com; s=arc-20160816;        b=Ex+ihMJ/6pibJRzrGQt1gitpWQh2GL8XS02BOoIelYe/kFD9gWlGCkqL1mCat8mBM8         NvVEA8NTqA7suhGOgkS9ZhuPwFKDCC+/yALJ3lU2cruQVA52gFFlAQXqqQMd3ZBKUA4Z         zkRuFs3eExpBaLwDJs07zIJtagosTNVKdPu2vhUkY34EVBGS4BkVP/nI5v9NYbqYzCNF         Ngzwt9ThcBtzWA8nEliaeBOdIZ8wD/IcWcdyVlnDEMRkl6kOoVEHYyHmFhXf0qZLTQh7         2EkWpAeKE4lI3trTehLJd0+QzC7NH6n0tSNLBLgKOUCJaykjdkhm7EYvhTpP+AHE+Evm         7JaQ==</li>
<li>Cc: <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google; t=1693540288; x=1694145088; darn=eclipse.pmel.noaa.gov;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence         :x-original-authentication-results:x-original-sender:cc:to:subject         :message-id:date:from:in-reply-to:references:mime-version:sender         :from:to:cc:subject:date:message-id:reply-to;        bh=UpvPnP+orHzHqyfWtluHBjcL+a5VS9aMsrqwyyzrHZA=;        b=HgW6NKMFcFzdLgBlE7VbQ+9/TqTBs4CAeXhMtWlSEMJvAR+VARXEGHaH/uGfotCYD1         jEKhrtP3+qLSI+7dHfRhQM/sTFVLflzv/KVO56CToJCjumZetNNy1w4BfkOWv1J3AJ8Q         ZfGbzsaxDq4CrKvmEsP1AgDpWXFhaVM3QZpj5g3j4qt15Ofr0CQagjXsPGBm96vfgVD1         aqo+YwdA1wfPqhYuXCndUNrrlrw3kNMxvq/NGN6o4oACm76b3g2OghOG6C4MJeMxvbC7         jaQBVqPovW30vlUM4pkO6OBDysD6WZzedvQ+C+Fozztfa61FEAzskwpl/wCakDYafJ7A         nqyw==</li>
<li>In-reply-to: &lt;<a href="msg01280.html">CAEwQpaKOu0W7F4m-d5PLnuwFhCeveKF0Mc1tbdSGLD9ErdzwCA@mail.gmail.com</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg01279.html">CADrnUWwbv0wyB3x-Mt+xq5jotsBJcfLz4HrAiMHa0c8Teu0mJA@mail.gmail.com</a>&gt; &lt;<a href="msg01280.html">CAEwQpaKOu0W7F4m-d5PLnuwFhCeveKF0Mc1tbdSGLD9ErdzwCA@mail.gmail.com</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<div dir="ltr"><div dir="ltr">Dear Satheesh and Ferret users,<br></div><div class="gmail_quote"><div dir="ltr" class="gmail_attr"><br></div><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex"><div dir="ltr"><div class="gmail_quote"><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex"><div dir="ltr"><div><div style="margin:0px;padding:0px 0px 20px;width:704px;font-family:&quot;Google Sans&quot;,Roboto,RobotoDraft,Helvetica,Arial,sans-serif"><div><div id="m_-5983644045542807880m_741472129057522475gmail-:1f2" style="direction:ltr;margin:8px 0px 0px;padding:0px"><div id="m_-5983644045542807880m_741472129057522475gmail-:1f1" style="font-variant-numeric:normal;font-variant-east-asian:normal;font-variant-alternates:normal;font-kerning:auto;font-feature-settings:normal;font-stretch:normal;line-height:1.5;font-family:Arial,Helvetica,sans-serif;overflow:hidden"><div dir="ltr"><div>I have &quot;soda_3.15.2_mn_ocean_reg_*.nc&quot; data obtained from&#xA0;<a rel="nofollow" href="https://urldefense.com/v3/__https://www2.atmos.umd.edu/*ocean/index_files/soda3.15.2_mn_download_b.htm__;fg!!PvDODwlR4mBZyAb0!STqnaFzfI35zGo-dhbwl4vmDgAUDrbBEMzPOfq0LCXWdC7pcF7TVhf5kngRfXHA4c9HqbeiKsVQm0CktoRY$" target="_blank">https://www2.atmos.umd.edu/~ocean/index_files/soda3.15.2_mn_download_b.htm</a></div><div><br></div><div>It has T,S,U,V, dia-surface velocity T-points, SSH, etc.&#xA0;</div><div>Please advise how I can estimate vertical velocity using the available information.</div></div></div></div></div></div></div></div></blockquote><div><br></div><div>A short answer is, vertically integrate the continuity equation w_z = - u_x - v_y, where the horizontal derivatives are calculated with Ferret&#39;s differentiation operators.</div><div><br></div><div>But, I have no idea how robust the result will be.&#xA0; Vertical velocity is a noisy quantity and an ad-hoc method like this may&#xA0;give you an unreliable answer.</div></div></div></blockquote><div><br></div><div><br></div><div>Since that message of mine, I have experienced exactly this problem.&#xA0; The bottom line is, <b><i>use the model&#39;s continuity equation!</i></b></div><div><br></div><div>Below is a plot of vertical velocity from a numerical linear shallow-water equation: w = -H * (&#x2202;u/&#x2202;x&#xA0;+ &#x2202;v/&#x2202;y).&#xA0; The black curve is the true w, calculated using the model&#39;s (discrete) continuity equation. The horizontal velocity field (u,v) is very smooth and well resolved by the grid, and as a result, the black curve is very smooth and well resolved.&#xA0; In contrast,&#xA0;&#xA0;the red curve is w calculated with Ferret&#39;s centered difference operator @DDC.&#xA0; I&#39;m pasting the Ferret code below the image.&#xA0; Although the central, large-amplitude wiggles are suspicious with only one gridpoint per peak, the outer lobe looks well resolved.&#xA0; So, if&#xA0;you look at the red curve without knowing the true vertical velocity, you might think this may be a real physical phenomenon, perhaps a gravity wave!</div><div><br></div><div>Am I not using the&#xA0;@DDC operator correctly?&#xA0; I don&#39;t think that&#39;s the case.&#xA0; If you heavily smooth the red curve, it approaches the true vertical velocity, as the blue curve shows.&#xA0; (This numerical code uses the B-grid and the Cartesian coordinates. So, u[x=@DDC]&#xA0;+ v[y=@DDC]&#xA0;is the right calculation.)</div><div><br></div><div>Vertical velocity is proportional to the difference between &#x2202;u/&#x2202;x and &#x2212;&#x2202;v/&#x2202;y.&#xA0; If you plot them, they look almost identical.&#xA0; That is, for a large-scale flow, the horizontal velocity field is almost divergenceless: &#x2202;u/&#x2202;x&#xA0;+ &#x2202;v/&#x2202;y &#x2248; 0.&#xA0; That means that w is the residual.&#xA0; It&#39;s a big number minus a big number.&#xA0; So, a little minor difference in horizontal derivative results in a significant difference in w.&#xA0; (This is not the classical truncation error of single-precision floats.&#xA0; As the blue curve shows, even this big-number-minus-big-number calculation is giving the &quot;correct&quot; numbers.)</div><div><br></div><div>Now, if you look at typical GCM results, you find that the horizontal field isn&#39;t always as well-resolved as in my ideal model.&#xA0; You often find the horizontal field marginally resolved.&#xA0; Our experience is that that&#39;s fine: even a marginally resolved field isn&#39;t very far from the reality.&#xA0; So, the vertical velocity field, if calculated correctly, should also be physically sound.&#xA0; The problem here is that you have to calculate it correctly.</div><div><br></div><div>Ryo</div><div><br></div><div><br></div><div><br></div><div><img src="pngjYxPKWOgmb.png" alt="tmp.png" width="536" height="536"><br></div><div><br></div><div>set data <a rel="nofollow" href="http://all.nc">all.nc</a><br>let div = (-1)*(u[x=@DDC] + v[y=@DDC])*4000 ! depth * div(u,v)<br>let div_s = div[i=@SHN:3,j=@SHN:3] ! a bit smoothed<br>let div_ss = div[i=@SHN:17,j=@SHN:17] ! heavily smoothed<br>plot/line/symbol/x=1030/L=1/hlimits=2400:3600 w, div, div_s, div_ss<br>frame/file=tmp.png<br></div><div><br></div><div><br></div><div><br></div><div>&#xA0;</div><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex"><div dir="ltr"><div class="gmail_quote"><div><br></div><div>To get a robust result,</div><div><br></div><div>1. First, examine the SODA manual to find out what grid configuration SODA uses.&#xA0; For example, let&#39;s assume that it uses the C grid.</div><div><br></div><div>2. Use the C-grid continuity equation to calculate vertical velocity, which should be identical to the vertical velocity within SODA.&#xA0; &#xA0;(SODA must have vertical velocity internally. Whether it saves/outputs it or not is a separate issue.)</div><div><br></div><div>I don&#39;t think you can do this within Ferret.</div><div><br></div><div>Ryo</div><div><br></div></div></div>
</blockquote></div></div>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="01282" href="msg01282.html">Re: [ferret_users] Vertical velocity in Soda3.15.2 monthly mean data</a></strong>
<ul><li><em>From:</em> Satheesh Shenoi</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="01279" href="msg01279.html">[ferret_users] Vertical velocity in Soda3.15.2 monthly mean data</a></strong>
<ul><li><em>From:</em> Satheesh Shenoi</li></ul></li>
<li><strong><a name="01280" href="msg01280.html">Re: [ferret_users] Vertical velocity in Soda3.15.2 monthly mean data</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg01280.html">Re: [ferret_users] Vertical velocity in Soda3.15.2 monthly mean data</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg01282.html">Re: [ferret_users] Vertical velocity in Soda3.15.2 monthly mean data</a></strong>
</li>

</UL>
<center>[<a href="msg01280.html">Thread Prev</a>][<a href="msg01282.html">Thread Next</a>][<A HREF="threads.html#01281">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
