<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] Problems with netcdf output and zaxreplace -->
<!--X-From-R13: Uvbetvb Uenssvab <t.tenssvabNgvz.vg> -->
<!--X-Date: Tue, 28 Apr 2020 03:08:15 &#45;0700 -->
<!--X-Message-Id: 171c041e7df.g.graffino@tim.it -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Derived: binCtLThdc7A4.bin -->
<!--X-Derived: binHcWNAhV5YQ.bin -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Problems with netcdf output and zaxreplace</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00616.html">Thread Prev</a>][<a href="msg00625.html">Thread Next</a>][<A HREF="threads.html#00624">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Problems with netcdf output and zaxreplace</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>&lt;<a href="mailto:william.s.kessler@DOMAIN.HIDDEN">william.s.kessler@xxxxxxxx</a>&gt;, &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Problems with netcdf output and zaxreplace</strong></li>
<li><strong>From</strong>: <strong>Giorgio Graffino &lt;<a href="mailto:g.graffino@DOMAIN.HIDDEN">g.graffino@xxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 28 Apr 2020 12:07:56 +0200 (CEST)</li>
<li>Arc-authentication-results: i=3; mx.google.com;       arc=pass (i=2);       spf=softfail (google.com: domain of transitioning <a href="mailto:g.graffino@DOMAIN.HIDDEN">g.graffino@xxxxxx</a> does not designate 209.85.160.200 as permitted sender) smtp.mailfrom=<a href="mailto:g.graffino@DOMAIN.HIDDEN">g.graffino@xxxxxx</a></li>
<li>Arc-authentication-results: i=2; mx.google.com;       arc=pass (i=1 spf=pass spfdomain=tim.it);       spf=softfail (google.com: domain of transitioning <a href="mailto:g.graffino@DOMAIN.HIDDEN">g.graffino@xxxxxx</a> does not designate 65.153.203.174 as permitted sender) smtp.mailfrom=<a href="mailto:g.graffino@DOMAIN.HIDDEN">g.graffino@xxxxxx</a></li>
<li>Arc-authentication-results: i=1; mx.google.com;       spf=pass (google.com: domain of <a href="mailto:g.graffino@DOMAIN.HIDDEN">g.graffino@xxxxxx</a> designates 82.57.200.117 as permitted sender) smtp.mailfrom=<a href="mailto:g.graffino@DOMAIN.HIDDEN">g.graffino@xxxxxx</a></li>
<li>Arc-message-signature: i=3; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=message-id:mime-version:cc:subject:to:reply-to:from:date;        bh=AKNCNHqSVd+PQxfqgqWMLR3TYQezWDf8FGYQ2G4uaoc=;        b=YLRKCMWn70Ns+m+MKF8wQpb7EKx2MtFAbmEx2TU/vH2UF2sMefRIazidkRLSqO7are         3bb3l9cTB9jX3AKtt2qoEk0ek+Q3NMjhW/be//Ffw+FQhNC1xO+34PdBuQKaDC++gAol         riWNgoSZpwq7cxPMI5Bu7q92ZGIp8Ha4kH4vvrwvDx09wrtJkydDu4t0bMmKYTsHoAke         KV5aPmKUyuGd99oSMNCF0cQxQWULRr/+vJO9q/Xyg1NcJNzqi4maEchJrz4MVMUCIIy/         7yUQjsX/ssoX2UxL8Z4BYQ0FMyZenYQHeCTvEgyVbWWQ/D2nmB4CqigX65Yb594k4cnk         VMwQ==</li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=mime-version:cc:subject:to:reply-to:from:date:message-id;        bh=AKNCNHqSVd+PQxfqgqWMLR3TYQezWDf8FGYQ2G4uaoc=;        b=Fi29X4mbZ/adEUtYXTvBmSgHzBUoWXZX5yYToJdfUMW1fpyGqRlAHkxPxof1PqAQVZ         n3nKlnMjQaTpym4Fq74cIp9LrIR/fg4mAl68t5+tUd1VhFdBYVubTZ8y5PUZvCfnWJcV         8K/jiruabUhvB/EBtkg+r2qnn/c6Ko3hQ0ju/oMSHTp4j5LqZSc6GYQHLP5DCmKRmOFT         18y9xJh2B2DJsEnyAjitcEJuo/54k8I7coWH/YSJph9HBHp4gQ0P1qvWjIeVVPaPGx6X         XfhpswErPuceFNtoJf7nGV7MF4Rx6GndPXUdR9mKaJeZBtc3NX9/NQfJAQ30C9aTa6EB         4SCg==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=mime-version:cc:subject:to:reply-to:from:date:message-id;        bh=AKNCNHqSVd+PQxfqgqWMLR3TYQezWDf8FGYQ2G4uaoc=;        b=xtV1IQiwE/9Eb7B/yKx+UVJPe8JNwvlTyLiFax4QZlxTx6WwdtyS6vX/DQMfG+Hi0N         GBLdt+iHEqArkE5ESuw7Bcvr8etKDtwqLb+zoaB0AAQMDa7lxbYk89aNOW5WBXzUY9tf         Fd3Jmi0u2QPwPHWP3CkbLGoY/WeSg7pW+TjKOrtFKhYN8MQJJqXUxfWK+huWaNgBLxsL         RTc4/qIPrB/AzC7J1BSnLvAoZb5uL3vCf+ewYwTdO5H7LAi0uJ7yfya7BHl5GEP/UXlq         3Fnhq563pHRfKp7edVUmxrntKagFwrHgKNde1tMj0MQexTro/PdsuVuPifCGrVVtub5f         lfIQ==</li>
<li>Arc-seal: i=3; a=rsa-sha256; t=1588068493; cv=pass;        d=google.com; s=arc-20160816;        b=GKuqtPvtshpKJkPJlW5/QSRZS1QZF4s+4PxuRmfNAQRq3r1nmYKKTcK7wDO5WVDfEc         QYn2kyldZQ6ouozGxpCbumQ2p1RF6cvXbzenPEiqPEvVm2rg+Xk5oT05OMkUB6gWPUd0         0VhNAoL3S1lrFERUUoJfNKYh5/qTZ7rNxb0JdjdCh8d7OnAOT1tPH+Zw32DK23y3CHAR         j7WqiR7mC90WexAq/vRBW4tE1EyU+Anhwmm6VgFJniEqGC0mpYjeKbivvx+Uy1A/mi6k         IqwUty8dH1Twg2co7yqIzSzhVy+2qLn/J5SuBPKJ0tFYvYJPQE0SSGgm5QVFINH8kvtX         8bgQ==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1588068480; cv=pass;        d=google.com; s=arc-20160816;        b=abFSohXbk4egiGKpjx1nIoCeUAibWTeb+xbo68YU9J9GYZSI9C+MYVIjv+U7VqXVnJ         z7zrPvKD5Rrj/2UVd8z4uY64ZknMr8mMLnDK1ZlTSXsHqHuJRy+faB9ya43fZdL4SoHD         txkizysvKT0SqYzciDHkn4JlnBEm/Y9wPHBTZ7i8yg51hV4mDru76BCiYmtEWXTBvZqb         iw7nMcaukD7irTgtUocb2+5jLQ67YweKqg9NQjrVeaNxf8Z4nCEKtZXVLW3V/DjJHQdh         fsorfiQXABu1GDZ1sbgqm7H0UDjAgMzWLzU54xiQj6jw8bb6isBgJvrD2D58paaQeVhl         hwAA==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1588068478; cv=none;        d=google.com; s=arc-20160816;        b=OBGe5/G1TsxaUjuLYR7I9MDGAo9NTW8FKsxBBEbKSxTNAsfhe3/rSqy0lpSj9HGN18         /MJQRLwuLlgfxbDcsYOzsYWqHThtfur20+u9oAjwi9owS+AytV1owL5lv33ZlczOp1Lb         N5gs5Le8KNMIqZ+6tRlpXD24TpNwLYzQl/78u5fGV1xPt+8IVRBihfxmUDj1pEr/Mdu+         JglA1fBdhCA2ecEuT0SIBCnLxJSThAVSdfCccm5Y5gFDlr5MXV5Cela6dN6FkOAtXzev         +bVH372vmm53LOiv5exk26Y0pciBdTiL+R+ufXf5Q4TBLV6QwRHWmdTd3cCzV9BnNQoh         6cWQ==</li>
<li>Cc: Ferret &lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google;        h=sender:date:from:reply-to:to:subject:cc:mime-version:message-id         :x-original-sender:x-original-authentication-results:precedence         :mailing-list:list-id:list-post:list-help:list-archive;        bh=AKNCNHqSVd+PQxfqgqWMLR3TYQezWDf8FGYQ2G4uaoc=;        b=m+Lb6f/uhJG2M4msOEZzi3mQuJGemqd2sRLYMnqCrlU5pN8rv4CqidbiICPrYpkoy0         prQZCWLPoOViWcQ8eV6d0wtgxoZYXG6Af18o0Cm1qKJdq9LJd1otEvp30vKZiQorV0IO         aTtxTZw3HrRn+jKNOX1SB2xH2UuNAv1Cadi0qqmeavEI7FTR/en3Rm7MWYsdfztVLeis         yR/QlmaZBgWFNIydBzdnVWTbUH2WD+aZaejGav2hfUPt7eou5Nlp8HTOCTbnWsqr88Kg         E/4P89RUnJtXlADiPuyaP/BXBoyvaoJEec6qWsHSql0X2OEQupLt2crXawssWDxkx5gJ         yaRg==</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>Reply-to: Giorgio Graffino &lt;<a href="mailto:g.graffino@DOMAIN.HIDDEN">g.graffino@xxxxxx</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
Thanks Billy and&nbsp;Ansley for your prompt reply, and sorry about my slow reply.<div><br></div><div>Turned out Billy was right about using REPLACE, it solved the first problem about unused axis. The second problem (about the regridding) was instead due to a NCO command I executed before the analysis, which was messing up with the time variable of the input files; basically, nothing related with Ferret. I'm attaching the modified Ferret script.</div><div><br></div><div>I have another problem though: I'd ike to run that script on many models, so I'm including it in a bash script (see attached). I wrote that bash script according to what I read here (https://ferret.pmel.noaa.gov/Ferret/faq/batch-mode-usage), and adapted the REPEAT command according to this (<a rel="nofollow" href="https://www.pmel.noaa.gov/maillists/tmap/ferret_users/fu_2002/msg00184.html">https://www.pmel.noaa.gov/maillists/tmap/ferret_users/fu_2002/msg00184.html</a>). However, everytime I execute the bash script I obtain this error:</div><div><br></div><div><span style="font-family:monospace"><span style="background-color: rgb(255, 255, 255);">!-&gt; REPEAT: I=1
</span><br> **ERROR: command syntax: II = ???
<br>define symbol ii
<br>Command file, command group, or REPEAT execution aborted</span></div><div><span style="font-family:monospace">
<br></span>The weird thing is that the relevant commands work if run inside Ferret, so the error should be somewhere esle in the bash script. Can you please give me some advice?</div><div><br></div><div>Thanks a lot.</div><div><br></div><div>Giorgio<br>
<blockquote>
  ----Messaggio originale----
 <br>Da: william.s.kessler@xxxxxxxx
 <br>Data: 16-apr-2020 17.52
 <br>A: "Giorgio Graffino"&lt;g.graffino@xxxxxx&gt;
 <br>Cc: "Ferret"&lt;ferret_users@xxxxxxxx&gt;
 <br>Ogg: Re: [ferret_users] Problems with netcdf output and zaxreplace
 <br>
 <br>Hi Giorgio -
 <br>
 <br>Without having looked at your files, here's a guess:
 <br>
 <br>If some or all of your files include an unused axis (perhaps a single-point axis, either y=LAT or t=a calendar), then that is being carried through the calculation and possibly conflicting with the regridding of ZAXREPLACE.
 <br>
 <br>One way to avoid this is to RESHAPE the original files to get rid of the unused axes.
 <br>
 <br>Suppose you have a time series that includes the position encoded in the grid, perhaps with single-point x,y axes (try SHOW GRID). 
 <br>
 <br>Then:
 <br>let omit_xy = RESHAPE(varname,t[gt=time_axis]+z[gz=depth_axis])
 <br>
 <br>The new variable omit_xy will have just the z,t axes you want.
 <br>
 <br>Since RESHAPE "wraps" the variable onto the new axes, first be sure that the omitted axes are in fact single points.
 <br>
 <br>This is just a guess!
 <br>
 <br>Billy
 <br>
 <br>&gt; On Apr 16, 2020, at 7:19 AM, Giorgio Graffino &lt;g.graffino@xxxxxx&gt; wrote:
 <br>&gt; 
 <br>&gt; Dear Ferreters,
 <br>&gt; hope you can help me with this. 
 <br>&gt; 
 <br>&gt; I'm using Ferret (v6.842) on a cluster machine. My purpose is to regrid the meridional mass transport (time depth lat lon) into density space (time density lat lon) to compute the transport between some density layers. I'm writing a script based on this (https://github.com/NOAA-PMEL/Ferret/blob/master/jnls/examples/depth_to_density_demo.jnl), which is using zaxreplace. I also found something about auxiliary regridding (https://ferret.pmel.noaa.gov/Ferret/faq/depth-axis-to-density-axis), but it requires a newer version of Ferret.
 <br>&gt; 
 <br>&gt; I'm using the script on several CMIP6 models, and saving the resulting time series as netcdf files for further analysis. I'm including as attachments the script and one of the output files, not the input files being too big. I'm facing two problems, and I can't find anything useful on the archives.
 <br>&gt; 
 <br>&gt; 1) First problem: for most models Ferret isn't producing any useful output files, because of error messages like this one:
 <br>&gt; 
 <br>&gt; TMAP ERR: error in line definition
 <br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file coords dont match variable coords on axis LAT153_153
 <br>&gt; 
 <br>&gt; As a result, I'm left with empty files. The point is that no LAT153_153 should exist, the variable being a time series. There is nothing special about 153, since other models produce different errors (LAT122_122, LAT124_124, LAT156_156, and so on). What is even more puzzling is that the computed variables are alright, because I can plot them with Ferret. I'm just not able to attach them as netcdf variables, and the resulting file is empty. Why is Ferret defining such axis for a time series?
 <br>&gt; 
 <br>&gt; 2) Second problem: for other models Ferret is complaining about the axis transformation. The error in this case is:
 <br>&gt; 
 <br>&gt; **ERROR: regridding: only @ASN regridding between calendar and
 <br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; non-calendar axes: DENS
 <br>&gt; 
 <br>&gt; No variable is produced after using zaxreplace. I'm puzzled here because I'm defining a vertical axis, and I don't understand why calendars should matter. Is it a problem with zaxreplace? In case, could you provide me the relevant code?
 <br>&gt; 
 <br>&gt; Thanks in advance.
 <br>&gt; 
 <br>&gt; Giorgio
 <br>&gt; 
 <br>&gt; 
 <br>&gt; &lt;STC_rho_historical_EC-Earth3_pacific.nc&gt;&lt;generate_STC_rho_CMIP6.jnl&gt;
 <br>
 <br>
 <br>
</blockquote>
<br></div><p><strong>Attachment:
<a href="binCtLThdc7A4.bin" ><tt>generate_STC_rho_CMIP6.sh</tt></a></strong><br>
<em>Description:</em> application/shellscript</p>
<p><strong>Attachment:
<a href="binHcWNAhV5YQ.bin" ><tt>generate_STC_rho_CMIP6.jnl</tt></a></strong><br>
<em>Description:</em> Binary data</p>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00625" href="msg00625.html">Re: [ferret_users] Problems with netcdf output and zaxreplace</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00616.html">Re: [ferret_users] Problems with netcdf output and zaxreplace</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00625.html">Re: [ferret_users] Problems with netcdf output and zaxreplace</a></strong>
</li>

</UL>
<center>[<a href="msg00616.html">Thread Prev</a>][<a href="msg00625.html">Thread Next</a>][<A HREF="threads.html#00624">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
