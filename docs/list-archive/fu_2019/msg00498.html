<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] Python externat function with several arguments with different shapes. -->
<!--X-From-R13: Yney Ezvgu &#45; @AOO Ossvyvngr <xney.fzvguNabnn.tbi> -->
<!--X-Date: Thu, 23 Jan 2020 13:54:46 &#45;0800 -->
<!--X-Message-Id: CAELLC7WrJH2UHSEm7vCVSRU6jCqmKVj70+o16+BhQt_RUL4B2A@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 748B98C5&#45;C36F&#45;4AC7&#45;94CD&#45;4A8EB83083C2@lsce.ipsl.fr -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Python externat function with several arguments with different shapes.</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00497.html">Thread Prev</a>][Thread Next][<A HREF="threads.html#00498">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Python externat function with several arguments with different shapes.</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Olivier Marti &lt;<a href="mailto:olivier.marti@DOMAIN.HIDDEN">olivier.marti@xxxxxxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Python externat function with several arguments with different shapes.</strong></li>
<li><strong>From</strong>: <strong>Karl Smith - NOAA Affiliate &lt;<a href="mailto:karl.smith@DOMAIN.HIDDEN">karl.smith@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Thu, 23 Jan 2020 13:54:31 -0800</li>
<li>Arc-authentication-results: i=2; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=HAzNW7vS;       spf=pass (google.com: domain of <a href="mailto:karl.smith@DOMAIN.HIDDEN">karl.smith@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:karl.smith@DOMAIN.HIDDEN">karl.smith@xxxxxxxx</a>;       dmarc=pass (p=REJECT sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-authentication-results: i=1; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=HAzNW7vS;       spf=pass (google.com: domain of <a href="mailto:karl.smith@DOMAIN.HIDDEN">karl.smith@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:karl.smith@DOMAIN.HIDDEN">karl.smith@xxxxxxxx</a>;       dmarc=pass (p=REJECT sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence:cc         :to:subject:message-id:date:from:in-reply-to:references:mime-version         :dkim-signature;        bh=XmKkNet44Avw5mZIWqXWLCkd7FlnJAImwsr8nC86CkY=;        b=gyaZnzDRt/e/3lkdT6s2+MHGkmJ3dWNTPko39q7AqXPGf0po1wQIdJHRCMTnX5Gtt1         FIyrVohaBcn+4IvGHYUDwZWFrE9Ku3L6uCt/2figjp9Am2PHsbXxUgPECP8lYcb4Nllq         1fNFKD431m/ROcI7tia1FV/RmPfhzPYhSj9/8B9XPrwc4T6fF7/HX7OO3xksHMQ4CIaZ         s92l+xe9a4HrWA/gQzUaa0nhpp9ahzRXaf+f3S+uEHOyZoASXYc8O87P6PQBESGzMMIB         S9Yyivx6FG2pNT+BycJeI6emG87uQU6soSH7hjTHHgT7UuMFv7V725oI7LqXYF0Z9Zms         r0kw==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=cc:to:subject:message-id:date:from:in-reply-to:references         :mime-version:dkim-signature;        bh=XmKkNet44Avw5mZIWqXWLCkd7FlnJAImwsr8nC86CkY=;        b=ahgiRg8FOJ1vnzDOlVOzr6AnpDQywuPphUXUvELJ5SrDyMKPSGmm7NCAOdHtPq+j0A         5RD1J+B0dS7whWt7lN80TUodRjjb5h1Emt6r+yFpq1t8Z+LewRaMpmQhnIwwYXOgCsc7         t2OD8BrW9eEU7u66igJWcdz9X9KbXZOHkXuDsQ4OXuHYsJTIkRR/jMO/mfrswWYLlOc9         Ixg/m5vA/OzVh8pwXVTwd+VmQjt22MjlALdqapwTh2GXMnD6wikmsruO4eqDK2mNE37U         gg9WejpeTj/BWZ2oVH3AtQoSdWKUu5/hCwpeJN80fQ/A7n6Kk+RwLpsbCdwM8dH/oSSh         MNuQ==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1579816484; cv=pass;        d=google.com; s=arc-20160816;        b=uPX2lsuT/ULODSELzHzllHwVqMWSMrGJV1gjvf0zKWYf6xI5TW0suwLGvnGUph1bqJ         uxO0gABUVjkr0dQBmNEuEc1C6At0OSw6XBlxnLYwzia9UAXCEohVy2d7hTggbUF0zFdJ         mswDW7xueyfK2jidWXIpMGoVBveWmqjwntOhHnEEtaTMRwHglrHtwOYSZRSi8IG9KBqV         z4GiT15iujH/TfXH2GCToY644jo4mHDvS/omz73E3aWhFN5skAC0hH8iXS/BJUgb9YgG         QfBInl2pPCvd5VFjbFl4cCbO51QVVEuEdBX96MBlXISqAUczL+5wCpy642UAhjWzC/TZ         jL+g==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1579816483; cv=none;        d=google.com; s=arc-20160816;        b=eRJspSAv6TUyM+bITb74RRe6+bgO4vR56AAIQu/0ze9hphoveW60aev1ozekSpVPRg         4nVWreBvJUezPRBrxs/FH54twMbQDjckPqsJ3Dq1/zV1rxXme4f40fX9y3LyWHdge98t         7rP12T+HrY2u9CyAWGTsWxcol1D45bnyu1C//vrrydkxFj6fJELUWldWweNswWQYnedd         WFcImBBsk8MEmkSqGUlzDn02i4y3a1/TXHEZ/aGtAyLesze/rjCzjSJABrzP2Iq7ROFM         DdU8t7R/G5KsBq577zKiLse5avzK4uXrQN+228xYceFFfWw7Wi9Yhgkv4x19BDd4xr+5         N6lg==</li>
<li>Cc: ferret &lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google;        h=mime-version:references:in-reply-to:from:date:message-id:subject:to         :cc:x-original-sender:x-original-authentication-results:precedence         :mailing-list:list-id:list-post:list-help:list-archive;        bh=XmKkNet44Avw5mZIWqXWLCkd7FlnJAImwsr8nC86CkY=;        b=lVY4Yy3kNTULrBpmyEqi1A3ePENXlYOGAKu+nYZT+Y0Vz/vXRgBow4eq5s6U5F6uNJ         WjcA9OunsuzcyJjiEtohRw6OBj+QmU0Pc0nnpBn4Q1IKmX9X8SZX7V7FnoWKlkubVAgP         ea9uRwuEgHrJ2NRhworujWA85GpI05XFTlTDMDMXKiCQQU3iGUPDJuo2xMzTVLmVZbp5         Qr5B6d0adtP8rqhY0LElmhmoRZK6HSO4XDVnzMWvMySgN39gf6jwsQzY/vawtCmlexa6         6sf/gXWXpKuV8bjNj7OuSt5shnefqHbyYgNMSfAVZ3Pb8cvBa4a/cYLOe7QgmzjeamSo         4Uew==</li>
<li>In-reply-to: &lt;<a href="msg00497.html">748B98C5-C36F-4AC7-94CD-4A8EB83083C2@lsce.ipsl.fr</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00497.html">748B98C5-C36F-4AC7-94CD-4A8EB83083C2@lsce.ipsl.fr</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<div dir="ltr">Hi Olivier,<div><br></div><div>You&#xA0;need to describe the grid of the result.</div><div><br></div><div>By default Ferret/PyFerret assumes the axes of the results of an external function (in Fortran or Python) is inherited from the axes of all the argument(s).&#xA0; This means all arguments must have compatible grids and the result will be this grid.&#xA0; If this is not the case (as in your PyEF), one needs to describe the what axes are inherited from which arguments, and/or if the result uses custom (or abstract) axes.&#xA0; There is an example under &quot;A grid-changing PyEF&quot; on the documentation page&#xA0;<a rel="nofollow" href="https://ferret.pmel.noaa.gov/Ferret/documentation/pyferret/pyefs">https://ferret.pmel.noaa.gov/Ferret/documentation/pyferret/pyefs</a>&#xA0;&#xA0;</div><div><br></div><div>In your case you could add the following to the initialization dictionary variable &quot;initdict&quot;:</div><div><br></div><div><font face="monospace">&#xA0; &#xA0; &#xA0; &#xA0; &quot;axes&quot;: (pyferret.AXIS_IMPLIED_BY_ARGS, pyferret.AXIS_IMPLIED_BY_ARGS,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;pyferret.AXIS_IMPLIED_BY_ARGS, pyferret.AXIS_IMPLIED_BY_ARGS,</font></div><div><font face="monospace">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;pyferret.AXIS_IMPLIED_BY_ARGS, pyferret.AXIS_IMPLIED_BY_ARGS),<br>&#xA0; &#xA0; &#xA0; &#xA0; &quot;influences&quot;: ((False,False,False,False,False,False),</font></div><div><font face="monospace">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;(True,True,True,True,True,True)),</font><br></div><div><br></div><div><font face="arial, sans-serif">(The &quot;axes&quot; tuple above is actually the default and only &quot;influences&quot; tuple of tuples is actually needed here, but I include it for the custom axis discussion below.)&#xA0;&#xA0;</font></div><div><font face="arial, sans-serif">This would tell Ferret to that the grid of the result is exactly the grid of the second argument and the grid of the first argument does not have any effect on the results.&#xA0; Thus, the grids of the two arguments do not need to be compatible.</font></div><div><font face="arial, sans-serif"><br></font></div><div><font face="arial, sans-serif">If an axis of the grid of the result is actually different from either grid (for example, values are at the midpoints of the &quot;bins&quot; of an axis and has one less value), then you would need to call the axis a custom axis &quot;pyferret.AXIS_CUSTOM&quot; (or possibly an abstract axis &quot;pyferret.AXIS_ABSTRACT&quot;), indicate that neither argument axis influences the result axis, then describe the custom axes by defining the &quot;ferret_custom_axes&quot; method (and/or describe the abstract axes by defining the &quot;ferret_result_limits&quot; method).&#xA0; The example referenced above has more information on doing this.</font></div><div><font face="arial, sans-serif"><br></font></div><div><font face="arial, sans-serif">Best,</font></div><div><font face="arial, sans-serif">Karl</font></div><div><font face="arial, sans-serif"><br></font></div></div><br><div class="gmail_quote"><div dir="ltr" class="gmail_attr">On Thu, Jan 23, 2020 at 2:54 AM Olivier Marti &lt;<a rel="nofollow" href="mailto:olivier.marti@xxxxxxxxxxxx">olivier.marti@xxxxxxxxxxxx</a>&gt; wrote:<br></div><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">Hello everybody,<br>
<br>
I&#39;m trying to build a python external function (PyEF). It should build an histogram from a list of classes. So the input arguments will be a Ferret array, and a list of classes. With a call like :<br>
<br>
histo(&#xA0; SIICECOV[L=1,K=1])&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;, XSEQUENCE({0., 0.1, 0.2, 1.0, 2.0}) )<br>
or<br>
histo( XSEQUENCE(SIICECOV[L=1,K=1]), XSEQUENCE({0., 0.1, 0.2, 1.0, 2.0}) )<br>
or<br>
histo( XSEQUENCE(SIICECOV[L=1,K=1]), YSEQUENCE({0., 0.1, 0.2, 1.0, 2.0}) )<br>
<br>
But it always fails. For instance :<br>
<br>
&gt; STAT histo( XSEQUENCE(SIICECOV[L=1,K=1]), XSEQUENCE({0., 0.1, 0.2, 1.0, 2.0}) )<br>
&#xA0;**ERROR: inconsistent sizes of data regions: X axis<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; XSEQUENCE({0., 0.1, 0.2, 1.0, 2.0}) has 5 points (I=1:5)<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; _expression_ has 9216 points (I=0001:9216)<br>
STAT histo( XSEQUENCE(SIICECOV[L=1,K=1]), XSEQUENCE({0., 0.1, 0.2, 1.0, 2.0}) )<br>
Command file, command group, or REPEAT execution aborted<br>
<br>
<br>
or <br>
<br>
&gt; STAT histo( XSEQUENCE(SIICECOV[L=1,K=1]), XYEQUENCE({0., 0.1, 0.2, 1.0, 2.0}) )<br>
&#xA0;**ERROR: command syntax: XYEQUENCE({0., 0.1, 0.2, 1.0, 2.0})<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; unknown function &quot;XYEQUENCE&quot;<br>
STAT histo( XSEQUENCE(SIICECOV[L=1,K=1]), XYEQUENCE({0., 0.1, 0.2, 1.0, 2.0}) )<br>
Command file, command group, or REPEAT execution aborted<br>
<br>
<br>
<br>
<br>
Before performing any computation, I cannot find a way to write an external function that accept two arguments with different shapes. Any hint or exemple ?<br>
<br>
Thanks,<br>
<br>
Olivier<br>
<br>
The python function :<br>
<br>
Example Ferret external function written in Python<br>
&#39;&#39;&#39;<br>
import numpy<br>
import pyferret<br>
<br>
def ferret_init(id):<br>
&#xA0; &#xA0; &#39;&#39;&#39;Creates and returns the initialization dictionary for this PyEF&#39;&#39;&#39;<br>
&#xA0; &#xA0; initdict = { &quot;numargs&quot; : 2, &quot;descript&quot;: &quot;Test function&quot;,<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&quot;argnames&quot;: (&quot;A&quot;, &quot;Histogram boundaries&quot;),<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;}<br>
&#xA0; &#xA0; return initdict<br>
<br>
def ferret_compute(id, result, result_bad_flag, inputs, input_bad_flags):<br>
&#xA0; &#xA0; &#39;&#39;&#39; Essai d&#39;histogramme<br>
&#xA0; &#xA0; ARG1 is the array. <br>
&#xA0; &#xA0; ARG2 is the list of class boundaries<br>
&#xA0; &#xA0; &#39;&#39;&#39;<br>
<br>
&#xA0; &#xA0; badmask = ( numpy.fabs(inputs[pyferret.ARG1] - input_bad_flags[pyferret.ARG1]) &lt; 1.0E-5 )<br>
&#xA0; &#xA0; goodmask = numpy.logical_not(badmask)<br>
<br>
&#xA0; &#xA0; result[badmask]&#xA0; = input_bad_flags[pyferret.ARG1]<br>
&#xA0; &#xA0; result[goodmask] = inputs[pyferret.ARG1][goodmask]<br>
<br>
&#x2014; <br>
Olivier Marti&#xA0; - LSCE B&#xE2;t 714 p. 1049<br>
Tel : +33 1 69 08 77 27<br>
mailto:<a rel="nofollow" href="mailto:olivier.marti@xxxxxxxxxxxx" target="_blank">olivier.marti@xxxxxxxxxxxx</a><br>
<br>
<br>
</blockquote></div><br clear="all"><div><br></div>-- <br><div dir="ltr" class="gmail_signature"><div dir="ltr">Karl M. Smith, Ph.D.<br>JISAO Univ. Wash. and PMEL NOAA<br>&quot;The contents of this message are mine personally and do<br>not necessarily reflect any position of the Government<br>or the National Oceanic and Atmospheric Administration.&quot;<br></div></div>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00497" href="msg00497.html">[ferret_users] Python externat function with several arguments with different shapes.</a></strong>
<ul><li><em>From:</em> Olivier Marti</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00497.html">[ferret_users] Python externat function with several arguments with different shapes.</a></strong>
</li>

</UL>
<center>[<a href="msg00497.html">Thread Prev</a>][Thread Next][<A HREF="threads.html#00498">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
