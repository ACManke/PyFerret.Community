<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] Problems with netcdf output and zaxreplace -->
<!--X-From-R13: Ivyyvnz Yrffyre <jvyyvnz.f.xrffyreNabnn.tbi> -->
<!--X-Date: Thu, 16 Apr 2020 08:52:40 &#45;0700 -->
<!--X-Message-Id: BF94A3E9&#45;F961&#45;4DA2&#45;B3B7&#45;5C18360AF3ED@noaa.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 171835bf252.g.graffino@tim.it -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Problems with netcdf output and zaxreplace</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00614.html">Thread Prev</a>][<a href="msg00616.html">Thread Next</a>][<A HREF="threads.html#00615">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Problems with netcdf output and zaxreplace</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Giorgio Graffino &lt;<a href="mailto:g.graffino@DOMAIN.HIDDEN">g.graffino@xxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Problems with netcdf output and zaxreplace</strong></li>
<li><strong>From</strong>: <strong>William Kessler &lt;<a href="mailto:william.s.kessler@DOMAIN.HIDDEN">william.s.kessler@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Thu, 16 Apr 2020 08:52:36 -0700</li>
<li>Arc-authentication-results: i=2; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=gV6Yv0Ig;       spf=pass (google.com: domain of <a href="mailto:william.s.kessler@DOMAIN.HIDDEN">william.s.kessler@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:william.s.kessler@DOMAIN.HIDDEN">william.s.kessler@xxxxxxxx</a>;       dmarc=pass (p=REJECT sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-authentication-results: i=1; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=gV6Yv0Ig;       spf=pass (google.com: domain of <a href="mailto:william.s.kessler@DOMAIN.HIDDEN">william.s.kessler@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:william.s.kessler@DOMAIN.HIDDEN">william.s.kessler@xxxxxxxx</a>;       dmarc=pass (p=REJECT sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence:to         :references:message-id:content-transfer-encoding:cc:date:in-reply-to         :from:subject:mime-version:dkim-signature;        bh=LJqcCH2J2Ska8Iw3RdwsYQEO+7mLnowWaQpTfbxQjII=;        b=PCv+OitFDhiQoxF1T8DyMjyK0Cn9liyWsONiDRA3PiayQOvPCnGaZ//YGTYj9IH+j3         yRNtMEAa8XZaeKkZq87/EDqaeiC4AuikzjWdUVRBoWZVJnOMdfbDXAPG0HuRbdQb2sBW         Z04dNdwCsAdfGb4nq81IXslKc79lI8PPpXtRtsDPn2p66HuNbvr0Ly8kQbgFQcHTvHfZ         h38PlWUfA2CHceHHIfLxIrT+7L0RncK+U/GyZIaLvV/lClQ2xX4pQSayceNrarW9D6N+         b+BFgoz47TMIw2PTcTvylOeEii/4AWX/s1CorHrnUffxidr1HfcadDl7oZrWBBcDJ5iV         /HEg==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=to:references:message-id:content-transfer-encoding:cc:date         :in-reply-to:from:subject:mime-version:dkim-signature;        bh=LJqcCH2J2Ska8Iw3RdwsYQEO+7mLnowWaQpTfbxQjII=;        b=Kt+3Gn4ke6FvN0UZzO7Q2W+I+VU52MmvOK2RGMglrklZzoubk9jIh7XTm+M4zx5zDl         L41dyyk1ll1V5qOQz6TVzerRS/MuHlpUWE1xtU/RS/IOIJ/N/7NsANu/eFpzyDsIbWtn         H6zyqYAuBr3oxV5PE8XQiISjhjKiYJk1NhwmZvYA4O6NPF+Q9fbGr12wQWtu0Y/ZRqxX         46Dp+/94g+v/CWDzb0OQxeAId9uyN1IOdbia1QTt7jZbNgn/sP/LvAKfm2XGbrIPwS4y         6quj/Su3Y97h4svEb2ngVJ+B5o3MK8YTvMKIaYTpLGbNzB7CSDwa7JXp/o6vM2Xkjg8y         9CnA==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1587052359; cv=pass;        d=google.com; s=arc-20160816;        b=VfDrRvwBAtLXtR3jBNY3K2GzbxJwwhgkdz8qsDdze6WKLJZLwHWaQKJBxZjvKgk4bu         CVHVhMc7zaJ6ClKMoU3QL3l3QVWaVzeNgAbpZi1+1K5QehfWN9Ym9047pGzZvqPM58y9         uKF+Tz7co5hPKsHkF+UvmOrkOGF0H9NSK83oiyRnrwwRKeF8NKpk/txhIg+xIeyMK4yZ         uf7VoAU5MxWTzLREQhGLjM4bneIl5h7Tc4M60kq492CayMZXNxPQAcj2qmrbblGoK/NM         hVi3e29Hc/KLzoVHPitlLwI2odS7OtbQglHvzI3FWIZkHu5iakE77s8tQ7o4gx4plvDK         RzNw==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1587052358; cv=none;        d=google.com; s=arc-20160816;        b=k2uTIbxWXxyEhuQcDwxrQHcYq2QNwuawXqFP+QIMqDZ8DskbWNL87QTlcvCFs40ef6         WmuKo0V4qTEkBAFcSy4auaT8zoSQ2wZHafzLR67zQyKhp8GiFVRoG8sqomsHkTZDZRYj         2dJv+sqmJ4syqfK00xDoDgA1rT1z/O7UjblpJqxaiAC3fA4lJD8l+BW/otCBBmdl6jEh         m7zHs3UvgX3b2BqjOlKKavmIUQfJS0fzK3T36CVTrNuiVHi8WxgbI167jOLbzuUdn+mh         kCY6tk6d2EGqbikjNqDUo6LTMGilh+MmSM27CLu5ESB4q23L/NYf7nfyS7Q3RoxoM1tN         +2TQ==</li>
<li>Cc: Ferret &lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google;        h=mime-version:subject:from:in-reply-to:date:cc         :content-transfer-encoding:message-id:references:to         :x-original-sender:x-original-authentication-results:precedence         :mailing-list:list-id:list-post:list-help:list-archive;        bh=LJqcCH2J2Ska8Iw3RdwsYQEO+7mLnowWaQpTfbxQjII=;        b=ju/YwadK327XriCTXgsIepzhKnfpgnHAl3lB0sFTnxXrEhHL5+AaqnsPDS3G6wA57E         yt10YwafzU0bqO4QYRo3QTOcwe4hhmmRU8HEKGSwlEgC0Dry9zJOZob+wRwz9br/ZYEa         x63lJZHoAzfHEoHRnKBDLzCZtJazcNWYDLLpYAlQ32LSP+8rb5oyM99wJsmcY1edhuux         /HnDwxwTXflnCCEhgNXbKjt72DxxVaYjnBkcH/9TvGoULuSZrgyccnZi2snI1psjEmh/         3N2BofG1HZIddJ5eoilbnEu0cRAzciq6LAel6118VXBdZ0MNjNLRgIJ3NtTOS4R0ZaDC         IT7w==</li>
<li>In-reply-to: &lt;<a href="msg00614.html">171835bf252.g.graffino@tim.it</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00614.html">171835bf252.g.graffino@tim.it</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Hi Giorgio -

Without having looked at your files, here's a guess:

If some or all of your files include an unused axis (perhaps a single-point axis, either y=LAT or t=a calendar), then that is being carried through the calculation and possibly conflicting with the regridding of ZAXREPLACE.

One way to avoid this is to RESHAPE the original files to get rid of the unused axes.

Suppose you have a time series that includes the position encoded in the grid, perhaps with single-point x,y axes (try SHOW GRID). 

Then:
let omit_xy = RESHAPE(varname,t[gt=time_axis]+z[gz=depth_axis])

The new variable omit_xy will have just the z,t axes you want.

Since RESHAPE &quot;wraps&quot; the variable onto the new axes, first be sure that the omitted axes are in fact single points.

This is just a guess!

Billy

&gt; On Apr 16, 2020, at 7:19 AM, Giorgio Graffino &lt;g.graffino@xxxxxx&gt; wrote:
&gt; 
&gt; Dear Ferreters,
&gt; hope you can help me with this. 
&gt; 
&gt; I'm using Ferret (v6.842) on a cluster machine. My purpose is to regrid the meridional mass transport (time depth lat lon) into density space (time density lat lon) to compute the transport between some density layers. I'm writing a script based on this (<a  rel="nofollow" href="https://github.com/NOAA-PMEL/Ferret/blob/master/jnls/examples/depth_to_density_demo.jnl">https://github.com/NOAA-PMEL/Ferret/blob/master/jnls/examples/depth_to_density_demo.jnl</a>), which is using zaxreplace. I also found something about auxiliary regridding (<a  rel="nofollow" href="https://ferret.pmel.noaa.gov/Ferret/faq/depth-axis-to-density-axis">https://ferret.pmel.noaa.gov/Ferret/faq/depth-axis-to-density-axis</a>), but it requires a newer version of Ferret.
&gt; 
&gt; I'm using the script on several CMIP6 models, and saving the resulting time series as netcdf files for further analysis. I'm including as attachments the script and one of the output files, not the input files being too big. I'm facing two problems, and I can't find anything useful on the archives.
&gt; 
&gt; 1) First problem: for most models Ferret isn't producing any useful output files, because of error messages like this one:
&gt; 
&gt; TMAP ERR: error in line definition
&gt;              file coords dont match variable coords on axis LAT153_153
&gt; 
&gt; As a result, I'm left with empty files. The point is that no LAT153_153 should exist, the variable being a time series. There is nothing special about 153, since other models produce different errors (LAT122_122, LAT124_124, LAT156_156, and so on). What is even more puzzling is that the computed variables are alright, because I can plot them with Ferret. I'm just not able to attach them as netcdf variables, and the resulting file is empty. Why is Ferret defining such axis for a time series?
&gt; 
&gt; 2) Second problem: for other models Ferret is complaining about the axis transformation. The error in this case is:
&gt; 
&gt; **ERROR: regridding: only @ASN regridding between calendar and
&gt;           non-calendar axes: DENS
&gt; 
&gt; No variable is produced after using zaxreplace. I'm puzzled here because I'm defining a vertical axis, and I don't understand why calendars should matter. Is it a problem with zaxreplace? In case, could you provide me the relevant code?
&gt; 
&gt; Thanks in advance.
&gt; 
&gt; Giorgio
&gt; 
&gt; 
&gt; &lt;STC_rho_historical_EC-Earth3_pacific.nc&gt;&lt;generate_STC_rho_CMIP6.jnl&gt;


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00614" href="msg00614.html">[ferret_users] Problems with netcdf output and zaxreplace</a></strong>
<ul><li><em>From:</em> Giorgio Graffino</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00614.html">[ferret_users] Problems with netcdf output and zaxreplace</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00616.html">Re: [ferret_users] Problems with netcdf output and zaxreplace</a></strong>
</li>

</UL>
<center>[<a href="msg00614.html">Thread Prev</a>][<a href="msg00616.html">Thread Next</a>][<A HREF="threads.html#00615">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
