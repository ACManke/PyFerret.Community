<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] minor issue: "Ignoring erroneous point_spacing=even attribute." -->
<!--X-From-R13: "Oafyrl Q. [naxr" <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Wed, 8 Jul 2020 09:33:45 &#45;0700 -->
<!--X-Message-Id: ce4dbbfa&#45;ca8b&#45;ca21&#45;365c&#45;90f6d2f8c777@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CAEwQpa+PF1pgqvzDQkbWFe_hMtLmsH5NjzgqWWUc9Pab_UhhWA@mail.gmail.com -->
<!--X-Reference: be2512de&#45;bec3&#45;18f2&#45;b732&#45;1a45ee8f88be@noaa.gov -->
<!--X-Reference: CAEwQpa+d6HKw8tjWxaXkjeOmKO1mAGrWEf9kgAfXf8t0jaa7KQ@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] minor issue: &quot;Ignoring erroneous point_spacing=even attribute.&quot;</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00763.html">Thread Prev</a>][<a href="msg00765.html">Thread Next</a>][<A HREF="threads.html#00764">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] minor issue: &quot;Ignoring erroneous point_spacing=even attribute.&quot;</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Ryo Furue &lt;<a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] minor issue: &quot;Ignoring erroneous point_spacing=even attribute.&quot;</strong></li>
<li><strong>From</strong>: <strong>&quot;Ansley C. Manke&quot; &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Wed, 8 Jul 2020 09:33:39 -0700</li>
<li>Arc-authentication-results: i=2; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=njUV9fc7;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>;       dmarc=pass (p=REJECT sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-authentication-results: i=1; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=njUV9fc7;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>;       dmarc=pass (p=REJECT sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence         :content-language:in-reply-to:mime-version:user-agent:date         :message-id:from:references:cc:to:subject:dkim-signature;        bh=q8mtmU0Leq57Eu1uPYzSsZDZDoN2yt3DTP91oPYNFDs=;        b=RLDDqZxJqBU1XdfI9KtONBf0yZAJRvynEbODgYTZevdaODs7yOv6g/H5oRp/eALH+9         VHTqLdZRSbfGmrYGDcXQSifGKRk9Py7qJzCinwH9dHVL+XfdRQz/k7qwN0uHo7usjqEp         63rUaG8lVTh8YYRfDljKjPphLrBGFUxJJ0NsjNQeJovQxAigHYE2HscFVDYxtSbilcO4         qxwiXkb+kels8lm/9o7+DKQIFmvZ6O2h5y42jXEWfjzUCdgv6fRUd0WGlgYioF1AhXNc         dB9poP1JfxZwlZPHxphuTYJf0UYOU9DyHC6oN/q+a2dQnTrzVcV3y3FEyJUqZXyZjYms         YKbw==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=content-language:in-reply-to:mime-version:user-agent:date         :message-id:from:references:cc:to:subject:dkim-signature;        bh=q8mtmU0Leq57Eu1uPYzSsZDZDoN2yt3DTP91oPYNFDs=;        b=OgfRJjtWLsd8q/2SS+YMKNQ6Q66/2V2nbHbKfKemCI9eMQaQO3ES0TtHHgegdjq5hD         OdV/TOBq09CKcBRPjNEbgrdWR4/fHRgQUoqNBQLrc49eJ24c9s3DYTGrxc7J/DF/qVwE         fxBiwzD3IQUNJG+IfAht8u6Sj8L/X1RgrHasiSGKjEXpOdKx4OTcnu2ZV/yHHuN4M+RT         TzUiG+3QzTXBiGAsizeT8eVr8berujPpBFxwwzjl9C4GEzZGRvXGzyZRdD1Wzvqua39W         fqxpjzZzrDWTrYFO7Dwd0x7vya+ifWpRxiLm+UAHaIlFncD5hNHAYZVM4Gpubdp1yHsS         Iz3A==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1594226024; cv=pass;        d=google.com; s=arc-20160816;        b=bx+b5trQE72vlrBtVaccb8XmeCv9VWOmTqb0p81EnankICeXqHZ+DYje5daghzrIgP         pVAoIaECLvpkGsDPF24yKIvpnTDxyw3A7ET+pyCQyFm7xT+W1I9jMxzpwGgVY270z6P9         00Y2wWSO306oLvE9NAAHxrvNnsYkqaLSooitlSvx+hoOKmxrug21KwY+ztz7B7EYANlm         PDF1+g5p0sdt9DO/3GPYF6gkWh9DdjpdTtsbjs+qRfjiDVjrHXtC9STmADOZpQz/02i6         X0Z3BUpIAkUIxKIdds0Myt1I5mgaw4ZSftcdIUvS8YddvxDw70fkRRX+DCuxalCsDj2c         uDJA==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1594226023; cv=none;        d=google.com; s=arc-20160816;        b=tv7U74y8LrkkT6nzuD0FoJ4afs0hOvqf26P9v1IUH4hGPQntxdO8OPA1QaQauSAxLq         rP+Kg1kF4aHQhLXhaQgoABIQLcOWdPzY7ukJrslDa4MyQaLDQmgC+5ckAe6F442miH1Z         AmB5wDEXfwP0YhOZE2LcYHzfZPVkjLmL3dCqlcIPLNFDHuQQHYu9/4Mqe6ZjV0l39d51         1LnK+uw7oDpPqzyPuTZnuXOmLrBMRflFz6HAGIOxnWErUukIZ9GlH4Mi/EZD6Ok3grEY         AKV2S8DaOQ8JR/j3Yp96K+5CFei4FhFGCALZVQarMmEw2CwiMPF8gFVR374e3rV+uDqa         g80Q==</li>
<li>Cc: ferret users &lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google;        h=subject:to:cc:references:from:message-id:date:user-agent         :mime-version:in-reply-to:content-language:x-original-sender         :x-original-authentication-results:precedence:mailing-list:list-id         :list-post:list-help:list-archive;        bh=q8mtmU0Leq57Eu1uPYzSsZDZDoN2yt3DTP91oPYNFDs=;        b=cb1iSV5kOOXZfOGbF3fbigDnWsLZibS5xymNI9xQw097ahxXoI710iVtG4EbzwOa8l         rUqX5NR9s4TZYHGHh4a97fQxPLtJai4Z8FAkmmFHw1h9gqC24RgNQoVTE9gWQBAg7fHE         fQboFRPT0n44KH6eJe0l+RtQgXvXIZ4qZsfAbaMA7bjeY7q4/yIvlKPq/fHrj8bbkuyT         R/MZSAco86VX/BVrHPCKgEVeqFe15DXAPcVaTmquJz3hC75XazHYk2BTEI+cj9w5KL+r         VX/Y5CXtfB92inaVza2afzNRVkaeohkB3Vi+cWvgcAwTiI05T65EuUy3Caa/9IryYTe/         kwgQ==</li>
<li>In-reply-to: &lt;<a href="msg00763.html">CAEwQpa+d6HKw8tjWxaXkjeOmKO1mAGrWEf9kgAfXf8t0jaa7KQ@mail.gmail.com</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00761.html">CAEwQpa+PF1pgqvzDQkbWFe_hMtLmsH5NjzgqWWUc9Pab_UhhWA@mail.gmail.com</a>&gt; &lt;<a href="msg00762.html">be2512de-bec3-18f2-b732-1a45ee8f88be@noaa.gov</a>&gt; &lt;<a href="msg00763.html">CAEwQpa+d6HKw8tjWxaXkjeOmKO1mAGrWEf9kgAfXf8t0jaa7KQ@mail.gmail.com</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:68.0) Gecko/20100101 Thunderbird/68.10.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->

  
  
    <font face="Arial">Hi,<br>
      No, it turns out that Ferret has for a long time saved a
      floating-point axis as single precision, going back to v7.0
      anyway. When I wrote yesterday I'd forgotten that. What changed
      more recently was the test for irregular axes.&#xA0; Previous to v7.4
      if the axis had a point_spacing = "even" we took it at its word
      and stored the axis as regularly spaced, that is, save the first
      coordinate location, the number of points, and the first
      delta-coordinates and form the axis from that information.<br>
      <br>
      In v7.4, we "resolved" this ticket
      <a rel="nofollow" class="moz-txt-link-freetext" href="https://github.com/NOAA-PMEL/Ferret/issues/334">https://github.com/NOAA-PMEL/Ferret/issues/334</a><br>
      <br>
      by adding a sanity check, and if it fails, keep the coordinates in
      the file.&#xA0; I find that that test isn't right, and is marking axes
      like the one in your example as irregular.&#xA0; So,&#xA0; I'll fix that
      test to make it less stringent, and also, if the axis is still
      found to be irregular save it with p</font><font face="Arial"><font
        face="Arial">oint_spacing = "uneven".<br>
        <br>
        -Ansley<br>
        <br>
      </font></font>
    <div class="moz-cite-prefix">On 7/8/2020 5:54 AM, Ryo Furue wrote:<br>
    </div>
    <blockquote type="cite"
cite="">
      
      <div dir="ltr">
        <div dir="ltr">Hi Ansley,</div>
        <div dir="ltr"><br>
        </div>
        <div>Thank you for the detailed, helpful explanation!</div>
        <br>
        <div class="gmail_quote">
          <div dir="ltr" class="gmail_attr">On Wed, Jul 8, 2020 at 5:54
            AM Ansley C. Manke &lt;<a rel="nofollow"
              href="mailto:ansley.b.manke@xxxxxxxx"
              moz-do-not-send="true">ansley.b.manke@xxxxxxxx</a>&gt;
            wrote:<br>
          </div>
          <blockquote class="gmail_quote" style="margin:0px 0px 0px
            0.8ex;border-left:1px solid
            rgb(204,204,204);padding-left:1ex">
            <div>When a coordinates are read in on initializing a
              dataset, they're checked for regular spacing using the
              data type of the coordinates in the file, so a
              floating-point axis is checked using single-precision
              testing.</div>
          </blockquote>
          <div>&#xA0;[ . . . ]</div>
          <blockquote class="gmail_quote" style="margin:0px 0px 0px
            0.8ex;border-left:1px solid
            rgb(204,204,204);padding-left:1ex">
            <div>&#xA0;But, on writing a netCDF dataset, Ferret/PyFerret
              always writes coordinates in double precision.&#xA0;</div>
          </blockquote>
          <div><br>
          </div>
          <div>Has that changed recently?&#xA0; Initially I suspected that
            that was the reason, but the new netCDF file from the SAVE
            command has single-precision axes:</div>
          <div><br>
          </div>
          <font face="monospace">float LON(LON) ;<br>
            LON:units = "degrees_east" ;<br>
            LON:modulo = 360.f ;<br>
            LON:point_spacing = "even" ;<br>
            LON:axis = "X" ;<br>
          </font>
          <div><font face="monospace">LON:standard_name = "longitude" ;&#xA0;<br>
            </font></div>
          <div><font face="monospace">. . .</font></div>
          <div><font face="monospace"><br>
            </font></div>
          <div><font face="arial, sans-serif">(from</font><font
              face="monospace"> ncdump -h <a rel="nofollow" href="http://tmp.nc"
                moz-do-not-send="true">tmp.nc</a> </font><font
              face="arial, sans-serif">)&#xA0; This causes an "irregular
              axis" warning for LON in this case on PyFerret v7.6 on
              macOS .&#xA0; In the original netCDF file</font></div>
          <div><font face="arial, sans-serif"><br>
            </font></div>
          <div><font face="monospace">float lon(lon) ;<br>
              lon:units = "degree east" ;<br>
            </font></div>
          <div><br>
          </div>
          <div>(It was produced by a colleague and I don't have much
            control over it).&#xA0; I've found that some of the values of
            longitude (<font face="monospace">ncdump -p9 -c . . .</font>
            )&#xA0; are different between the two datasets.</div>
          <div><br>
          </div>
          <div>As you say below, you are in the middle of moving toward
            preserving original data and names, and I guess this
            particular transition to recovering axis data types has been
            implemented.</div>
          <div><br>
          </div>
          <div>But, I still don't understand exactly what's causing the
            problem,&#xA0; because all the bits of a single-precision number
            are preserved by the single -&gt; double conversion and the
            re-conversion double -&gt; single should always recover the
            original single precision value, bit-by-bit.&#xA0; Perhaps
            something beyond straightforward conversions is happening?</div>
          <div><br>
          </div>
          <div>Anyway, this is a harmelss issue.&#xA0; I just wanted to
            document it.</div>
          <div><br>
          </div>
          <div>Ryo</div>
          <div><font face="monospace"><br>
            </font></div>
          <blockquote class="gmail_quote" style="margin:0px 0px 0px
            0.8ex;border-left:1px solid
            rgb(204,204,204);padding-left:1ex">
            <div> <br>
              It looks as&#xA0; though we changed the testing for
              regular-spacing somewhere at about version 7.4, and I'll
              have a look at that.&#xA0; Also, we've been working along in
              general on changes so that any netCDF files that Ferret
              writes as subsets or otherwise based on netcdf files,
              match what is in the input files.&#xA0; Things like upcasing
              variable names and ignoring attributes should at least be
              controllable. In recent versions we write data using the
              same data type as the input file, and it should be easy to
              do the same for axes, so for this example the y-axis would
              be written as single precision coordinate variable.&#xA0; So
              we'll have a look at that too.<br>
              <br>
              Ansley<br>
              <br>
              <div>On 7/3/2020 6:51 AM, Ryo Furue wrote:<br>
              </div>
              <blockquote type="cite">
                <div dir="ltr">Ferret Team,
                  <div><br>
                  </div>
                  <div>I searched our mailing archive but didn't find it
                    there.</div>
                  <div><br>
                  </div>
                  <div>My original netCDF file has an&#xA0;x axis like</div>
                  <div><br>
                  </div>
                  <div>&#xA0; &#xA0;<font face="monospace">float lat = 9.95,
                      10.05, 10.15, . . .</font></div>
                  <div><br>
                  </div>
                  <div>without the "point_spacing=even" attribute.</div>
                  <div><br>
                  </div>
                  <div>I open the file in PyFerret and save just one
                    timestep (L) into a new file:</div>
                  <div><br>
                  </div>
                  <div>&#xA0; &#xA0; <font face="monospace">save/file=<a rel="nofollow"
                        href="http://tmp.nc/l=10" target="_blank"
                        moz-do-not-send="true">tmp.nc/l=10</a> var</font></div>
                  <div><br>
                  </div>
                  <div>I then open this new file and PyFerret says,</div>
                  <div><br>
                  </div>
                  <div><font face="monospace">&#xA0; &#xA0; *** NOTE: Axis "LAT"
                      is irregular. Ignoring erroneous
                      point_spacing=even attribute.</font><br>
                  </div>
                  <div><br>
                  </div>
                  <div>Indeed the new file has gotten the
                    "point_spacing=even" attribute.</div>
                  <div><br>
                  </div>
                  <div>I come across this problem from time to time.&#xA0;
                    (Today I reproduced this on PyFerret v7.5 on Linux.)</div>
                  <div><br>
                  </div>
                  <div>The axis is a single-precision real and
                    the&#xA0;gridpoints&#xA0;may not be&#xA0; precisely&#xA0;represented.&#xA0;
                    So, I'm not surprised&#xA0;that this axis isn't regarded
                    as "even".&#xA0; That is, PyFerret is doing the right
                    thing when it reads the new netCDF file.&#xA0; So, it's
                    probably a mistake that it added the "even"
                    attribute when it saved the data.</div>
                  <div><br>
                  </div>
                  <div>Strangely, the longitude axis -0.05, 0.05, 0.15,
                    . . . , which originally didn't have a point_spacing
                    attribute either, got a point_spacing = "<font
                      color="#ff0000">un</font>even" attribute in the
                    new file!</div>
                  <div><br>
                  </div>
                  <div>Cheers,</div>
                  <div>Ryo</div>
                  <div><br>
                  </div>
                </div>
              </blockquote>
              <br>
              <pre cols="72">-- 
Ansley Manke
Science Data Integration Group
NOAA Pacific Marine Environmental Laboratory
7600 Sand Point Way NE
Seattle WA 98115

I am currently teleworking and am available Tue-Wed-Thu.</pre>
            </div>
          </blockquote>
        </div>
      </div>
    </blockquote>
    <br>
    <pre class="moz-signature" cols="72">-- 
Ansley Manke
Science Data Integration Group
NOAA Pacific Marine Environmental Laboratory
7600 Sand Point Way NE
Seattle WA 98115

I am currently teleworking and am available Tue-Wed-Thu.</pre>
  


<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00761" href="msg00761.html">[ferret_users] minor issue: &quot;Ignoring erroneous point_spacing=even attribute.&quot;</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
<li><strong><a name="00762" href="msg00762.html">Re: [ferret_users] minor issue: &quot;Ignoring erroneous point_spacing=even attribute.&quot;</a></strong>
<ul><li><em>From:</em> Ansley C. Manke</li></ul></li>
<li><strong><a name="00763" href="msg00763.html">Re: [ferret_users] minor issue: &quot;Ignoring erroneous point_spacing=even attribute.&quot;</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00763.html">Re: [ferret_users] minor issue: &quot;Ignoring erroneous point_spacing=even attribute.&quot;</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00765.html">[ferret_users] PyFerret build failing on Mac 10.15 (Catalina) and MacPorts | Plus some MacPort/PyFerret hints</a></strong>
</li>

</UL>
<center>[<a href="msg00763.html">Thread Prev</a>][<a href="msg00765.html">Thread Next</a>][<A HREF="threads.html#00764">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
