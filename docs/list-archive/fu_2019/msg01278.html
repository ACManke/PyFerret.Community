<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [EXTERNAL] Re: [ferret_users] Produce a time serie by averaging a large variable -->
<!--X-From-R13: Dlb Thehr <shehrNunjnvv.rqh> -->
<!--X-Date: Wed, 2 Aug 2023 22:16:14 &#45;0700 -->
<!--X-Message-Id: CAEwQpaJzERo41nEBgehTRWv2bM7CvwC&#45;4sXUbHZZmcozLCSzUA@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 1766599257.51543874.1690824433485.JavaMail.zimbra@lsce.ipsl.fr -->
<!--X-Reference: CAEwQpa+azKT3QqkQ7=RaeEB7ysQz3=PNW5HGi2KQX_VW1z4NKw@mail.gmail.com -->
<!--X-Reference: 992051030.51618127.1690881244840.JavaMail.zimbra@lsce.ipsl.fr -->
<!--X-Reference: CAKE4FWqXnSCMEkc1xu8DGONnEowQ57X81afN5jLZy4HnvcPx1A@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [EXTERNAL] Re: [ferret_users] Produce a time serie by averaging a large variable</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg01277.html">Thread Prev</a>][<a href="msg01279.html">Thread Next</a>][<A HREF="threads.html#01278">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [EXTERNAL] Re: [ferret_users] Produce a time serie by averaging a large variable</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Xiaoyu Bai &lt;<a href="mailto:xbai1@DOMAIN.HIDDEN">xbai1@xxxxxxxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [EXTERNAL] Re: [ferret_users] Produce a time serie by averaging a large variable</strong></li>
<li><strong>From</strong>: <strong>Ryo Furue &lt;<a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a>&gt;</strong></li>
<li>Date: Thu, 3 Aug 2023 14:15:35 +0900</li>
<li>Arc-authentication-results: i=4; mx.google.com;       dkim=pass header.i=@hawaii.edu header.s=google header.b=a3ldXGvc;       arc=pass (i=2 spf=pass spfdomain=hawaii.edu dkim=pass dkdomain=hawaii.edu);       spf=pass (google.com: domain of <a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a> designates 209.85.219.69 as permitted sender) smtp.mailfrom=<a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a></li>
<li>Arc-authentication-results: i=3; mx.google.com;       dkim=pass header.i=@hawaii.edu header.s=google header.b=a3ldXGvc;       arc=pass (i=2 spf=pass spfdomain=hawaii.edu dkim=pass dkdomain=hawaii.edu);       spf=pass (google.com: domain of <a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a> designates 209.85.219.69 as permitted sender) smtp.mailfrom=<a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a></li>
<li>Arc-authentication-results: i=2; mx.google.com;       dkim=pass header.i=@hawaii.edu header.s=google header.b=a3ldXGvc;       arc=pass (i=1 spf=pass spfdomain=hawaii.edu dkim=pass dkdomain=hawaii.edu dmarc=pass fromdomain=hawaii.edu);       spf=pass (google.com: domain of <a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a></li>
<li>Arc-authentication-results: i=1; mx.google.com;       dkim=pass header.i=@hawaii.edu header.s=google header.b=a3ldXGvc;       spf=pass (google.com: domain of <a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:furue@DOMAIN.HIDDEN">furue@xxxxxxxxxx</a>;       dmarc=pass (p=NONE sp=NONE dis=NONE) header.from=hawaii.edu</li>
<li>Arc-message-signature: i=4; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence:cc         :to:subject:message-id:date:from:in-reply-to:references:mime-version         :sender:dkim-signature;        bh=ST8EOdR9TwxuTfeDr7WRSn28XGEWBfUKeAj2Mw9Y7bs=;        fh=YgoP2uX/MbogwtZlL7b+5usUnoQQbl7LnPb5sLN2H4g=;        b=q/XZcnCuQ5dJUKuaB86Xszu9Xy9NmnvtibSGFMorw6M2TN+uRkvgHe1x8bJ1yhkrXD         8IdVX+1gAzn/vkhgoMeGdhgHwpRSV1d8kx+G+zhEI7lYflG6cX/8uk8nulBVHH85lIv0         q99MgA9b/LZyx9K+56KrwE5EFkYeKHlLc03tP0Vx//YL/cAywYu/qPlqIH4r+RWEFqjS         LdRn/ordc0SyHrHCJv4H9UFUg3GWVCjapjND55SftjqRbqAp5xO3bXPxQmS1Pm7hf2Q9         dHVKsW48td00FD04Q5a8Ubk2Iy1s8Ut89Q4lHlyjn36as9i1tyEghkRBdIeIyHQp1uMG         xobw==</li>
<li>Arc-message-signature: i=3; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=cc:to:subject:message-id:date:from:in-reply-to:references         :mime-version:dkim-signature;        bh=ST8EOdR9TwxuTfeDr7WRSn28XGEWBfUKeAj2Mw9Y7bs=;        fh=YgoP2uX/MbogwtZlL7b+5usUnoQQbl7LnPb5sLN2H4g=;        b=Rzrqsnyv+mGRvdwQ+UFW8AqqvedlOlOXoFX8vWe7uAB1icB5odvvIkUo75VA6jSGBB         iHi/ZxCXTlCIdHS3g40TH58xTzgymIInHPd2ixeOuzH0lK03+i0Vex2WjwtSCDCa/1AJ         bsUgBCumvro2f1ZlwbGb8wUrehv/WKXVYvYsyE4IoPwXx5PwdPdpdHiWRd9hFoGSCfRc         gmhH/bqVK0kdRwxHY1PyZREZkK/5UAPsGtI1QfLLhJzdFfKpWv8oUXYm3lHDiw+HskPu         GlVcayoszZeL7eWVclfWu+iUattsCVlyIJQ2VKaPWp3X3OJKMpfK3E1xktxoyGaNhX1Q         05Xg==</li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=cc:to:subject:message-id:date:from:in-reply-to:references         :mime-version:dkim-signature;        bh=ST8EOdR9TwxuTfeDr7WRSn28XGEWBfUKeAj2Mw9Y7bs=;        fh=YgoP2uX/MbogwtZlL7b+5usUnoQQbl7LnPb5sLN2H4g=;        b=FJtEVzT3O3+wdJMCKaAxFzWHBFLMe4HakLW80jPwpd3DO+KZixVhgUqbORjJLFebZV         jG4TUOsM3IQbTyCq04tlWSmpnDoSZ1y14J9/3kVLZZl98B4XADwJ+jl3KomDUo51LVON         iF9oE9+GWz0/6aLvXc2b52GuFzKIUnvYg2Bp8RRAaQfGJ2hxg4BaAT706fHSk7gAUpJN         T54J6jKql3vcwM8+KuS/2X/8hzXT1Rh3JDZttNC2i9OVK8WDKALKS4L3GQbZZY9ltMkJ         ck/nf7K21u9e8vE1suO7Ca5Wov3gGM1QLs+m8rQoR/6+MAbN9DHUZ4Ntrkm3VZeqRy9t         Zokg==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=cc:to:subject:message-id:date:from:in-reply-to:references         :mime-version:dkim-signature;        bh=ST8EOdR9TwxuTfeDr7WRSn28XGEWBfUKeAj2Mw9Y7bs=;        fh=YgoP2uX/MbogwtZlL7b+5usUnoQQbl7LnPb5sLN2H4g=;        b=a1fpc01Zw+66AyEKwa4RBq7y2hHtieEn6BOqH7abzFSNUmo1YOpqdBgYe0mMFKsabp         MbqXNAJdRExUDgp7w6D5Q+FL/zb8dd1btZnapEyA+82aenSQ0BsJrw4mzw0VzO+P6MWt         rnDLFVWX4Y3kJKKpwVosV/BvpNWQlx73XKrP/wuOy3jeaL9MJ5W3M6XhS969t6NJE/hG         9Cp/He9BsZ/8yrOJzLsJQkF25979fjeFDktJbTJqMMmYqrdDoc13TtL+L/gZbM5QDR1A         eALQMBIMKrjHHjWgtHTph8auGJR5s2O0BgQXh9YFYARGtwsoDNq6JtUD9VC0utRBI/wi         V0EA==</li>
<li>Arc-seal: i=4; a=rsa-sha256; t=1691039772; cv=pass;        d=google.com; s=arc-20160816;        b=XM6q8MyMddZH3BdaVIHmvTvMO7KxlyPXfUUMRzu12UvtrksTUmn9u9S3+zlJL7rMns         JaLA+2oMKsvwaTsno2wiJh21qkb+wyGGg8tzex/hT+qg46HbtqCOEjaINHjac/YBcg8r         KYZl6N2cPohZFik3dj2jhtMxsQBoBAPU7EIGKpXDBliJ/OHZIsg0jb1ZqhCPm4smd2EG         XqGQgZ2eeMF+s0R1xi+EHZZRX4fZTtg1L5ML0SNss1Hq3DjvglBgRlOXi5OQ5dp2NFB0         jv8ShiiNcvORksbbhZzp3R6kEK6xxfGwXJ8++7/0H0YUF1SsBs5k8RoatFmcWygWOZPm         sVjw==</li>
<li>Arc-seal: i=3; a=rsa-sha256; t=1691039770; cv=pass;        d=google.com; s=arc-20160816;        b=RYxcbHT+k8SbZnzzuDiE/n685nP2IX2+N637GgIG2vFFksCEmEVEIztFJbCBJNc6Bg         4B/08WbR0RrSylp9ZnOR+3SS6rmyLuzxrx5mJgLu+k7ft9B5H8mpxowI9wZgTpAJVCAH         xZ5Zy1Y3TlfmpDoFlnvXPNpxSNB7gJKyzRI5xkxDavRXmqN6/KWXASuDmjtzrpSdjUkh         8TXimGangaptu/44Y6U2Yol9wxkOgPKlG+7Q2y9gVm8BOhuzc9VTqswSSMiFuC05HqMx         LEW59sn2SqXpijwuHxIlgxrONTf7gaT1WQx06FU64eS9SkYcLzmTW/3+MocNp94KvDae         0ajg==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1691039748; cv=pass;        d=google.com; s=arc-20160816;        b=QLNCGoNSqcEUkI+tvRPPGoWFI08OURUxODkyfXm6gq8ugAqGaN8S0Fg9X9jVJk7ZPP         fTPo+Kp4yvsmPBNpRMttiZZgpm/AfRd+WkjofrEThnqVO9g7PSa1tjTqLaHK8mw2W0Xg         MqqaSgd3QMXyxZQaMRNHSaN1XhJQzt8jmY21ih9/ZoRIS1Cte6x20IPY2g+0XawLZRGc         jt9zf6iPlgneZ+YLuhA6OiVuMQVOJBJ2HWM600Qk4dJlWFu5+AeHoueHUOPjllqwmH1h         RWT5Z7K097FLVdpNopravzvM6QolD8MqWMdaG/4oG6FeNeFqYpV3J6o7Mfb3v3eSh6H9         J4jw==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1691039747; cv=none;        d=google.com; s=arc-20160816;        b=RzOA/WyhL0t6eWf5mekzJCO1ro6pkganq+yrEhjdxNdaA9ODKAgm/OeohcGJyoHZTR         x6ELpKRhIvXnlvX9c92l3a+/59OABghL2UgdjPGl9Gczlpb1oeRzY1+cTUMtjjAJKgzW         O//p+Dja3zzq7FWFCUSWkg6BTOlL0uhtxKuXtzOzVhnvQvHBN7L89SzZozRvFdIoQRQV         1DmafeL2hv5O5FUQUzOvIWawfEwxkPoyW9kIQZYpnXKv7viVdYekBfnt4P8Rns4qeP35         sFF/HbXpOWHLd6FPhDLUGfoF9KdwdjA/aG+CLb1nJ+nb73F/fwEdPFpMUtnjw13vTqda         5ifQ==</li>
<li>Cc: Patrick Brockmann &lt;<a href="mailto:patrick.brockmann@DOMAIN.HIDDEN">patrick.brockmann@xxxxxxxxxxxx</a>&gt;,        ferret &lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;,        Karine Laurent &lt;<a href="mailto:karine.laurent@DOMAIN.HIDDEN">karine.laurent@xxxxxxxxxxxx</a>&gt;</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google; t=1691039772; x=1691644572;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence         :x-original-authentication-results:x-original-sender:cc:to:subject         :message-id:date:from:in-reply-to:references:mime-version:sender         :from:to:cc:subject:date:message-id:reply-to;        bh=ST8EOdR9TwxuTfeDr7WRSn28XGEWBfUKeAj2Mw9Y7bs=;        b=fFuXthkS2cDEr1i7rJBVPGcji1gWdNm4dE6J7HJ2JeZAqk+d3cYdIsE/oPH1zkVVqX         ETyxRQDwG/TTJdkB18JM/AkVFViDv2qaguKPEQHShaVo03mb+2Qxm3V+rUBmU4cSlgik         7b2auI9Pv2LuYdLqa2d3d70jYC9fAGXizpbfpGklTcNvhV2vatbJIIOb2yOSqJukTj+F         ib5MF6ustoQ2UlmheFB/dwKV0g33XrvgMkuS5QByK/ft3g+Qrr02eVxP6fekbJSB1XZc         Brnz0BtvCbxojGq1mok8NO/xA5kN1hEeUh6POMP+3/OMDnJ+EUM3fyg2D7oNVFP/aKdt         3qZA==</li>
<li>In-reply-to: &lt;CAKE4FWqXnSCMEkc1xu8DGONnEowQ57X81afN5jLZy4HnvcPx1A@mail.gmail.com&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg01276.html">1766599257.51543874.1690824433485.JavaMail.zimbra@lsce.ipsl.fr</a>&gt; &lt;CAEwQpa+azKT3QqkQ7=RaeEB7ysQz3=PNW5HGi2KQX_VW1z4NKw@mail.gmail.com&gt; &lt;992051030.51618127.1690881244840.JavaMail.zimbra@lsce.ipsl.fr&gt; &lt;CAKE4FWqXnSCMEkc1xu8DGONnEowQ57X81afN5jLZy4HnvcPx1A@mail.gmail.com&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<div dir="ltr"><div dir="ltr">Hi Xiaoyu and Patrick</div><br><div class="gmail_quote"><div dir="ltr" class="gmail_attr">On Wed, Aug 2, 2023 at 7:17&#x202F;AM Xiaoyu Bai &lt;<a rel="nofollow" href="mailto:xbai1@xxxxxxxxxxxxx">xbai1@xxxxxxxxxxxxx</a>&gt; wrote:<br></div><blockquote class="gmail_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex"><div dir="ltr"><div>[ . . . ]</div><div><font face="monospace">let ave = VMRN2O[k=@ave, l=@ave]</font></div><div><font face="monospace">repeat/I=1:144 (repeat/J=1:143 (define symbole lat=`i`; save/append/file=<a rel="nofollow" href="https://urldefense.com/v3/__http://tmp.nc__;!!PvDODwlR4mBZyAb0!U0nxqdEvb8XgAFgLlc4Lh_9uq8TTue9t5FNLFOmQ0qZEAC8hNQexPgO0UQ22y9ZhDAt16SRv6dD2uIDKSQ$" target="_blank">grid_($lat)_`j`.nc</a><span>&#xA0;</span>ave))</font></div></div></blockquote><div><br></div><div><br></div><div>I&#39;d like to just add that you don&#39;t have to generate different files for different latitudes; you can just add latitude&#xA0;&quot;slices&quot; to an existing file.&#xA0; Again, just to show the basic idea, here is <i><b>pseudo code</b></i>:</div><div><br></div><div><font face="monospace">spawn rm <a rel="nofollow" href="http://tmpfile.nc">tmpfile.nc</a> ! delete the file</font></div><div><font face="monospace">repeat/L=1:lmax ( \</font></div><div><font face="monospace">&#xA0; &#xA0;repeat/j=1:jmax ( \</font></div><div><font face="monospace">&#xA0; &#xA0; &#xA0; save/append/file=<a rel="nofollow" href="http://tmpfile.nc/">tmpfile.nc/</a><font color="#ff0000">jlimits=1:jmax</font> ave ) )</font></div><div><br></div><div>You calculate the average latitude by latitude&#xA0;and add the result to the file.</div><div><br></div><div>Another consideration is: if at all possible, x=@ave and y=@ave should be calculated at the same time, because Ferret is smart enough to special-case this to calculate the true area average over the lon-lat grid boxes.</div><div><br></div><div>So, my recommendation would be to calculate the x-y average (var[x=@ave,y=@ave]) for each K and each L and store the result in a temporary netCDF file; then open the file and calculate the z average for each L.</div><div><br></div><div>Ryo</div><div><br></div></div></div>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="01276" href="msg01276.html">[ferret_users] Produce a time serie by averaging a large variable</a></strong>
<ul><li><em>From:</em> Patrick Brockmann</li></ul></li>
<li><strong><a name="01277" href="msg01277.html">Re: [ferret_users] Produce a time serie by averaging a large variable</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg01277.html">Re: [ferret_users] Produce a time serie by averaging a large variable</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg01279.html">[ferret_users] Vertical velocity in Soda3.15.2 monthly mean data</a></strong>
</li>

</UL>
<center>[<a href="msg01277.html">Thread Prev</a>][<a href="msg01279.html">Thread Next</a>][<A HREF="threads.html#01278">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
