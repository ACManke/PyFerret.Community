<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] MEMORY/SIZE= changes the result of SAVE -->
<!--X-From-R13: "Oafyrl Q. [naxr" <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Thu, 19 Dec 2019 14:17:22 &#45;0800 -->
<!--X-Message-Id: 7247aaf1&#45;d07c&#45;c0b9&#45;63b5&#45;e7ba2c77d0a2@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CAEwQpaKVFocmfaDOdRg9UZ1Mc81DEv2y44fVsq6SpuXhAzY0vw@mail.gmail.com -->
<!--X-Reference: b3a2d861&#45;78db&#45;ce5f&#45;d8b0&#45;d5a25f36dba5@io&#45;warnemuende.de -->
<!--X-Reference: CAEwQpaLY7unwks6dwaN_XghK8SY&#45;syeM&#45;TsOw1dpSaMjDZLU_Q@mail.gmail.com -->
<!--X-Reference: CAEwQpa+aFn_EppGbk1XwyE0qtK2CMtc9EJHgRnAJcFpmf=yD9w@mail.gmail.com -->
<!--X-Reference: CAEwQpaK8+zinaK_dB=22qrfCBbTJW_pJoGTBfFn9PXiUnvRttw@mail.gmail.com -->
<!--X-Reference: e27df4c1&#45;048e&#45;9e18&#45;f212&#45;4d6350d3b465@noaa.gov -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] MEMORY/SIZE= changes the result of SAVE</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00465.html">Thread Prev</a>][<a href="msg00466.html">Thread Next</a>][<A HREF="threads.html#00469">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] MEMORY/SIZE= changes the result of SAVE</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] MEMORY/SIZE= changes the result of SAVE</strong></li>
<li><strong>From</strong>: <strong>&quot;Ansley C. Manke&quot; &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Thu, 19 Dec 2019 14:17:17 -0800</li>
<li>Arc-authentication-results: i=2; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=IiuATDMl;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>;       dmarc=pass (p=REJECT sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-authentication-results: i=1; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=IiuATDMl;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>;       dmarc=pass (p=REJECT sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence         :content-language:in-reply-to:mime-version:user-agent:date         :message-id:references:to:from:subject:dkim-signature;        bh=LnYtVOBjDsR+3C70DVdlFanb025lqjmgHjZqTvlkzE4=;        b=cOfSnpwh6RHFAFZXq4VmZ48X8XHtbSYYAitQoyfe5VBL+By1pKmb5+x9R8UZgNI58N         HYitDaoPNIrkXnnLap+tpM8gbXUitrnwtdpPtOXeibOw/np4BvyroMn5euwpLVVvpVzl         JAXBsjTa9NrNHd2vVuuK76eo2fcV+yxxSYrDFdw+JDEjtDikW0ZdjgRrIB8EJOc/x6NA         h5VXUt/g+CGJ1uC9BaQE26dPq4e/4/0u+n8NkUi7qd/3FrTxYICUSfPEv+6/T7wOT/G6         5U371FB0/cxgWAIrAHRCPImz1ocqJS7/0KsjKRlSWthQffmN6h68ARf0KsHcrcKBtih1         7ZkQ==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=content-language:in-reply-to:mime-version:user-agent:date         :message-id:references:to:from:subject:dkim-signature;        bh=LnYtVOBjDsR+3C70DVdlFanb025lqjmgHjZqTvlkzE4=;        b=u3ZkM5GE9FS4SsJGgHGyhNt8jX0aAJ5GQ/V7xwXdPyYkrZ44vuYwqDJZQMAbD4+WpZ         T4v4iyTldUtN9/85id4ntq/gHwhfUaW+kRSH4MXshk6QxCCBh/YK9B5P/x6cK3z4Kr2D         i3QdaX9zGFRWZ9h95y+mKH6/IbVhnxNfwMbwxg1p6t6FLT7cP3RPxxNbA/TSxpiVXeCS         D617lwWYtOIQAb9jCR88Tsjz6RH5pJI3NIvxzhDdCS+YPhsd+KUw7XMKUNu7pbkPHixo         sM8KO170BKK/GCh8SrRz0OeOU1GFPsu3Om4dqHOhzvMain+3z9adoNd0XHpfgJYbeTqW         9Mnw==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1576793841; cv=pass;        d=google.com; s=arc-20160816;        b=ALGG9qWQ76zA5GUC16D0xVGA8fqTEgAGoDIdD8k0cT57jOtlkR3IC0rcPUEdttxxIM         oV+wFp9iLOz4gTg/7PDHy6mmESjUkFwlMyeojPktyOBzQYJGOG+vxw/W41/5GO9nP1iC         3lfFhNXA3/4wDe6VrLsuQmYI9SvREWcRr34nIJsa+hRnBaU6X5sOzEnkegRKXDrs2zyR         C8J3KR5nwXfukvGvly5XxxNSjQRtN1xdTatl0olWKGeTHwLHQFjl0bYAMeUI+OjFKi82         YImvUi/5xhOukEmgSLO0f9Vba4f/8bruxHK18AGQsddcg7/YvZ0wQQ09/YdvQgMdZ4K3         8FWQ==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1576793840; cv=none;        d=google.com; s=arc-20160816;        b=xtjuVndTJQHEWa5Hi7BtsArxXkxcLthDijqrz/PH2Y/pTElI/SRwMnUw3tBIkNyhJk         gCsbkHQ4+W6Wi3he+frjvLtERbp4OXf2Eep03ksiSR/b/rNScGfGQ7dlMnrs3nQ+UoST         ESg1qb3JsQni7n5E9ezjbF1ol36qoBgA0M8saBeR1S/Ku46xHkc+djZy+gkxH/RkmQVa         nHGF9pmAKVDWxQS3b+9du3ijdjQDXn1TgGeLrnQBsFGSHBn2IeBDH7ZMX05IKqigbgHh         PKHAQccdt2bJ80k3+RDd0FXJxE3T811C065EGgoEbYwWajFczkLNJ9BpL3XB9kCrzz8A         XM9Q==</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google;        h=subject:from:to:references:message-id:date:user-agent:mime-version         :in-reply-to:content-language:x-original-sender         :x-original-authentication-results:precedence:mailing-list:list-id         :list-post:list-help:list-archive;        bh=LnYtVOBjDsR+3C70DVdlFanb025lqjmgHjZqTvlkzE4=;        b=WkcEJDn1JFcloRxe1qrTlrbJH8nZmr08lQy4EM+BJepVDR9nVZmgRiWrsi9U05OLcW         I4tn9SXgTASAQ6r+OSpmDHc99uqy+d0SHpbMKlY6uUmLxZ+qGAPQ6sFe4W7rwYvL2T87         qyzdBRmnyXRc1PmFEwH+dWXe2B7XUXd0sZns6/lLVw2yx+UKciUAVKALmi/h01JKkZTc         Ze2eTehuKxjJgI72tEkN3uiSuyPhARrmLKAehrAIb9lAl/GKZqfwgjLYKwhkFZ+K/eRe         8lPWrIvO6NkTlXTemycn3IKmy6oCgRK9qyWsm4qbVWDuLHJOFbR78C/cQzcsZOuT55CE         zBJQ==</li>
<li>In-reply-to: &lt;<a href="msg00465.html">e27df4c1-048e-9e18-f212-4d6350d3b465@noaa.gov</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00456.html">CAEwQpaKVFocmfaDOdRg9UZ1Mc81DEv2y44fVsq6SpuXhAzY0vw@mail.gmail.com</a>&gt; &lt;<a href="msg00457.html">b3a2d861-78db-ce5f-d8b0-d5a25f36dba5@io-warnemuende.de</a>&gt; &lt;<a href="msg00458.html">CAEwQpaLY7unwks6dwaN_XghK8SY-syeM-TsOw1dpSaMjDZLU_Q@mail.gmail.com</a>&gt; &lt;CAEwQpa+aFn_EppGbk1XwyE0qtK2CMtc9EJHgRnAJcFpmf=yD9w@mail.gmail.com&gt; &lt;CAEwQpaK8+zinaK_dB=22qrfCBbTJW_pJoGTBfFn9PXiUnvRttw@mail.gmail.com&gt; &lt;<a href="msg00465.html">e27df4c1-048e-9e18-f212-4d6350d3b465@noaa.gov</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:68.0) Gecko/20100101 Thunderbird/68.3.1</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->

  
  
    <p>Hi,</p>
    <p>We have tracked down the cause of this bug. We appreciate the
      report, as it appears only in some circumstances. The fix will in
      the next Ferret/PyFerret release. <br>
    </p>
    This was a case of a bug introduced a couple of years ago, but which
    shows up only when there's the right combination of the size of the
    grid and the memory setting and Ferret/PyFerret's estimate of what
    it needs to do in allocating resources as it evaluates the
    _expression_.&#xA0; Reports of odd behavior like this are crucial as our
    testing, though it is extensive, can certainly miss things!<br>
    <p>Ansley<br>
    </p>
    <p><br>
    </p>
    <div class="moz-cite-prefix">On 12/17/2019 10:07 AM, Ansley C. Manke
      wrote:<br>
    </div>
    <blockquote type="cite"
      cite="">
      
      <p>Hi,</p>
      <p>I suspect this may have to do with Ferret/PyFerret breaking up
        the computation when computing a number of transformations
        including @AVE - that's summarized in point 2, here:</p>
      <p><a rel="nofollow" class="moz-txt-link-freetext"
href="https://ferret.pmel.noaa.gov/Ferret/documentation/release_notes/version-7-2-release-notes"
          moz-do-not-send="true">https://ferret.pmel.noaa.gov/Ferret/documentation/release_notes/version-7-2-release-notes</a></p>
      <p>This behavior where the results differ does show up for the
        first time in v7.2.&#xA0; <br>
      </p>
      <p>Breaking up the computation is done according to the size of
        the data to be worked on and the available memory setting.&#xA0; That
        would explain why changing the size of the computation changes
        the behavior.&#xA0; The verbose output of "SET MODE DIAGNOSTIC" lists
        the operations called scattering and gathering. And a summary is
        given with "SHOW MEMORY/DIAGNOSTIC".&#xA0; I'll work with your
        example and see if I can tell what's going on.<br>
      </p>
      <p>The core analysis code is identical with Ferret and Pyferret,
        so we wouldn't expect differences there.<br>
      </p>
      <p>-Ansley<br>
      </p>
      <p><br>
      </p>
      <div class="moz-cite-prefix">On 12/17/2019 4:52 AM, Ryo Furue
        wrote:<br>
      </div>
      <blockquote type="cite"
cite="">
        
        <div dir="ltr">
          <div>Hi, again,</div>
          <div><br>
          </div>
          <div>Just one more experiment.</div>
          <br>
          <div class="gmail_quote">
            <div dir="ltr" class="gmail_attr">On Mon, Dec 16, 2019 at
              1:31 PM Ryo Furue &lt;<a rel="nofollow" href="mailto:furue@xxxxxxxxxx"
                moz-do-not-send="true">furue@xxxxxxxxxx</a>&gt; wrote:<br>
            </div>
            <blockquote class="gmail_quote" style="margin:0px 0px 0px
              0.8ex;border-left:1px solid
              rgb(204,204,204);padding-left:1ex">
              <div dir="ltr">
                <div class="gmail_quote">
                  <blockquote class="gmail_quote" style="margin:0px 0px
                    0px 0.8ex;border-left:1px solid
                    rgb(204,204,204);padding-left:1ex">
                    <div dir="ltr">
                      <div class="gmail_quote">
                        <div>Unfortunately, I've just reproduced exactly
                          the same problem on Ferret 7.5.0 on Linux.&#xA0; So
                          far, we haven't got Pyferret on our Linux
                          server.<br>
                        </div>
                      </div>
                    </div>
                  </blockquote>
                  <div><br>
                  </div>
                  <div>So, the same problem is reproduced with PyFerret
                    7.5 on the same Linux machine:</div>
                </div>
              </div>
            </blockquote>
            <div><br>
            </div>
            <div>On PyFerret 7.5 on my Mac, exactly the same problem
              occurs with the same dataset.&#xA0; So, it's more likely that
              other people can reproduce the problem.</div>
            <div><br>
            </div>
            <div>Regards,</div>
            <div>Ryo</div>
            <div><br>
            </div>
            <div>&#xA0;</div>
            <blockquote class="gmail_quote" style="margin:0px 0px 0px
              0.8ex;border-left:1px solid
              rgb(204,204,204);padding-left:1ex">
              <div dir="ltr">
                <div class="gmail_quote">
                  <div> The presence or absence of a SET MEMORY command
                    changes the result of SAVE without any diagnostics.</div>
                  <div><br>
                  </div>
                  <div>I'll try to further reduce my data file.</div>
                  <div><br>
                  </div>
                  <div>Regards,</div>
                  <div>Ryo</div>
                  <div>-----------</div>
                  <div>&#xA0; NOAA/PMEL TMAP<br>
                    &#xA0; PyFerret v7.5 (optimized)<br>
                    &#xA0; Linux 4.15.0-1061-azure - 11/14/19<br>
                    &#xA0; 16-Dec-19 13:21<br>
                  </div>
                  <div><br>
                  </div>
                  <blockquote class="gmail_quote" style="margin:0px 0px
                    0px 0.8ex;border-left:1px solid
                    rgb(204,204,204);padding-left:1ex">
                    <div dir="ltr">
                      <div class="gmail_quote">
                        <div>====================<br>
                        </div>
                        <div>&#xA0; NOAA/PMEL TMAP<br>
                          &#xA0; FERRET v7.5 (optimized)<br>
                          &#xA0; Linux 2.6.32-754.11.1.el6.x86_64 64-bit -
                          04/25/19<br>
                          &#xA0; 16-Dec-19 00:02<br>
                        </div>
                        <div>&#xA0;</div>
                        <div>!=== my script to reproduce the bug ===</div>
                        <div>! Delete the SET MEMORY command and the two
                          output variables become identical.<br>
                          !</div>
                        <div>set data tmp-usss0500m-L600.nc ! Contains
                          var "usss" .<br>
                          <br>
                          set memory/size=300 ! &lt;- Delete this line<br>
                          let u = usss[d=1]<br>
                          save/clobber/file=<a rel="nofollow" href="http://tmp-u.nc"
                            target="_blank" moz-do-not-send="true">tmp-u.nc</a>
                          &#xA0;u[m=1:10@AVE]<br>
                          save/clobber/file=<a rel="nofollow" href="http://tmp-usss.nc"
                            target="_blank" moz-do-not-send="true">tmp-usss.nc</a>
                          &#xA0;usss[m=1:10@AVE]<br>
                          <br>
                          !--- plot to see if they are identical ---<br>
                          cancel var/all<br>
                          cancel data/all<br>
                          set data <a rel="nofollow" href="http://tmp-u.nc"
                            target="_blank" moz-do-not-send="true">tmp-u.nc</a><br>
                          set data <a rel="nofollow" href="http://tmp-usss.nc"
                            target="_blank" moz-do-not-send="true">tmp-usss.nc</a><br>
                          plot/x=101W/y=4S:4N u[d=1], usss[d=2]<br>
                          <br>
                        </div>
                      </div>
                    </div>
                  </blockquote>
                </div>
              </div>
            </blockquote>
          </div>
        </div>
      </blockquote>
    </blockquote>
  


<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00456" href="msg00456.html">[ferret_users] MEMORY/SIZE= changes the result of SAVE</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
<li><strong><a name="00457" href="msg00457.html">Re: [ferret_users] MEMORY/SIZE= changes the result of SAVE</a></strong>
<ul><li><em>From:</em> Martin Schmidt</li></ul></li>
<li><strong><a name="00458" href="msg00458.html">Re: [ferret_users] MEMORY/SIZE= changes the result of SAVE</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
<li><strong><a name="00459" href="msg00459.html">Re: [ferret_users] MEMORY/SIZE= changes the result of SAVE</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
<li><strong><a name="00464" href="msg00464.html">Re: [ferret_users] MEMORY/SIZE= changes the result of SAVE</a></strong>
<ul><li><em>From:</em> Ryo Furue</li></ul></li>
<li><strong><a name="00465" href="msg00465.html">Re: [ferret_users] MEMORY/SIZE= changes the result of SAVE</a></strong>
<ul><li><em>From:</em> Ansley C. Manke</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00465.html">Re: [ferret_users] MEMORY/SIZE= changes the result of SAVE</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00466.html">[ferret_users] fixed scaling factor by default</a></strong>
</li>

</UL>
<center>[<a href="msg00465.html">Thread Prev</a>][<a href="msg00466.html">Thread Next</a>][<A HREF="threads.html#00469">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
