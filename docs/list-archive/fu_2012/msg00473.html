<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] NetCDF: Not a valid data type or _FillValue type mismatch -->
<!--X-From-R13: Oafyrl [naxr <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Wed, 12 Sep 2012 12:27:43 &#45;0700 -->
<!--X-Message-Id: 5050E22A.70308@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 1314812268.8435.160.camel@oo -->
<!--X-Reference: 5050B7EC.8080705@mercator&#45;ocean.fr -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] NetCDF: Not a valid data type or _FillValue type mismatch</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00472.html">Thread Prev</a>][<a href="msg00474.html">Thread Next</a>][<A HREF="threads.html#00473">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] NetCDF: Not a valid data type or _FillValue type mismatch</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>ferret &lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] NetCDF: Not a valid data type or _FillValue type mismatch</strong></li>
<li><strong>From</strong>: <strong>Ansley Manke &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Wed, 12 Sep 2012 12:27:38 -0700</li>
<li>In-reply-to: &lt;<a href="msg00472.html">5050B7EC.8080705@mercator-ocean.fr</a>&gt;</li>
<li>List-archive: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/?hl=en_US">http://groups.google.com/a/noaa.gov/group/ferret_users/?hl=en_US</a>&gt;</li>
<li>List-help: &lt;<a href="http://support.google.com/a/noaa.gov/bin/topic.py?hl=en_US&topic=25838">http://support.google.com/a/noaa.gov/bin/topic.py?hl=en_US&topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/post?hl=en_US">http://groups.google.com/a/noaa.gov/group/ferret_users/post?hl=en_US</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe?hl=en_US">http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe?hl=en_US</a>&gt;, &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;1314812268.8435.160.camel@oo&gt; &lt;<a href="msg00472.html">5050B7EC.8080705@mercator-ocean.fr</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:15.0) Gecko/20120907 Thunderbird/15.0.1</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    Hi,<br>
    I think I see what may be the cause of this. I'll work with Bruno to
    verify this for the data he's looking at, but now I see what is
    happening with the dataset in the 2011 message with the earlier
    report of the same error.&#xA0; That dataset has _FillValue attributes on
    the coordinate axis variables, e.g. in the ncdump output, the X axis
    looks like this:<br>
    <br>
    <tt>...</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; float longitude(longitude) ;</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; longitude:valid_min = -12.f ;</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; longitude:valid_max = -7.f ;</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; longitude:step = 0.1666641f ;</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; longitude:units = "degrees_east" ;</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; longitude:unit_long = "Degrees East" ;</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; longitude:long_name = "Longitude" ;</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; longitude:standard_name = "longitude" ;</tt><tt><br>
    </tt><tt>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; longitude:_FillValue = 1.e+35f ;</tt><tt><br>
    </tt><br>
    This isn't something we expect under the CF standard for NetCDF
    datasets, because coordinate variables must have all valid values.
    But apparently some software is set up to write this attribute.<br>
    <br>
    Ferret always writes coordinate data with the double-precision
    datatype, and for coordinate variables, it writes out all of the
    attributes from the file.&#xA0; So it has set itself up to write a
    double-precision variable with a single-precision _FillValue
    attribute. That's the error condition that the NetCDF library is
    returning (error code -45 _FillValue type mismatch).<br>
    <br>
    We can fix this within Ferret by either not writing the _FillValue
    attribute for coordinate axes, or setting its type to match the
    coordinate data type.&#xA0; <br>
    <br>
    A workaround with existing versions of Ferret is to tell Ferret not
    to write this attribute for the coordinate axes.&#xA0; <br>
    <tt><br>
    </tt>
    <blockquote><tt>yes? use test_out.cdf
      </tt><br>
      <tt>
        yes? cancel att/output (`u,return=xaxis`)._FillValue</tt><br>
      <tt>
        yes? cancel att/output (`u,return=yaxis`)._FillValue</tt><br>
      <tt>
        yes? cancel att/output (`u,return=zaxis`)._FillValue</tt><br>
      <br>
      <tt>yes? set reg/i=10/j=10
      </tt><br>
      <tt>yes? save/file=test_out_subset.cdf/clobber u
      </tt><br>
    </blockquote>
    <tt><br>
    </tt>-Ansley<br>
    <br>
    <br>
    <br>
    <div class="moz-cite-prefix">On 9/12/2012 9:27 AM, Bruno Levier
      wrote:<br>
    </div>
    <blockquote cite=""
      type="cite">Hi
      <br>
      <br>
      I have the same kind of problem that Paulo mentioned one year ago,
      and I couldn't find a solution in Ferret's archives.
      <br>
      <br>
      I can plot a variable from a dataset, but I can not save it in a
      new file.
      <br>
      <br>
      yes? use my_data.nc
      <br>
      yes?
      <br>
      yes? stat atms
      <br>
      <br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Atmospheric pressure at sea level
      <br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; X:&#xA0; N/A
      <br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Y:&#xA0; N/A
      <br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DEPTH (m): -99999
      <br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; TIME: 30-APR-2012 22:00 to 04-MAY-2012 04:30
      <br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; E:&#xA0; N/A
      <br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; F:&#xA0; N/A
      <br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DATA SET: my_data.nc
      <br>
      <br>
      &#xA0;Total # of data points: 43 (1*1*1*43*1*1)
      <br>
      &#xA0;# flagged as bad&#xA0; data: 0
      <br>
      &#xA0;Minimum value: 1018
      <br>
      &#xA0;Maximum value: 1020.5
      <br>
      &#xA0;Mean&#xA0;&#xA0;&#xA0; value: 1019.5 (unweighted average)
      <br>
      &#xA0;Standard deviation: 0.72517
      <br>
      yes?
      <br>
      yes? save /file=toto.nc atms
      <br>
      &#xA0;LISTing to file toto.nc
      <br>
      NetCDF: Not a valid data type or _FillValue type mismatch
      (OPeNDAP/netCDF Error code -45)
      <br>
      &#xA0;could not change CDF mode
      <br>
      ncclose: ncid 131072: NetCDF: Not a valid data type or _FillValue
      type mismatch
      <br>
      <br>
      <br>
      <br>
      ncdump of the file gives for variable ATMS:
      <br>
      <br>
      &#xA0;&#xA0;&#xA0; float ATMS(TIME, DEPTH) ;
      <br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ATMS:long_name = "Atmospheric pressure at sea level" ;
      <br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ATMS:standard_name = "air_pressure_at_sea_level" ;
      <br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ATMS:units = "hectopascal" ;
      <br>
      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ATMS:_FillValue = 9.96921e+36f ;
      <br>
      <br>
      <br>
      <br>
      Thank you for your help,
      <br>
      <br>
      Bruno Levier
      <br>
      <br>
      <br>
      On 08/31/2011 07:37 PM, Paulo B. Oliveira wrote:
      <br>
      <blockquote type="cite">Hi,
        <br>
        <br>
        The attached CDF file (test_out.cdf) was built by an extraction
        tool
        <br>
        from the MyOcean (<a rel="nofollow" class="moz-txt-link-freetext" href="http://www.myocean.eu.org/">http://www.myocean.eu.org/</a>) data server. It's
        OK to
        <br>
        plot the data but I'm not being able to save a subset of data.
        <br>
        <br>
        A "Not a valid data type" error occurs, either asking to
        preserve the
        <br>
        variable attributes or not.
        <br>
        <br>
        Any hints ? Thanks.
        <br>
        <br>
        ___________________________ converting to float ________________
        <br>
        $ ferret
        <br>
        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; NOAA/PMEL TMAP
        <br>
        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; FERRET v6.65
        <br>
        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Linux rh5 (gfortran) 2.6.18-164.11.1.el5 - 11/30/10
        <br>
        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 31-Aug-11 18:32
        <br>
        <br>
        yes?&#xA0; use test_out.cdf
        <br>
        yes? set reg/i=10/j=10
        <br>
        yes? save/file=test_out_subset.cdf/clobber u
        <br>
        &#xA0; LISTing to file test_out_subset.cdf
        <br>
        &#xA0; *** NOTE: Converting data type of missing_value NC_SHORT to
        match
        <br>
        output type of variable NC_FLOAT
        <br>
        NetCDF: Not a valid data type or _FillValue type mismatch
        <br>
        (OPeNDAP/netCDF Error code -45)
        <br>
        &#xA0; could not change CDF mode
        <br>
        ncclose: ncid 131072: NetCDF: Not a valid data type or
        _FillValue type
        <br>
        mismatch
        <br>
        <br>
        ___________________________ keeping var atts ________________
        <br>
        $ ferret
        <br>
        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; NOAA/PMEL TMAP
        <br>
        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; FERRET v6.65
        <br>
        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Linux rh5 (gfortran) 2.6.18-164.11.1.el5 - 11/30/10
        <br>
        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 31-Aug-11 18:32
        <br>
        <br>
        yes? use test_out.cdf
        <br>
        yes? set reg/i=10/j=10
        <br>
        yes? set att/output=all (U)
        <br>
        yes? save/file=test_out_subset.cdf/clobber U
        <br>
        &#xA0; LISTing to file test_out_subset.cdf
        <br>
        NetCDF: Not a valid data type or _FillValue type mismatch
        <br>
        (OPeNDAP/netCDF Error code -45)
        <br>
        &#xA0; could not change CDF mode
        <br>
        ncclose: ncid 131072: NetCDF: Not a valid data type or
        _FillValue type
        <br>
        mismatch
        <br>
        <br>
        &#xA0;&#xA0; </blockquote>
      <br>
    </blockquote>
    <br>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00472" href="msg00472.html">Re: [ferret_users] NetCDF: Not a valid data type or _FillValue type mismatch</a></strong>
<ul><li><em>From:</em> Bruno Levier</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00472.html">Re: [ferret_users] NetCDF: Not a valid data type or _FillValue type mismatch</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00474.html">[ferret_users] Combining NetCDF files</a></strong>
</li>

</UL>
<center>[<a href="msg00472.html">Thread Prev</a>][<a href="msg00474.html">Thread Next</a>][<A HREF="threads.html#00473">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
