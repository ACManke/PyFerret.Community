<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] Conservative remapping -->
<!--X-From-R13: Oafyrl [naxr <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Tue, 22 May 2012 09:38:40 &#45;0700 -->
<!--X-Message-Id: 4FBBC10B.2060403@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 12464743.3991581337687931615.JavaMail.defaultUser@defaultHost -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Conservative remapping</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00219.html">Thread Prev</a>][<a href="msg00227.html">Thread Next</a>][<A HREF="threads.html#00220">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Conservative remapping</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Conservative remapping</strong></li>
<li><strong>From</strong>: <strong>Ansley Manke &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 22 May 2012 09:38:35 -0700</li>
<li>In-reply-to: &lt;12464743.3991581337687931615.JavaMail.defaultUser@defaultHost&gt;</li>
<li>List-archive: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/?hl=en_US">http://groups.google.com/a/noaa.gov/group/ferret_users/?hl=en_US</a>&gt;</li>
<li>List-help: &lt;<a href="http://www.google.com/support/a/noaa.gov/bin/static.py?hl=en_US&page=groups.cs">http://www.google.com/support/a/noaa.gov/bin/static.py?hl=en_US&page=groups.cs</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/post?hl=en_US">http://groups.google.com/a/noaa.gov/group/ferret_users/post?hl=en_US</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe?hl=en_US">http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe?hl=en_US</a>&gt;, &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;12464743.3991581337687931615.JavaMail.defaultUser@defaultHost&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:12.0) Gecko/20120428 Thunderbird/12.0.1</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    Hi Markus,<br>
    If you use the @AVE regridding transformation to regrid between
    grids that are defined with units of longitude and latitude, Ferret
    applies the latitude correction.&#xA0; This is documented here:<br>
    <br>
    <b><a rel="nofollow"
href="http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/Grids-Regions/GRIDS#_VPID_198">4.2.4.1
        Regridding transformations</a>&#xA0; </b>(at<b> </b><a rel="nofollow" class="moz-txt-link-freetext" href="http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/Grids-Regions/GRIDS#_VPID_198">http://ferret.pmel.noaa.gov/Ferret/documentation/users-guide/Grids-Regions/GRIDS#_VPID_198</a>)<br>
    <blockquote>@AVE&#x2014;averaging
      <p align="left">Computes the length-weighted average of all points
        on the source grid that lie partly or completely within each
        grid cell of the destination grid. If any portion of a source
        grid cell containing data overlaps a given destination grid
        cell, then data from that source cell contributes to the
        destination cell, weighted by the fraction of the destination
        cell overlapped by the source cell. The source data are treated
        as continuous, extending to the edges of the grid cells.</p>
      <p class="indented"><b>Note:</b> When @AVE is applied
        simultaneously to the X and Y axes, where X and Y are longitude
        and latitude, respectively, an area-weighted average (weighted
        by cos(latitude)) is used. The @AVE transformation is unique in
        this respect. In multiple axis applications other than X and Y
        @AVE will be applied sequentially to the axes, computing the
        "average of the average." ...</p>
    </blockquote>
    -Ansley<br>
    <br>
    On 5/22/2012 4:58 AM, <a rel="nofollow" class="moz-txt-link-abbreviated" href="mailto:markus.mingel@xxxxxxxxx">markus.mingel@xxxxxxxxx</a> wrote:
    <blockquote
      cite=""
      type="cite">
      <pre wrap="">Dear All,

I would regrid a variable defined in gC/m2 on a regular grid to a new regular 
grid; since the variable is a flux, I should use a mass conservation. Iin order 
to have a variable independent by the cell area I tried to multiply the 
variable by the area before the regridding, and then I divided by the new area 
after the regridding, however when I check the global value on the new grid 
this is not the expected value.
Here a sample code:

USE npp.nc

DEFINE AXIS/X=-179.5:179.5:1 xaxis
DEFINE AXIS/Y=-89.5:89.5:1   yaxis
DEFINE GRID/X=xaxis/Y=yaxis  reg_grid

let dummy = y[gy=yaxis] + x[gx=xaxis]

! Computing the area of the new grid

LET r=6370*1000		! radius of earth in m
LET pi=atan(1.)*4.
LET deg2rad=pi/180.
LET deg2km=1000*2*pi*r/360.

LET Final_area=xbox[g=dummy]*ybox[g=dummy]*cos(y[g=dummy]*deg2rad)
*deg2km*deg2km*1e-6
LET Original_area=xbox[g=npp]*ybox[g=npp]*cos(y[g=npp]*deg2rad)
*deg2km*deg2km*1e-6

let npp_partial  = npp * Original_area
let npp_new     = npp[G=reg_grid]
let npp_final     = npp_new /  Final_area

The global value of npp is 106 Pg, while  npp_final has a much lower value.
Any suggestions?

Best
Markus
</pre>
    </blockquote>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00219" href="msg00219.html">[ferret_users] Conservative remapping</a></strong>
<ul><li><em>From:</em> markus.mingel@xxxxxxxxx</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00219.html">[ferret_users] Conservative remapping</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00227.html">Re: [ferret_users] Conservative remapping</a></strong>
</li>

</UL>
<center>[<a href="msg00219.html">Thread Prev</a>][<a href="msg00227.html">Thread Next</a>][<A HREF="threads.html#00220">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
