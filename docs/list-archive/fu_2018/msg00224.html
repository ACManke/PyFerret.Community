<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] @FNR in 2D fills up x dimension first -->
<!--X-From-R13: Vryyn Dvrqr <Vryyn.DvrqrNqjq.qr> -->
<!--X-Date: Tue, 3 Jul 2018 10:58:43 &#45;0700 -->
<!--X-Message-Id: 7e8a173f&#45;68b7&#45;f6c1&#45;a39d&#45;1a79a597e762@exch.dwd.de -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: b707eb3a&#45;0146&#45;60d9&#45;b4c5&#45;9c768979a732@exch.dwd.de -->
<!--X-Reference: c5104d1f&#45;2041&#45;f20d&#45;5641&#45;f9241faaecf3@noaa.gov -->
<!--X-Derived: pngueaauZqI34.png -->
<!--X-Derived: pngybNScGy_RS.png -->
<!--X-Derived: png5jNMWtmbb5.png -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] @FNR in 2D fills up x dimension first</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00223.html">Thread Prev</a>][<a href="msg00219.html">Thread Next</a>][<A HREF="threads.html#00224">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] @FNR in 2D fills up x dimension first</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>&lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] @FNR in 2D fills up x dimension first</strong></li>
<li><strong>From</strong>: <strong>Hella Riede &lt;<a href="mailto:Hella.Riede@DOMAIN.HIDDEN">Hella.Riede@xxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 3 Jul 2018 19:58:27 +0200</li>
<li>Arc-authentication-results: i=3; mx.google.com;       arc=pass (i=2);       spf=softfail (google.com: domain of transitioning <a href="mailto:hella.riede@DOMAIN.HIDDEN">hella.riede@xxxxxx</a> does not designate 52.222.5.176 as permitted sender) smtp.mailfrom=<a href="mailto:hella.riede@DOMAIN.HIDDEN">hella.riede@xxxxxx</a></li>
<li>Arc-authentication-results: i=2; mx.google.com;       arc=pass (i=1 spf=pass spfdomain=dwd.de);       spf=softfail (google.com: domain of transitioning <a href="mailto:hella.riede@DOMAIN.HIDDEN">hella.riede@xxxxxx</a> does not designate 65.127.216.226 as permitted sender) smtp.mailfrom=<a href="mailto:Hella.Riede@DOMAIN.HIDDEN">Hella.Riede@xxxxxx</a></li>
<li>Arc-authentication-results: i=1; mx.google.com;       spf=pass (google.com: domain of <a href="mailto:hella.riede@DOMAIN.HIDDEN">hella.riede@xxxxxx</a> designates 141.38.3.245 as permitted sender) smtp.mailfrom=<a href="mailto:Hella.Riede@DOMAIN.HIDDEN">Hella.Riede@xxxxxx</a></li>
<li>Arc-message-signature: i=3; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=message-id:content-language:in-reply-to:mime-version:user-agent         :date:organization:from:references:to:subject         :arc-authentication-results:arc-message-signature         :arc-authentication-results:arc-message-signature         :arc-authentication-results;        bh=MpLYsy1adJOCKSNI2fGiEWN9stEDUuOvsQIpvEh8Kqk=;        b=coAHU7u3/Cx0+A5M/BqCb6jjScjKd/3aKeIsWcGnIWwy29P+M4v8FW9uEJxSsg7bZ8         ro4BGxkPah446sHhxHtLdzyL7BUMzjGe+6F1BvIY+3xcQFRjmMl36KeeA4Wncot1mSQt         Q4OwGnscGS4c2CpUI7mKjh4grcYXs7MRS2GNapHNfDDn6QIWcu8cOrYwemhtpffhyWIj         sICBivVuce0JM/RkFiIXLI+O/w+nkFvYmRv48FUxd8qIQNksU2ZwGKThMiCE2r+jeX9Z         2AiRAnsGGkJ5FaDkYJQYspfWyxs8RQodnryXZIAREiurLO+AE2WchjROurQKIlLEa895         Qk1g==</li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=content-language:in-reply-to:mime-version:user-agent:date         :message-id:organization:from:references:to:subject         :arc-authentication-results:arc-message-signature         :arc-authentication-results;        bh=MpLYsy1adJOCKSNI2fGiEWN9stEDUuOvsQIpvEh8Kqk=;        b=pqJ/9z0i6IGWmjE2zuidE7rtep7OYPoDA5zaUmmI/DUsOVYjK78+A5JiwM1eExj+wm         V386ACnbhArDuCB9Cja5d/FnxF5NeNbC1UjiGt4XRwfwLNQL3kWW5eMjLf4jr/6t4D+p         O7432Dj2Q2owTuqmMpgwjVU4o7ommNAPH9OrcOCyP0Dn7n0dey0r6877LFGdGxpAvXW5         ITxEiY7Sk/ok4jS8ok3nb8cGV7mNDn7a+n7x4/Kp5IDeU2Qx62ba4kLVwL12GWP/WWFB         9NJ0FCjLfj1xjSe4LVce27Y/UstskYVNcAphRFUdUiGyK+q2Dc6HCYRBy3klb8Dk3vUf         2tLw==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=content-language:in-reply-to:mime-version:user-agent:date         :message-id:organization:from:references:to:subject         :arc-authentication-results;        bh=MpLYsy1adJOCKSNI2fGiEWN9stEDUuOvsQIpvEh8Kqk=;        b=tWV8/uQLFI7bEoXCYO/l2BEVQGRe/d26mOnIcGkjXFqT16W5WHdueAgyJIq7TIGXqR         VItHBcgqSQiEKwEA+lKjfQNldrz5ebrndwyCv3KOs9lPUZ2A6mbOTjN/jLICifgHZjyb         +WSBNs7HSnTeXGjLfEPRsK4BfI64KEpaX0urvApB+Yr2A3NIA/a9Ig8uOGj/uwmCSDY+         dI8G9k8wXtrCMOEDlDHQhaNggggZCIruNHJs4r+q1WH5/9Eg8lBf5+FK/lVIBItfwHGH         3QTvz6umHMwU7SwRci0c+EVrwAml52eQqUwFsN1iQP5pDNYL/ZMFhEdUcjS9o5Gdu0IL         Z7Ww==</li>
<li>Arc-seal: i=3; a=rsa-sha256; t=1530640721; cv=pass;        d=google.com; s=arc-20160816;        b=hxGg0Dz2XcVjEaLHwavpSB5+OwHcG3UhcpXcLQt+onl93HXSm4Gxar8kx0zB0n11l4         m3QPcfU7yg7N6LwVwpYMAKcVWOICcxFNuUzsIm3UcuyQOfrXhOuIf0krR6L7GotxRx0w         PekN0HlxvZKD8r02/IEMO1tYAc20BhP8j9HA/0M8i/Ci0MVdnXn/f0pjeO6wAleVcvA9         M5JGAt9Izm1v3vOiVD2wniEyeeEMFW36ckB4mgK6PEKw8HsRFd7So2vXN1BQpok4qziB         8uEpv/NsE8PdipDSpCqlSgUxvwHDNLDJg2jOFQoSdGQsNDhBVPkM7EU6ezhPkUnvyaCZ         gJqw==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1530640716; cv=pass;        d=google.com; s=arc-20160816;        b=fnDJgqpkWWT7EzMAwFalMjBg5UrRfrj5R/+WFEj7GefZaMkBq5M3PyOHHAH16CgmrW         hwpJnJuIrWNy10uLwwAtlKo59M0bCMoCewWbruwSUkxZpmGJTspevMNvI4o00Sprxk0q         IMXNzyDmVfKMFAz7JnWQWrxWNhCTZBs8vulRGyTTdz0dBrRrX/sYxQ0AJ1cT1tI0NX+i         tBaOyUOczFLlv0U3PyvvCcu4qAJwZd5sySlLJvuyYYrhwReif6v3j2mLo4nbBtq2W+fd         U8k09P1jBqZcfNycr9L1JSIQ1bMGE4ZzezoGc8E9ieQ71aaLqrtx0TngMpRQBOGAqEJx         63fQ==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1530640709; cv=none;        d=google.com; s=arc-20160816;        b=rzRuVTJMDKBBruonCIUi/oufPdcL8lV5G+AeKMJlVtirkelh3m3yQZWvQvY1x80myt         70x1ua6ytI8ol2DQyW2TE6SzJCbul+YJFIBJYlbJMctCx+oSOFdC1tOEF19fJKeavAjv         Xp4bUwKgnXRNSmDBwPPwaWdqEQNp7A+ZV4dWVA9yga+zOW802LagrnjhTfLN+dP4Dbl/         51vDCpUoq/BcsMVyD2dX0DtH6mEXm3yVMOR3rD0dEzej51SCxQ7AxchUcJDnly5B4YS5         crXgsBuA/8VjFP1fd8EUIBosLoKIvRolrWxVtPogXmr6eatpU9gW2FkN0wNDGLQAPZRr         7uHw==</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google;        h=sender:subject:to:references:from:organization:date:user-agent         :mime-version:in-reply-to:content-language:message-id         :x-original-sender:x-original-authentication-results:precedence         :mailing-list:list-id:list-post:list-help:list-archive;        bh=MpLYsy1adJOCKSNI2fGiEWN9stEDUuOvsQIpvEh8Kqk=;        b=IiApjkw0R6I50MwvvaT5v8WjTefVqgYOoB7CbqZKjcsEKsCavZl5rtkaIpvAWBmqVt         tSXZpKbvA7wPT+2rXHu6sxkqeDj21BhnVq7MFGz7r3iatDTPnc6STZ1wF75rLPdj35Pa         vPGU21pVI3Suwq9Ix0vu/bEiO03Vv2nbR09ghr9r418JGV+00dSNyDpoWN2YeM40Sg7W         vbDEtlx25XAW/QbS8pLJ423ENNqGCYb25N+vi8r1AASqBlDvmwib2qaiC+U6r8RZwroK         TxY31jxshrUN/RYPQMwkZRBa1giMmd7u4XE70a1vD1iq+jVP+6p26zHNcJ3EnBff4tLa         4uqw==</li>
<li>In-reply-to: &lt;<a href="msg00223.html">c5104d1f-2041-f20d-5641-f9241faaecf3@noaa.gov</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>Organization: Deutscher Wetterdienst</li>
<li>References: &lt;<a href="msg00218.html">b707eb3a-0146-60d9-b4c5-9c768979a732@exch.dwd.de</a>&gt; &lt;<a href="msg00223.html">c5104d1f-2041-f20d-5641-f9241faaecf3@noaa.gov</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Thunderbird/52.8.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi Ansley,

</pre><tt>I had looked into fill_xy before trying @FNR, but it is &quot;leaking&quot; 
</tt><tt>interpolation, see attached figure fill_xy_6iter_interpolation_leak.png.
</tt><pre style="margin: 0em;">

fill_xy_iter1.png
</pre><tt>shows that already at iteration = 1 (iter), fill_xy does not correspond 
</tt><tt>to filling up with nearest-neighbor values. See for instance x=2 y=1: 
</tt><tt>should be filled with 1.
</tt><pre style="margin: 0em;">

fill_xy_iter1_longaxes.png
</pre><tt>Same happens when x and y axes span from -2 to 10 to be sure not to cut 
</tt><tt>any area of the created grid object, not shown.
</tt><pre style="margin: 0em;">

The mask was '1' everywhere on the grid for all examples.

def ax/x=-2:10:1 xax
def ax/y=-2:10:1 yax
def sym lev = (0.5,10.5,1)
let a   = {3,3,3,5,5,5}
let b   = {1,2,3,1,2,3}
let val = {1,2,3,4,5,6}
let gridded=SCAT2GRIDGAUSS_XY(a,b,val,x[gx=xax],y[gy=yax],0.8,0.8,0.8,0)
let mask = IF gridded THEN 1 ELSE 1
let iter = 1
let filled = FILL_XY (gridded, mask, iter)
shade/lev=($lev) filled
go polymark poly/lev=($lev)/key/ov/line/fill a b val circle 2



Best regards,
Hella Riede



</pre><tt>P.S. Regarding figure fill_xy_6iter_interpolation_leak.png: I had made a 
</tt><tt>mistake in my previous handmade &quot;expected&quot; figure at position x=3 y=2, 
</tt><tt>which is corrected in the attached version.
</tt><pre style="margin: 0em;">






Am 29.06.2018 um 20:10 schrieb Ansley C. Manke:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi Hella,

</pre><tt>The function fill_xy does&#xA0; fill in two dimensions together, but with one 
</tt><tt>caveat. Here is your script, with the xax and yax axis definitions 
</tt><tt>changed so that the points are not in the corners of the domain
</tt><pre style="margin: 0em;">

 &#xA0;&#xA0; yes? let a&#xA0;&#xA0; = {1,1,8,8,2}
 &#xA0;&#xA0; yes? let b&#xA0;&#xA0; = {1,8,8,1,4}
 &#xA0;&#xA0; yes? let val = {2,4,6,8,10}

 &#xA0;&#xA0; yes? def ax/x=-2:10:1 xax
 &#xA0;&#xA0; yes? def ax/y=-2:10:1 yax

 &#xA0;&#xA0; yes? def sym lev = (1.5,10.5,1)

 &#xA0;&#xA0; yes? !! assign values from dots to grid cells
 &#xA0;&#xA0; yes? set win 1
 &#xA0;&#xA0; yes? let gridded =
 &#xA0;&#xA0; SCAT2GRIDGAUSS_XY(a,b,val,x[gx=xax],y[gy=yax],0.8,0.8,0.8,0)
 &#xA0;&#xA0; yes? shade/lev=($lev) gridded

 &#xA0;&#xA0; yes? show function fill_xy
 &#xA0;&#xA0; FILL_XY(DATA,MASK,N)
 &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; fills missing values with average nearest neighbour values
 &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; DATA: this arg is filled
 &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; MASK: mask (1 -&gt; fill, missing -&gt; do not fill)
 &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; N: the maximum number of fill-passes

 &#xA0;&#xA0; yes? ! define a mask that's 1 everywhere
 &#xA0;&#xA0; yes? let mask = 0*missing(gridded,1)+1
 &#xA0;&#xA0; yes? set window/new
 &#xA0;&#xA0; yes? shade/lev=($lev) fill_xy(gridded, mask, 1)

 &#xA0;&#xA0; ! also look at fill_xy(gridded, mask, 2), fill_xy(gridded, mask, 3) ...

</pre><tt>The function avoids filling singleton points that lie in a corner of the 
</tt><tt>domain. We'll have to look into why that happens, but otherwise this 
</tt><tt>function does what you need.
</tt><pre style="margin: 0em;">

Ansley


On 6/28/2018 7:37 AM, Hella Riede wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hello ferret community,

</pre><tt>I am using @FNR in two dimensions and got an unexpected result (see 
</tt><tt>ferret script at end of this mail):
</tt><pre style="margin: 0em;">

</pre><tt>In the attached ferret_before_FNR.png, the original 2D grid cells are 
</tt><tt>shown (values inherited from dots by scat2grid, see below).
</tt><pre style="margin: 0em;">

</pre><tt>ferret_after_FNR.png shows the result after applying @FNR (fill with 
</tt><tt>nearest neighbor) in 2 dimensions.
</tt><pre style="margin: 0em;">

</pre><tt>As an example for the unexpected result, lets take the grid cell at 
</tt><tt>(x=8,y=5). Its value before @FNR was undefined. The nearest neighbor 
</tt><tt>is (x=8,y=8). Yet, the value is inherited from (x=2,y=4).
</tt><pre style="margin: 0em;">

</pre><tt>Is @FNR not supposed to be applied in 2D or is the logic behind 
</tt><tt>different from what I expected? It seems the missing points are always 
</tt><tt>filled up in x dimension first, and only remaining missing values are 
</tt><tt>then filled up in y direction ...
</tt><pre style="margin: 0em;">

</pre><tt>I attached a manual version of what I would have expected as 
</tt><tt>ferret_FNR_expected.png.
</tt><pre style="margin: 0em;">


Thank you very much in advance for helping to clarify this.


Best regards,
Hella Riede




can var/all
can sym/all

let a&#xA0;&#xA0; = {1,1,8,8,2}
let b&#xA0;&#xA0; = {1,8,8,1,4}
let val = {2,4,6,8,10}

def ax/x=1:8:1 xax
def ax/y=1:8:1 yax

def sym lev = (1.5,10.5,1)

!! assign values from dots to grid cells
set win 1
</pre><tt>let gridded = 
</tt><tt>SCAT2GRIDGAUSS_XY(a,b,val,x[gx=xax],y[gy=yax],0.8,0.8,0.8,0)
</tt><pre style="margin: 0em;">
shade/lev=($lev) gridded
!! plot original scattered values for comparison
go polymark poly/lev=($lev)/key/ov/line/fill a b val circle 2


!! fill up undefined values with nearest neighbor
set win 2
let nn = gridded[x=@FNR,y=@FNR]
shade/lev=($lev) nn
go polymark poly/lev=($lev)/key/ov/line/fill a b val circle 2

</pre></blockquote><pre style="margin: 0em;">


</pre></blockquote><pre style="margin: 0em;">

--

Hella Riede

Deutscher Wetterdienst
Forschung und Entwicklung - Verfahrensentwicklung Fernerkundung (FE23)
Projekt Flottenwetterkarte (FloWKar)
Frankfurter Str. 135, 63067 Offenbach / Main
Tel. +49-69-8062-2414

<a  rel="nofollow" href="https://www.bmvi.de/SharedDocs/DE/Artikel/DG/mfund-projekte/flotten-wetter-karte-flowkar.html">https://www.bmvi.de/SharedDocs/DE/Artikel/DG/mfund-projekte/flotten-wetter-karte-flowkar.html</a>


</pre><p><strong>Attachment:
<a href="pngueaauZqI34.png" ><tt>fill_xy_6iter_interpolation_leak.png</tt></a></strong><br>
<em>Description:</em> PNG image</p>
<p><strong>Attachment:
<a href="pngybNScGy_RS.png" ><tt>fill_xy_iter1.png</tt></a></strong><br>
<em>Description:</em> PNG image</p>
<p><strong>Attachment:
<a href="png5jNMWtmbb5.png" ><tt>fill_xy_iter1_longaxes.png</tt></a></strong><br>
<em>Description:</em> PNG image</p>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00218" href="msg00218.html">[ferret_users] @FNR in 2D fills up x dimension first</a></strong>
<ul><li><em>From:</em> Hella Riede</li></ul></li>
<li><strong><a name="00223" href="msg00223.html">Re: [ferret_users] @FNR in 2D fills up x dimension first</a></strong>
<ul><li><em>From:</em> Ansley C. Manke</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00223.html">Re: [ferret_users] @FNR in 2D fills up x dimension first</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00219.html">[ferret_users] Yes, pyferret is for ferret users!</a></strong>
</li>

</UL>
<center>[<a href="msg00223.html">Thread Prev</a>][<a href="msg00219.html">Thread Next</a>][<A HREF="threads.html#00224">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
