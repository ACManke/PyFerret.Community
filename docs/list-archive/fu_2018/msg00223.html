<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] @FNR in 2D fills up x dimension first -->
<!--X-From-R13: "Oafyrl Q. [naxr" <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Fri, 29 Jun 2018 11:10:22 &#45;0700 -->
<!--X-Message-Id: c5104d1f&#45;2041&#45;f20d&#45;5641&#45;f9241faaecf3@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: b707eb3a&#45;0146&#45;60d9&#45;b4c5&#45;9c768979a732@exch.dwd.de -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] @FNR in 2D fills up x dimension first</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00222.html">Thread Prev</a>][<a href="msg00224.html">Thread Next</a>][<A HREF="threads.html#00223">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] @FNR in 2D fills up x dimension first</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] @FNR in 2D fills up x dimension first</strong></li>
<li><strong>From</strong>: <strong>&quot;Ansley C. Manke&quot; &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Fri, 29 Jun 2018 11:10:18 -0700</li>
<li>Arc-authentication-results: i=2; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=Lmd9XVEG;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>;       dmarc=pass (p=QUARANTINE sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-authentication-results: i=1; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=Lmd9XVEG;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>;       dmarc=pass (p=QUARANTINE sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence         :content-language:in-reply-to:mime-version:user-agent:date         :message-id:from:references:to:subject:arc-authentication-results         :arc-message-signature:dkim-signature:arc-authentication-results;        bh=F24HA2YXgKSVUdhToogyXb/Xmaguga7jFBBxpcbAf5U=;        b=Gez9P43rfrx3NNzsvf0kjkhrvMQNM25+kynYhVVFUT7hKhM9eM4wf7aW4PC0gWic9b         SwUEJdOO48TzvGHGED1wdSXW0CbRjuTQki6++RKV5V2ccRzkMFFHic5ggkTSMozAvDo+         9NRwu9xCLpfizf9ZotyUlbrSeeypQyk/fl1OfrOoe2hwRqhY9F+GZyXBCpJu1ljfUNAI         qLjewnEfCbw7aZ7rIcXRSWX1s+a0en3IVcARG98US6BGIj2S8qtNKykibt/TPyA/E1tg         8dySg2mxVydxGZoZu1+LUWUrO0kw+dGEgI8SiC/p32yCuxphPn7L3A80vg/QWMU9Uosz         GmLg==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=content-language:in-reply-to:mime-version:user-agent:date         :message-id:from:references:to:subject:dkim-signature         :arc-authentication-results;        bh=F24HA2YXgKSVUdhToogyXb/Xmaguga7jFBBxpcbAf5U=;        b=yRPhndAJ3w2br+M20/ecMdITfXyzoM5R7vselMsJUnn6/qPOqGNggwceoAPipiy6Tx         M0tk1wtB0IT5RX4ZaZ3VBLBJg1xebJKvBHfBe4SNSzVVVtp8B+IKSF7HfOi3YSIEQmzS         ynaAvhhkx7P32lKPFrS9wzlVWj3hNmcnvtXjKAWDh6nXacAjopxx50Nw9yPS+6mdMhzA         UY30EJozYGgEP8bHA7kSGVnKR4mJbBZMLZa4/LcVdLTxhuVhr8ANX075F+x8uFs/rKro         VMWMdBMzpO5dVy3KSgg4yXm1Rs2xrrm286AgZe5gNgySgknfs2f7jqfSattNS01pbL2u         sSoQ==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1530295821; cv=pass;        d=google.com; s=arc-20160816;        b=jkbD7cI+2GUeY+xAxt4MR9oueS00nEsjpzAe6wBb7pYGslx/uMntLRuth2pWoZno9B         TMK17I9cqRfEwmyxCEI81qIQlQlHv9ubmJPYNTQbqFA2VcMtPE/9bGo8/JCwKXzzLis4         hyHI/1OCwxWdldnmH1ubo+fo/o/Obl6bDJH604rJnjmEuTOvV6+pLzw1RFT2yloLtYFL         kmDDk4r/qfijSk6pgYLL4kPhIjdzT7Qs4mWJwOKrgTVIxhtg2Kxh4EZsK5+Tgxlum1Z/         TTolLMX3sd/t7Gr8EWAIGbkCA5ITVPMGStgSBiit+wqci7KPmXSVbdzieAYfQ5HkML+I         9hYg==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1530295820; cv=none;        d=google.com; s=arc-20160816;        b=ZH1XZYHi9xk1fwrsAo/ZPV2+CC/4v2/DMQC80i0e0ufqAssyyuo/fL5T2tyPW37dSY         2n/Bvtgmh5EfZ/vRNozzd7vHmQfWQIWrhtATemkiUMlbMHETcK2cqvjI9tobQdAmuP0h         Hv5ntMR1ZXQ7POVcYIMTg9pIaWr8t1yQHVgK6DqxqGNBzjscIvSM69SbnbNBDiKsLrM8         tbkPj6GyMeKnfFzIKKPwdvY7+QJ46vwnJtN++Pl0lYNaQsSmdC4giVpTJ2YjJkw+RNq1         jnuQ72AMkLGfTstdPxu06rOA68OP6lLt2RTZKv16T96vzgo9qfRSkm4ouVaRvVYa4kIX         VYGQ==</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google;        h=subject:to:references:from:message-id:date:user-agent:mime-version         :in-reply-to:content-language:x-original-sender         :x-original-authentication-results:precedence:mailing-list:list-id         :list-post:list-help:list-archive;        bh=F24HA2YXgKSVUdhToogyXb/Xmaguga7jFBBxpcbAf5U=;        b=GuiEopxVipzUsvplTFM0sbMj8KUs/KCIwp+OPz+MZddH268F/QRWWRVGHl/B2ujERw         hfu2OQP+/uS/K9VaOAOaMVa2qp9KTm7mVR9SjTHRySM4TtlxE5fUN7aqb1PC+i+jJQBv         hmhypWEIFha+QJzx8BdHz9C3X1+V7kbP10xoOT1BVDIfDlvJpZA6oYq3RmcSoqS5KMdG         k+3l6qJHVxMRoCt6/N8hzUAsrqxo9noqPB4nf/Q5DXT3BbasYq3L8THOQndTw5Y2K5Ju         DU0bTlJk11oL2Aw/dy0TptV2sQJHySylpQBoFmtl7mzgDBrymTSC3nz4VXAKX8RwEtZ7         lInw==</li>
<li>In-reply-to: &lt;<a href="msg00218.html">b707eb3a-0146-60d9-b4c5-9c768979a732@exch.dwd.de</a>&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;<a href="msg00218.html">b707eb3a-0146-60d9-b4c5-9c768979a732@exch.dwd.de</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko/20100101 Thunderbird/52.8.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    <p>Hi Hella,</p>
    <p>The function fill_xy does&#xA0; fill in two dimensions together, but
      with one caveat. Here is your script, with the xax and yax axis
      definitions changed so that the points are not in the corners of
      the domain<br>
    </p>
    <blockquote><tt>yes? let a&#xA0;&#xA0; = {1,1,8,8,2}<br>
        yes? let b&#xA0;&#xA0; = {1,8,8,1,4}<br>
        yes? let val = {2,4,6,8,10}<br>
        <br>
        yes? def ax/x=-2:10:1 xax<br>
        yes? def ax/y=-2:10:1 yax<br>
        <br>
        yes? def sym lev = (1.5,10.5,1)<br>
        &#xA0;<br>
        yes? !! assign values from dots to grid cells<br>
        yes? set win 1<br>
        yes? let gridded =
        SCAT2GRIDGAUSS_XY(a,b,val,x[gx=xax],y[gy=yax],0.8,0.8,0.8,0)<br>
        yes? shade/lev=($lev) gridded<br>
        &#xA0;<br>
        yes? show function fill_xy<br>
        FILL_XY(DATA,MASK,N)<br>
        &#xA0;&#xA0;&#xA0; fills missing values with average nearest neighbour values<br>
        &#xA0;&#xA0;&#xA0; DATA: this arg is filled<br>
        &#xA0;&#xA0;&#xA0; MASK: mask (1 -&gt; fill, missing -&gt; do not fill)<br>
        &#xA0;&#xA0;&#xA0; N: the maximum number of fill-passes<br>
      </tt><tt><br>
      </tt><tt><tt>yes? ! define a mask that's 1 everywhere<br>
          yes? </tt>let mask = 0*missing(gridded,1)+1</tt><tt><br>
      </tt><tt><tt>yes? </tt>set window/new <br>
        yes? shade/lev=($lev) fill_xy(gridded, mask, 1)</tt><tt><br>
      </tt><tt>&#xA0;<br>
      </tt><tt>! also look at fill_xy(gridded, mask, 2),
        fill_xy(gridded, mask, 3) ..</tt>.<br>
    </blockquote>
    The function avoids filling singleton points that lie in a corner of
    the domain. We'll have to look into why that happens, but otherwise
    this function does what you need.<br>
    <br>
    Ansley<br>
    <br>
    <br>
    <div class="moz-cite-prefix">On 6/28/2018 7:37 AM, Hella Riede
      wrote:<br>
    </div>
    <blockquote type="cite"
      cite="">Hello
      ferret community,
      <br>
      <br>
      I am using @FNR in two dimensions and got an unexpected result
      (see ferret script at end of this mail):
      <br>
      <br>
      In the attached ferret_before_FNR.png, the original 2D grid cells
      are shown (values inherited from dots by scat2grid, see below).
      <br>
      <br>
      ferret_after_FNR.png shows the result after applying @FNR (fill
      with nearest neighbor) in 2 dimensions.
      <br>
      <br>
      As an example for the unexpected result, lets take the grid cell
      at (x=8,y=5). Its value before @FNR was undefined. The nearest
      neighbor is (x=8,y=8). Yet, the value is inherited from (x=2,y=4).
      <br>
      <br>
      Is @FNR not supposed to be applied in 2D or is the logic behind
      different from what I expected? It seems the missing points are
      always filled up in x dimension first, and only remaining missing
      values are then filled up in y direction ...
      <br>
      <br>
      I attached a manual version of what I would have expected as
      ferret_FNR_expected.png.
      <br>
      <br>
      <br>
      Thank you very much in advance for helping to clarify this.
      <br>
      <br>
      <br>
      Best regards,
      <br>
      Hella Riede
      <br>
      <br>
      <br>
      <br>
      <br>
      can var/all
      <br>
      can sym/all
      <br>
      <br>
      let a&#xA0;&#xA0; = {1,1,8,8,2}
      <br>
      let b&#xA0;&#xA0; = {1,8,8,1,4}
      <br>
      let val = {2,4,6,8,10}
      <br>
      <br>
      def ax/x=1:8:1 xax
      <br>
      def ax/y=1:8:1 yax
      <br>
      <br>
      def sym lev = (1.5,10.5,1)
      <br>
      <br>
      !! assign values from dots to grid cells
      <br>
      set win 1
      <br>
      let gridded =
      SCAT2GRIDGAUSS_XY(a,b,val,x[gx=xax],y[gy=yax],0.8,0.8,0.8,0)
      <br>
      shade/lev=($lev) gridded
      <br>
      !! plot original scattered values for comparison
      <br>
      go polymark poly/lev=($lev)/key/ov/line/fill a b val circle 2
      <br>
      <br>
      <br>
      !! fill up undefined values with nearest neighbor
      <br>
      set win 2
      <br>
      let nn = gridded[x=@FNR,y=@FNR]
      <br>
      shade/lev=($lev) nn
      <br>
      go polymark poly/lev=($lev)/key/ov/line/fill a b val circle 2
      <br>
      <br>
    </blockquote>
    <br>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00224" href="msg00224.html">Re: [ferret_users] @FNR in 2D fills up x dimension first</a></strong>
<ul><li><em>From:</em> Hella Riede</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00218" href="msg00218.html">[ferret_users] @FNR in 2D fills up x dimension first</a></strong>
<ul><li><em>From:</em> Hella Riede</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00222.html">Re: [ferret_users] @FNR in 2D fills up x dimension first</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00224.html">Re: [ferret_users] @FNR in 2D fills up x dimension first</a></strong>
</li>

</UL>
<center>[<a href="msg00222.html">Thread Prev</a>][<a href="msg00224.html">Thread Next</a>][<A HREF="threads.html#00223">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
