<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] which climatology should I use -->
<!--X-From-R13: "Oafyrl Q. [naxr" <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Fri, 28 Sep 2018 14:19:14 &#45;0700 -->
<!--X-Message-Id: a843bae4&#45;16a4&#45;7e36&#45;be78&#45;9414c48cdf4c@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CAKE4FWqrGSGEj8Sn1&#45;KTm5E=_rOt=WWgANfo86r2=xc9Vxesng@mail.gmail.com -->
<!--X-Reference: 531ba79b&#45;eca5&#45;8432&#45;5512&#45;b1b34318c0d2@noaa.gov -->
<!--X-Reference: CAKE4FWpORVryWFRXSBD4g4GTYRK6co&#45;mXknaCN85qr=cC7DZsA@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] which climatology should I use</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00346.html">Thread Prev</a>][<a href="msg00349.html">Thread Next</a>][<A HREF="threads.html#00347">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] which climatology should I use</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] which climatology should I use</strong></li>
<li><strong>From</strong>: <strong>&quot;Ansley C. Manke&quot; &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Fri, 28 Sep 2018 14:19:11 -0700</li>
<li>Arc-authentication-results: i=2; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=bRih5eeG;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>;       dmarc=pass (p=QUARANTINE sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-authentication-results: i=1; mx.google.com;       dkim=pass header.i=@noaa.gov header.s=google header.b=bRih5eeG;       spf=pass (google.com: domain of <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a> designates 209.85.220.41 as permitted sender) smtp.mailfrom=<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>;       dmarc=pass (p=QUARANTINE sp=NONE dis=NONE) header.from=noaa.gov</li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=list-archive:list-help:list-post:list-id:mailing-list:precedence         :content-language:in-reply-to:mime-version:user-agent:date         :message-id:from:references:cc:subject:dkim-signature;        bh=bz8YRisi1yIimQDkLZ8TPsjQlk8AtMZ9q2iuBErV/DE=;        b=FxTkyK0INmesjOrlPLX8aVmnKrpwWwC2P5641GPmz/zDn9Bxa9XNgO3T/YOifQ2dFs         98fvhl6R1Mnc9en3375ssJbj/6z2t6Ep+/7kVV9fC0kxzJOPKBrWeqvs4z+tXERWwUwM         LSkBbuySXE8tu65qij63EBqljLOW8x9QSK7OsHUVH+QFDwJxk1al7de1HJkwNk8J+OPC         7BazeM6oeuH3xhMJ6T+7OSj0K2WBh7VHOyaZbiuISr3tnPE+0QXpdcGVDayFPaLMCbFN         GK55AdDX6sLIZc93DK8BOmEjZxCTksrX05bgge3YOOGnPoom0dhEN3MWjQtC0Qt5NZ7b         XksA==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=content-language:in-reply-to:mime-version:user-agent:date         :message-id:from:references:cc:subject:dkim-signature;        bh=bz8YRisi1yIimQDkLZ8TPsjQlk8AtMZ9q2iuBErV/DE=;        b=Bp0s3WskuXetHpMAF80BGBtNDdroqJTAP4bwyJhkQ71ySubMkQxMbp5CzZ0TrM998C         NYkzsHjogYXJ2WYBWgfzEjvZzYPM7jnBVXGEbp4lkBHkVsjAin7bdbQctuOPlKLJANTL         gyoTW0ECDpqQfqabbKdvXK4ByD/q+HM9yySMagq13EH6ygLHaU/AWBMx+qmlyQZrjz32         O1KP2Kc/3QyfVuhtaCTSrnIctJWxzvoyz6/SgPy2cwxmXuSHxI+In5tVUjf8Ojid5QRX         KHNGgozjHy9mr+x6KqvRmMCseSE1y7E+vqETUz1gyWPF33vMBbM+FQQuygcySRgtp2ic         D7Xg==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1538169554; cv=pass;        d=google.com; s=arc-20160816;        b=cvY24Lj4dW9ukGybMybkwQXwml9HjzJkIl3SmrzVJ3/bwjfQ/7Aojf4VjGbC7P5s29         wdlb0/NfEcWYKczB2X4R4zK8t3SgN1DdHkS0K2q3Ylg7G7MkXBGEkWZaTrR+GpMgixXv         IfJHxWFfrbkdBYvFLzokn02x+bNBNxax0frW67BIJwMIfM5b4IRPtd+ddiCMA/jd5Xo8         31DRnNC6XtvDGqeFG6PhTKCYE5Dg64xL5M/1WmdbOrVSOI/R/xTJO2j70Rd8oKHFlxQo         4b5LONSwCatv5GvoLbXfYXEw9xvmwDnTF2hLdto1Yo9QGApOa3IrVuNc/RLXrydTMPTs         L/4A==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1538169553; cv=none;        d=google.com; s=arc-20160816;        b=gm8U//7i3l/na3uc86/XE/M/PmLl50OQuN1VWnwJ3CAXIQu30bX+aif81eaJHLv9Xr         HZrxAQciS9v3L88m+QdPSo1r3BYOS/Ip163f6WlVuR5RRq3saBuwYVUatX6jlOd6/dbw         s0IwFZTqUZKL9DwYc3r/zZVEAxX87RshjRuCK9wqo244segsYCiUpaz/w4n1vDiMJrwb         XiUBQTiQ+1GIBzw5QROVp6xJufsXTQlWoBoyx9i7/Nkg0IicW/EvdTsH8RE3HDYNptz6         GUnQR1/SoHIYzojjnMBavJT5QKrBToLso3QapZQ9vhDf90UyacWh8cVgqHxRBSCCHNv1         jEiQ==</li>
<li>Cc: <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google;        h=subject:cc:references:from:message-id:date:user-agent:mime-version         :in-reply-to:content-language:x-original-sender         :x-original-authentication-results:precedence:mailing-list:list-id         :list-post:list-help:list-archive;        bh=bz8YRisi1yIimQDkLZ8TPsjQlk8AtMZ9q2iuBErV/DE=;        b=TxF5ym/mYj96POEKezK/GOD8iJMv8DABu3OwOQC8ozRN3PV/vRC733/yL8I5fGjsa9         kP0FW1poKMYb6vZhY23tTsrCXPKkGCSdgzN0ivbIf7cyKlKpBNINPy50lEJjNXPaV7ad         3jFYy4b215cRJzZF1RVKIsBDnK8kdAeZS4+YFaOLZcR949Onq4trhAOLH+cac9d5eW8C         0gkOhWXKh6Wrl0IZRnZ7l8Y1IYhydsjdD0IBlKx/OuTySUTqto7ukMunontkbmjrkeZ7         4KhjOLjFSWXTKUN4SpoxeXc2GUD22/5h/Jl6fJNaw6c9wShUBhmPwg15GdnDxiIJertw         bWUg==</li>
<li>In-reply-to: &lt;CAKE4FWpORVryWFRXSBD4g4GTYRK6co-mXknaCN85qr=cC7DZsA@mail.gmail.com&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;CAKE4FWqrGSGEj8Sn1-KTm5E=_rOt=WWgANfo86r2=xc9Vxesng@mail.gmail.com&gt; &lt;<a href="msg00345.html">531ba79b-eca5-8432-5512-b1b34318c0d2@noaa.gov</a>&gt; &lt;CAKE4FWpORVryWFRXSBD4g4GTYRK6co-mXknaCN85qr=cC7DZsA@mail.gmail.com&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:60.0) Gecko/20100101 Thunderbird/60.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    <p>Hi,</p>
    <p>Modulo regridding is done as a simple sum_of_data divided by the
      count, as your clim_sumave/40 expressions are. The @AVE takes into
      account the grid-cell sizes. It will be related to that but I have
      not looked into it closely.<br>
    </p>
    <p>As to the blank plots in your repeat loop, I think that what's
      happening is that there's a conflict in the use of the I index.&#xA0;
      REPEAT/I=1:9 sets the context of the command to be I=1, and so the
      expressions inside the loop are evaluated at I=1. The grid doesn't
      have a Z axis, so you could use K as the repeat-loop index or the
      syntax REPEAT/RANGE=1:9/NAME=&#xA0; which is intended to address
      exactly this issue. <br>
    </p>
    <p>-Ansley<br>
    </p>
    <div class="moz-cite-prefix">On 9/28/2018 9:36 AM, Xiaoyu Bai wrote:<br>
    </div>
    <blockquote type="cite"
cite="">
      
      <div dir="ltr">
        <div dir="ltr">Dear Ansley,
          <div><br>
          </div>
          <div>Thank you very&#xA0;much. After I changed T to L,&#xA0;@MOD and
            "let pr_`i`_clim_sumave=pr_`i`[L=@SUM]/40" gave me the same
            result. However, if I use "let pr_`i`_clim=pr_`i`[L=@AVE]"
            comparing to&#xA0;@MOD, there are still some differences between
            them. Any particular reason for that? Attach is one
            difference figure.&#xA0;</div>
          <div><br>
          </div>
          <div>By the way, when I use&#xA0;"repeat/i=1:9:1
            (contour/fill/palette=blue_darkred
            (pr_`i`_clim-pr_mod_[L=`i`])*60*60*24*30;
            frame/file=0`i`_CNRM.png)", pyferret (v7.42) gives me blank
            figures. If I plot them separately, like
            "contour/fill/palette=blue_darkred
            (pr_9_clim-pr_mod[L=9])*60*60*24*30", the figure attached
            shows up. Any suggestions?</div>
          <div><br>
          </div>
          <div>Thank you again and have a nice weekend.</div>
          <div><br>
          </div>
          <div>Xiaoyu&#xA0;</div>
        </div>
      </div>
      <br>
      <div class="gmail_quote">
        <div dir="ltr">On Thu, Sep 27, 2018 at 8:52 PM Ansley C. Manke
          &lt;<a rel="nofollow" href="mailto:ansley.b.manke@xxxxxxxx"
            moz-do-not-send="true">ansley.b.manke@xxxxxxxx</a>&gt;
          wrote:<br>
        </div>
        <blockquote class="gmail_quote" style="margin:0 0 0
          .8ex;border-left:1px #ccc solid;padding-left:1ex">
          <div text="#000000" bgcolor="#FFFFFF">
            <p>Hello,</p>
            <p>The stride syntax that you're using should be given with
              the index L not the time-coordinate T, so all of the
              January data is<br>
            </p>
            <p>&#xA0;pr[L=1:480:12]</p>
            <p>A stride using T=&#xA0; is acting on the underlying time units
              of the time axis, which is a monthly axis but with units
              of days. So that means that [T=1:480:12] is asking for
              data at every 12th day for the first 480 days.&#xA0; The clue
              that I noticed was the time label at the top of your
              second plot, where it's reporting that the plot used data
              from the range 7-jan-1969 to 2-May 1970 .<br>
            </p>
            <p>With that change, I think the plots agree pretty well,
              and of course @MOD is simplest to use.<br>
            </p>
            <p>The @MOD regridding will work with any time axis whether
              it starts out as a monthly series or not, so if you
              started with daily data, it gathers all of the January
              data for each year, taking into account the calendar's
              definition of months, and returns the climatological
              average; and so on for each month. It'd also handle
              partial grid cells, so if the source data somehow
              timesteps which don't fall exactly within the
              climatological grid-cell definitions, it takes the correct
              portions of grid cells to contribute to each monthly
              result.<br>
            </p>
            <p>Ansley<br>
            </p>
            <p><br>
            </p>
            <div class="m_-2538637471756057838moz-cite-prefix">On
              9/27/2018 10:37 AM, Xiaoyu Bai wrote:<br>
            </div>
            <blockquote type="cite">
              <div dir="ltr">
                <div dir="ltr">
                  <div dir="ltr">
                    <div dir="ltr">
                      <div dir="ltr">
                        <div dir="ltr">
                          <div dir="ltr">Dear ferreters,
                            <div><br>
                            </div>
                            <div>I have a monthly rainfall .nc file
                              which has Gregorian calendar. I wanted to
                              compute climatology for each month. I
                              tried with&#xA0; "MONTH_GREGORIAN@MOD", tried
                              with pick every month out then take the
                              average, "repeat/i=1:12:1 let
                              pr_`i`=pr[T=`i`:480:12];&#xA0;repeat/i=1:12:1
                              let pr_`i`_clim=pr_`i`[T=@AVE]", tried
                              with sum them up then divide them by the
                              total years&#xA0; "repeat/i=1:12:1 let
                              pr_`i`_clim_sumave=pr_`i`[T=@SUM]/40". I
                              compared these results and found that none
                              of them were the same. Any suggestions on
                              which climatology should I use? By
                              the&#xA0;way, for the Gregorian calendar, if I
                              want to make the rain rates by month, is
                              there a better way than *60*60*24*(days of
                              the month)?&#xA0;</div>
                            <div><br>
                            </div>
                            <div>Attach are the December climatology
                              comparison figures I made.&#xA0;</div>
                            <div><br>
                            </div>
                            <div>My script was as&#xA0;follows:</div>
                            <div>use <a rel="nofollow"
href="https://weather.rsmas.miami.edu:443/repository/opendap/synth:c74267a4-dcdd-4c30-ad10-784a279aa022:L0NOUk0tQU02LURJQS12Mi9MYW5kQ29udHJvbC9BbW9uL3ByX0Ftb25fQ05STS1BTTYtRElBLXYyX0xhbmRDb250cm9sX3IxaTFwMV8xOTY5MDEtMjAwODEyLm5j/entry.das"
                                target="_blank" moz-do-not-send="true">https://weather.rsmas.miami.edu:443/repository/opendap/synth:c74267a4-dcdd-4c30-ad10-784a279aa022:L0NOUk0tQU02LURJQS12Mi9MYW5kQ29udHJvbC9BbW9uL3ByX0Ftb25fQ05STS1BTTYtRElBLXYyX0xhbmRDb250cm9sX3IxaTFwMV8xOTY5MDEtMjAwODEyLm5j/entry.das</a></div>
                            <div>set region/X=-30:70/Y=-40:40</div>
                            <div>let pr_mod=pr[gt=MONTH_GREGORIAN@MOD]</div>
                            <div>repeat/i=1:12:1 let
                              pr_`i`=pr[T=`i`:480:12]</div>
                            <div>repeat/i=1:12:1 let
                              pr_`i`_clim=pr_`i`[T=@AVE]</div>
                            <div>repeat/i=1:12:1 let
                              pr_`i`_clim_sumave=pr_`i`[T=@SUM]/40&#xA0;&#xA0;<br
                                clear="all">
                              <div>
                                <div>repeat/i=1:9:1
                                  (contour/fill/palette=blue_darkred
                                  (pr_`i`_clim_sumave-pr_`i`_clim)*60*60*24*30;
                                  frame/file=0`i`_CNRM.png)</div>
                                <div>repeat/i=10:12:1
                                  (contour/fill/palette=blue_darkred
                                  (pr_`i`_clim_sumave-pr_`i`_clim)*60*60*24*30;
                                  frame/file=`i`_CNRM.png)</div>
                              </div>
                              <div><br>
                              </div>
                              <div>Thank you very much.&#xA0;&#x1F638;</div>
                              -- <br>
                              <div dir="ltr"
                                class="m_-2538637471756057838gmail_signature">
                                <div dir="ltr">Xiaoyu</div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </blockquote>
          </div>
        </blockquote>
      </div>
      <br clear="all">
      <div><br>
      </div>
      -- <br>
      <div dir="ltr" class="gmail_signature"
        data-smartmail="gmail_signature">
        <div dir="ltr">Xiaoyu</div>
      </div>
    </blockquote>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00349" href="msg00349.html">Re: [ferret_users] which climatology should I use</a></strong>
<ul><li><em>From:</em> Xiaoyu Bai</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00344" href="msg00344.html">[ferret_users] which climatology should I use</a></strong>
<ul><li><em>From:</em> Xiaoyu Bai</li></ul></li>
<li><strong><a name="00345" href="msg00345.html">Re: [ferret_users] which climatology should I use</a></strong>
<ul><li><em>From:</em> Ansley C. Manke</li></ul></li>
<li><strong><a name="00346" href="msg00346.html">Re: [ferret_users] which climatology should I use</a></strong>
<ul><li><em>From:</em> Xiaoyu Bai</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00346.html">Re: [ferret_users] which climatology should I use</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00349.html">Re: [ferret_users] which climatology should I use</a></strong>
</li>

</UL>
<center>[<a href="msg00346.html">Thread Prev</a>][<a href="msg00349.html">Thread Next</a>][<A HREF="threads.html#00347">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
