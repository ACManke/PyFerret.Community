<!-- MHonArc v2.6.18 -->
<!--X-Subject: [ferret_users] RE: sampling point data from a 3D grid -->
<!--X-From-R13: "Brnefr X. Phpunana" <crnefroNBevaprgba.SRG> -->
<!--X-Date: Tue, 8 May 2018 16:36:18 &#45;0700 -->
<!--X-Message-Id: 63A10437CDB0D246976F6CD01C424A933659B5@csgmbx213w -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 63A10437CDB0D246976F6CD01C424A9336599D@csgmbx213w -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[ferret_users] RE: sampling point data from a 3D grid</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00156.html">Thread Prev</a>][<a href="msg00158.html">Thread Next</a>][<A HREF="threads.html#00157">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[ferret_users] RE: sampling point data from a 3D grid</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>&quot;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&quot; &lt;<a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>[ferret_users] RE: sampling point data from a 3D grid</strong></li>
<li><strong>From</strong>: <strong>&quot;Pearse J. Buchanan&quot; &lt;<a href="mailto:pearseb@DOMAIN.HIDDEN">pearseb@xxxxxxxxxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 8 May 2018 23:36:11 +0000</li>
<li>Accept-language: en-GB, en-US</li>
<li>Arc-authentication-results: i=2; mx.google.com;       arc=pass (i=1 spf=pass spfdomain=princeton.edu);       spf=neutral (google.com: 65.127.216.226 is neither permitted nor denied by domain of <a href="mailto:pearseb@DOMAIN.HIDDEN">pearseb@xxxxxxxxxxxxx</a>) smtp.mailfrom=<a href="mailto:pearseb@DOMAIN.HIDDEN">pearseb@xxxxxxxxxxxxx</a></li>
<li>Arc-authentication-results: i=1; mx.google.com;       spf=pass (google.com: domain of <a href="mailto:pearseb@DOMAIN.HIDDEN">pearseb@xxxxxxxxxxxxx</a> designates 128.112.128.214 as permitted sender) smtp.mailfrom=<a href="mailto:pearseb@DOMAIN.HIDDEN">pearseb@xxxxxxxxxxxxx</a></li>
<li>Arc-message-signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=mime-version:content-language:accept-language:in-reply-to         :references:message-id:date:thread-index:thread-topic:subject:to         :from:arc-authentication-results:arc-message-signature         :arc-authentication-results;        bh=2Tus/R5FcDX3M3O451SU58S/c28uZiTPcWnyNwiYA9U=;        b=xVBubuY4ApTjSjk48G9pKP63X7lhB+O0/JRLuqul6foUyL2he5//wKViybLq0MyOGn         CAOYyIitSEDxoMcY9U7GmS4QCtji1DIhClvPXo5a8AI1KxYE3nD/AJu0VQrdRVksrtdI         p0Z60otNBeiBm/NH0GYx7bAu+ClXYxQXcJ6IOaDlpB1vvTpaOzlelPiq+3AQHGbNku6q         zU4m1hDBlo7U00cpYoswYKkZi7bXDijaCSUfPR89Tw561BdUb/GlV8GMPqapSBw9Idgl         JzI3CnhOiCqnWXwqmbkPUxb9gZwuE2vDFuHWi7KUHPgrTPCZRGLAIoNt0n4TVyWwTLQf         qVtA==</li>
<li>Arc-message-signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;        h=mime-version:content-language:accept-language:in-reply-to         :references:message-id:date:thread-index:thread-topic:subject:to         :from:arc-authentication-results;        bh=2Tus/R5FcDX3M3O451SU58S/c28uZiTPcWnyNwiYA9U=;        b=mKBpp9+w+7u2SALk5iWWmuOmjx4jMQtsLyB5YjO5x1cUOR+6KZ7TrNKjfRABT6uitN         ZLaKAACEOWKrewcfXNV+BdBNP2D2T/8A83OhHM4VplTlL2wczLcSbUImW1F58chzrnEg         /uKqXPBQrs/XqxNJW//rNBNfVslrT5rKU/Z/JoH0XO/lan/09/64djAtLtmrGvBXD7uD         u8OG5FwNqjMPzt2Hmo3nHxyyjgMBi4as2xzBTmr/zUF2qab+ObUg5Jw1YyMGvPvn4+VE         EizQeXlCO3JZvlgfLY17RCCyldJk5Hvd472MrcPDeBxhNsovOhLrDQX0UyN89mDP7CPh         YIxA==</li>
<li>Arc-seal: i=2; a=rsa-sha256; t=1525822576; cv=pass;        d=google.com; s=arc-20160816;        b=f2BuQzt/VPNihGPULqq6PPhe9BtUtw9OO5CkCfRlBQvDX3tfuSGnwsRd4aSnvYBi22         8clkMdv0ZmFUIYcklemLPY5v1sUbbpNX3uEVScFpxCKl2vzPAcQ6xx3NqwuKX6RQ6/Da         e0x45OZhYBmm4N4Ow0RLJxxJ0pxWslFjzVbTPxILp6Cab9ZXWreaO4JiJv53IecSFDOG         OpsE/nKRs36BpM5K0sRaZgy02aDVcN+FuIJfYowDRsMhuZsJQliI8237IGV7HsM9jPT2         pcN/0hs9qV/6W03z8lroEuPt+IRWpaOosIM/pPbmW0iJ/fVTkIVNSfbYYY3gC7+bJCpl         EAZg==</li>
<li>Arc-seal: i=1; a=rsa-sha256; t=1525822571; cv=none;        d=google.com; s=arc-20160816;        b=EzxLx8UC4BKiQDXppz1JuZPUuaM6Iv1R4FrgiCuFWRDQOJa8SAJixyyS5ueiyc1eLc         A3jvgomiVsiqO4hfzZJua+JNUEcs7QyB90a9RNGOD97tU//MIyA52GjEZpuENLZiM6Ti         fYa2vfp2IQosK1vPWrQ35CB9x12OWpcfQL9sPhVFstEGFfa7BOMwPSWT+UFHMpSSiUIl         iwXQbYvpVUdqgq926pAv9nVyPUvKwiY2Kc3qAG10D/YK3Roye7RGkb5lcYuOsxk4gie3         s4Yfaogk9vBK0XS4CqeQRzq2vJIV7kRZV8Bdd/todUFi3AEEmDiY74OORyZdI9Fb8PLf         wOVQ==</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=noaa.gov; s=google;        h=sender:from:to:subject:thread-topic:thread-index:date:message-id         :references:in-reply-to:accept-language:content-language         :mime-version:x-original-sender:x-original-authentication-results         :precedence:mailing-list:list-id:list-post:list-help:list-archive;        bh=2Tus/R5FcDX3M3O451SU58S/c28uZiTPcWnyNwiYA9U=;        b=Q3861nm9kt0pPt9hWd/KfmkHHlaxvc8y2cgP/o2hPs9QKbW3dy9o6zieDn80I5wFJ/         aIPK572fM3kuPpAqHFSVLr30USBXZ3L+IuT+IxUW5Tn15zdMtKJruTPvZlZe1BdDfAsU         sA6v17++9BwhkmE8gT6jbYe1C4+kXTuYN/h/8b8r66f8oiOCdhjZFAqt2y3ASei1C7u5         PFeMflfgPxvVx3hRoOifmpMEOrHqsFI5LmEm5B4njC6AZZw310ehJqJel7BBdSu3KXCv         wSFMzRfJ3IhV8SszUJZ8/DKbULppmcjXyk98nLNbv13wA6tpMvc8Je62cZFD1gFsfOhS         JPzA==</li>
<li>In-reply-to: &lt;63A10437CDB0D246976F6CD01C424A9336599D@csgmbx213w&gt;</li>
<li>List-archive: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/">https://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">https://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="https://groups.google.com/a/noaa.gov/group/ferret_users/post">https://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;63A10437CDB0D246976F6CD01C424A9336599D@csgmbx213w&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>Thread-index: AdPnBAccfdyN7Z2eTuWNktWbtRpg1AAH6gHZ</li>
<li>Thread-topic: sampling point data from a 3D grid</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td style="">


<div style="direction: ltr;font-family: Tahoma;color: #000000;font-size: 10pt;">Hello all,<br>
<br>
I answered this question after looking through the documentation more. For future users who want to sample their 3D gridded data to point data form (that is, in 1D), I'll show what I did.<br>
<br>
After sampling your 3D data onto 2 dimensions (lon,lat) using samplexy, it appears the best thing to do is use the @weq transformation. The information is held there in the documentation, so look for @WEQ on the ferret page for exactly the same thing I'm writing
 here.<br>
<br>
1. identify correct depth levels<br>
&nbsp;&nbsp;&nbsp; let zero_at_my_zees = MY_DEPTHS - z[g=MY_NEW_2D_GRID] &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ! In this case MY_DEPTHS is a x*y*z length 1D array, while MY_NEW_2D_GRID is a x*y*z by z 2D array.<br>
2. create the weighting for interpolating<br>
&nbsp;&nbsp;&nbsp; let kernal = zero_at_my_zees[z=@weq:0]<br>
3. Apply the weights to the depths chosen by @WEQ<br>
&nbsp;&nbsp;&nbsp; let integrand = kernal*<b>MY_VARIABLE</b><br>
4. sum the weighted depths to get the interpolated value on your new x*y*z 1D array<br>
&nbsp;&nbsp;&nbsp; let MY_NEW_1D_GRID = integrand[z=@sum]<br>
&nbsp;&nbsp; <br>
You now have a 1D array of your 3D gridded variable (MY_VARIABLE) that is interpolated onto your lon, lat, depth point coordinates.<br>
<br>
Hope that helps people in the future.<br>
<br>
Pearse<br>
<br>
<br>
<div style="font-family: Times New Roman; color: #000000; font-size: 16px">
<hr tabindex="-1">
<div id="divRpF489025" style="direction: ltr;"><font size="2" color="#000000" face="Tahoma"><b>From:</b> owner-ferret_users@xxxxxxxx [owner-ferret_users@xxxxxxxx] on behalf of Pearse J. Buchanan [pearseb@xxxxxxxxxxxxx]<br>
<b>Sent:</b> 08 May 2018 16:45<br>
<b>To:</b> ferret_users@xxxxxxxx<br>
<b>Subject:</b> [ferret_users] sampling point data from a 3D grid<br>
</font><br>
</div>
<div></div>
<div>
<div style="direction:ltr; font-family:Tahoma; color:#000000; font-size:10pt">Hello dear ferret user community,<br>
<br>
I see there is a great function &quot;samplexy&quot; for sampling point data from a 2D gridded field.<br>
<br>
After looking around in the documentation for a little while, I couldn't find an example showing how one might perform the same sampling from a 3D field. I understand that this might be more complicated because interpolation becomes tricky in 3 dimensions.<br>
<br>
Is there a similar function, or capability using a combination of functions, that allows the user to sample point data in 3D space?<br>
<br>
Let's say I have three 1D columns of data, each holding lon (x), lat (y) and depth (z) coordinates. Because these are 1D columns corresponding to every location that I have sampled, they are x*y*z long. Now I have a gridded data set A that is in 3D at different
 coordinates. I understand that we can easily retrieve data from A at x and y points at each z level using &quot;samplexy&quot;. Then I have a new data set, on a x*y by z grid, with data points that do not correspond to my x and y locations very usefully masked out.
 What I am finding difficult is to place this x*y by z dataset onto a x*y*z grid, which is equivalent to my 1D arrays of lon (x), lat (y) and depth (z).<br>
<br>
I have tried &quot;reshape&quot;, as per the example in the user guide documentation. This gives me my 1D column of x*y*z length, masked out at the right places. However, for some reason this command converts all the gridded data of A into zeros.<br>
<br>
Any help would be very much appreciated. I'm sure someone out there has tried this before.<br>
<br>
Pearse<br>
</div>
</div>
</div>
</div>


</td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00156" href="msg00156.html">[ferret_users] sampling point data from a 3D grid</a></strong>
<ul><li><em>From:</em> Pearse J. Buchanan</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00156.html">[ferret_users] sampling point data from a 3D grid</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00158.html">[ferret_users] d&#x3C1;/dz calculation using pyferret</a></strong>
</li>

</UL>
<center>[<a href="msg00156.html">Thread Prev</a>][<a href="msg00158.html">Thread Next</a>][<A HREF="threads.html#00157">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
