<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [ferret_users] problems with short data type -->
<!--X-From-R13: Oafyrl [naxr <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Tue, 18 Feb 2014 12:54:29 &#45;0800 -->
<!--X-Message-Id: 5303C876.1070902@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CAJo_tOJrWZYp4oqVc+9&#45;rDampXJ8=VF4bNqLVHsYnuFPcEKzyg@mail.gmail.com -->
<!--X-Reference: 528659F8.7080800@noaa.gov -->
<!--X-Reference: 5303B17C.10900@io&#45;warnemuende.de -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] problems with short data type</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00050.html">Thread Prev</a>][<a href="msg00052.html">Thread Next</a>][<A HREF="threads.html#00051">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] problems with short data type</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Martin Schmidt &lt;<a href="mailto:martin.schmidt@DOMAIN.HIDDEN">martin.schmidt@xxxxxxxxxxxxxxxxx</a>&gt;, <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] problems with short data type</strong></li>
<li><strong>From</strong>: <strong>Ansley Manke &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 18 Feb 2014 12:54:14 -0800</li>
<li>In-reply-to: &lt;<a href="msg00050.html">5303B17C.10900@io-warnemuende.de</a>&gt;</li>
<li>List-archive: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/">http://groups.google.com/a/noaa.gov/group/ferret_users/</a>&gt;</li>
<li>List-help: &lt;<a href="http://support.google.com/a/noaa.gov/bin/topic.py?topic=25838">http://support.google.com/a/noaa.gov/bin/topic.py?topic=25838</a>&gt;, &lt;<a href="mailto:ferret_users+help@noaa.gov">mailto:ferret_users+help@noaa.gov</a>&gt;</li>
<li>List-id: &lt;ferret_users.noaa.gov&gt;</li>
<li>List-post: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/post">http://groups.google.com/a/noaa.gov/group/ferret_users/post</a>&gt;, &lt;<a href="mailto:ferret_users@noaa.gov">mailto:ferret_users@noaa.gov</a>&gt;</li>
<li>List-unsubscribe: &lt;<a href="http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe">http://groups.google.com/a/noaa.gov/group/ferret_users/subscribe</a>&gt;, &lt;<a href="mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com">mailto:googlegroups-manage+809428289204+unsubscribe@googlegroups.com</a>&gt;</li>
<li>Mailing-list: list <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a>; contact <a href="mailto:ferret_users%2Bowners@DOMAIN.HIDDEN">ferret_users+owners@xxxxxxxx</a></li>
<li>References: &lt;CAJo_tOJrWZYp4oqVc+9-rDampXJ8=VF4bNqLVHsYnuFPcEKzyg@mail.gmail.com&gt; &lt;528659F8.7080800@noaa.gov&gt; &lt;<a href="msg00050.html">5303B17C.10900@io-warnemuende.de</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:24.0) Gecko/20100101 Thunderbird/24.3.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    Hi Martin,<br>
    That is not our intended behavior when writing data. What Ferret
    should do is to keep the original attributes and data types when
    writing a file variable, for instance using Ferret to make a
    subset.&nbsp; This is in fact what the most recent version of Ferret
    does.<br>
    <br>
    Here is the netCDF header for an example file:<br>
    <blockquote><tt>&gt; ncdump -h example_scale.nc </tt><br>
      <br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; short Elev(Ti, Yc, Xc) ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Elev:long_name = "Surface elevation" ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Elev:units = "meter" ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Elev:valid_range = -9., 9. ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Elev:_FillValue = -32768s ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Elev:missing_value = -32767s ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Elev:scale_factor = 0.000274674967954587 ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Elev:add_offset = 0. ;</tt><br>
    </blockquote>
    If I write a subset of this variable with Ferret:<br>
    <blockquote><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NOAA/PMEL TMAP</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FERRET v6.85&nbsp; </tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Linux 2.6.32-358.23.2.el6.x86_64 64-bit - 11/12/13</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 18-Feb-14 12:40&nbsp;&nbsp;&nbsp;&nbsp; </tt><br>
      <br>
      <tt>yes? use example_scale.nc </tt><br>
      <tt>yes? sh&nbsp; att elev</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp; attributes for dataset: ./example_scale.nc</tt><br>
      <tt>&nbsp;Elev.long_name = Surface elevation </tt><br>
      <tt>&nbsp;Elev.units = meter </tt><br>
      <tt>&nbsp;Elev.valid_range = -9, 9</tt><br>
      <tt>&nbsp;Elev._FillValue = -32768</tt><br>
      <tt>&nbsp;Elev.missing_value = -32767</tt><br>
      <tt>&nbsp;Elev.scale_factor = 0.000274675</tt><br>
      <tt>&nbsp;Elev.add_offset = 0</tt><br>
      <tt>yes? save/y=59/clobber/file=subset.nc elev</tt><br>
      <tt>&nbsp;LISTing to file subset.nc</tt><br>
    </blockquote>
    <br>
    Now here are the attributes<tt><br>
    </tt>
    <blockquote><tt>&gt; ncdump -h subset.nc </tt><br>
      <tt>netcdf subset {</tt><br>
      <tt>dimensions:</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; XC = 35 ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; YC59_59 = 1 ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bnds = 2 ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TI = UNLIMITED ; // (1 currently)</tt><br>
      <tt>variables:</tt><br>
      <tt>...</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; short ELEV(TI, YC59_59, XC) ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ELEV:missing_value = -32767s ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ELEV:_FillValue = -32768s ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ELEV:long_name = "Surface elevation" ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ELEV:units = "meter" ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ELEV:scale_factor = 0.000274674967954587 ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ELEV:add_offset = 0. ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ELEV:history = "From example_scale" ;</tt><br>
      <br>
      <tt>// global attributes:</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :history = "FERRET V6.85&nbsp;&nbsp; 18-Feb-14" ;</tt><br>
      <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :Conventions = "CF-1.0" ;</tt><br>
      <tt>}</tt></blockquote>
    <tt><br>
    </tt>In Ferret v6.842, one can ask for this behavior with the
    setting:<br>
    <blockquote><tt>set att/outtype=all </tt><tt>elev</tt><br>
    </blockquote>
    We unfortunately implemented the feature which writes data in their
    original data type, without writing these essential attributes as
    well. My apologies for the time you had to spend on this.<br>
    <br>
    Ansley<br>
    <br>
    <div class="moz-cite-prefix">On 2/18/2014 11:16 AM, Martin Schmidt
      wrote:<br>
    </div>
    <blockquote cite="" type="cite">Hi,
      <br>
      <br>
      processing ASCAT netcdf data I stumbled into a problem related to
      data accuracy and data formats.
      <br>
      <br>
      Some ASCAT data come in netcdf format, daily data with a time
      stamp. I want to combine them into a single file.
      <br>
      I use a script, reading the files with ferret and writing the data
      with "append". This worked well for older ferret versions
      <br>
      like 6.72 or earlier but does not with recent versions (6.842).
      <br>
      <br>
      The problem seems to be the following:
      <br>
      <br>
      In the original files data are stored with type "short" and a
      scale factor:
      <br>
      <br>
      short wind_speed(time, depth, latitude, longitude) ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wind_speed:long_name = "wind speed" ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wind_speed:units = "m/s" ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wind_speed:scale_factor = 0.01 ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wind_speed:add_offset = 0. ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wind_speed:valid_min = 0. ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wind_speed:valid_max = 6000. ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wind_speed:_FillValue = -32768s ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wind_speed:standard_name = "wind_speed" ;
      <br>
      <br>
      A typical wind speed value is 1010 corresponding to 10.1 m/s.
      ncdump shows integers like 1010 in the original files.
      <br>
      <br>
      Old ferret reads these data correctly and writes reals (floats):
      <br>
      <br>
      float WIND_SPEED(TIME, DEPTH, LATITUDE81_400, LONGITUDE481_840) ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WIND_SPEED:_FillValue = -327.68f ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WIND_SPEED:long_name = "wind speed" ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WIND_SPEED:units = "m/s" ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WIND_SPEED:history = "From dummy_2011" ;
      <br>
      <br>
      Checking with ncdump I see values like 10.1 in the output file -
      everything seems to be correct.
      <br>
      <br>
      But recent ferret writes shorts but now without a scale factor:
      <br>
      <br>
      short WIND_SPEED(TIME, DEPTH, LATITUDE81_400, LONGITUDE481_840) ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WIND_SPEED:_FillValue = -327s ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WIND_SPEED:long_name = "wind speed" ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WIND_SPEED:units = "m/s" ;
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WIND_SPEED:history = "From dummy_2011" ;
      <br>
      <br>
      Checking with ncdump I find integers like 10 in the output file,
      which means reduced accuracy. Also the
      <br>
      fill value is not correct any more.
      <br>
      <br>
      My questions:
      <br>
      - this happens without any warning and it took me several hours to
      find this out. Is this a desired feature? I could understand,
      <br>
      if the input format would be used for output, but what about the
      reduced accuracy. At least a warning would be fine.
      <br>
      <br>
      - how to find such dangerous traps and how to avoid them? ferret
      is great in just opening files and delivering data in their
      context
      <br>
      of dimensions and coordinates. It was one of the great advantages
      that no detailed file analysis is needed.
      <br>
      <br>
      So this leaves me a little bit helpless.
      <br>
      <br>
      Best,
      <br>
      Martin
      <br>
      <br>
    </blockquote>
    <br>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00050" href="msg00050.html">[ferret_users] problems with short data type</a></strong>
<ul><li><em>From:</em> Martin Schmidt</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00050.html">[ferret_users] problems with short data type</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00052.html">[ferret_users] FERRET compilation on Debian 7</a></strong>
</li>

</UL>
<center>[<a href="msg00050.html">Thread Prev</a>][<a href="msg00052.html">Thread Next</a>][<A HREF="threads.html#00051">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
