<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [ferret_users] daily climatology &#45; problem of February 29 -->
<!--X-From-R13: Brgre Emnob <fmnocrg83Ntznvy.pbz> -->
<!--X-Date: Wed, 27 Apr 2011 07:03:31 &#45;0700 -->
<!--X-Message-Id: BANLkTikXO3OKu6CpWCQ2ODU=c5AiMXR7EA@mail.gmail.com -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: BANLkTimvjm5WLeR0=W8ReWOou22238m6&#45;w@mail.gmail.com -->
<!--X-Reference: BANLkTim5uaZqqKxZi1yNvdA+Qw3Kr4shqA@mail.gmail.com -->
<!--X-Reference: 4DA88630.9070009@noaa.gov -->
<!--X-Derived: gifz2Lj6o12bC.gif -->
<!--X-Derived: gifa12IGRVjMq.gif -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] daily climatology - problem of February 29</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00267.html">Thread Prev</a>][<a href="msg00265.html">Thread Next</a>][<A HREF="threads.html#00320">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] daily climatology - problem of February 29</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Steve Hankin &lt;<a href="mailto:Steven.C.Hankin@DOMAIN.HIDDEN">Steven.C.Hankin@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] daily climatology - problem of February 29</strong></li>
<li><strong>From</strong>: <strong>Peter Szabo &lt;<a href="mailto:szabpet83@DOMAIN.HIDDEN">szabpet83@xxxxxxxxx</a>&gt;</strong></li>
<li>Date: Wed, 27 Apr 2011 16:03:26 +0200</li>
<li>Cc: ferret &lt;<a href="mailto:oar.pmel.ferret_users@DOMAIN.HIDDEN">oar.pmel.ferret_users@xxxxxxxx</a>&gt;</li>
<li>Dkim-signature: v=1; a=rsa-sha256; c=relaxed/relaxed;        d=gmail.com; s=gamma;        h=domainkey-signature:mime-version:in-reply-to:references:date         :message-id:subject:from:to:cc:content-type; bh=ytFm1TwV60xM/hnZaXl6sBvVrlvHLP8eIzlJuBzQk+E=; b=hv4AwbKeo4Mlf/XCH/LiLUEa7ImacxaqOx4ouy1hM/dnQXzi3f+mQJDbRpb3EylARQ NHvbnE4pm/xrrjL/735Unjtmlzt7qYvoe66syEFmYX3aJQ6YnNdydvsev41Ahl7WsX6/ hQ1T7GDm5cbETJveU5ZHFNcA3iFCeplC/Y/Gs=</li>
<li>Domainkey-signature: a=rsa-sha1; c=nofws;        d=gmail.com; s=gamma; h=mime-version:in-reply-to:references:date:message-id:subject:from:to :cc:content-type; b=DOWQKjzksK7fmc8mHCAV5E/1gVMoHH0flI8KQpGpGLnEfpNkJDONFMjsjVpFlFwzWS hEY6MwP3dXEAfOTAIcdx0yJVARSDCedNBkg4GphCO00v/050WE4BpdpczBRME3WdVa/s JXBFopzenI7yuPkhuSXvVbcg5CCrlf2n1Ah+4=</li>
<li>In-reply-to: &lt;<a href="mailto:4DA88630.9070009@DOMAIN.HIDDEN">4DA88630.9070009@xxxxxxxx</a>&gt;</li>
<li>References: &lt;<a href="mailto:BANLkTimvjm5WLeR0%3DW8ReWOou22238m6-w@DOMAIN.HIDDEN">BANLkTimvjm5WLeR0=W8ReWOou22238m6-w@xxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:BANLkTim5uaZqqKxZi1yNvdA%2BQw3Kr4shqA@DOMAIN.HIDDEN">BANLkTim5uaZqqKxZi1yNvdA+Qw3Kr4shqA@xxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:4DA88630.9070009@DOMAIN.HIDDEN">4DA88630.9070009@xxxxxxxx</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
Hi Steven,<div><br></div><div>thanks. It worked for me, the logic is clear, though, when I interpolated the climatology onto the real data set, it slightly changed the values in no-leap years.&#xFFFD;</div><div><br></div><div>I attach a figure (leap_noleap.gif) when I simply plot the climatology over a leap (upper plot) and no-leap (lower plot) year. We can recognize the one-day slip towards the beginning of the year (Feb 29. equals to March 1.), so, the problem is this one-day delay and an empty box (error) for Dec 31. every 4 years.<br>
If I apply your suggested linear interpolation, I get a quarter-day delay&#xFFFD;(upper plot of lin1964_lin1961.gif)&#xFFFD;for leap-years compared to leap years without an interpolation, while during no-leap years (like 1961) results are a bit different than the original daily climatology defined by &#xFFFD;def axis/t=0:365.2425/edges/npoints=365/t0=1-JAN-0001/units=days/modulo tdaily</div>
<div><br></div><div>Hope it was not that confusing,</div><div><br></div><div>thanks, Peter</div><div><br><div class="gmail_quote">On Fri, Apr 15, 2011 at 7:53 PM, Steve Hankin <span dir="ltr">&lt;<a rel="nofollow" href="mailto:Steven.C.Hankin@xxxxxxxx">Steven.C.Hankin@xxxxxxxx</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex;">

  
    
  
  <div text="#000000" bgcolor="#ffffff">
    Hi Peter,<br>
    <br>
    To get your calculation to complete without error you need only
    regrid your 1 year (365.2425 day long) climatology back onto the
    Gregorian calendar.&#xFFFD; Simply replace the definition <br><div class="im">
    &#xFFFD;&#xFFFD;&#xFFFD; let t2m_anom=t2m-t2m_clim<br></div>
    with<br>
    &#xFFFD;&#xFFFD;&#xFFFD; <b>let t2m_anom=t2m-t2m_clim[gt=tm2@LIN]</b> <br>
    Note that @LIN is the default ... shown here just to emphasize that
    linear interpolation is used.<br>
    <br>
    Here&#39;s the background.&#xFFFD; A daily climatology is not a clean problem
    no matter how you slice it.&#xFFFD; I suppose your intent for a &quot;daily
    climatology of 366 days&quot; might be that the final result contains a
    Feb. 29 date, which is computed from 1/4 as many input points as all
    other days. &#xFFFD; Ferret will not readily calculate things this way
    (though I imagine it could be forced to do so with sufficient
    torture applied&#xFFFD;<span><span> ;-) </span></span>).&#xFFFD;&#xFFFD;
    For better or worse, Ferret&#39;s regridding algorithm between calendar
    types doesn&#39;t regard the proclamations of Pope Gregory as
    scientifically based.&#xFFFD; (The logic being that in a leap year the
    earth does not actually take an additional day to revolve around the
    sun.) &#xFFFD; Instead they regard <u>each individual year (1961, 1962,
      ...) as representing the same time interval, regardless of how the
      calendar may divide it into days</u>.&#xFFFD;&#xFFFD; I offer this just as
    background.&#xFFFD;&#xFFFD; (It can play havoc with daily (24 hour)
    climatologies!)<br>
    <br>
    Here is a script to illustrate.&#xFFFD; (Note:&#xFFFD; For this email list it is
    helpful to pose questions and solutions that do not depend on access
    to particular files.)<br>
    <blockquote><tt>define axis/t=1-jan-1961:31-dec-1990:1/unit=days
        tlong<br>
        let myvar = RANDU(T[gt=tlong])&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD; ! a dummy data variable<div class="im"><br>
        def
        axis/t=0:365.2425/edges/npoints=365/t0=1-JAN-0001/units=days/modulo
        daily1<br></div>
        let myvar_clim=myvar[gt=daily1@mod]<br>
        let myvar_anom=myvar-myvar_clim[gt=tlong]</tt><br>
      <br>
      <tt>set region/t=1-jan-1980:31-dec-1980<br>
        set view upper<br>
        plot myvar, myvar_clim<br>
        set view lower<br>
        plot myvar_anom</tt><br>
    </blockquote><div><div></div><div class="h5">
    <img src="" alt=""><br>
    <br>
    On 4/15/2011 3:07 AM, Peter Szabo wrote:
    <blockquote type="cite">
      <div>Hey,</div>
      <div><br>
      </div>
      <div>I would like to get daily climatology for 366 days (including
        Feb 29), then final goal is getting daily anomalies through
        multiple years (also containing Feb 29s). It works for 365-day
        climatology.</div>
      Sorry for the re-post.
      <div><br>
      </div>
      <div>Thanks for the help, Peter<br>
        <div><br>
          <br>
          <div class="gmail_quote">On Wed, Apr 13, 2011 at 10:56 AM,
            Peter Szabo <span dir="ltr">&lt;<a rel="nofollow" href="mailto:szabpet83@xxxxxxxxx" target="_blank">szabpet83@xxxxxxxxx</a>&gt;</span>
            wrote:<br>
            <blockquote class="gmail_quote" style="margin:0pt 0pt 0pt 0.8ex;border-left:1px solid rgb(204, 204, 204);padding-left:1ex">Dear Users,
              <div><br>
              </div>
              <div>I try to count anomaly from daily climatology through
                multiple years.</div>
              <div>It is a 30-year data set with a normal Gregorian
                calendar axis:</div>
              <div><br>
              </div>
              <div>
                <div>yes? sh axis treal</div>
                <div>&#xFFFD;name &#xFFFD; &#xFFFD; &#xFFFD; axis &#xFFFD; &#xFFFD; &#xFFFD; &#xFFFD; &#xFFFD; &#xFFFD; &#xFFFD;# pts &#xFFFD; start &#xFFFD; &#xFFFD; &#xFFFD; &#xFFFD;
                  &#xFFFD; &#xFFFD; &#xFFFD; &#xFFFD;end</div>
                <div>&#xFFFD;TREAL &#xFFFD; &#xFFFD; TIME &#xFFFD; &#xFFFD; &#xFFFD; &#xFFFD; &#xFFFD; &#xFFFD; 10957 r &#xFFFD; 01-JAN-1961
                  12:00 &#xFFFD; &#xFFFD;31-DEC-1990 12:00</div>
                <div>T0 = 01-JAN-1961 00:00:00</div>
              </div>
              <div><br>
              </div>
              <div>
                I define the modulo time axis, then I count daily
                climatology, finally I extract it from my time series:</div>
              <div><br>
              </div>
              <div>def
                axis/t=0:365.2425/edges/npoints=365/t0=1-JAN-0001/units=days/modulo
                daily1</div>
              <div>let t2m_clim=t2m[gt=daily1@mod]</div>
              <div>let t2m_anom=t2m-t2m_clim</div>
              <div><br>
              </div>
              <div>The problem is that it does not take into account
                February 29s, and thus it gives an error:</div>
              <div>
                <div>&#xFFFD;**ERROR: inconsistent sizes of data regions: T
                  axis</div>
                <div>
                  &#xFFFD;&#xFFFD; &#xFFFD; &#xFFFD; &#xFFFD; &#xFFFD;T2M61A has 10950 points (L=00001:10950)</div>
                <div>&#xFFFD;&#xFFFD; &#xFFFD; &#xFFFD; &#xFFFD; &#xFFFD;_expression_ has 10957 points
                  (L=00001:10957)</div>
              </div>
              <div><br>
              </div>
              <div>If I reduce my t2m to 10950 days (in order to
                simulate &quot;skipping&quot; february 29s), It does the
                extraction, though, some tiny bias might occur as a
                consequent of this.</div>
              <div>It raises some further questions:</div>
              <div><br>
              </div>
              <div>Why do not the following two take feb 29s into
                account? The daily2 is almost the same as daily1.
                Furthermore, the daily3 axis is giving a totally
                different result.</div>
              <div>def
                axis/t=0:365.2425/edges/npoints=366/t0=1-JAN-0001/units=days/modulo
                daily2</div>
              <div>
                <div>def
                  axis/t=0:365.2425:1/edges/t0=1-JAN-0001/units=days/modulo
                  daily3</div>
                <div><br>
                </div>
                <div>If I define my modulo axis to skip feb 29, it gives
                  obviously bad results.</div>
                <div>def
                  axis/t=0:365/edges/npoints=365/t0=1-JAN-0001/units=days/modulo
                  daily4</div>
              </div>
              <div><br>
              </div>
              <div>I enclose a plot with the 4 daily climatological
                axes.</div>
              <div>Which one is correct? Why is there huge difference
                between the axes? How can I make a daily climatology
                which takes into account February 29?</div>
              <div><br>
              </div>
              <div>Thanks in advance,</div>
              <div><br>
              </div>
              <font color="#888888">
                <div>Peter Szabo</div>
              </font></blockquote>
          </div>
          <br>
        </div>
      </div>
    </blockquote>
  </div></div></div>

</blockquote></div><br></div>
<p><strong>Attachment:
<a href="gifz2Lj6o12bC.gif" ><tt>leap_noleap.gif</tt></a></strong><br>
<em>Description:</em> GIF image</p>
<p><strong>Attachment:
<a href="gifa12IGRVjMq.gif" ><tt>lin1964_lin1961.gif</tt></a></strong><br>
<em>Description:</em> GIF image</p>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00263" href="msg00263.html">[ferret_users] daily climatology - problem of February 29</a></strong>
<ul><li><em>From:</em> Peter Szabo</li></ul></li>
<li><strong><a name="00266" href="msg00266.html">Re: [ferret_users] daily climatology - problem of February 29</a></strong>
<ul><li><em>From:</em> Peter Szabo</li></ul></li>
<li><strong><a name="00267" href="msg00267.html">Re: [ferret_users] daily climatology - problem of February 29</a></strong>
<ul><li><em>From:</em> Steve Hankin</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00267.html">Re: [ferret_users] daily climatology - problem of February 29</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00265.html">[ferret_users] defining a var consisting of two vars on different time axes</a></strong>
</li>

</UL>
<center>[<a href="msg00267.html">Thread Prev</a>][<a href="msg00265.html">Thread Next</a>][<A HREF="threads.html#00320">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
