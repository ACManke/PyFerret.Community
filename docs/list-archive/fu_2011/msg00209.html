<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [ferret_users] plotting and interpolating data given on curvilinear grids -->
<!--X-From-R13: [negva Epuzvqg <znegva.fpuzvqgNvb&#45;jnearzhraqr.qr> -->
<!--X-Date: Mon, 21 Mar 2011 10:25:59 &#45;0700 -->
<!--X-Message-Id: 4D878A19.40702@io&#45;warnemuende.de -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 4D558413.7080709@noaa.gov -->
<!--X-Reference: 4D592AE2.4070100@io&#45;warnemuende.de -->
<!--X-Reference: 4D596F7A.2070609@noaa.gov -->
<!--X-Reference: 4D5EA165.6050501@io&#45;warnemuende.de -->
<!--X-Reference: 4D5EC739.9030703@noaa.gov -->
<!--X-Reference: BAY161&#45;w1283EE09FB9CECEF7729D8B5B50@phx.gbl -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] plotting and interpolating data given on curvilinear grids</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00206.html">Thread Prev</a>][<a href="msg00215.html">Thread Next</a>][<A HREF="threads.html#00209">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] plotting and interpolating data given on curvilinear grids</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>PaulaOCN Nunes &lt;<a href="mailto:oceanografa@DOMAIN.HIDDEN">oceanografa@xxxxxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] plotting and interpolating data given on curvilinear grids</strong></li>
<li><strong>From</strong>: <strong>Martin Schmidt &lt;<a href="mailto:martin.schmidt@DOMAIN.HIDDEN">martin.schmidt@xxxxxxxxxxxxxxxxx</a>&gt;</strong></li>
<li>Date: Mon, 21 Mar 2011 18:25:45 +0100</li>
<li>Cc: <a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>, <a href="mailto:oar.pmel.ferret_users@DOMAIN.HIDDEN">oar.pmel.ferret_users@xxxxxxxx</a></li>
<li>In-reply-to: &lt;<a href="mailto:BAY161-w1283EE09FB9CECEF7729D8B5B50@DOMAIN.HIDDEN">BAY161-w1283EE09FB9CECEF7729D8B5B50@xxxxxxx</a>&gt;</li>
<li>Organization: IOW</li>
<li>References: &lt;<a href="mailto:4D558413.7080709@DOMAIN.HIDDEN">4D558413.7080709@xxxxxxxx</a>&gt; &lt;<a href="mailto:4D592AE2.4070100@DOMAIN.HIDDEN">4D592AE2.4070100@xxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:4D596F7A.2070609@DOMAIN.HIDDEN">4D596F7A.2070609@xxxxxxxx</a>&gt; &lt;<a href="mailto:4D5EA165.6050501@DOMAIN.HIDDEN">4D5EA165.6050501@xxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:4D5EC739.9030703@DOMAIN.HIDDEN">4D5EC739.9030703@xxxxxxxx</a>&gt; &lt;<a href="mailto:BAY161-w1283EE09FB9CECEF7729D8B5B50@DOMAIN.HIDDEN">BAY161-w1283EE09FB9CECEF7729D8B5B50@xxxxxxx</a>&gt;</li>
<li>Reply-to: <a href="mailto:martin.schmidt@DOMAIN.HIDDEN">martin.schmidt@xxxxxxxxxxxxxxxxx</a></li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
<li>User-agent: Mozilla/5.0 (X11; U; AIX 5.3; en-US; rv:1.9.1.11) Gecko/20100701 SeaMonkey/2.0.6</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi Paula,

</pre><tt>I gave it up to put the track data in daily files. I have a script ready 
</tt><tt>that does this for me. It is based on curv_to_rect_map and works.
</tt><tt>However, I confine my data to a smaller region (south Atlantic). 
</tt><tt>Otherwise it reveals as too slow. I moved to a fast machine that
</tt><pre style="margin: 0em;">
serves as frontend of a supercomputer. Otherwise - as said - really slow.
</pre><tt>I also had a short look into the code. Is far as I see the method does 
</tt><tt>something like a nearest neighbour search for each grid
</tt><tt>point of the rectangular grid and searches over all grid points of the 
</tt><tt>curvilinear grid. There are some pieces of code where
</tt><tt>I believe that the index order should be changed for speed up, but this 
</tt><tt>is not in the central part of the code and should
</tt><pre style="margin: 0em;">
not really matter.

</pre><tt>Finally I was not convinced, that the interpolation was correct 
</tt><tt>everywhere and did not find a way for a good and final check.
</tt><tt>So I gave up and wrote a little fortran code to read the swath data. The 
</tt><tt>method used here is more basic - I do not interpolate but put the track 
</tt><tt>data simply into
</tt><tt>boxes on a regular grid. However, the swath width of the ASCAT data is 
</tt><tt>much smaller than that of QuikSCAT and the final
</tt><tt>product reveals a lot of jumps from overlapping tracks too distant in 
</tt><tt>time. Playing around with the interpolation and averaging method
</tt><tt>does not really help. So a more sophisticated gridding method is 
</tt><tt>definitely required.
</tt><pre style="margin: 0em;">

</pre><tt>Fortunately, such data are available now from IFREMER. Please have a 
</tt><tt>look at
</tt><pre style="margin: 0em;">

<a  rel="nofollow" href="ftp://ftp.ifremer.fr/ifremer/cersat/products/gridded/MWF/L3/ASCAT/Daily/Netcdf/">ftp://ftp.ifremer.fr/ifremer/cersat/products/gridded/MWF/L3/ASCAT/Daily/Netcdf/</a>

I think this is was you need!

Good luck,
Martin


PaulaOCN Nunes wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi Martin;

</pre><tt>I work with ASCAT files as well, and I use the command 
</tt><tt>&quot;scat2gridgauss_xy&quot;  to plot over all the passes in the end of a day.
</tt><tt>Not sure if I'm doing right, but comparing with the shading output it 
</tt><tt>looks similar (also the &quot;min&quot; and &quot;max&quot; values),  I attached an 
</tt><tt>example of the shade picture for the &quot;scat2gridgauss_xy&quot; output 
</tt><tt>(&quot;shadeWIND_SPEEDscat2grid.gif&quot;) and for &quot; shade WIND_SPEED, lon,lat&quot; 
</tt><tt>(&quot;shadeWIND_SPEED.gif&quot;).
</tt><tt>Your question about the shade command got me curious, and for sure, I 
</tt><tt>tried to do the same and I still don't understand, if there isn't 
</tt><tt>interpolation, why it plots in areas between the points of LON/LAT 
</tt><tt>(&quot;plotLONLAT.gif&quot;) .
</tt><tt>Sorry Ansley, would you explain better this &quot;checkerboard&quot; variable? I 
</tt><tt>reproduced it but could not understand...besides, it uses the &quot;shade&quot; 
</tt><tt>command as well (shade checkerboard, lon, lat), equal  &quot;shade 
</tt><tt>WIND_SPEED, lon,lat&quot;.
</tt><tt>By the end, I had a problem when I tried to do the same as Martin, 
</tt><tt>with the command &quot;curv_to_rect_map&quot;, Ferret stops; don't show any 
</tt><tt>error and remains in the in blank display.
</tt><tt>I first tried axis with 12.5 km ( ASCAT resolution) and after 1&#xB0;, but 
</tt><tt>ferrets locks anyway...does anyone have a clue way I'm not able to do it?
</tt><pre style="margin: 0em;">

OBS: I use FERRET v6.401
         Linux(g77) 2.6.9-89.ELsmp - 12/09/09

Above these tests commands:

*set memo/size=1000
use ascat_20110316_011801_metopa_22850_eps_o_125_1019_ovw.l2.nc
shade WIND_SPEED,LON,LAT; go land_hires
frame/file=&quot;shadeWIND_SPEED.gif&quot;

plot/vs lon,lat ; go land_hires
frame/file=&quot;plotLONLAT.gif&quot;

define axis/x=1:267238:1 tripaxis
let tripaGRID=X[gx=tripaxis]

define axis/x=0:360:0.1126/UNIT=degrees xaxis
define axis/y=-90:90:0.1126/UNIT=degrees yaxis

let uASCAT=sin(WIND_DIR*(3.1416/180))*WIND_SPEED
let vASCAT=cos(WIND_DIR*(3.1416/180))*WIND_SPEED

let lon2=reshape(lon,tripaGRID)
let lat2=reshape(lat,tripaGRID)

</pre><tt>let 
</tt><tt>uASCATgrau=scat2gridgauss_xy(lon2,lat2,uASCAT,x[gx=xaxis],y[gy=yaxis],0.2252, 
</tt><tt>0.2252, 2, 0)
</tt><tt>let 
</tt><tt>vASCATgrau=scat2gridgauss_xy(lon2,lat2,vASCAT,x[gx=xaxis],y[gy=yaxis],0.2252, 
</tt><tt>0.2252, 2, 0)
</tt><pre style="margin: 0em;">
let mag=(uASCATgrau^2+vASCATgrau^2)^0.5

shade/level=(0,20,1) mag; go land_hires
frame/file=&quot;shadeWIND_SPEEDscat2grid.gif&quot;

plot/vs lon,lat
let checkerboard = 0*wind_speed+mod(i+j,2)
shade/pal=greyscale/lev=(0,2,1) checkerboard, lon, lat

let lonlatout=y[gy=yaxis]+x[gx=xaxis]
let lonin=lon;let latin=lat
let map=curv_to_rect_map(lonin,latin,lonlatout,1)
shade map
frame/file=&quot;shadeMAP.gif&quot;

*Greetings,
Paula Lamosa Nunes



------------------------------------------------------------------------
Date: Fri, 18 Feb 2011 11:23:37 -0800
From: ansley.b.manke@xxxxxxxx
</pre><tt>Subject: Re: [ferret_users] plotting and interpolating data given on 
</tt><tt>curvilinear grids
</tt><pre style="margin: 0em;">
To: martin.schmidt@xxxxxxxxxxxxxxxxx
CC: oar.pmel.ferret_users@xxxxxxxx

Hi Martin,
</pre><tt>There is a newer interpolation method in the pipeline, but not yet 
</tt><tt>available. The libcf library being developed by Unidata and a group of 
</tt><tt>collaborators will give us faster tools for interpolating between 
</tt><tt>grids.  We are paying close attention to this development and will 
</tt><tt>implement it in Ferret as soon as it's ready. When there's a beta 
</tt><tt>version of the interpolation code, and other capabilities available, 
</tt><tt>we will add it as an option for people to experiment with. Here's the 
</tt><tt>link to the information about libcf:
</tt><pre style="margin: 0em;">
<a  rel="nofollow" href="http://www.unidata.ucar.edu/software/libcf/">http://www.unidata.ucar.edu/software/libcf/</a>

</pre><tt>With the existing tools in Ferret, if all your data has the same 
</tt><tt>curvilienar grid and are interpolating to the same rectilinear grid, 
</tt><tt>you can re-use the map function. This speeds up the entire process 
</tt><tt>quite a lot, and it's the reason we have two functions; one to compute 
</tt><tt>the map and the other to apply it.
</tt><pre style="margin: 0em;">

</pre><tt>The SHADE command only fills each grid box with the corresponding 
</tt><tt>color. It's not doing any interpolation. The curvilinear version of 
</tt><tt>the shade command can use curvlinear coordinate variables that define 
</tt><tt>either the edges of the grid cells or their centers.  Here it looks 
</tt><tt>like the grid defines the centers - else their size would be one 
</tt><tt>larger than the grid size of the data fields.
</tt><pre style="margin: 0em;">

yes? use &quot;ascat_20100111_005400_metopa_16755_eps_o_125_1018_ovw.l2.nc&quot;
yes? sh dat
     currently SET data sets:
</pre><tt>    1&gt; ./ascat_20100111_005400_metopa_16755_eps_o_125_1018_ovw.l2.nc  
</tt><tt>(default)
</tt><tt> name     title                             I         J         
</tt><tt>K         L
</tt><tt> TIME     time                             1:82      1:3259    
</tt><tt>...       ...
</tt><tt> LAT      latitude                         1:82      1:3259    
</tt><tt>...       ...
</tt><tt> LON      longitude                        1:82      1:3259    
</tt><tt>...       ...
</tt><pre style="margin: 0em;">
 WVC_INDEX
</pre><tt>          cross track wind vector cell nu  1:82      1:3259    
</tt><tt>...       ...
</tt><pre style="margin: 0em;">
 MODEL_SPEED
</pre><tt>          model wind speed at 10 m         1:82      1:3259    
</tt><tt>...       ...
</tt><pre style="margin: 0em;">
 MODEL_DIR
</pre><tt>          model wind direction at 10 m     1:82      1:3259    
</tt><tt>...       ...
</tt><tt> ICE_PROB ice probability                  1:82      1:3259    
</tt><tt>...       ...
</tt><tt> ICE_AGE  ice age (a-parameter)            1:82      1:3259    
</tt><tt>...       ...
</tt><pre style="margin: 0em;">
 WVC_QUALITY_FLAG
</pre><tt>          wind vector cell quality         1:82      1:3259    
</tt><tt>...       ...
</tt><pre style="margin: 0em;">
 WIND_SPEED
</pre><tt>          wind speed at 10 m               1:82      1:3259    
</tt><tt>...       ...
</tt><tt> WIND_DIR wind direction at 10 m           1:82      1:3259    
</tt><tt>...       ...
</tt><pre style="margin: 0em;">
 BS_DISTANCE
</pre><tt>          backscatter distance             1:82      1:3259    
</tt><tt>...       ...
</tt><pre style="margin: 0em;">

</pre><tt>A nice way to visualize a grid is to define a &quot;checkerboard&quot; variable, 
</tt><tt>which alternates 1 and zero over the grid, based on the variable we're 
</tt><tt>looking at.
</tt><pre style="margin: 0em;">

yes? let checkerboard = 0*wind_speed+mod(i+j,2)
</pre><tt>yes? shade/hlim=50e:150e/vlim=-80:0/pal=greyscale/lev=(0,2,1) 
</tt><tt>checkerboard, lon, lat
</tt><pre style="margin: 0em;">



</pre><tt>So I think what looks in your shade.gif image like data smeared across 
</tt><tt>the middle of this swath is really just the way the shape of the cells 
</tt><tt>changes. The question is why the regridded data has a gap in that 
</tt><tt>area. There should be many points within the 1-degree radius that 
</tt><tt>you've chosen, to use in the interpolation. I don't understand that, 
</tt><tt>but will try to look into it.
</tt><pre style="margin: 0em;">

Ansley


On 2/18/2011 8:42 AM, Martin Schmidt wrote:

    Hi Ferreters,

    I am trying to use ASCAT data downloaded from

    <a  rel="nofollow" href="ftp://podaac.jpl.nasa.gov/pub/ocean_wind/ascat/preview/L2/12km/">ftp://podaac.jpl.nasa.gov/pub/ocean_wind/ascat/preview/L2/12km/</a>

    The files are netcdf files in curvilinear form, lat, lon and data
    are defined on a common abstract (x,y) grid.
    It does not have a geophysical meaning.

    Ferret should be able to deal with such data. Indeed

    use ascat_20100111_005400_metopa_16755_eps_o_125_1018_ovw.l2.nc
    shade/d=1 WIND_SPEED, lon,lat; frame /file=shade.gif

    works and gives figure shade.gif.It does not look really bad.

    Now I want to put the data on a regular grid in geographic
    coordinates. The GFDL routine curv_to_rect_map
    should be fine.
    yes? define axis/x=0:360:1/modulo/units=degrees xax
    yes? def axis/y=-85:85:1/units=degrees yax
    yes? let lonlatout = y[gy=yax] + x[gx=xax]
    yes? let lonin = lon[d=1]
    yes? let latin = lat[d=1]
    yes? let map = curv_to_rect_map ( lonin,latin,lonlatout,1)
    yes? save/clobber/file=curv_map.nc  map
    (1 degree resolution)

    After some coffee:

    yes? cancel var/all
    yes? use curv_map.nc
    yes? let wo=curv_to_rect(wind_SPEED[d=1], map[d=2])
    yes? shade wo; frame /file=curv_to_rect.gif

    Both figures are in the attachment. The results have something to
    do with each other but they are also pretty different.

    So my question:
    I do not really believe in the figure shade.gif. The reason is,
    that I may plot (lon,lat) pairs into
    the figure (plot/vs/ov lon,lat. In shade.gif there remain broad
    bands of coloured areas, in curv_to_rect.gif most data are covered
    by the symbols.
    So I guess, that the shade command implies some inappropriate
    interpolation.
    Does anyone have experience with plotting and processing such
    curviliear data?

    It is great to have the interpolation tool curv_to_rect. But is
    there a chance to optimize the code
    for a speed up of the curv_to_rect_map routine? I would like to
    process years of data on a finer grid and it is very slow with 1
    degree resolution.
    Unfortunately the weights are changing for every file.

    Is there another and faster way to do this with ferret?

    Greetings,
    Martin Schmidt


</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00096" href="msg00096.html">[ferret_users] Announcing Ferret v6.6.7, a bug-fix release</a></strong>
<ul><li><em>From:</em> Ansley Manke</li></ul></li>
<li><strong><a name="00097" href="msg00097.html">Re: [ferret_users] Announcing Ferret v6.6.7, a bug-fix release</a></strong>
<ul><li><em>From:</em> Martin Schmidt</li></ul></li>
<li><strong><a name="00098" href="msg00098.html">Re: [ferret_users] Announcing Ferret v6.6.7, a bug-fix release</a></strong>
<ul><li><em>From:</em> Ansley Manke</li></ul></li>
<li><strong><a name="00119" href="msg00119.html">[ferret_users] plotting and interpolating data given on curvilinear grids</a></strong>
<ul><li><em>From:</em> Martin Schmidt</li></ul></li>
<li><strong><a name="00120" href="msg00120.html">Re: [ferret_users] plotting and interpolating data given on curvilinear grids</a></strong>
<ul><li><em>From:</em> Ansley Manke</li></ul></li>
<li><strong><a name="00206" href="msg00206.html">RE: [ferret_users] plotting and interpolating data given on curvilinear grids</a></strong>
<ul><li><em>From:</em> PaulaOCN Nunes</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00206.html">RE: [ferret_users] plotting and interpolating data given on curvilinear grids</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00215.html">[ferret_users] Jason Images</a></strong>
</li>

</UL>
<center>[<a href="msg00206.html">Thread Prev</a>][<a href="msg00215.html">Thread Next</a>][<A HREF="threads.html#00209">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
