<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [ferret_users] Jason Images -->
<!--X-From-R13: "Bnhyb P. Ayvirven" <cobNvcvzne.cg> -->
<!--X-Date: Tue, 22 Mar 2011 04:37:53 &#45;0700 -->
<!--X-Message-Id: 1300794090.10957.52.camel@oo -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: 4D558413.7080709@noaa.gov -->
<!--X-Reference: 4D592AE2.4070100@io&#45;warnemuende.de -->
<!--X-Reference: 4D596F7A.2070609@noaa.gov -->
<!--X-Reference: 4D5EA165.6050501@io&#45;warnemuende.de -->
<!--X-Reference: 4D5EC739.9030703@noaa.gov -->
<!--X-Reference: BAY161&#45;w1283EE09FB9CECEF7729D8B5B50@phx.gbl -->
<!--X-Reference: BAY161&#45;w2637E9F7C8B0E3B61CF103B5B50@phx.gbl -->
<!--X-Derived: cdf8HNZaST2TI.cdf -->
<!--X-Derived: jpg5ux7cEjNbM.jpg -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Jason Images</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00217.html">Thread Prev</a>][<a href="msg00223.html">Thread Next</a>][<A HREF="threads.html#00219">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Jason Images</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>PaulaOCN Nunes &lt;<a href="mailto:oceanografa@DOMAIN.HIDDEN">oceanografa@xxxxxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Jason Images</strong></li>
<li><strong>From</strong>: <strong>&quot;Paulo B. Oliveira&quot; &lt;<a href="mailto:pbo@DOMAIN.HIDDEN">pbo@xxxxxxxxx</a>&gt;</strong></li>
<li>Date: Tue, 22 Mar 2011 11:41:30 +0000</li>
<li>Cc: <a href="mailto:oar.pmel.ferret_users@DOMAIN.HIDDEN">oar.pmel.ferret_users@xxxxxxxx</a></li>
<li>In-reply-to: &lt;<a href="mailto:BAY161-w2637E9F7C8B0E3B61CF103B5B50@DOMAIN.HIDDEN">BAY161-w2637E9F7C8B0E3B61CF103B5B50@xxxxxxx</a>&gt;</li>
<li>References: &lt;<a href="mailto:4D558413.7080709@DOMAIN.HIDDEN">4D558413.7080709@xxxxxxxx</a>&gt; &lt;<a href="mailto:4D592AE2.4070100@DOMAIN.HIDDEN">4D592AE2.4070100@xxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:4D596F7A.2070609@DOMAIN.HIDDEN">4D596F7A.2070609@xxxxxxxx</a>&gt; &lt;<a href="mailto:4D5EA165.6050501@DOMAIN.HIDDEN">4D5EA165.6050501@xxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:4D5EC739.9030703@DOMAIN.HIDDEN">4D5EC739.9030703@xxxxxxxx</a>&gt; &lt;<a href="mailto:BAY161-w1283EE09FB9CECEF7729D8B5B50@DOMAIN.HIDDEN">BAY161-w1283EE09FB9CECEF7729D8B5B50@xxxxxxx</a>&gt; &lt;<a href="mailto:BAY161-w2637E9F7C8B0E3B61CF103B5B50@DOMAIN.HIDDEN">BAY161-w2637E9F7C8B0E3B61CF103B5B50@xxxxxxx</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Hi Paula,

The function RESHAPE allows you to skip the step of creating an
intermediate file to build triples. 

You can save intermediate results so that you don't need to have all
files open at the same time.

The attached script should do what you're looking for. I've written a
loop to generate a sequence of LON data but you should be able to adapt
it easily. 

Bom trabalho!

Paulo B. Oliveira
----------------------------------------------------------------------


On Mon, 2011-03-21 at 20:49 +0000, PaulaOCN Nunes wrote:
&gt; 
&gt; Hello Ferret users;
&gt; 
&gt; I attached an example of a netcdf Jason file which I'm working on
&gt; (&quot;JA1_IPR_2PcP334_001_20110125_040633_20110125_050240.nc&quot;)
&gt; I'm interested in the sea surface height anomaly (SSHA) and their
&gt; coordinates (lat, lon), but the file comes with all the data in the
&gt; time axis 
&gt; (1 pair of coordinates and a measure of SSHA for each scan of the
&gt; satellite). Here goes the display of the data:
&gt; 
&gt;     1&gt; ./JA1_IPR_2PcP334_001_20110125_040633_20110125_050240.nc
&gt; (default)
&gt;  name     title                             I         J         K
&gt; L
&gt;  LAT      latitude                         ...       ...       ...
&gt; 1:2350
&gt;  LON      longitude                        ...       ...       ...
&gt; 1:2350
&gt;  SSHA     sea surface height anomaly       ...       ...       ...
&gt; 1:2350, etc
&gt; 
&gt; I realize I need to regrid it to the &quot;I&quot; and &quot;J&quot; axis to be able to
&gt; work with it, then, I first tried to regrid the &quot;lat&quot; variable to the
&gt; &quot;I&quot; axis:
&gt; 
&gt; define axis/x=1:2350:1 iaxis
&gt; define grid/x=iaxis gridCOL
&gt; let lat2=lat[g=gridCOL]
&gt; 
&gt; But it didn't show any difference on the grid ferret's display:
&gt; 
&gt; sh grid lat
&gt;     GRID GSF1
&gt;  name       axis              # pts   start                end
&gt;  normal    X
&gt;  normal    Y
&gt;  normal    Z
&gt;  TIME      TIME              2350 i   25-JAN-2011 04:06    25-JAN-2011
&gt; 05:02
&gt; 
&gt; sh grid lat2
&gt;     GRID GSF1
&gt;  name       axis              # pts   start                end
&gt;  normal    X
&gt;  normal    Y
&gt;  normal    Z
&gt;  TIME      TIME              2350 i   25-JAN-2011 04:06    25-JAN-2011
&gt; 05:02
&gt; 
&gt; Second I tried to regrid the &quot;lat&quot; variable, but to a grid with the 3
&gt; axis:
&gt; 
&gt;  define axis/y=1:2350:1 jaxis
&gt;  define axis/t=1:1:1 laxis
&gt;  define grid/x=iaxis/y=jaxis/t=laxis gridCOL_ROW
&gt; let lat3=lat[g=gridCOL_ROW]
&gt; sh grid lat3
&gt;     GRID (G002)
&gt;  name       axis              # pts   start                end
&gt;  normal    X
&gt;  normal    Y
&gt;  normal    Z
&gt;  LAXIS     T                    1 r   1                    1
&gt; 
&gt; ...it was worse, ferret and I got more confused...The only way I could
&gt; work out to give this data a X/Y axis was to save it as a binary:
&gt; 
&gt; list/clobber/format=unformatted/file=&quot;jason1.dat&quot; lon,lat,ssha
&gt; 
&gt; ...and open it again:
&gt; 
&gt; define axis/x=1:2350:1 iaxis
&gt; define grid/x=iaxis gridCOL
&gt; file/format=unformatted/grid=gridCOL/var=lon,lat,ssha/col=3
&gt; &quot;jason1.dat&quot;
&gt;   sh da
&gt;     2&gt; ./jason1.dat  (default)
&gt;  name     title                             I         J         K
&gt; L
&gt;  LON      LON
&gt; 1:2350    ...       ...       ...
&gt;  LAT      LAT
&gt; 1:2350    ...       ...       ...
&gt;  SSHA     SSHA
&gt; 1:2350    ...       ...       ...
&gt; 
&gt; Does anyone have an easier way to regrid the data from the &quot;L&quot; axis to
&gt; the &quot;I&quot;/&quot;J&quot; axis?
&gt;  After this, I used the &quot;scat2gridgauss_xy&quot; command to put the
&gt; variables to this global grid:
&gt; 
&gt; !global grid for all Jason's possible tracks:
&gt; define axis/x=0:360:0.052252252/UNIT=degrees xJASON
&gt; define axis/y=-66.15:60.15:0.052252252/UNIT=degrees yJASON
&gt; let
&gt; sshaJASON=scat2gridgauss_xy(lon,lat,ssha,x[gx=xJASON],y[gy=yJASON],0.5, 0.5, 2, 0)
&gt; 
&gt; I ploted these &quot;sshaJASON&quot; variable with &quot;shade&quot;, no problems, but
&gt; isn't there a way to the axis recognize the coordinates described by
&gt; the variables &quot;lat&quot; and &quot;lon&quot;,
&gt; without the need of the &quot;scat2gridgauss_xy&quot; command?
&gt; Well, this file is one track of the satellite, and I 'd like to join a
&gt; hole cycle of it, which is the sum of 254 files, to do so, I made a
&gt; script in loop, for load and save the 254 binaries files 
&gt; but I'm not able, because Ferret allows until 100 datasets to be
&gt; loaded at the same time:
&gt;  
&gt; repeat/i=1:(numberFILES):1 (\
&gt; list `i`; \
&gt; file/var=ndata &quot;ndata_`i`.txt&quot;; \
&gt; define axis/x=1:`ndata[i=1]`:1 iaxis; \
&gt; ca da 1; \
&gt; define grid/x=iaxis gridTRIPA; \
&gt; let arq= &quot;JASON_`i`.dat&quot;; \
&gt; file/format=unformatted/grid=gridTRIPA/var=lon,lat,ssha/col=3
&gt; &quot;`arq`&quot; ; \
&gt; let
&gt; sshaJASON=scat2gridgauss_xy(lon,lat,ssha,x[gx=xJASON],y[gy=yJASON],0.5, 0.5, 2, 0) ; \
&gt; let sshaJASON`i` = missing(sshaJASON,0); \
&gt; let sobrepoe`i`_ssha=if (sshaJASON NE 0) then (sshaJASON) else
&gt; (sobrepoe`i-1`_ssha[l=1]); \
&gt; )
&gt; let sobrepoe_ssha=sobrepoe(numberFILES)_ssha[l=1]
&gt; set variable/bad=0 sobrepoe_ssha[l=1]
&gt; set memo/size=1000;shade sobrepoe_ssha;go land_hires
&gt; 
&gt; So I tried to cancel the variables (&quot;ca var ssha&quot;) at the end of loop,
&gt; but:
&gt; 
&gt; **ERROR: invalid command: can only CANCEL variables you DEFINE SSHA
&gt; ca var ssha
&gt; 
&gt; then I tried to cancel the dataset at the end of loop (&quot;ca da/all&quot; or
&gt; &quot;ca da 1&quot;), but it keep asking for the old variable (SSHA),
&gt; and I'm unabled to use the new variable with the overlappings
&gt; (sobrepoe_ssha):
&gt; 
&gt; !-&gt; REPEAT: I=1
&gt;  !-&gt; list 1
&gt;              VARIABLE : constant
&gt;           1.000
&gt;  !-&gt; SET DATA/EZ/var=ndata
&gt; &quot;/home/paula/Ressurgencia/JASON/c334/ndata_1.txt&quot;
&gt;  !-&gt; define axis/x=1:2350:1 iaxis
&gt; Replacing definition of axis IAXIS
&gt;  !-&gt; DEFINE VARIABLE arq=
&gt; &quot;/home/paula/Ressurgencia/JASON/c334/JASON_1.dat&quot;
&gt;  !-&gt; SET
&gt; DATA/EZ/format=unformatted/grid=gridTRIPA/var=lon,lat,ssha/col=3
&gt; &quot;/home/paula/Ressurgencia/JASON/c334/JASON_1.dat&quot;
&gt;  !-&gt; DEFINE VARIABLE sshaJASON1 = missing(sshaJASON,0)
&gt;  !-&gt; DEFINE VARIABLE sobrepoe1_ssha=if (sshaJASON NE 0) then
&gt; (sshaJASON) else (sobrepoe0_ssha[l=1])
&gt;  
&gt; let sobrepoe_ssha=sobrepoe($cont2)_ssha[l=1]
&gt;  !-&gt; DEFINE VARIABLE sobrepoe_ssha=sobrepoe1_ssha[l=1]
&gt; set variable/bad=0 sobrepoe_ssha[l=1]
&gt;  
&gt; shade sobrepoe_ssha
&gt;  **ERROR: variable unknown or not in data set: SSHA
&gt; shade sobrepoe_ssha
&gt; Command file, command group, or REPEAT execution aborted
&gt; 
&gt; Is there any way to clear the datasets so I'm able to handle with new
&gt; variables?
&gt; 
&gt; Thanks,
&gt; Paula Lamosa Nunes

</pre><p><strong>Attachment:
<a href="cdf8HNZaST2TI.cdf" ><tt>ssha2d.cdf</tt></a></strong><br>
<em>Description:</em> Cdf file</p>
<pre> ! NOAA/PMEL TMAP
 ! FERRET v6.65  
 ! Linux rh5 (gfortran) 2.6.18-164.11.1.el5 - 11/30/10
 ! 22-Mar-11 10:04     


!------------------------------------------------- lower resolution to speed up
define axis/x=0:360:0.5/UNIT=degrees        xJASON
define axis/y=-66.15:60.15:0.5/UNIT=degrees yJASON

let ssha2d_0 = 1/0*x[gx=xJASON]+y[gy=yJASON]
save/clobber/file=ssha2d.cdf ssha2d_0

!-- for &quot;real&quot; files --------------------
!let nfiles = `spawn(&quot;ls JA1*nc | wc -l&quot;)`
!repeat/range=1:`nfiles`:1/name=it (\
! use JA1_...`it`....

repeat/range=1:250:1/name=it (\
 use ssha2d;\
 use JA1_IPR_2PcP334_001_20110125_040633_20110125_050240;\
 def ax/x=1:`lon,ret=lend`:1 xnp;\
 let xp  = reshape(lon, x[gx=xnp])+it-1;\
 let yp  = reshape(lat, x[gx=xnp]);\
 let val = reshape(ssha,x[gx=xnp]);\
 let s2g = scat2gridgauss_xy(xp,yp,val,x[gx=xJASON],y[gy=yJASON],0.5, 0.5, 2, 0);\
 let ssha2d_`it` = if s2g then s2g else ssha2d_`it-1`[d=ssha2d];\
 save/clobber/file=ssha2d.cdf ssha2d_`it`;\
 canc data/all; canc var ssha2d_`it`;canc mem/all\
)

use etopo20; shade/pal=bluescale rose
 use ssha2d;\
 shade/ov  ssha2d_250;\

quit
</pre><p><strong>Attachment:
<a href="jpg5ux7cEjNbM.jpg" ><tt>ssha2d_mk.jpg</tt></a></strong><br>
<em>Description:</em> JPEG image</p>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00223" href="msg00223.html">RE: [ferret_users] Jason Images</a></strong>
<ul><li><em>From:</em> PaulaOCN Nunes</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00096" href="msg00096.html">[ferret_users] Announcing Ferret v6.6.7, a bug-fix release</a></strong>
<ul><li><em>From:</em> Ansley Manke</li></ul></li>
<li><strong><a name="00097" href="msg00097.html">Re: [ferret_users] Announcing Ferret v6.6.7, a bug-fix release</a></strong>
<ul><li><em>From:</em> Martin Schmidt</li></ul></li>
<li><strong><a name="00098" href="msg00098.html">Re: [ferret_users] Announcing Ferret v6.6.7, a bug-fix release</a></strong>
<ul><li><em>From:</em> Ansley Manke</li></ul></li>
<li><strong><a name="00119" href="msg00119.html">[ferret_users] plotting and interpolating data given on curvilinear grids</a></strong>
<ul><li><em>From:</em> Martin Schmidt</li></ul></li>
<li><strong><a name="00120" href="msg00120.html">Re: [ferret_users] plotting and interpolating data given on curvilinear grids</a></strong>
<ul><li><em>From:</em> Ansley Manke</li></ul></li>
<li><strong><a name="00206" href="msg00206.html">RE: [ferret_users] plotting and interpolating data given on curvilinear grids</a></strong>
<ul><li><em>From:</em> PaulaOCN Nunes</li></ul></li>
<li><strong><a name="00215" href="msg00215.html">[ferret_users] Jason Images</a></strong>
<ul><li><em>From:</em> PaulaOCN Nunes</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00217.html">Re: [ferret_users] Jason Images</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00223.html">RE: [ferret_users] Jason Images</a></strong>
</li>

</UL>
<center>[<a href="msg00217.html">Thread Prev</a>][<a href="msg00223.html">Thread Next</a>][<A HREF="threads.html#00219">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
