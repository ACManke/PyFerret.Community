<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [ferret_users] Interpolation 2D issue -->
<!--X-From-R13: "Ivyyvnz E. Yrffyre" <jvyyvnz.f.xrffyreNabnn.tbi> -->
<!--X-Date: Fri, 11 Mar 2011 11:34:58 &#45;0800 -->
<!--X-Message-Id: AE95F7DF&#45;88F3&#45;4015&#45;8B29&#45;30412C80A5DC@noaa.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: AANLkTikhKS6nWJjTF9_JP4ssAbGnTwMpnfJUfmxF+igF@mail.gmail.com -->
<!--X-Reference: 4D772AA8.2060906@io&#45;warnemuende.de -->
<!--X-Reference: AANLkTikNM_U1XrgAj2V+6KUa_VDrztAg2cHX0YZ8aHrr@mail.gmail.com -->
<!--X-Reference: 4D7799B2.1080607@io&#45;warnemuende.de -->
<!--X-Reference: 4D77B903.2090301@noaa.gov -->
<!--X-Reference: AANLkTi=m+DNW=mGeUXV7VNTi_HrewxCAD2KW2r8tDfUd@mail.gmail.com -->
<!--X-Reference: 4D79E6AD.8030502@io&#45;warnemuende.de -->
<!--X-Reference: AANLkTineD5P=Y8mvyD5VQ7KDXgW8yCgEzJ__BqjwvDSc@mail.gmail.com -->
<!--X-Reference: AANLkTin&#45;bJGW9KWfswxnRsgDzxpv6Rc=SF592QxAbD14@mail.gmail.com -->
<!--X-Reference: CACA09D1&#45;85EF&#45;4ADD&#45;A1D5&#45;716A9A04A84F@noaa.gov -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [ferret_users] Interpolation 2D issue</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00167.html">Thread Prev</a>][<a href="msg00169.html">Thread Next</a>][<A HREF="threads.html#00168">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Interpolation 2D issue</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Szymon Roziewski &lt;<a href="mailto:szymon.roziewski@DOMAIN.HIDDEN">szymon.roziewski@xxxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Interpolation 2D issue</strong></li>
<li><strong>From</strong>: <strong>&quot;William S. Kessler&quot; &lt;<a href="mailto:william.s.kessler@DOMAIN.HIDDEN">william.s.kessler@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Fri, 11 Mar 2011 11:34:58 -0800</li>
<li>Cc: Ferret users &lt;<a href="mailto:oar.pmel.ferret_users@DOMAIN.HIDDEN">oar.pmel.ferret_users@xxxxxxxx</a>&gt;</li>
<li>In-reply-to: &lt;<a href="mailto:CACA09D1-85EF-4ADD-A1D5-716A9A04A84F@DOMAIN.HIDDEN">CACA09D1-85EF-4ADD-A1D5-716A9A04A84F@xxxxxxxx</a>&gt;</li>
<li>References: &lt;<a href="mailto:AANLkTikhKS6nWJjTF9_JP4ssAbGnTwMpnfJUfmxF%2BigF@DOMAIN.HIDDEN">AANLkTikhKS6nWJjTF9_JP4ssAbGnTwMpnfJUfmxF+igF@xxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:4D772AA8.2060906@DOMAIN.HIDDEN">4D772AA8.2060906@xxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:AANLkTikNM_U1XrgAj2V%2B6KUa_VDrztAg2cHX0YZ8aHrr@DOMAIN.HIDDEN">AANLkTikNM_U1XrgAj2V+6KUa_VDrztAg2cHX0YZ8aHrr@xxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:4D7799B2.1080607@DOMAIN.HIDDEN">4D7799B2.1080607@xxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:4D77B903.2090301@DOMAIN.HIDDEN">4D77B903.2090301@xxxxxxxx</a>&gt; &lt;<a href="mailto:AANLkTi%3Dm%2BDNW%3DmGeUXV7VNTi_HrewxCAD2KW2r8tDfUd@DOMAIN.HIDDEN">AANLkTi=m+DNW=mGeUXV7VNTi_HrewxCAD2KW2r8tDfUd@xxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:4D79E6AD.8030502@DOMAIN.HIDDEN">4D79E6AD.8030502@xxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:AANLkTineD5P%3DY8mvyD5VQ7KDXgW8yCgEzJ__BqjwvDSc@DOMAIN.HIDDEN">AANLkTineD5P=Y8mvyD5VQ7KDXgW8yCgEzJ__BqjwvDSc@xxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:AANLkTin-bJGW9KWfswxnRsgDzxpv6Rc%3DSF592QxAbD14@DOMAIN.HIDDEN">AANLkTin-bJGW9KWfswxnRsgDzxpv6Rc=SF592QxAbD14@xxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:CACA09D1-85EF-4ADD-A1D5-716A9A04A84F@DOMAIN.HIDDEN">CACA09D1-85EF-4ADD-A1D5-716A9A04A84F@xxxxxxxx</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<tt>Another approach is the first fill (FLN) your field by extending the  
</tt><tt>endpoints (think carefully and test what this will do in a 2-d field  
</tt><tt>across, say, a peninsula or island). Then you can apply SBX or SPZ or  
</tt><tt>whatever, then blank the result where the original field is blank.
</tt><pre style="margin: 0em;">

</pre><tt>But, as always, do not do this blindly. Any of these choices imply  
</tt><tt>certain assumptions about what is really going on at the edges.
</tt><pre style="margin: 0em;">

BK

On Mar 11, 2011, at 10:30 AM, William S. Kessler wrote:

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>That is a statistics problem without a unique answer. It is a matter  
</tt><tt>of estimating the N-member smoothed value where fewer than N members  
</tt><tt>are known. Assumptions must be made.
</tt><pre style="margin: 0em;">

</pre><tt>One way to do this in Ferret is SCAT2GRIDGAUSS, which is simply a  
</tt><tt>weighted average that will compute values according to chosen  
</tt><tt>distance scales XSCALE, YSCALE and CUTOFF. If you are starting with  
</tt><tt>gridded data and want to keep the same grid, take the existing  
</tt><tt>gridpoints as XPTS,YPTS; it will then be a smoothing operator that  
</tt><tt>extends to (or past) the edges.
</tt><pre style="margin: 0em;">

Another is to use SBX or SPZ with sequentially increasing length:

! First define smoothed fields of varying length:
let sm3 = original_data[x=@sbx:3]
let sm5 = original_data[x=@sbx:5]
let sm7 = original_data[x=@sbx:7]

! Now use each one where it exists:
let smootha = if sm7 then sm7 else sm5
let smoothb = if smootha then smootha else sm3
let smooth = if smoothb then smoothb else original_data

</pre><tt>One advantage of an approach like this is that it reduces the  
</tt><tt>smoothing scale at the boundaries. That will often be appropriate  
</tt><tt>for a coastal ocean, where the scales are typically smaller at the  
</tt><tt>coastal margins. SCAT2GRIDGAUSS, on the other hand, will apply the  
</tt><tt>same smoothing everywhere.
</tt><pre style="margin: 0em;">

Billy K

On 11 Mar 2011, at 8:48 AM, Szymon Roziewski wrote:

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi Ferreters,
</pre><tt>I am wandering if there exists any functions which do almost the  
</tt><tt>same as SBX and SHN but on the boundary where there are not  
</tt><tt>sufficient number of neighbours they just take the neighbouring  
</tt><tt>sites only at the interior direction where the neighbours exist.
</tt><pre style="margin: 0em;">
They could really help me.

kind regards,
Szymon Roziewski

2011/3/11 Szymon Roziewski &lt;szymon.roziewski@xxxxxxxxx&gt;
Yes, I found it.
But when I was searching through the manual pdf I had to overlook it.
Thank you.

2011/3/11 Martin Schmidt &lt;martin.schmidt@xxxxxxxxxxxxxxxxx&gt;

</pre><tt>Please go to the ferret web site, documentation, open the index,  
</tt><tt>click &quot;m&quot; and scroll down
</tt><pre style="margin: 0em;">
to &quot;missing function&quot;

Best,
martin
Szymon Roziewski wrote:
Hi Martin,
It looks very nice.
</pre><tt>I have to try out this but I don't really know what the function  
</tt><tt>missing does. I had a look at manual and searched ferret site but  
</tt><tt>there's no anything about this function.
</tt><pre style="margin: 0em;">

Kind regards,
Szymon Roziewski

</pre><tt>2011/3/9 Ansley Manke &lt;Ansley.B.Manke@xxxxxxxx &lt;<a  rel="nofollow" href="mailto:Ansley.B.Manke@xxxxxxxx">mailto:Ansley.B.Manke@xxxxxxxx</a> 
</tt><tt>&gt;&gt;
</tt><pre style="margin: 0em;">


  Hi -
  We had noticed recently that documentation for fill_xy was missing
  from the manual. Your email here gives a nice example that we can
  use there.

  Ansley


  On 3/9/2011 7:16 AM, Martin Schmidt wrote:

      Hi,
      you are right, the documentation did not find its way into the
      manual. It is easy anyway. The mask needs to be
      1 where filling is allowed and zero otherwise. Please try the
      following

      yes? use coads_climatology
      yes? let mask=missing(sst/sst,1)
      yes? shade/l=1 mask
      yes? shade/l=1 fill_xy(sst,mask,5)
      Filling is allowed

      !Now missings at land
      yes? let mask=sst/sst
      yes? shade/l=1 mask
      yes? shade/l=1 fill_xy(sst,mask,5)
      Nothing is filled.

      And now:
      yes? let mask= if y[gy=sst] gt 0 then missing(sst/sst,1) else
      sst/sst
      yes? shade/l=1 fill_xy(sst,mask,5)

      Now filling happens in the northern hemisphere.

      Hope this helps,
      Martin

      Szymon Roziewski wrote:

          Dear Martin / Ferreters,
          I have problem with using fill_xy function. I saw some
          examples and read sth in the ferret archives but I still
          stuck.
          I try to explain my issue.
          This is reading an ice field and putting into a lndseaf. I
          also quote the grid definition.

</pre><tt>          DEFINE AXIS/X=-5.666666667:5.25:0.083333333/unit=degree  
</tt><tt>xlon
</tt><pre style="margin: 0em;">
          DEFINE AXIS/Y=-2.0:10.0:0.083333333/unit=degree ylat
          DEFINE GRID/x=xlon/y=ylat grid_xlon_xlat
</pre><tt>          file/skip=1/format=(80f1.0/52f1.0)/columns=132/ 
</tt><tt>grid=grid_xlon_xlat/var=lndseaf
</tt><pre style="margin: 0em;">
          ICE.DAT

          Then I interpolate the lndseaf onto a fine grid.

</pre><tt>          DEFINE AXIS/X=-5.666666667:5.25:0.010416667/unit=degree  
</tt><tt>xfine
</tt><pre style="margin: 0em;">
          DEFINE AXIS/Y=-2.0:10.0:0.010416667/unit=degree yfine !1/8
          DEFINE GRID/x=xfine/y=yfine grid_xfine_yfine
          let ice_regridded lndseaf[gxy=grid_xfine_yfine]

          What I did next was make the mask.

          let mask = ice_regridded/ice_regridded

          And I used the mask with fill_xy as the following

          let ice_ext = fill_xy(ice_regridded,mask,5)

          But It didn't change anything. I tried out using different
          values of third argument of fill_xy. However, I didn't
          improve at all.
          So, I think either I was using fill_xy badly or I
          misunderstood something.

          I also tried out FLN function as follows

          let ext = ice_regridded[x=@FLN:50,y=@FLN:50]

          But this resulted with no changes to the ice_regridded as
          well.
          I attach ICE.DAT to make it more real.

          Kind regards,
          Szymon Roziewski



          2011/3/9 Martin Schmidt &lt;martin.schmidt@xxxxxxxxxxxxxxxxx
          &lt;<a  rel="nofollow" href="mailto:martin.schmidt@xxxxxxxxxxxxxxxxx">mailto:martin.schmidt@xxxxxxxxxxxxxxxxx</a>&gt;
          &lt;<a  rel="nofollow" href="mailto:martin.schmidt@xxxxxxxxxxxxxxxxx">mailto:martin.schmidt@xxxxxxxxxxxxxxxxx</a>
          &lt;<a  rel="nofollow" href="mailto:martin.schmidt@xxxxxxxxxxxxxxxxx">mailto:martin.schmidt@xxxxxxxxxxxxxxxxx</a>&gt;&gt;&gt;

             Dear Szymon,

             you may use fill_xy(data, mask, 2) before you filter
          data. This
             extrapolates the data smoothly into land by two points
          and the
             filter @SBX and @SHN
             can do something reasonable near land too. Applying
          your land mask
             later removes remaining extrapolated points.

             Greetings,
             Martin

             Szymon Roziewski wrote:

                 Dear Ferreters,

                 I have an ice field that is a matrix filled by 0 or
          1. Because
                 of weak resolution I need it to be interpolated on
          a finer grid.
                 I tried out two approaches.
                 The first, I interpolated with using @SBX and @SHN
          functions.
                 Basically, I got neat result except to the boundary
          where I
                 got a lack of data. Because this functions don't
          have data to
                 interpolate and ending up with 0 value.
                 As the second I used scat2gridgauss_xy function
          which gave me
                 smoother result but near the boundary I got the ice
          that
                 should not to be. I think that this function is do
          smooth the
                 data sometimes to much.

                 Have any of you had something similar with it?
                 Maybe there are some good ferret functions to
          interpolate ice
                 field which is 0 or 1.

                 I attach two graphics for better explanation.

                 Kind regards,
                 Szymon Roziewski





          --             Z wyrazami szacunku,
          Szymon Roziewski





--
Z wyrazami szacunku,
Szymon Roziewski




--
Z wyrazami szacunku,
Szymon Roziewski



--
Z wyrazami szacunku,
Szymon Roziewski
</pre></blockquote><pre style="margin: 0em;">

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
William S. Kessler
NOAA / Pacific Marine Environmental Laboratory
7600 Sand Point Way NE
Seattle WA 98115 USA

william.s.kessler@xxxxxxxx
Tel: 206-526-6221
Fax: 206-526-6744
Web: <a  rel="nofollow" href="http://www.pmel.noaa.gov/people/kessler">http://www.pmel.noaa.gov/people/kessler</a>

</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00169" href="msg00169.html">Re: [ferret_users] Interpolation 2D issue</a></strong>
<ul><li><em>From:</em> William S. Kessler</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00149" href="msg00149.html">[ferret_users] Interpolation 2D issue</a></strong>
<ul><li><em>From:</em> Szymon Roziewski</li></ul></li>
<li><strong><a name="00152" href="msg00152.html">Re: [ferret_users] Interpolation 2D issue</a></strong>
<ul><li><em>From:</em> Martin Schmidt</li></ul></li>
<li><strong><a name="00155" href="msg00155.html">Re: [ferret_users] Interpolation 2D issue</a></strong>
<ul><li><em>From:</em> Szymon Roziewski</li></ul></li>
<li><strong><a name="00156" href="msg00156.html">Re: [ferret_users] Interpolation 2D issue</a></strong>
<ul><li><em>From:</em> Martin Schmidt</li></ul></li>
<li><strong><a name="00160" href="msg00160.html">Re: [ferret_users] Interpolation 2D issue</a></strong>
<ul><li><em>From:</em> Szymon Roziewski</li></ul></li>
<li><strong><a name="00166" href="msg00166.html">Re: [ferret_users] Interpolation 2D issue</a></strong>
<ul><li><em>From:</em> Szymon Roziewski</li></ul></li>
<li><strong><a name="00167" href="msg00167.html">Re: [ferret_users] Interpolation 2D issue</a></strong>
<ul><li><em>From:</em> William S. Kessler</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00167.html">Re: [ferret_users] Interpolation 2D issue</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00169.html">Re: [ferret_users] Interpolation 2D issue</a></strong>
</li>

</UL>
<center>[<a href="msg00167.html">Thread Prev</a>][<a href="msg00169.html">Thread Next</a>][<A HREF="threads.html#00168">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<A HREF="http://ferret.pmel.noaa.gov/Ferret/contact-us">Contact Us</A>
<br>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> /
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://ferret.pmel.noaa.gov">Ferret</a>
</address>

<br>
 <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 

</font>
<!--X-User-Footer-End-->
</body>
</html>
