<!-- MHonArc v2.5.13 -->
<!--X-Subject: Re: [ferret_users] Details on using @AVE function correctly -->
<!--X-From-R13: Oafyrl [naxr <nafyrl.o.znaxrNabnn.tbi> -->
<!--X-Date: Mon, 16 Oct 2006 14:21:40 &#45;0700 -->
<!--X-Message-Id: 4533F7E2.6000404@noaa.gov -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 20061011170129.wr3rdajuhc8wksoc@webmail.fsu.edu -->
<!--X-Reference: Pine.LNX.4.58.0610120334390.12757@caos.iisc.ernet.in -->
<!--X-Reference: 20061012111315.45mxl17exscs404s@webmail.fsu.edu -->
<!--X-Reference: Pine.LNX.4.58.0610122154450.13389@caos.iisc.ernet.in -->
<!--X-Reference: 20061016123427.xpt7knm1foo44kgg@webmail.fsu.edu -->
<!--X-Reference: Pine.LNX.4.58.0610162333450.7927@caos.iisc.ernet.in -->
<!--X-Reference: 20061016145540.7p7f1xo680o488co@webmail.fsu.edu -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<title>Re: [ferret_users] Details on using @AVE function correctly</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00681.html">Thread Prev</a>][<a href="msg00683.html">Thread Next</a>][<A HREF="threads.html#00682">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Details on using @AVE function correctly</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong><a href="mailto:guimond@DOMAIN.HIDDEN">guimond@xxxxxxxxxxxxx</a></strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Details on using @AVE function correctly</strong></li>
<li><strong>From</strong>: <strong>Ansley Manke &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li>Date: Mon, 16 Oct 2006 14:21:38 -0700</li>
<li>Cc: Jaison Kurian &lt;<a href="mailto:jaison@DOMAIN.HIDDEN">jaison@xxxxxxxxxxxxxxxxxx</a>&gt;, <a href="mailto:oar.pmel.ferret_users@DOMAIN.HIDDEN">oar.pmel.ferret_users@xxxxxxxx</a></li>
<li>In-reply-to: &lt;<a href="msg00679.html">20061016145540.7p7f1xo680o488co@webmail.fsu.edu</a>&gt;</li>
<li>References: &lt;<a href="msg00667.html">20061011170129.wr3rdajuhc8wksoc@webmail.fsu.edu</a>&gt;&lt;<a href="msg00668.html">Pine.LNX.4.58.0610120334390.12757@caos.iisc.ernet.in</a>&gt;&lt;<a href="msg00670.html">20061012111315.45mxl17exscs404s@webmail.fsu.edu</a>&gt;&lt;<a href="msg00672.html">Pine.LNX.4.58.0610122154450.13389@caos.iisc.ernet.in</a>&gt;&lt;20061016123427.xpt7knm1foo44kgg@webmail.fsu.edu&gt;&lt;Pine.LNX.4.58.0610162333450.7927@caos.iisc.ernet.in&gt;&lt;<a href="msg00679.html">20061016145540.7p7f1xo680o488co@webmail.fsu.edu</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxxxxxxx</a></li>
<li>User-agent: Thunderbird 1.5.0.7 (Windows/20060909)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#ffffff" style="background-color: #ffffff; color: #000000; "><font color="#000000">



Hi Steve,<br>
Where are you looking in the documentation?&nbsp; Sometimes we who write
docs are too close to it all and can't see where confusion arises.
There is this paragraph a little ways down under <br>
<p align="left"><font color="#1f1a17" face="Times" size="3"><font
 color="#1f1a17" face="Times" size="3"><font color="#1f1a17"
 face="Times" size="3"><font color="#1f1a17" face="Times" size="3"><font
 color="#1f1a17" face="Times" size="3"><font color="#1f1a17"
 face="Palatino" size="4"><b>Ch3 Sec2.4.1.&nbsp;</b>
</font><font color="#1f1a17" face="Palatino" size="4"><b>General
information about transformations <br>
</b></font></font></font></font></font></font></p>
<blockquote>
  <p align="left"><font color="#1f1a17" face="Times" size="3"><font
 color="#1f1a17" face="Times" size="3"><font color="#1f1a17"
 face="Times" size="3"><font color="#1f1a17" face="Times" size="3"><font
 color="#1f1a17" face="Times" size="3"><font color="#1f1a17"
 face="Times" size="3"><br>
  </font></font></font></font></font></font></p>
  <p align="left"><font color="#1f1a17" face="Times" size="3"><font
 color="#1f1a17" face="Times" size="3"><font color="#1f1a17"
 face="Times" size="3"><font color="#1f1a17" face="Times" size="3"><font
 color="#1f1a17" face="Times" size="3"><font color="#1f1a17"
 face="Times" size="3">...If integration or averaging limits are given
as world coordinates, the grid boxes at the edges of the region
specified are weighted according to the fraction of grid box that
actually lies within the specified region. If the transformation limits
are given as subscripts, the full box size of each grid point along the
axis is used&#8212;including the first and last subscript given. The region
information that is listed with the output reflects this. <br>
  </font></font></font></font></font></font></p>
  <p align="left"><font color="#1f1a17" face="Times" size="3"><font
 color="#1f1a17" face="Times" size="3"><font color="#1f1a17"
 face="Times" size="3"><font color="#1f1a17" face="Times" size="3"><font
 color="#1f1a17" face="Times" size="3"><font color="#1f1a17"
 face="Times" size="3"><br>
  </font></font></font></font></font></font></p>
</blockquote>
But, I guess that we could also add to the @AVE section, perhaps
something like the <b>BOLD</b> text below.<br>
<br>
<p align="left"><font color="#1f1a17" face="Times" size="3"><font
 color="#1f1a17" face="Times" size="3"><font color="#1f1a17"
 face="Times" size="3"><font color="#1f1a17" face="Times" size="3"><font
 color="#1f1a17" face="Times" size="3"><font color="#1f1a17"
 face="Palatino" size="4"><b>Ch3 Sec2.4.6.&nbsp;</b>
</font><font color="#1f1a17" face="Palatino" size="4"><b>@AVE&#8212;average&nbsp;</b>
</font></font></font></font></font></font></p>
<p align="left"><font color="#1f1a17" face="Times" size="3"><font
 color="#1f1a17" face="Times" size="3"><font color="#1f1a17"
 face="Times" size="3"><font color="#1f1a17" face="Times" size="3"><font
 color="#1f1a17" face="Times" size="3"><font color="#1f1a17"
 face="Times" size="3">
The transformation @AVE computes the average weighted by grid box
size&#8212;a single number representing the average of the variable between
two endpoints. <b>When the endpoints are expressed as coordinates,
e.g. var[X=3.5:8@AVE], then the average is weighted with partial box
sizes so that the average extends from exactly x=3.5 to 8.&nbsp; If the
endpoints are expressed as indices, e.g. var[L=5:12@AVE] then entire
boxes contribute to the average. <br>
</b></font></font></font></font></font></font></p>
<p align="left"><font color="#1f1a17" face="Times" size="3"><font
 color="#1f1a17" face="Times" size="3"><font color="#1f1a17"
 face="Times" size="3"><font color="#1f1a17" face="Times" size="3"><font
 color="#1f1a17" face="Times" size="3"><font color="#1f1a17"
 face="Times" size="3"><b><br>
</b></font></font></font></font></font></font></p>
<br>
<br>
<a class="moz-txt-link-abbreviated" href="">guimond@coaps.fsu.edu</a> wrote:
<blockquote cite=""
 type="cite">Hi Jaison,
  <br>
&nbsp;Thank you for your response.&nbsp; This is a very nice review of the @AVE
functions and something I think should be added to the documentation.&nbsp;
It is not obvious how the grid box weights are computed from what is
given and one could easily trust the values when in fact they would be
wrong.&nbsp; I will post this response to the group.&nbsp;&nbsp; So, basically using
the calendar format (i.e. var[t=02-JAN-2001:05-JAN-2001@AVE]) of @AVE
will ALWAYS underestimate the mean because of the 0.50 weight on each
end.&nbsp; I think another way to get at the correct method would be to:
  <br>
  <br>
let new_var = var[t=02-JAN-2001:05-JAN-2001]
  <br>
  <br>
let new_var_mean = new_var[t=@AVE]
  <br>
  <br>
This computes the mean over all the grid cells in range by removing the
values from the rest of the data.
  <br>
  <br>
  <br>
Any idea why @AVE was created like this?
  <br>
  <br>
  <br>
Thanks again,
  <br>
  <br>
Steve
  <br>
  <br>
  <br>
Quoting Jaison Kurian <a class="moz-txt-link-rfc2396E" href="">&lt;jaison@caos.iisc.ernet.in&gt;</a>:
  <br>
  <br>
  <blockquote type="cite">Hi Steve,
    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; I faced a simular confusion earlier...that time Ansley
    <br>
clarified my doubts.
    <br>
    <br>
&nbsp;Basically over "co-ordinate axes" ie. X/Y/Z/T, @AVE is weigthed
    <br>
by grid box lenth, based on the specified region. But over "abstract
    <br>
axes or indices" ie. I/J/K/L it is not. Let us see one example.
    <br>
    <br>
&nbsp;&nbsp; define axis/t=01-JAN-2001:06-JAN-2001:1/units=days/t0=31-DEC-2000
time
    <br>
&nbsp;&nbsp; let var = SIN(t[gt=time])
    <br>
&nbsp;&nbsp; set list/precision=10
    <br>
    <br>
&nbsp;&nbsp; ! first 3-methods to find ave
    <br>
    <br>
&nbsp;&nbsp; list var[l=2:5@AVE]
    <br>
&nbsp;&nbsp; list
var[t=02-JAN-2001:05-JAN-2001@SUM]/var[t=02-JAN-2001:05-JAN-2001@NGD]
    <br>
&nbsp;&nbsp; list var[t="01-JAN-2001:12":"05-JAN-2001:12"@AVE]
    <br>
    <br>
&nbsp;&nbsp; ! fourth method to find ave
    <br>
    <br>
&nbsp;&nbsp; list var[t=02-JAN-2001:05-JAN-2001@AVE]
    <br>
    <br>
The first 3 list commands will give the same answer, the sum of
variable
    <br>
values from 2nd to 5th devided by number of points, ie. 4. But the last
one
    <br>
will give a different anwer. Let me explain in detail.
    <br>
    <br>
The first time point is "01-JAN-2001:00:00"
    <br>
&nbsp; its bounds are&nbsp; "31-DEC-2000:12:00" and "01-JAN-2001:12:00"
    <br>
The second time point is "02-JAN-2001:00:00"
    <br>
&nbsp; its bounds are "01-JAN-2001:12:00" and "02-JAN-2001:12:00"
    <br>
    <br>
Hence when you are specifying as the starting T for an average
    <br>
operation as "02-JAN-2001",only half of the grid box comes after
    <br>
this time (ie. from "02-JAN-2001:00:00" to "02-JAN-2001:12:00")
    <br>
hence this value gets only 0.5 weightage..similar is the case
    <br>
with the value on "05-JAN-2001". So, the average
    <br>
    <br>
&nbsp;&nbsp; var[t=02-JAN-2001:05-JAN-2001@AVE]
    <br>
    <br>
will be computed as
    <br>
    <br>
&nbsp;&nbsp; (var[t=02-JAN-2001]*0.5+var[t=03-JAN-2001]*1+var[t=04-JAN-2001]*1+
    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var[t=05-JAN-2001]*0.5)/3
    <br>
    <br>
This problem is overcome by specifying exact grid boundaries in method
    <br>
3 above. In method 2 a combination of @SUM and @NGD has been used.
Since
    <br>
@SUM is a non-weighted calculation, this will give the answer without
    <br>
any problems like method 4 above.
    <br>
    <br>
Back to your question
    <br>
---------------------
    <br>
So what should a proper method for simple mean ? Any of first 3 methods
    <br>
from above example. Then you may ask, how to make it easier with the
    <br>
time specified on calendar format : here is the trick
    <br>
    <br>
let l1 = L[gt=var,t=02-JAN-2001]
    <br>
let l2 = L[gt=var,t=05-JAN-2001]
    <br>
list var[l=`l1`:`l2`@AVE]
    <br>
    <br>
Hope this helps,
    <br>
    <br>
Regards,
    <br>
    <br>
Jaison
    <br>
    <br>
On Mon, 16 Oct 2006 <a class="moz-txt-link-abbreviated" href="">guimond@coaps.fsu.edu</a> wrote:
    <br>
    <br>
    <blockquote type="cite">Hi Jaison,
      <br>
&nbsp; I decided to e-mail you separatley about this question and then I
      <br>
will post the responses to the group.&nbsp; I have computed some means and I
      <br>
am questioning how ferret goes about them.&nbsp; Specifically, I have
      <br>
computed the time mean of a var between two endpoints, call them t1 and
      <br>
t2:
      <br>
      <br>
let mean1 = var[t=`t1`:`t2`@AVE]
      <br>
      <br>
According to the FERRET users guide, this will be the mean over the
      <br>
"exact" region or from gridpoint to gridpoint, correct?&nbsp; Now if I do
      <br>
something like this:
      <br>
      <br>
let mean2 = var[l=10:15@AVE], using time steps instead of time values.
      <br>
      <br>
I will get a different answer because this method averages from
      <br>
gridcell to gridcell and not gridpoint to gridpoint, correct?
      <br>
      <br>
I am confused on what is the more accurate depiction of the mean here.
      <br>
I want to average from one single time point, t1, to another time
      <br>
point, t2.&nbsp; This is why I used the formula for mean1.&nbsp; Is this correct
      <br>
for simple means?
      <br>
      <br>
Thanks for your help,
      <br>
Steve Guimond
      <br>
      <br>
----------------------------------------------------------------
      <br>
      <br>
      <br>
    </blockquote>
    <br>
    <br>
  </blockquote>
  <br>
  <br>
  <br>
----------------------------------------------------------------
  <br>
  <br>
  <br>
</blockquote>
<br>
<pre class="moz-signature" cols="75">-- 

~&gt;   ~&gt;   ~&gt;   ~&gt;   ~&gt;   ~&gt;   ~&gt;   ~&gt;   ~&gt;   ~&gt;   ~&gt; 

Ansley Manke, NOAA/PMEL   <a class="moz-txt-link-abbreviated" href="">ansley.b.manke@noaa.gov</a>
7600 Sand Point Way NE, Seattle WA
Phone 206-526-6246,  FAX 206-526-6744

</pre>


</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00683" href="msg00683.html">Re: [ferret_users] Details on using @AVE function correctly</a></strong>
<ul><li><em>From:</em> guimond</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00667" href="msg00667.html">[ferret_users] remove zero from x-axis</a></strong>
<ul><li><em>From:</em> guimond</li></ul></li>
<li><strong><a name="00668" href="msg00668.html">Re: [ferret_users] remove zero from x-axis</a></strong>
<ul><li><em>From:</em> Jaison Kurian</li></ul></li>
<li><strong><a name="00670" href="msg00670.html">Re: [ferret_users] remove zero from x-axis</a></strong>
<ul><li><em>From:</em> guimond</li></ul></li>
<li><strong><a name="00672" href="msg00672.html">Re: [ferret_users] remove zero from x-axis</a></strong>
<ul><li><em>From:</em> Jaison Kurian</li></ul></li>
<li><strong><a name="00679" href="msg00679.html">[ferret_users] Details on using @AVE function correctly</a></strong>
<ul><li><em>From:</em> guimond</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00681.html">Re: [ferret_users] Details on using @AVE function correctly</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00683.html">Re: [ferret_users] Details on using @AVE function correctly</a></strong>
</li>

</UL>
<center>[<a href="msg00681.html">Thread Prev</a>][<a href="msg00683.html">Thread Next</a>][<A HREF="threads.html#00682">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<hr>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> / 
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://tmap.pmel.noaa.gov">TMAP</a>
</address> <br> <a href="http://ferret.pmel.noaa.gov/Ferret/ferret_contact_us.html">Contact Us</a> | <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 
</font>
<!--X-User-Footer-End-->
</body>
</html>
