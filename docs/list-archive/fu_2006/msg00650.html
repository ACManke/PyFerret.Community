<!-- MHonArc v2.5.13 -->
<!--X-Subject: Re: [ferret_users] How to combine files ??? -->
<!--X-From-R13: Xnvfba Yhevna <wnvfbaNpnbf.vvfp.rearg.va> -->
<!--X-Date: Thu, 5 Oct 2006 01:09:56 &#45;0700 -->
<!--X-Message-Id: Pine.LNX.4.58.0610051340570.16253@caos.iisc.ernet.in -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1159944015.2671.574.camel@pc191&#45;118.nies.go.jp -->
<!--X-Reference: Pine.LNX.4.58.0610042142400.5858@caos.iisc.ernet.in -->
<!--X-Reference: 1160025835.2671.661.camel@pc191&#45;118.nies.go.jp -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<title>Re: [ferret_users] How to combine files ???</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00649.html">Thread Prev</a>][<a href="msg00647.html">Thread Next</a>][<A HREF="threads.html#00650">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] How to combine files ???</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>&quot;Dr. Vinu K. Valsala&quot; &lt;<a href="mailto:vinu.valsala@DOMAIN.HIDDEN">vinu.valsala@xxxxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] How to combine files ???</strong></li>
<li><strong>From</strong>: <strong>Jaison Kurian &lt;<a href="mailto:jaison@DOMAIN.HIDDEN">jaison@xxxxxxxxxxxxxxxxxx</a>&gt;</strong></li>
<li>Date: Thu, 05 Oct 2006 13:46:55 +0530 (IST)</li>
<li>Cc: <a href="mailto:ferret_users@DOMAIN.HIDDEN">ferret_users@xxxxxxxx</a></li>
<li>In-reply-to: &lt;<a href="msg00649.html">1160025835.2671.661.camel@pc191-118.nies.go.jp</a>&gt;</li>
<li>References: &lt;<a href="msg00644.html">1159944015.2671.574.camel@pc191-118.nies.go.jp</a>&gt;&lt;<a href="msg00646.html">Pine.LNX.4.58.0610042142400.5858@caos.iisc.ernet.in</a>&gt;&lt;<a href="msg00649.html">1160025835.2671.661.camel@pc191-118.nies.go.jp</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Hi Vinu,
         Ideally, the method i suggested should work fine,
here is an example :

    define axis/y=-90:90:1/units=latitudes   ybig
    define axis/y=-80:-70:1/units=latitudes  ysmall
    let var     = SIN(y[gy=ysmall])
    let var_big = var[gy=ybig]
    list var
    list/j=1:30 var_big

You can check at each step of your script to know exactly
from where the missing value problem occurs. If the latitude
values on the source and destination Y-axis are the same,
then there is no need for any regridding (eg. @NRST) which
will take extra time.

 Try to list the values of readed-in variable and new variable
created in Ferret (on YLAT axis) and track down the problem.

Regards,

Jaison 


On Thu, 5 Oct 2006, Dr. Vinu K. Valsala wrote:

&gt; Hi Jaison,
&gt; 
&gt; Thank you for your reply.
&gt; 
&gt; The method works fine. But, there is one missing
&gt; value at each file boundaries in the combined 
&gt; netcdf file. See the following table. The individual
&gt; files have values for all latitudes but one value
&gt; is missing in the combined netcdf file at each file boundaries.
&gt; 
&gt; 
&gt; 2-Individual files          combined netcdf file.
&gt; ===================         ====================
&gt; 22.5S / 8: -1.403  ----&gt;    22.5S / 24:   ....
&gt; 25.3S / 7: -0.184           25.3S / 23:  -0.18
&gt; 28.1S / 6:  0.336           28.1S / 22:   0.34
&gt; 30.9S / 5:  0.789           30.9S / 21:   0.79
&gt; 33.8S / 4:  1.653           33.7S / 20:   1.65
&gt; 36.6S / 3:  3.538           36.6S / 19:   3.54
&gt; 39.4S / 2:  5.956           39.4S / 18:   5.96
&gt; 42.2S / 1:  7.314           42.2S / 17:   7.31
&gt; 45S   / 8:  8.121  ----&gt;    45S   / 16:   ....
&gt; 47.8S / 7:  7.605           47.8S / 15:   7.60
&gt; 50.6S / 6:  6.409           50.6S / 14:   6.41
&gt; 53.4S / 5:  5.032           53.4S / 13:   5.03
&gt; 56.2S / 4:  3.785           56.2S / 12:   3.79
&gt; 59.1S / 3:  2.822           59.1S / 11:   2.82
&gt; 61.9S / 2:  2.421           61.9S / 10:   2.42
&gt; 64.7S / 1:  3.052           64.7S /  9:   3.05
&gt; 
&gt; 
&gt; The steps I used are here,
&gt; 
&gt; yes? use snapshots.000051.01.01.dta.nc.0000
&gt; yes? define axis/y=-87.187:90.:2.8125/units=latitudes ylat
&gt; yes? let u_model = u[d=1,gy=ylat]
&gt; yes? sp rm n1n.nc
&gt; yes? save/file=n1n.nc/JLIMITS=1:64/J=1:8/clobber u_model
&gt; yes? cancel data 1
&gt; yes? use snapshots.000051.01.01.dta.nc.0001
&gt; yes? let u_model = u[d=1,gy=ylat]
&gt; yes? save/file=n1n.nc/J=9:16/append u_model
&gt; 
&gt; .... and so on.
&gt; 
&gt; 
&gt; NOTE
&gt; The missing value fills correctly when I use @nrst regridding
&gt; mode. i.e.  let u_model = u[d=1,gy=ylat@nrst]
&gt; So, is that necessary to put @nrst on regridding?
&gt; 
&gt; Thanks in advance,
&gt; -Vinu
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; On Wed, 2006-10-04 at 22:09 +0530, Jaison Kurian wrote:
&gt; &gt; Hi Vinu,
&gt; &gt;          If you want to combine the NetCDF files decomposed
&gt; &gt; on latitude, then (assuming the individual NetCDF files are
&gt; &gt; on proper latitude axis)
&gt; &gt; 
&gt; &gt;  1. define the destination latitude axis 
&gt; &gt; 
&gt; &gt;       yes? define axis/y=-90:90:1/units=latitudes ylat ! 181 points
&gt; &gt; 
&gt; &gt;  2  Assign the destination grid to the variables as follows,
&gt; &gt; 
&gt; &gt;       yes? let temp_1 = temp[d=1,gy=ylat]
&gt; &gt; 
&gt; &gt;  3  Identify the start and end J, on 'ylat' axis, according
&gt; &gt;       to each input NetCDF file (ie. from first processor 
&gt; &gt;       owards). Let it be J=1:20, then open a new file as
&gt; &gt; 
&gt; &gt;       yes? sp rm -f ncout.nc
&gt; &gt;       yes? save/file=ncout.nc/JLIMITS=1:181/J=1:20/CLOBBER temp_1
&gt; &gt;       
&gt; &gt;  4  Close the first input file. Open the second input file then,
&gt; &gt;       (assuming J for this file is 21:40)
&gt; &gt; 
&gt; &gt;       yes? cancel data 1
&gt; &gt;       yes? set data inputncfile2.nc.0001
&gt; &gt;       yes? let temp_1 = temp[d=1,gy=ylat]
&gt; &gt;       yes? save/file=ncout.nc/J=21:40/APPEND temp_1
&gt; &gt; 
&gt; &gt;  5 Repeat step 4 for other remaining input files.
&gt; &gt; 
&gt; &gt; If the number of input files and variables in each input files 
&gt; &gt; are large, this method is not at all feasible. In this case you
&gt; &gt; can try using the mppnccombine.c distributed with MOM4p0 code,
&gt; &gt; (<a  href="https://fms.gfdl.noaa.gov/">https://fms.gfdl.noaa.gov/</a>) from GFDL. Which is fairly complex 
&gt; &gt; enough to handle a wide range of input files. But you may have 
&gt; &gt; to modify it, to suit for your input files.
&gt; &gt; 
&gt; &gt; Hope this helps,
&gt; &gt; 
&gt; &gt; Regards,
&gt; &gt; 
&gt; &gt; Jaison
&gt; &gt; 
&gt; &gt; On Wed, 4 Oct 2006, Vinu K. V. wrote:
&gt; &gt; 
&gt; &gt; &gt; Hi Ferreters,
&gt; &gt; &gt; 
&gt; &gt; &gt; 	A parallel run produces out put as pieces (netcdf), 
&gt; &gt; &gt; each file contains a portion of latitude. How can one combine
&gt; &gt; &gt; this individual files into one single file of entire
&gt; &gt; &gt; latitudes ?
&gt; &gt; &gt; 
&gt; &gt; &gt; For example,
&gt; &gt; &gt; 
&gt; &gt; &gt; 10 files are produced, each file containing output 
&gt; &gt; &gt; for a portion of latitudes, say, -90  to -80, -80 to -70 and so on.
&gt; &gt; &gt; 
&gt; &gt; &gt; I have tried save/file=my_file.nc/append over a dummy 
&gt; &gt; &gt; file, whose grid is defined for entire globe, but didnt work.
&gt; &gt; &gt; 
&gt; &gt; &gt; I suppose there are other methods exist in Ferret to
&gt; &gt; &gt; do this properly.
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Please help me to find a solution. Thanks in advance
&gt; &gt; &gt; 
&gt; &gt; &gt; -Vinu
&gt; &gt; &gt; 
&gt; 
</pre>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00644" href="msg00644.html">[ferret_users] How to combine files ???</a></strong>
<ul><li><em>From:</em> Vinu K. V.</li></ul></li>
<li><strong><a name="00646" href="msg00646.html">Re: [ferret_users] How to combine files ???</a></strong>
<ul><li><em>From:</em> Jaison Kurian</li></ul></li>
<li><strong><a name="00649" href="msg00649.html">Re: [ferret_users] How to combine files ???</a></strong>
<ul><li><em>From:</em> Dr. Vinu K. Valsala</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00649.html">Re: [ferret_users] How to combine files ???</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00647.html">[ferret_users] Setting global data set attributes in Version 6</a></strong>
</li>

</UL>
<center>[<a href="msg00649.html">Thread Prev</a>][<a href="msg00647.html">Thread Next</a>][<A HREF="threads.html#00650">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<hr>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> / 
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://tmap.pmel.noaa.gov">TMAP</a>
</address> <br> <a href="http://ferret.pmel.noaa.gov/Ferret/ferret_contact_us.html">Contact Us</a> | <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 
</font>
<!--X-User-Footer-End-->
</body>
</html>
