<!-- MHonArc v2.5.13 -->
<!--X-Subject: Re: [ferret_users] Details on using @AVE function correctly -->
<!--X-From-R13: thvzbaqNpbncf.sfh.rqh -->
<!--X-Date: Mon, 16 Oct 2006 14:41:37 &#45;0700 -->
<!--X-Message-Id: 20061016171613.e4j9gy9w08sw48og@webmail.fsu.edu -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20061011170129.wr3rdajuhc8wksoc@webmail.fsu.edu -->
<!--X-Reference: Pine.LNX.4.58.0610120334390.12757@caos.iisc.ernet.in -->
<!--X-Reference: 20061012111315.45mxl17exscs404s@webmail.fsu.edu -->
<!--X-Reference: Pine.LNX.4.58.0610122154450.13389@caos.iisc.ernet.in -->
<!--X-Reference: 20061016123427.xpt7knm1foo44kgg@webmail.fsu.edu -->
<!--X-Reference: Pine.LNX.4.58.0610162333450.7927@caos.iisc.ernet.in -->
<!--X-Reference: 20061016145540.7p7f1xo680o488co@webmail.fsu.edu -->
<!--X-Reference: 4533F7E2.6000404@noaa.gov -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<title>Re: [ferret_users] Details on using @AVE function correctly</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
<center>[<a href="msg00682.html">Thread Prev</a>][<a href="msg00673.html">Thread Next</a>][<A HREF="threads.html#00683">Index</A>]</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [ferret_users] Details on using @AVE function correctly</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><strong>To</strong>: <strong>Ansley Manke &lt;<a href="mailto:ansley.b.manke@DOMAIN.HIDDEN">ansley.b.manke@xxxxxxxx</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [ferret_users] Details on using @AVE function correctly</strong></li>
<li><strong>From</strong>: <strong><a href="mailto:guimond@DOMAIN.HIDDEN">guimond@xxxxxxxxxxxxx</a></strong></li>
<li>Date: Mon, 16 Oct 2006 17:16:13 -0400</li>
<li>Cc: Jaison Kurian &lt;<a href="mailto:jaison@DOMAIN.HIDDEN">jaison@xxxxxxxxxxxxxxxxxx</a>&gt;, <a href="mailto:oar.pmel.ferret_users@DOMAIN.HIDDEN">oar.pmel.ferret_users@xxxxxxxx</a></li>
<li>In-reply-to: &lt;<a href="msg00682.html">4533F7E2.6000404@noaa.gov</a>&gt;</li>
<li>References: &lt;<a href="msg00667.html">20061011170129.wr3rdajuhc8wksoc@webmail.fsu.edu</a>&gt;&lt;<a href="msg00668.html">Pine.LNX.4.58.0610120334390.12757@caos.iisc.ernet.in</a>&gt;&lt;<a href="msg00670.html">20061012111315.45mxl17exscs404s@webmail.fsu.edu</a>&gt;&lt;<a href="msg00672.html">Pine.LNX.4.58.0610122154450.13389@caos.iisc.ernet.in</a>&gt;&lt;20061016123427.xpt7knm1foo44kgg@webmail.fsu.edu&gt;&lt;Pine.LNX.4.58.0610162333450.7927@caos.iisc.ernet.in&gt;&lt;<a href="msg00679.html">20061016145540.7p7f1xo680o488co@webmail.fsu.edu</a>&gt; &lt;<a href="msg00682.html">4533F7E2.6000404@noaa.gov</a>&gt;</li>
<li>Sender: <a href="mailto:owner-ferret_users@DOMAIN.HIDDEN">owner-ferret_users@xxxxxxxxxxxxx</a></li>
<li>User-agent: Internet Messaging Program (IMP) H3 (4.0.4)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
Hi Ansley,<br>
 Yes, I think that is more clear than before.  When someone wants to 
know about @AVE, they may not go to the &quot;General information about 
transformations&quot; section and thus miss out on this important point.   I 
think this is a very easy mistake to make, using coordinates for @AVE 
and expecting to get an arithmetic mean back.  The difference between 
using coordinates and indices in the mean doesn't amount to a whole lot 
of numerical diffferences (at least for some of the cases I have seen), 
which adds a bit to the confusion since there are no glaring 
discrepancies.<br>
<br>
Thanks for your reply.<br>
<br>
Steve<br>
<br>
<br>
<br>
Quoting Ansley Manke &lt;ansley.b.manke@noaa.gov&gt;:<br>
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">Hi Steve,<br>
Where are you looking in the documentation?  Sometimes we who write 
docs are too close to it all and can't see where confusion arises. 
There is this paragraph a little ways down under<br>
<br>
*Ch3 Sec2.4.1. * *General information about transformations<br>
*<br>
<br>
<br>
   ...If integration or averaging limits are given as world<br>
   coordinates, the grid boxes at the edges of the region specified are<br>
   weighted according to the fraction of grid box that actually lies<br>
   within the specified region. If the transformation limits are given<br>
   as subscripts, the full box size of each grid point along the axis<br>
   is used---including the first and last subscript given. The region<br>
   information that is listed with the output reflects this.<br>
<br>
<br>
But, I guess that we could also add to the @AVE section, perhaps 
something like the *BOLD* text below.<br>
<br>
*Ch3 Sec2.4.6. * *@AVE---average *<br>
<br>
The transformation @AVE computes the average weighted by grid box 
size---a single number representing the average of the variable 
between two endpoints. *When the endpoints are expressed as 
coordinates, e.g. var[X=3.5:8@AVE], then the average is weighted with 
partial box sizes so that the average extends from exactly x=3.5 to 
8.  If the endpoints are expressed as indices, e.g. var[L=5:12@AVE] 
then entire boxes contribute to the average.<br>
*<br>
<br>
*<br>
*<br>
<br>
<br>
<br>
guimond@coaps.fsu.edu wrote:<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">Hi Jaison,<br>
 Thank you for your response.  This is a very nice review of the 
@AVE functions and something I think should be added to the 
documentation.  It is not obvious how the grid box weights are 
computed from what is given and one could easily trust the values 
when in fact they would be wrong.  I will post this response to the 
group.   So, basically using the calendar format (i.e. 
var[t=02-JAN-2001:05-JAN-2001@AVE]) of @AVE will ALWAYS 
underestimate the mean because of the 0.50 weight on each end.  I 
think another way to get at the correct method would be to:<br>
<br>
let new_var = var[t=02-JAN-2001:05-JAN-2001]<br>
<br>
let new_var_mean = new_var[t=@AVE]<br>
<br>
This computes the mean over all the grid cells in range by removing 
the values from the rest of the data.<br>
<br>
<br>
Any idea why @AVE was created like this?<br>
<br>
<br>
Thanks again,<br>
<br>
Steve<br>
<br>
<br>
Quoting Jaison Kurian &lt;jaison@caos.iisc.ernet.in&gt;:<br>
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em">Hi Steve,<br>
          I faced a simular confusion earlier...that time Ansley<br>
clarified my doubts.<br>
<br>
 Basically over &quot;co-ordinate axes&quot; ie. X/Y/Z/T, @AVE is weigthed<br>
by grid box lenth, based on the specified region. But over &quot;abstract<br>
axes or indices&quot; ie. I/J/K/L it is not. Let us see one example.<br>
<br>
   define axis/t=01-JAN-2001:06-JAN-2001:1/units=days/t0=31-DEC-2000 time<br>
   let var = SIN(t[gt=time])<br>
   set list/precision=10<br>
<br>
   ! first 3-methods to find ave<br>
<br>
   list var[l=2:5@AVE]<br>
   list 
var[t=02-JAN-2001:05-JAN-2001@SUM]/var[t=02-JAN-2001:05-JAN-2001@NGD]<br>
   list var[t=&quot;01-JAN-2001:12&quot;:&quot;05-JAN-2001:12&quot;@AVE]<br>
<br>
   ! fourth method to find ave<br>
<br>
   list var[t=02-JAN-2001:05-JAN-2001@AVE]<br>
<br>
The first 3 list commands will give the same answer, the sum of variable<br>
values from 2nd to 5th devided by number of points, ie. 4. But the last one<br>
will give a different anwer. Let me explain in detail.<br>
<br>
The first time point is &quot;01-JAN-2001:00:00&quot;<br>
  its bounds are  &quot;31-DEC-2000:12:00&quot; and &quot;01-JAN-2001:12:00&quot;<br>
The second time point is &quot;02-JAN-2001:00:00&quot;<br>
  its bounds are &quot;01-JAN-2001:12:00&quot; and &quot;02-JAN-2001:12:00&quot;<br>
<br>
Hence when you are specifying as the starting T for an average<br>
operation as &quot;02-JAN-2001&quot;,only half of the grid box comes after<br>
this time (ie. from &quot;02-JAN-2001:00:00&quot; to &quot;02-JAN-2001:12:00&quot;)<br>
hence this value gets only 0.5 weightage..similar is the case<br>
with the value on &quot;05-JAN-2001&quot;. So, the average<br>
<br>
   var[t=02-JAN-2001:05-JAN-2001@AVE]<br>
<br>
will be computed as<br>
<br>
   (var[t=02-JAN-2001]*0.5+var[t=03-JAN-2001]*1+var[t=04-JAN-2001]*1+<br>
        var[t=05-JAN-2001]*0.5)/3<br>
<br>
This problem is overcome by specifying exact grid boundaries in method<br>
3 above. In method 2 a combination of @SUM and @NGD has been used. Since<br>
@SUM is a non-weighted calculation, this will give the answer without<br>
any problems like method 4 above.<br>
<br>
Back to your question<br>
---------------------<br>
So what should a proper method for simple mean ? Any of first 3 methods<br>
from above example. Then you may ask, how to make it easier with the<br>
time specified on calendar format : here is the trick<br>
<br>
let l1 = L[gt=var,t=02-JAN-2001]<br>
let l2 = L[gt=var,t=05-JAN-2001]<br>
list var[l=`l1`:`l2`@AVE]<br>
<br>
Hope this helps,<br>
<br>
Regards,<br>
<br>
Jaison<br>
<br>
On Mon, 16 Oct 2006 guimond@coaps.fsu.edu wrote:<br>
<br>
<blockquote style="border-left: #0000FF solid 0.1em; margin-left: 0.0em; padding-left: 1.0em"><pre>Hi Jaison,
  I decided to e-mail you separatley about this question and then I
will post the responses to the group.  I have computed some means and I
am questioning how ferret goes about them.  Specifically, I have
computed the time mean of a var between two endpoints, call them t1 and
t2:

let mean1 = var[t=`t1`:`t2`@AVE]

According to the FERRET users guide, this will be the mean over the
&quot;exact&quot; region or from gridpoint to gridpoint, correct?  Now if I do
something like this:

let mean2 = var[l=10:15@AVE], using time steps instead of time values.

I will get a different answer because this method averages from
gridcell to gridcell and not gridpoint to gridpoint, correct?

I am confused on what is the more accurate depiction of the mean here.
I want to average from one single time point, t1, to another time
point, t2.  This is why I used the formula for mean1.  Is this correct
for simple means?

Thanks for your help,
Steve Guimond

----------------------------------------------------------------


</pre>
</blockquote><pre>

</pre>
</blockquote><pre>


----------------------------------------------------------------


</pre>
</blockquote>
--<br>
<br>
~&gt;   ~&gt;   ~&gt;   ~&gt;   ~&gt;   ~&gt;   ~&gt;   ~&gt;   ~&gt;   ~&gt;   ~&gt; Ansley Manke, 
NOAA/PMEL   ansley.b.manke@noaa.gov<br>
7600 Sand Point Way NE, Seattle WA<br>
Phone 206-526-6246,  FAX 206-526-6744<br>
<br>
<br>
<br>
<br>
<br>
</blockquote><pre>


----------------------------------------------------------------


</pre>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00667" href="msg00667.html">[ferret_users] remove zero from x-axis</a></strong>
<ul><li><em>From:</em> guimond</li></ul></li>
<li><strong><a name="00668" href="msg00668.html">Re: [ferret_users] remove zero from x-axis</a></strong>
<ul><li><em>From:</em> Jaison Kurian</li></ul></li>
<li><strong><a name="00670" href="msg00670.html">Re: [ferret_users] remove zero from x-axis</a></strong>
<ul><li><em>From:</em> guimond</li></ul></li>
<li><strong><a name="00672" href="msg00672.html">Re: [ferret_users] remove zero from x-axis</a></strong>
<ul><li><em>From:</em> Jaison Kurian</li></ul></li>
<li><strong><a name="00679" href="msg00679.html">[ferret_users] Details on using @AVE function correctly</a></strong>
<ul><li><em>From:</em> guimond</li></ul></li>
<li><strong><a name="00682" href="msg00682.html">Re: [ferret_users] Details on using @AVE function correctly</a></strong>
<ul><li><em>From:</em> Ansley Manke</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<li>Previous by thread:
<strong><a href="msg00682.html">Re: [ferret_users] Details on using @AVE function correctly</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00673.html">Re: [ferret_users] remove zero from x-axis</a></strong>
</li>

</UL>
<center>[<a href="msg00682.html">Thread Prev</a>][<a href="msg00673.html">Thread Next</a>][<A HREF="threads.html#00683">Index</A>]</center>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<hr>
<font size=-1>
<address>
<a href="http://www.doc.gov">Dept of Commerce</a> / 
<a href="http://www.noaa.gov">NOAA</a> /
<a href="http://www.oar.noaa.gov">OAR</a> /
<a href="http://www.pmel.noaa.gov">PMEL</a> /
<a href="http://tmap.pmel.noaa.gov">TMAP</a>
</address> <br> <a href="http://ferret.pmel.noaa.gov/Ferret/ferret_contact_us.html">Contact Us</a> | <a href="http://www.noaa.gov/privacy.html">Privacy Policy</a> | <a href="http://www.noaa.gov/disclaimer.html">Disclaimer</a> | <a href="accessibility.html">Accessibility Statement</a> 
</font>
<!--X-User-Footer-End-->
</body>
</html>
